<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>å·¥è—¤æ—§äºŒã®åšå®¢</title>
  
  
  <link href="http://huang_zhao.gitee.io/task/atom.xml" rel="self"/>
  
  <link href="http://huang_zhao.gitee.io/task/"/>
  <updated>2020-09-13T14:47:27.295Z</updated>
  <id>http://huang_zhao.gitee.io/task/</id>
  
  <author>
    <name>çˆ±è‚–å½¤çœŸæ˜¯å¤ªå¥½äº†</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Typescriptå…¥é—¨ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹</title>
    <link href="http://huang_zhao.gitee.io/task/2020/09/13/Typescript%E5%AD%A6%E4%B9%A0%E6%97%A5%E5%BF%97/"/>
    <id>http://huang_zhao.gitee.io/task/2020/09/13/Typescript%E5%AD%A6%E4%B9%A0%E6%97%A5%E5%BF%97/</id>
    <published>2020-09-13T14:47:11.000Z</published>
    <updated>2020-09-13T14:47:27.295Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-åŸºæœ¬ä»‹ç»"><a href="#1-åŸºæœ¬ä»‹ç»" class="headerlink" title="1 åŸºæœ¬ä»‹ç»"></a>1 åŸºæœ¬ä»‹ç»</h3><p>tsæ˜¯jsçš„è¶…é›†ï¼Œæ˜¯ç›®å‰å‰ç«¯å¿…å¤‡çš„åŸºç¡€ï¼ŒåŒ…å«äº†es5ï¼Œes6çš„è¯­æ³•</p><p>ä¹Ÿå¯ä»¥é›†æˆåˆ°vueä¸­</p><p>å®‰è£…ï¼šcnpm install -g typescript</p><p>æŸ¥çœ‹ç‰ˆæœ¬ï¼štsc -v</p><p>è¯­è¨€ç±»å‹ï¼šé™æ€å¼±ç±»å‹</p><p>æ— æ³•ç›´æ¥åœ¨æµè§ˆå™¨è¿è¡Œï¼Œéœ€è¦ç¼–è¯‘æˆjsä»£ç </p><h3 id="2-åŸºæœ¬ä½¿ç”¨"><a href="#2-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2 åŸºæœ¬ä½¿ç”¨"></a>2 åŸºæœ¬ä½¿ç”¨</h3><h4 id="2-1-å¦‚ä½•é…ç½®è‡ªåŠ¨ç¼–è¯‘"><a href="#2-1-å¦‚ä½•é…ç½®è‡ªåŠ¨ç¼–è¯‘" class="headerlink" title="2.1 å¦‚ä½•é…ç½®è‡ªåŠ¨ç¼–è¯‘"></a>2.1 å¦‚ä½•é…ç½®è‡ªåŠ¨ç¼–è¯‘</h4><p>ä½¿ç”¨idevï¼švscode</p><p>åœ¨vscodeä¸­åœ¨é¡¹ç›®ä¸‹cmdçª—å£è¾“å…¥<code>tsc --init</code>å°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª.jsonçš„é…ç½®æ–‡ä»¶</p><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­</p><pre class=" language-ts"><code class="language-ts"><span class="token comment" spellcheck="true">// é»˜è®¤æ˜¯æ³¨é‡Šçš„è§£å¼€æ³¨é‡Šå³å¯</span><span class="token string">"outDir"</span><span class="token punctuation">:</span> <span class="token string">"./js"</span><span class="token comment" spellcheck="true">// ä¼šæŠŠç¼–è¯‘å®Œæˆçš„tsä»£ç æ”¾åˆ°jsç›®å½•ä¸‹çš„æ–‡ä»¶ä¸­</span></code></pre><p>ç„¶åç‚¹å‡»ç»ˆç«¯â€“typescriptâ€“ç›‘è§†é…ç½®æ–‡ä»¶</p><p>å¦‚æœæŠ¥é”™9æˆæ˜¯å› ä¸ºtscæƒé™ä¸è¶³</p><p>è§£å†³æ–¹å¼ï¼šä»¥ç®¡ç†å‘˜æ–¹å¼æ‰“å¼€cmd</p><p>è¾“å…¥<code>set-ExecutionPolicy RemoteSigned</code></p><p>å†è¾“å…¥Aæˆ–è€…Yå³å¯</p><h3 id="3-æ•°æ®ç±»å‹"><a href="#3-æ•°æ®ç±»å‹" class="headerlink" title="3 æ•°æ®ç±»å‹"></a>3 æ•°æ®ç±»å‹</h3><h4 id="3-1-æ•°æ®ç±»å‹å®šä¹‰"><a href="#3-1-æ•°æ®ç±»å‹å®šä¹‰" class="headerlink" title="3.1 æ•°æ®ç±»å‹å®šä¹‰"></a>3.1 æ•°æ®ç±»å‹å®šä¹‰</h4><pre class=" language-ts"><code class="language-ts"><span class="token comment" spellcheck="true">// å¸ƒå°”ç±»å‹ boolean</span><span class="token keyword">let</span> boo<span class="token punctuation">:</span><span class="token keyword">boolean</span> <span class="token operator">=</span> <span class="token keyword">true</span><span class="token comment" spellcheck="true">// letå…³é”®å­— å˜é‡å:å˜é‡ç±»å‹ = å€¼</span></code></pre><h4 id="3-2-æ•°å­—ç±»å‹-number"><a href="#3-2-æ•°å­—ç±»å‹-number" class="headerlink" title="3.2 æ•°å­—ç±»å‹(number)"></a>3.2 æ•°å­—ç±»å‹(number)</h4><pre class=" language-ts"><code class="language-ts"><span class="token keyword">let</span> num<span class="token punctuation">:</span><span class="token keyword">number</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token keyword">let</span> num<span class="token punctuation">:</span><span class="token keyword">number</span> <span class="token operator">=</span> <span class="token number">123.3</span><span class="token comment" spellcheck="true">// æ•°å€¼ç±»å‹åŒ…æ‹¬æ•´å½¢å’Œæµ®ç‚¹å‹</span></code></pre><h4 id="3-3-å­—ç¬¦ç±»å‹ï¼ˆstringï¼‰"><a href="#3-3-å­—ç¬¦ç±»å‹ï¼ˆstringï¼‰" class="headerlink" title="3.3 å­—ç¬¦ç±»å‹ï¼ˆstringï¼‰"></a>3.3 å­—ç¬¦ç±»å‹ï¼ˆstringï¼‰</h4><pre class=" language-ts"><code class="language-ts"><span class="token keyword">let</span> str<span class="token punctuation">:</span><span class="token keyword">string</span> <span class="token operator">=</span> <span class="token string">"hz"</span></code></pre><h4 id="3-4-æ•°ç»„ç±»å‹ï¼ˆarrayï¼‰"><a href="#3-4-æ•°ç»„ç±»å‹ï¼ˆarrayï¼‰" class="headerlink" title="3.4 æ•°ç»„ç±»å‹ï¼ˆarrayï¼‰"></a>3.4 æ•°ç»„ç±»å‹ï¼ˆarrayï¼‰</h4><pre class=" language-ts"><code class="language-ts"><span class="token comment" spellcheck="true">// æ•°ç»„åœ¨å®šä¹‰çš„æ—¶å€™å¿…é¡»æŒ‡å®šå†…éƒ¨çš„ç±»å‹</span><span class="token comment" spellcheck="true">// ç¬¬ä¸€ç§å®šä¹‰æ–¹å¼</span><span class="token keyword">let</span> test_arry1<span class="token punctuation">:</span><span class="token keyword">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">456</span><span class="token punctuation">]</span><span class="token keyword">let</span> test_arry2<span class="token punctuation">:</span><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"hz"</span><span class="token punctuation">,</span><span class="token string">"lxt"</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// æ¨èç”¨åŒå¼•å·</span><span class="token comment" spellcheck="true">// ç¬¬äºŒç§å®šä¹‰æ–¹å¼</span><span class="token keyword">let</span> test_arry3<span class="token punctuation">:</span><span class="token keyword">Array</span><span class="token operator">&lt;</span><span class="token keyword">number</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">// ç¬¬ä¸‰ç§å®šä¹‰æ–¹å¼</span><span class="token comment" spellcheck="true">// é€šè¿‡anyç±»å‹å°±å¯ä»¥æ”¾ä»»æ„ç±»å‹</span><span class="token keyword">let</span> arr<span class="token punctuation">:</span><span class="token keyword">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'123'</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">,</span><span class="token keyword">true</span><span class="token punctuation">]</span></code></pre><h4 id="3-5-å…ƒç»„ç±»å‹ï¼ˆtupleï¼‰"><a href="#3-5-å…ƒç»„ç±»å‹ï¼ˆtupleï¼‰" class="headerlink" title="3.5 å…ƒç»„ç±»å‹ï¼ˆtupleï¼‰"></a>3.5 å…ƒç»„ç±»å‹ï¼ˆtupleï¼‰</h4><pre class=" language-ts"><code class="language-ts"><span class="token comment" spellcheck="true">// å¯ä»¥å®šä¹‰å†…éƒ¨ç±»å‹çš„æ•°ç»„ï¼Œå¿…é¡»ä¸€ä¸€å¯¹åº”</span><span class="token comment" spellcheck="true">// å…ƒç»„ç±»å‹ï¼ˆæ•°ç»„çš„ä¸€ç§ï¼‰</span><span class="token keyword">let</span> test_arry4<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token keyword">number</span><span class="token punctuation">,</span><span class="token keyword">string</span><span class="token punctuation">,</span><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"hz"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">"hz"</span><span class="token punctuation">,</span><span class="token string">"nb"</span><span class="token punctuation">]</span><span class="token punctuation">]</span></code></pre><h4 id="3-6-æšä¸¾ç±»å‹ï¼ˆenumï¼‰"><a href="#3-6-æšä¸¾ç±»å‹ï¼ˆenumï¼‰" class="headerlink" title="3.6 æšä¸¾ç±»å‹ï¼ˆenumï¼‰"></a>3.6 æšä¸¾ç±»å‹ï¼ˆenumï¼‰</h4><pre class=" language-ts"><code class="language-ts"><span class="token comment" spellcheck="true">// æšä¸¾ç±»å‹ï¼Œç›¸å½“äºåˆ›å»ºä¸€ç§æ–°çš„ç±»å‹ï¼Œé€šè¿‡æ ‡è¯†ç¬¦å’Œæ•°å€¼çš„å¯¹åº”æ¥è¡¨ç¤ºå€¼ç±»</span><span class="token comment" spellcheck="true">// ç”¨äºæ ‡è¯†ä¸€ç§çŠ¶æ€</span><span class="token keyword">enum</span> Flag <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>success<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>error<span class="token operator">=</span><span class="token number">2</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">var</span> f<span class="token punctuation">:</span>Flag <span class="token operator">=</span> Flag<span class="token punctuation">.</span>success console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Flag<span class="token punctuation">.</span>error<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//2 </span><span class="token comment" spellcheck="true">// å¦‚æœæšä¸¾ç±»å‹æ²¡æœ‰å®šä¹‰å€¼ï¼Œæ‰“å°çš„å°±æ˜¯ç´¢å¼•å€¼</span><span class="token keyword">enum</span> Color <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>red<span class="token punctuation">,</span>blue<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>green<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">var</span> c<span class="token punctuation">:</span>Color <span class="token operator">=</span> Color<span class="token punctuation">.</span>redconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>blue<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 5</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>green<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 6 å¦‚æœä¸Šä¸€ä¸ªå¯¹åº”å€¼ä¸æ˜¯ç´¢å¼•ï¼Œå°±ä¼šæŒ‰ç…§ä¸Šä¸€ä¸ªå€¼é€’å¢1</span></code></pre><h4 id="3-7-ä»»æ„ç±»å‹ï¼ˆanyï¼‰"><a href="#3-7-ä»»æ„ç±»å‹ï¼ˆanyï¼‰" class="headerlink" title="3.7 ä»»æ„ç±»å‹ï¼ˆanyï¼‰"></a>3.7 ä»»æ„ç±»å‹ï¼ˆanyï¼‰</h4><pre class=" language-ts"><code class="language-ts"><span class="token comment" spellcheck="true">// ä»»æ„ç±»å‹ any</span><span class="token keyword">let</span> data<span class="token punctuation">:</span><span class="token keyword">any</span> <span class="token operator">=</span> <span class="token number">123</span>data <span class="token operator">=</span> <span class="token string">'123'</span><span class="token comment" spellcheck="true">// ä»»æ„ç±»å‹çš„ç”¨é€”</span><span class="token comment" spellcheck="true">// å½“æˆ‘ä»¬éœ€è¦ç”¨å˜é‡æ¥å—ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œjsä¸­æ˜¯å¯ä»¥ç›´æ¥æ¥å—</span><span class="token comment" spellcheck="true">// å¿…é¡»æŒ‡å®šany</span><span class="token keyword">let</span> oBox<span class="token punctuation">:</span><span class="token keyword">any</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'box'</span><span class="token punctuation">)</span>oBox<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'red'</span></code></pre><h4 id="3-8-å…¶ä»–ç±»å‹ï¼ˆneverç±»å‹ï¼‰çš„å­ç±»å‹"><a href="#3-8-å…¶ä»–ç±»å‹ï¼ˆneverç±»å‹ï¼‰çš„å­ç±»å‹" class="headerlink" title="3.8 å…¶ä»–ç±»å‹ï¼ˆneverç±»å‹ï¼‰çš„å­ç±»å‹"></a>3.8 å…¶ä»–ç±»å‹ï¼ˆneverç±»å‹ï¼‰çš„å­ç±»å‹</h4><p>ä»£è¡¨ä»ä¸ä¼šå‡ºç°çš„å€¼</p><p>ä»¥ä¸ºè¿™neverç±»å‹çš„å˜é‡åªèƒ½è¢«ç±»å‹æ‰€èµ‹å€¼</p><pre class=" language-ts"><code class="language-ts"><span class="token comment" spellcheck="true">// å…¶ä»–ç±»å‹ï¼ˆneverç±»å‹ï¼‰çš„å­ç±»å‹</span><span class="token comment" spellcheck="true">//undefined</span><span class="token comment" spellcheck="true">// numæ­¤æ—¶åªèƒ½è¢«èµ‹å€¼undefined</span><span class="token keyword">var</span> num<span class="token punctuation">:</span>undefinedconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// å¦‚æœè¢«èµ‹å€¼å°±æ˜¯numberç±»å‹ï¼Œæ²¡èµ‹å€¼å°±æ˜¯undefinedç±»å‹</span><span class="token keyword">var</span> num<span class="token punctuation">:</span><span class="token keyword">number</span> <span class="token operator">|</span> undefinedconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// null</span><span class="token comment" spellcheck="true">// undefinedå¯ä»¥ä¸èµ‹å€¼æ˜¯å› ä¸ºä»–ä¸ä»…å¯ä»¥ä½œä¸ºç±»å‹ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå€¼ï¼Œè€Œnullä¸ä¸€æ ·ï¼Œå¦‚æœè¦å®šä¹‰nullç±»å‹å°±å¿…é¡»èµ‹å€¼nullå€¼</span><span class="token keyword">var</span> num1<span class="token punctuation">:</span><span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num1<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// ç»¼åˆè¿ç”¨</span><span class="token comment" spellcheck="true">// å¦‚æœæˆ‘ä»¬å¯¹ä¸€ä¸ªå€¼çš„ç±»å‹ä¸èƒ½ç¡®å®šï¼Œä¸ä»…å¯ä»¥ç”¨anyï¼Œä¹Ÿå¯ä»¥ç”¨|åˆ†éš”å¯èƒ½å‡ºç°çš„ç±»å‹</span><span class="token keyword">let</span> num<span class="token punctuation">:</span><span class="token keyword">number</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">|</span> undefinedconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// undefined</span>num <span class="token operator">=</span> <span class="token keyword">null</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// null</span>num <span class="token operator">=</span> <span class="token number">123</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 123</span></code></pre><h4 id="3-9-voidè¡¨ç¤ºæ²¡æœ‰ä»»ä½•ç±»å‹"><a href="#3-9-voidè¡¨ç¤ºæ²¡æœ‰ä»»ä½•ç±»å‹" class="headerlink" title="3.9 voidè¡¨ç¤ºæ²¡æœ‰ä»»ä½•ç±»å‹"></a>3.9 voidè¡¨ç¤ºæ²¡æœ‰ä»»ä½•ç±»å‹</h4><p>ä¸€èˆ¬ç”¨äºå®šä¹‰æ–¹æ³•çš„æ—¶å€™æ²¡æœ‰ä»»ä½•è¿”å›å€¼</p><pre class=" language-ts"><code class="language-ts"><span class="token comment" spellcheck="true">// è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•æ²¡æœ‰è¿”å›å€¼</span><span class="token keyword">function</span> <span class="token function">run1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">void</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'456'</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token function">run1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// å¦‚æœä¸€ä¸ªæ–¹æ³•æœ‰è¿”å›å€¼ï¼Œå°±æŒ‡å®šè¿”å›å€¼ç±»å‹</span><span class="token keyword">function</span> <span class="token function">run1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">number</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">123</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">run1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;1-åŸºæœ¬ä»‹ç»&quot;&gt;&lt;a href=&quot;#1-åŸºæœ¬ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;1 åŸºæœ¬ä»‹ç»&quot;&gt;&lt;/a&gt;1 åŸºæœ¬ä»‹ç»&lt;/h3&gt;&lt;p&gt;tsæ˜¯jsçš„è¶…é›†ï¼Œæ˜¯ç›®å‰å‰ç«¯å¿…å¤‡çš„åŸºç¡€ï¼ŒåŒ…å«äº†es5ï¼Œes6çš„è¯­æ³•&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥é›†æˆåˆ°vueä¸­&lt;/p</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="å‰ç«¯" scheme="http://huang_zhao.gitee.io/task/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="tsåŸºç¡€" scheme="http://huang_zhao.gitee.io/task/tags/ts%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>HTTPåè®®æŸ¥æ¼è¡¥ç¼º</title>
    <link href="http://huang_zhao.gitee.io/task/2020/09/13/HTTP%E5%8D%8F%E8%AE%AE%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/"/>
    <id>http://huang_zhao.gitee.io/task/2020/09/13/HTTP%E5%8D%8F%E8%AE%AE%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/</id>
    <published>2020-09-13T05:20:11.000Z</published>
    <updated>2020-09-13T14:49:49.586Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€HTTPåè®®ç‰ˆæœ¬åŒºåˆ«"><a href="#ä¸€ã€HTTPåè®®ç‰ˆæœ¬åŒºåˆ«" class="headerlink" title="ä¸€ã€HTTPåè®®ç‰ˆæœ¬åŒºåˆ«"></a>ä¸€ã€HTTPåè®®ç‰ˆæœ¬åŒºåˆ«</h3><ul><li>0.9 è¿œå¤ç‰ˆæœ¬ï¼Œåªæœ‰ä¸€ä¸ªGETå‘½ä»¤ï¼Œåªæ”¯æŒçº¯æ–‡æœ¬</li><li>1.1 ä¸»æµç‰ˆæœ¬<ul><li>å¼•å…¥äº†æŒä¹…é“¾æ¥ï¼Œé€šè¿‡è¯·æ±‚å¤´ä¸­çš„<code> keep-alive</code>æ¥è®¾ç½®</li><li>å¼•å…¥äº†ç®¡é“æœºåˆ¶ï¼ŒåŒä¸€ä¸ªtcpé“¾æ¥å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚</li><li>æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œè¯·æ±‚å¤´ä¸­çš„<code> range</code>æ¥å®ç°</li><li>ä½¿ç”¨äº†è™šæ‹Ÿç½‘ç»œï¼Œä¸€ä¸ªç‰©ç†æœºä¸Šå¯ä»¥å­˜åœ¨å¤šä¸ªè™šæ‹Ÿä¸»æœºï¼Œå…±äº«ä¸€ä¸ªipåœ°å€</li></ul></li><li>2.0 å…ˆè¿›ç‰ˆæœ¬<ul><li>äºŒè¿›åˆ¶åˆ†å¸§ï¼šå¤´ä¿¡æ¯å’Œæ•°æ®ä½“éƒ½æ˜¯äºŒè¿›åˆ¶</li><li>å¤´éƒ¨å‹ç¼©ï¼šåœ¨1.1ç‰ˆæœ¬å¤´éƒ¨ä¿¡æ¯ä¼šåé‡ï¼Œè€Œbodyåªæœ‰å‡ åä¸ªå­—èŠ‚ï¼Œé€šè¿‡HPACKç®—æ³•è¿›è¡Œäºšç´¢</li><li>å¤šè·¯å¤ç”¨ï¼šä¸€ä¸ªTCPé“¾æ¥ï¼Œå“­æŠ¤çŸ­å’Œæµè§ˆå™¨éƒ½å¯ä»¥åŒæ—¶å‘å‡ºå¤šä¸ªè¯·æ±‚ï¼Œä¸ç”¨æŒ‰é¡ºåºä¸€ä¸€å¯¹åº”ï¼Œè§£å†³äº†é˜Ÿå¤´é˜»å¡çš„é—®é¢˜</li><li>è¯·æ±‚ä¼˜å…ˆçº§ï¼šå¯ä»¥è®¾ç½®æ•°æ®å¸§çš„ä¼˜å…ˆçº§ï¼Œè®©æœåŠ¡å™¨å…ˆå¤„ç†é‡è¦çš„è¯·æ±‚</li></ul></li></ul><h3 id="äºŒã€çŠ¶æ€ç "><a href="#äºŒã€çŠ¶æ€ç " class="headerlink" title="äºŒã€çŠ¶æ€ç "></a>äºŒã€çŠ¶æ€ç </h3><ul><li>1xxï¼šä»£è¡¨è¯·æ±‚å·²ç»è¢«æ¥å—ï¼Œéœ€è¦åç»­å¤„ç†</li><li>2xxï¼šè¡¨ç¤ºæˆåŠŸ</li><li>3xxï¼šé‡å®šå‘çŠ¶æ€</li><li>4xxï¼šå®¢æˆ·ç«¯æœ‰è¯¯</li><li>5xxï¼šæœåŠ¡å™¨é”™è¯¯</li></ul><h4 id="1xx-ä¿¡æ¯ç±»"><a href="#1xx-ä¿¡æ¯ç±»" class="headerlink" title="1xx ä¿¡æ¯ç±»"></a>1xx ä¿¡æ¯ç±»</h4><p>æ¥å—çš„è¯·æ±‚æ­£åœ¨å¤„ç†ï¼Œä¿¡æ¯ç±»çŠ¶æ€ç </p><h4 id="2xx-æˆåŠŸ"><a href="#2xx-æˆåŠŸ" class="headerlink" title="2xx æˆåŠŸ"></a>2xx æˆåŠŸ</h4><ul><li><p>200 OK è¡¨ç¤ºä»å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚åœ¨æœåŠ¡å™¨ç«¯è¢«æ­£ç¡®è¯·æ±‚ã€‚</p></li><li><p>204 No contentï¼Œè¡¨ç¤ºè¯·æ±‚æˆåŠŸï¼Œä½†æ²¡æœ‰èµ„æºå¯è¿”å›ã€‚</p></li><li><p>206 Partial Contentï¼Œè¯¥çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯è¿›è¡Œäº†èŒƒå›´è¯·æ±‚ï¼Œè€ŒæœåŠ¡å™¨æˆåŠŸæ‰§è¡Œäº†è¿™éƒ¨åˆ†çš„ GET è¯·æ±‚ å“åº”æŠ¥æ–‡ä¸­åŒ…å«ç”± <strong>ã€ŒContent-Rangeã€</strong> æŒ‡å®šèŒƒå›´çš„å®ä½“å†…å®¹ã€‚</p></li></ul><h4 id="3xx-é‡å®šå‘"><a href="#3xx-é‡å®šå‘" class="headerlink" title="3xx é‡å®šå‘"></a>3xx é‡å®šå‘</h4><ul><li>301 moved permanentlyï¼Œæ°¸ä¹…æ€§é‡å®šå‘ï¼Œè¡¨ç¤ºèµ„æºå·²è¢«åˆ†é…äº†æ–°çš„ URLï¼Œè¿™æ—¶åº”è¯¥æŒ‰ Location é¦–éƒ¨å­—æ®µæç¤ºçš„ URI é‡æ–°ä¿å­˜ã€‚</li><li>302 foundï¼Œä¸´æ—¶æ€§é‡å®šå‘ï¼Œè¡¨ç¤ºèµ„æºä¸´æ—¶è¢«åˆ†é…äº†æ–°çš„ URLã€‚</li><li>303 see otherï¼Œè¡¨ç¤ºèµ„æºå­˜åœ¨ç€å¦ä¸€ä¸ª URLï¼Œåº”ä½¿ç”¨ GET æ–¹æ³•è·å–èµ„æºã€‚</li><li>304 not modifiedï¼Œå½“åå•†ç¼“å­˜å‘½ä¸­æ—¶ä¼šè¿”å›è¿™ä¸ªçŠ¶æ€ç ã€‚</li><li>307 temporary redirectï¼Œä¸´æ—¶é‡å®šå‘ï¼Œå’Œ302å«ä¹‰ç›¸åŒ,ä¸ä¼šæ”¹å˜method</li></ul><p>æ³¨æ„åŒºåˆ†ï¼š301ï¼ˆæ°¸ä¹…é‡å®šå‘ï¼‰ï¼Œ302ï¼ˆä¸´æ—¶é‡å®šå‘ï¼‰</p><h4 id="4xx-å®¢æˆ·ç«¯é”™è¯¯"><a href="#4xx-å®¢æˆ·ç«¯é”™è¯¯" class="headerlink" title="4xx å®¢æˆ·ç«¯é”™è¯¯"></a>4xx å®¢æˆ·ç«¯é”™è¯¯</h4><ul><li>400 bad requestï¼Œè¯·æ±‚æŠ¥æ–‡å­˜åœ¨è¯­æ³•é”™è¯¯ã€‚</li><li>401 unauthorizedï¼Œè¡¨ç¤ºå‘é€çš„è¯·æ±‚éœ€è¦æœ‰é€šè¿‡ HTTP è®¤è¯çš„è®¤è¯ä¿¡æ¯ã€‚</li><li>403 forbiddenï¼Œè¡¨ç¤ºå¯¹è¯·æ±‚èµ„æºçš„è®¿é—®è¢«æœåŠ¡å™¨æ‹’ç»ï¼Œå¯èƒ½é‡åˆ°è·¨ç«™è¯·æ±‚ä¼ªé€ </li><li>404 not foundï¼Œè¡¨ç¤ºåœ¨æœåŠ¡å™¨ä¸Šæ²¡æœ‰æ‰¾åˆ°è¯·æ±‚çš„èµ„æºï¼Œå¯èƒ½æ˜¯ç½‘å€è¾“é”™äº†</li><li>405 Method Not Allowedï¼ŒæœåŠ¡å™¨ç¦æ­¢ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡optionsæ–¹æ³•æ¥æŸ¥çœ‹æœåŠ¡å™¨å…è®¸çš„è®¿é—®æ–¹æ³•ï¼Œå¯èƒ½é‡åˆ°äº†corsï¼Œè·¨åŸŸé—®é¢˜</li></ul><h4 id="5xx-æœåŠ¡å™¨é”™è¯¯"><a href="#5xx-æœåŠ¡å™¨é”™è¯¯" class="headerlink" title="5xx æœåŠ¡å™¨é”™è¯¯"></a>5xx æœåŠ¡å™¨é”™è¯¯</h4><ul><li>500 internal sever errorï¼Œè¡¨ç¤ºæœåŠ¡å™¨ç«¯åœ¨æ‰§è¡Œè¯·æ±‚æ—¶å‘ç”Ÿäº†é”™è¯¯ã€‚</li><li>502 Bad Gatewayï¼ŒæœåŠ¡å™¨è‡ªèº«æ˜¯æ­£å¸¸çš„ï¼Œè®¿é—®çš„æ—¶å€™å‡ºäº†é—®é¢˜ï¼Œå…·ä½“å•¥é”™è¯¯æˆ‘ä»¬ä¸çŸ¥é“ã€‚</li><li>503 service unavailableï¼Œè¡¨æ˜æœåŠ¡å™¨æš‚æ—¶å¤„äºè¶…è´Ÿè½½æˆ–æ­£åœ¨åœæœºç»´æŠ¤ï¼Œæ— æ³•å¤„ç†è¯·æ±‚ã€‚</li></ul><h3 id="ä¸‰ã€HTTPçš„ç¼“å­˜ç­–ç•¥"><a href="#ä¸‰ã€HTTPçš„ç¼“å­˜ç­–ç•¥" class="headerlink" title="ä¸‰ã€HTTPçš„ç¼“å­˜ç­–ç•¥"></a>ä¸‰ã€HTTPçš„ç¼“å­˜ç­–ç•¥</h3><h4 id="1-å¼ºç¼“å­˜"><a href="#1-å¼ºç¼“å­˜" class="headerlink" title="1 å¼ºç¼“å­˜"></a>1 å¼ºç¼“å­˜</h4><p>ä¸¤ä¸ªå…³é”®å­—æ®µï¼šExpiresï¼ŒCache-Control</p><p>HTTP1.0ç‰ˆæœ¬ï¼Œä½¿ç”¨çš„æ˜¯Expiresï¼ŒHTTP1.1ä½¿ç”¨çš„æ˜¯Cache-Control</p><ul><li>Expiresè¡¨ç¤ºè¿‡æœŸæ—¶é—´ï¼Œæ—¶é—´æ˜¯ç›¸å¯¹äºæœåŠ¡å™¨æ—¶é—´è€Œè¨€ï¼Œæ‰€ä»¥å¯èƒ½å› ä¸ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ—¶é—´ä¸ä¸€è‡´è€Œå‡ºé”™</li><li>Cache-Control è¡¨ç¤ºè¿‡æœŸæ—¶é•¿ï¼Œä»ç°åœ¨å¼€å§‹å¤šå°‘ç§’è¿‡æœŸï¼Œè¿™æ ·å°±é¿å…äº†ä¸¤ç«¯æ—¶é—´ä¸ä¸€è‡´çš„é—®é¢˜</li></ul><p>æ³¨æ„ç‚¹ï¼š</p><ul><li>å½“Expireså’ŒCache-ControlåŒæ—¶å­˜åœ¨æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘Cache-Controlã€‚</li><li>å½“ç„¶äº†ï¼Œå½“ç¼“å­˜èµ„æºå¤±æ•ˆäº†ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å‘½ä¸­å¼ºç¼“å­˜ï¼Œæ¥ä¸‹æ¥å°±è¿›å…¥åå•†ç¼“å­˜ğŸ‘‡</li></ul><h4 id="2-åå•†ç¼“å­˜"><a href="#2-åå•†ç¼“å­˜" class="headerlink" title="2 åå•†ç¼“å­˜"></a>2 åå•†ç¼“å­˜</h4><p>å¼ºç¼“å­˜å¤±æ•ˆåï¼Œæµè§ˆå™¨å°±ä¼šåœ¨è¯·æ±‚å¤´ä¸­æºå¸¦å“åº”çš„ç¼“å­˜Tagå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ ¹æ®tagå†³å®šæ˜¯å¦ä½¿ç”¨ç¼“å­˜</p><p>ç¼“å­˜åˆ†æˆä¸¤ç§ï¼š<strong>ã€ŒLast-Modifiedã€</strong> å’Œ <strong>ã€ŒETagã€</strong></p><h5 id="2-1-Last-Modified"><a href="#2-1-Last-Modified" class="headerlink" title="2.1 Last-Modified"></a>2.1 Last-Modified</h5><p>è¡¨ç¤ºæœ€åä¿®æ”¹æ—¶é—´ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨çš„å“åº”å¤´ä¼šå¸¦ä¸Šè¿™ä¸ªå‚æ•°ï¼Œç„¶åè¿™ä¸ªå‚æ•°ä¼šåœ¨ä¸‹ä¸€æ¬¡ç¼“å­˜æœªå‘½ä¸­çš„æ—¶å€™åŠ å…¥åˆ°è¯·æ±‚å¤´æ”¹ä¸ºï¼š<strong>If-Modified-Since</strong>ï¼Œkeyä¸åŒï¼Œä½†æ˜¯valueç›¸åŒï¼ŒæœåŠ¡å™¨æ‹¿åˆ°è¿™ä¸ªå­—æ®µåï¼Œå°±ä¼šå’Œè¯·æ±‚èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´å¯¹æ¯”</p><ul><li>å¦‚æœè¯·æ±‚å¤´çš„æ—¶é—´æ›´ä¹…è¿œï¼Œè¯´æ˜è¿™ä¸ªæ•°æ®å·²ç»å‘ç”Ÿäº†æ”¹å˜å°±è¦è·Ÿæ–°è¿™ä¸ªç¼“å­˜äº†ï¼Œè¿”å›æ–°çš„èµ„æº</li><li>å¦åˆ™è¿”å›304å‘Šè¯‰æµè§ˆå™¨ç›´æ¥ä½¿ç”¨ç¼“å­˜</li></ul><h5 id="2-2-ETag"><a href="#2-2-ETag" class="headerlink" title="2.2 ETag"></a>2.2 ETag</h5><p>æœ¬è´¨å°±æ˜¯å¯¹è¯·æ±‚çš„èµ„æºé€šè¿‡md5ç®—æ³•è¿ç®—ï¼Œç”Ÿæˆçš„ç»“æœå“ªæ€•åŠ¨äº†ä¸€ä¸ªå­—èŠ‚éƒ½ç®—æ˜¯ä¿®æ”¹ï¼Œå­˜å‚¨å’Œè¯·æ±‚æ–¹å¼å’Œä¸Šé¢ç›¸ä¼¼</p><p>æµè§ˆå™¨æ¥å—åˆ°ETagå€¼ï¼Œä¼šåœ¨ä¸‹æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œå°†è¿™ä¸ªå€¼ä½œä¸º<strong>ã€ŒIf-None-Matchã€</strong>è¿™ä¸ªå­—æ®µçš„å†…å®¹ï¼Œå‘ç»™æœåŠ¡å™¨ã€‚</p><p>æœåŠ¡å™¨æ¥æ”¶åˆ°<strong>ã€ŒIf-None-Matchã€</strong>åï¼Œä¼šè·ŸæœåŠ¡å™¨ä¸Šè¯¥èµ„æºçš„<strong>ã€ŒETagã€</strong>è¿›è¡Œæ¯”å¯¹ğŸ‘‡</p><ul><li>å¦‚æœä¸¤è€…ä¸€æ ·çš„è¯ï¼Œç›´æ¥è¿”å›304ï¼Œå‘Šè¯‰æµè§ˆå™¨ç›´æ¥ä½¿ç”¨ç¼“å­˜</li><li>å¦‚æœä¸ä¸€æ ·çš„è¯ï¼Œè¯´æ˜å†…å®¹æ›´æ–°äº†ï¼Œè¿”å›æ–°çš„èµ„æºï¼Œè·Ÿå¸¸è§„çš„HTTPè¯·æ±‚å“åº”çš„æµç¨‹ä¸€æ ·</li></ul><h5 id="2-3-æ€»ç»“ï¼š"><a href="#2-3-æ€»ç»“ï¼š" class="headerlink" title="2.3 æ€»ç»“ï¼š"></a>2.3 æ€»ç»“ï¼š</h5><p>åå•†ç¼“å­˜çš„ä¸¤ç§æ–¹å¼</p><ul><li>æ€§èƒ½ä¸Šï¼šLast-Modifiedæ›´å¥½ï¼Œå› ä¸ºetagéœ€è¦è¿ç®—</li><li>ç²¾åº¦ä¸Šï¼šetagæ›´å¥½ï¼Œæ¯”å¦‚è¯´æŸä¸ªèµ„æºæ–‡ä»¶ï¼Œåªæ˜¯touchäº†ä¸€ä¸‹ï¼Œå¹¶æ²¡æœ‰ä¿®æ”¹å†…å®¹ï¼Œåœ¨ä¿®æ”¹æ—¶é—´ä¸Šæ˜¯æ›´æ–°äº†ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šå†…å®¹æ²¡å˜ã€‚</li><li>å¦‚æœä¸¤ç§æ–¹å¼éƒ½æ”¯æŒï¼Œä¼˜å…ˆè€ƒè™‘etag</li></ul><h4 id="3-ç¼“å­˜ä½ç½®"><a href="#3-ç¼“å­˜ä½ç½®" class="headerlink" title="3 ç¼“å­˜ä½ç½®"></a>3 ç¼“å­˜ä½ç½®</h4><p>æ€»ç»“æ¥è¯´ï¼šå¤§çš„jsï¼Œcssç¼“å­˜æ˜¯æ”¾åœ¨ç£ç›˜ä¸­ï¼Œä¸€äº›å°çš„èµ„æºç±»æ˜¯æ”¾åœ¨å†…å­˜ä¸­</p><h4 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4 æ€»ç»“"></a>4 æ€»ç»“</h4><ul><li><p>é¦–å…ˆæ£€æŸ¥<code>Cache-Control</code>ï¼Œ å°é²œï¼Œçœ‹å¼ºç¼“å­˜æ˜¯å¦å¯ç”¨</p></li><li><p>å¦‚æœå¯ç”¨çš„è¯ï¼Œç›´æ¥ä½¿ç”¨</p></li><li><p>å¦åˆ™è¿›å…¥åå•†ç¼“å­˜ï¼Œå‘é€HTTPè¯·æ±‚ï¼ŒæœåŠ¡å™¨é€šè¿‡è¯·æ±‚å¤´ä¸­çš„<code>If-Modified-Since</code>æˆ–è€…<code>If-None-Match</code>å­—æ®µæ£€æŸ¥èµ„æºæ˜¯å¦æ›´æ–°</p></li><li><p>èµ„æºæ›´æ–°ï¼Œè¿”å›èµ„æºå’Œ200çŠ¶æ€ç ã€‚</p></li><li><p>å¦åˆ™ï¼Œè¿”å›304ï¼Œç›´æ¥å‘Šè¯‰æµè§ˆå™¨ç›´æ¥ä»ç¼“å­˜ä¸­å»èµ„æºã€‚</p></li></ul><h3 id="å››ã€HTTPå’ŒHTTPS"><a href="#å››ã€HTTPå’ŒHTTPS" class="headerlink" title="å››ã€HTTPå’ŒHTTPS"></a>å››ã€HTTPå’ŒHTTPS</h3><p>HTTPSä¸æ˜¯ä¸€ä¸ªè¡Œçš„åº”ç”¨å±‚åè®®ï¼Œæœ¬è´¨æ˜¯HTTP+TLS/SSLåè®®çš„ç»„åˆï¼Œä¿è¯å®‰å…¨æ€§æ˜¯SSL/TLSçš„å·¥ä½œ</p><ul><li>SSLï¼šå®‰å…¨å¥—æ¥å±‚2</li><li>TLSï¼šä¼ è¾“å±‚å®‰å…¨ï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰</li></ul><p>HTTPSçš„å…³é”®ï¼š</p><ul><li>å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œå¹¶å»ºç«‹ä¸€ä¸ªä¿¡æ¯å®‰å…¨é€šé“ï¼Œæ¥ä¿è¯ä¼ è¾“è¿‡ç¨‹ä¸­çš„æ•°æ®å®‰å…¨;</li><li>å¯¹ç½‘ç«™æœåŠ¡å™¨è¿›è¡ŒçœŸå®èº«ä»½è®¤è¯ã€‚</li></ul><h3 id="äº”ã€çŸ­è½®è¯¢ï¼Œé•¿è½®è¯¢ï¼ŒWebSocket"><a href="#äº”ã€çŸ­è½®è¯¢ï¼Œé•¿è½®è¯¢ï¼ŒWebSocket" class="headerlink" title="äº”ã€çŸ­è½®è¯¢ï¼Œé•¿è½®è¯¢ï¼ŒWebSocket"></a>äº”ã€çŸ­è½®è¯¢ï¼Œé•¿è½®è¯¢ï¼ŒWebSocket</h3><h4 id="1-çŸ­è½®è¯¢"><a href="#1-çŸ­è½®è¯¢" class="headerlink" title="1 çŸ­è½®è¯¢"></a>1 çŸ­è½®è¯¢</h4><p>é€šè¿‡ä¸æ–­å»ºç«‹httpè¯·æ±‚ï¼Œæ— è®ºæ•°æ®æ˜¯å¦æœ‰æ›´æ–°éƒ½ç›´æ¥å“åº”</p><p>ä¼˜ç¼ºç‚¹ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šç®€å•</li><li>ç¼ºç‚¹ï¼šå¤§é‡æµªè´¹èµ„æº</li></ul><h4 id="2-é•¿è½®è¯¢"><a href="#2-é•¿è½®è¯¢" class="headerlink" title="2 é•¿è½®è¯¢"></a>2 é•¿è½®è¯¢</h4><p>æ¥å—åˆ°è¯·æ±‚ä¸ä¼šç›´æ¥å“åº”ï¼Œå…ˆæŠŠè¿™ä¸ªè¯·æ±‚æŒ‚èµ·ï¼Œåˆ¤æ–­æœåŠ¡ç«¯æ•°æ®æ˜¯å¦æœ‰æ›´æ–°</p><p>å¦‚æœæœ‰æ›´æ–°å°±å“åº”ï¼Œæ²¡æœ‰æ›´æ–°å°±ç­‰ä¸€ä¼šå†è¿”å›</p><p>ä¼˜ç¼ºç‚¹ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šæ¯”çŸ­è½®è¯¢èŠ‚çœäº†èµ„æº</li><li>ç¼ºç‚¹ï¼šæŒ‚èµ·ä¹Ÿä¼šå¯¼è‡´èµ„æºçš„æµªè´¹</li></ul><h4 id="3-WebSocket"><a href="#3-WebSocket" class="headerlink" title="3 WebSocket"></a>3 WebSocket</h4><p>WebSocket æ˜¯ Html5 å®šä¹‰çš„ä¸€ä¸ªæ–°åè®®ï¼Œä¸ä¼ ç»Ÿçš„ http åè®®ä¸åŒï¼Œè¯¥åè®®å…è®¸ç”±æœåŠ¡å™¨ä¸»åŠ¨çš„å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯ã€‚</p><p>ä½¿ç”¨ WebSocket åè®®çš„ç¼ºç‚¹æ˜¯åœ¨æœåŠ¡å™¨ç«¯çš„é…ç½®æ¯”è¾ƒå¤æ‚ã€‚WebSocket æ˜¯ä¸€ä¸ªå…¨åŒå·¥çš„åè®®ï¼Œä¹Ÿå°±æ˜¯é€šä¿¡åŒæ–¹æ˜¯å¹³ç­‰çš„ï¼Œå¯ä»¥ç›¸äº’å‘é€æ¶ˆæ¯ã€‚</p><h3 id="å…­ã€æ­£å‘ä»£ç†å’Œåå‘ä»£ç†"><a href="#å…­ã€æ­£å‘ä»£ç†å’Œåå‘ä»£ç†" class="headerlink" title="å…­ã€æ­£å‘ä»£ç†å’Œåå‘ä»£ç†"></a>å…­ã€æ­£å‘ä»£ç†å’Œåå‘ä»£ç†</h3><p>æ­£å‘ä»£ç†ï¼š</p><p>æˆ‘è¦å»æ‰¾é©¬äº‘å€Ÿé’±ï¼Œä½†æ˜¯ç›´æ¥æ‰¾é©¬äº‘ä»–ä¸ä¼šç»™æˆ‘ï¼Œæˆ‘å¯ä»¥é€šè¿‡èŠ±å‘—æ‰¾é©¬äº‘å€Ÿé’±ï¼Œéšè—çš„æ˜¯æˆ‘ï¼ˆå®¢æˆ·ç«¯ï¼‰</p><p>åå‘ä»£ç†ï¼š</p><p>è¾“å…¥<a href="http://www.baidu.com,æˆ‘ä»¬ä¸çŸ¥é“æ˜¯å“ªå°æœåŠ¡å™¨ä¸ºæˆ‘ä»¬å·¥ä½œ,ä½†æ˜¯åªè¦èƒ½è®¿é—®åˆ°å°±è¡Œ,éšè—çš„æ˜¯æœåŠ¡å™¨/">www.baidu.comï¼Œæˆ‘ä»¬ä¸çŸ¥é“æ˜¯å“ªå°æœåŠ¡å™¨ä¸ºæˆ‘ä»¬å·¥ä½œï¼Œä½†æ˜¯åªè¦èƒ½è®¿é—®åˆ°å°±è¡Œï¼Œéšè—çš„æ˜¯æœåŠ¡å™¨</a></p><p>ä¸€èˆ¬åå‘ä»£ç†ç”¨äºå®ç°æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;ä¸€ã€HTTPåè®®ç‰ˆæœ¬åŒºåˆ«&quot;&gt;&lt;a href=&quot;#ä¸€ã€HTTPåè®®ç‰ˆæœ¬åŒºåˆ«&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€HTTPåè®®ç‰ˆæœ¬åŒºåˆ«&quot;&gt;&lt;/a&gt;ä¸€ã€HTTPåè®®ç‰ˆæœ¬åŒºåˆ«&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;0.9 è¿œå¤ç‰ˆæœ¬ï¼Œåªæœ‰ä¸€ä¸ªGETå‘½ä»¤ï¼Œåªæ”¯æŒçº¯æ–‡</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="å‰ç«¯" scheme="http://huang_zhao.gitee.io/task/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="åè®®ï¼ŒæŸ¥æ¼è¡¥ç¼º" scheme="http://huang_zhao.gitee.io/task/tags/%E5%8D%8F%E8%AE%AE%EF%BC%8C%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/"/>
    
  </entry>
  
  <entry>
    <title>æ”¯ä»˜å®ç½‘é¡µæ”¯ä»˜æ¥å£è°ƒç”¨</title>
    <link href="http://huang_zhao.gitee.io/task/2020/04/25/%E6%94%AF%E4%BB%98%E5%AE%9D%E7%BD%91%E9%A1%B5%E6%94%AF%E4%BB%98%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8/"/>
    <id>http://huang_zhao.gitee.io/task/2020/04/25/%E6%94%AF%E4%BB%98%E5%AE%9D%E7%BD%91%E9%A1%B5%E6%94%AF%E4%BB%98%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8/</id>
    <published>2020-04-25T05:20:11.000Z</published>
    <updated>2020-08-26T01:05:37.429Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€SDK-APIæ¥å£çš„è°ƒç”¨"><a href="#ä¸€ã€SDK-APIæ¥å£çš„è°ƒç”¨" class="headerlink" title="ä¸€ã€SDK/APIæ¥å£çš„è°ƒç”¨"></a>ä¸€ã€SDK/APIæ¥å£çš„è°ƒç”¨</h2><p>æ”¯ä»˜å®å¹³å°ä¸æä¾›pythonçš„sdkï¼Œåªæœ‰apiï¼Œæˆ‘ä»¬å¯ä»¥å»ç½‘ä¸Šæ‰¾åˆ«äººå°è£…å¥½çš„sdkï¼Œå¤åˆ¶è¿‡æ¥ï¼Œäº†è§£å¯¹åº”å‚æ•°</p><p>å¯ä»¥é€šè¿‡æ”¯ä»˜å®æä¾›çš„è½¯ä»¶è‡ªåŠ¨ç”Ÿæˆå…¬é’¥å’Œç§é’¥</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> alipay <span class="token keyword">import</span> AliPay<span class="token comment" spellcheck="true"># app_private_key_string = open("/path/to/your/private/key.pem").read()</span><span class="token comment" spellcheck="true"># alipay_public_key_string = open("/path/to/alipay/public/key.pem").read()</span>app_private_key_string <span class="token operator">=</span> <span class="token triple-quoted-string string">"""-----BEGIN RSA PRIVATE KEY-----ä½ çš„ç§é’¥-----END RSA PRIVATE KEY-----"""</span>alipay_public_key_string <span class="token operator">=</span> <span class="token triple-quoted-string string">"""-----BEGIN PUBLIC KEY-----æ”¯ä»˜å®å¹³å°åˆ›å»ºçš„åº”ç”¨çš„å…¬é’¥-----END PUBLIC KEY-----"""</span>alipay <span class="token operator">=</span> AliPay<span class="token punctuation">(</span>    <span class="token comment" spellcheck="true"># åˆ›å»ºåº”ç”¨çš„appid</span>    appid<span class="token operator">=</span><span class="token string">"xxx"</span><span class="token punctuation">,</span>    app_notify_url<span class="token operator">=</span><span class="token string">'http://127.0.0.1:8000/home/'</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># the default notify path</span>    <span class="token comment" spellcheck="true"># é…ç½®ä½ çš„ç§é’¥</span>    app_private_key_string<span class="token operator">=</span>app_private_key_string<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># alipay public key, do not use your own public key!</span>    <span class="token comment" spellcheck="true"># é…ç½®åº”ç”¨çš„å…¬é’¥</span>    alipay_public_key_string<span class="token operator">=</span>alipay_public_key_string<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># åŠ å¯†æ–¹å¼</span>    sign_type<span class="token operator">=</span><span class="token string">"RSA2"</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># RSA or RSA2</span>    <span class="token comment" spellcheck="true"># è°ƒè¯•æ¨¡å¼ï¼Œå¦‚æœç”¨çœŸå®ç¯å¢ƒå°±è¦æ”¹æˆTrue</span>    debug<span class="token operator">=</span><span class="token boolean">False</span>  <span class="token comment" spellcheck="true"># False by default</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># æ”¯ä»˜å®çš„ç½‘å…³æ¥å£</span>alipay_url<span class="token operator">=</span><span class="token string">'https://openapi.alipaydev.com/gateway.do?'</span><span class="token comment" spellcheck="true"># ç”Ÿæˆæ”¯ä»˜é¡µé¢</span>order_string <span class="token operator">=</span> alipay<span class="token punctuation">.</span>api_alipay_trade_page_pay    <span class="token punctuation">(</span>    out_trade_no<span class="token operator">=</span><span class="token string">"20161112www4334"</span><span class="token punctuation">,</span>    total_amount<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">,</span>    subject<span class="token operator">=</span><span class="token string">'éŸ©çº¢ç‰ˆå……æ°”å¨ƒå¨ƒ'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># å•†å“åç§°</span>    <span class="token comment" spellcheck="true"># æäº¤getè¯·æ±‚çš„url</span>    return_url<span class="token operator">=</span><span class="token string">"xxx"</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true"># æäº¤postè¯·æ±‚çš„url</span>    notify_url<span class="token operator">=</span><span class="token string">"xxx"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># ç”Ÿæˆæ”¯ä»˜é“¾æ¥</span><span class="token keyword">print</span><span class="token punctuation">(</span>alipay_url<span class="token operator">+</span>order_string<span class="token punctuation">)</span></code></pre><p>è¿™é‡Œå†…éƒ¨æœ‰å¾ˆå¤šé…ç½®ä¿¡æ¯ï¼Œå¯ä»¥æŠŠé…ç½®ä¿¡æ¯æå–å‡ºæ¥æ”¾åˆ°settingsæ–‡ä»¶ä¸­ï¼Œè§£è€¦åˆ</p><h2 id="äºŒã€é¡¹ç›®ä¸­è°ƒç”¨æ”¯ä»˜æ¥å£"><a href="#äºŒã€é¡¹ç›®ä¸­è°ƒç”¨æ”¯ä»˜æ¥å£" class="headerlink" title="äºŒã€é¡¹ç›®ä¸­è°ƒç”¨æ”¯ä»˜æ¥å£"></a>äºŒã€é¡¹ç›®ä¸­è°ƒç”¨æ”¯ä»˜æ¥å£</h2><p>å‰ç«¯ç‚¹å‡»ç«‹å³è´­ä¹°ï¼ŒæŠŠåç«¯æ‰€éœ€è¦çš„å‚æ•°å‘é€ç»™åç«¯</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">PayView</span><span class="token punctuation">(</span>GenericViewSet<span class="token punctuation">,</span> CreateModelMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># ç™»å½•jwtè®¤è¯</span>    authentication_classes <span class="token operator">=</span> <span class="token punctuation">[</span>JSONWebTokenAuthentication<span class="token punctuation">,</span> <span class="token punctuation">]</span>    <span class="token comment" spellcheck="true"># é˜²æ­¢æ¸¸å®¢ç™»å½•</span>    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>IsAuthenticated<span class="token punctuation">,</span> <span class="token punctuation">]</span>    queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>Order<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span>    serializer_class <span class="token operator">=</span> sers<span class="token punctuation">.</span>OrderSerializer    <span class="token comment" spellcheck="true"># é‡å†™createæ–¹æ³•</span>    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'request': request&amp;#125;)</span>        <span class="token comment" spellcheck="true"># é€šè¿‡åºåˆ—åŒ–ç±»å»æ ¡éªŒæ•°æ®ï¼Œä¿å­˜æ•°æ®åˆ°æ•°æ®åº“ï¼Œç”Ÿæˆæ”¯ä»˜å®é“¾æ¥</span>        <span class="token comment" spellcheck="true"># ä¸»è¦é€»è¾‘éƒ½åœ¨åºåˆ—åŒ–ç±»ä¸­</span>        serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span>raise_exception<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># ç­‰åŒäºser.saveï¼ˆï¼‰</span>        self<span class="token punctuation">.</span>perform_create<span class="token punctuation">(</span>serializer<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># è¿”å›æ”¯ä»˜å®æ”¯ä»˜é“¾æ¥</span>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>context<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'pay_url'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>åºåˆ—åŒ–ç±»</p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ValidationError<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf <span class="token keyword">import</span> settings<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> models<span class="token keyword">class</span> <span class="token class-name">OrderSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># å‰ç«¯ä¼ ä»€ä¹ˆæ•°æ®è¿‡æ¥&amp;#123;course:[1,2,3],total_amount:100,subject:xxå•†å“,pay_type:1,&amp;#125;</span>    <span class="token comment" spellcheck="true"># userå­—æ®µéœ€è¦ï¼Œä½†æ˜¯ä¸æ˜¯ä¼ çš„ï¼Œä½¿ç”¨äº†jwt</span>    <span class="token comment" spellcheck="true"># éœ€è¦æŠŠcourse:[1,2,3] å¤„ç†æˆ course:[obj1,obj2,obj3]</span>    <span class="token comment" spellcheck="true"># è¯¾æ—¶ï¼š[1,4,6,]===>è¯¾æ—¶ï¼š[obj1,obj4,obj6,]</span>    <span class="token comment" spellcheck="true"># course=serializers.CharField()</span>    <span class="token keyword">from</span> course<span class="token punctuation">.</span>models <span class="token keyword">import</span> Course    <span class="token comment" spellcheck="true"># è¿™ä¸ªæ–¹æ³•å¯ä»¥è®©è¯¾æ—¶ï¼š[1,4,6,]===>è¯¾æ—¶ï¼š[obj1,obj4,obj6,]</span>    course<span class="token operator">=</span>serializers<span class="token punctuation">.</span>PrimaryKeyRelatedField<span class="token punctuation">(</span>queryset<span class="token operator">=</span>Course<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>all<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> write_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>        model <span class="token operator">=</span> models<span class="token punctuation">.</span>Order        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'total_amount'</span><span class="token punctuation">,</span><span class="token string">'subject'</span><span class="token punctuation">,</span><span class="token string">'pay_type'</span><span class="token punctuation">,</span><span class="token string">'course'</span><span class="token punctuation">]</span>        extra_kwargs<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>            <span class="token string">'total_amount'</span><span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'required':True&amp;#125;,</span>            <span class="token string">'pay_type'</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'required': True&amp;#125;,</span>        <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>    <span class="token keyword">def</span> <span class="token function">_check_price</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>        total_amount<span class="token operator">=</span>attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'total_amount'</span><span class="token punctuation">)</span>        course_list<span class="token operator">=</span>attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'course'</span><span class="token punctuation">)</span>        total_price<span class="token operator">=</span><span class="token number">0</span>        <span class="token keyword">for</span> course <span class="token keyword">in</span> course_list<span class="token punctuation">:</span>            total_price<span class="token operator">+=</span>course<span class="token punctuation">.</span>price        <span class="token keyword">if</span> total_price<span class="token operator">!=</span>total_amount<span class="token punctuation">:</span>            <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">'ä»·æ ¼ä¸åˆæ³•'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> total_amount    <span class="token keyword">def</span> <span class="token function">_gen_out_trade_no</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">import</span> uuid        <span class="token keyword">return</span> str<span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">_get_user</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># éœ€è¦requestå¯¹è±¡(éœ€è¦è§†å›¾é€šè¿‡contextæŠŠreuqestå¯¹è±¡ä¼ å…¥ã€‚é‡å†™createæ–¹æ³•)</span>        request<span class="token operator">=</span>self<span class="token punctuation">.</span>context<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> request<span class="token punctuation">.</span>user    <span class="token keyword">def</span> <span class="token function">_gen_pay_url</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>out_trade_no<span class="token punctuation">,</span>total_amout<span class="token punctuation">,</span>subject<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># total_amoutæ˜¯Decimalç±»å‹ï¼Œè¯†åˆ«ä¸äº†ï¼Œéœ€è¦è½¬æ¢æˆfloatç±»å‹</span>        <span class="token keyword">from</span> luffyapi<span class="token punctuation">.</span>libs<span class="token punctuation">.</span>al_pay <span class="token keyword">import</span> alipay<span class="token punctuation">,</span>gateway        order_string <span class="token operator">=</span> alipay<span class="token punctuation">.</span>api_alipay_trade_page_pay    <span class="token punctuation">(</span>            out_trade_no<span class="token operator">=</span>out_trade_no<span class="token punctuation">,</span>            total_amount<span class="token operator">=</span>float<span class="token punctuation">(</span>total_amout<span class="token punctuation">)</span><span class="token punctuation">,</span>            subject<span class="token operator">=</span>subject<span class="token punctuation">,</span>            return_url<span class="token operator">=</span>settings<span class="token punctuation">.</span>RETURN_URL<span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># getå›è°ƒï¼Œå‰å°åœ°å€ï¼ˆæœ€åè·³è½¬çš„æ”¯ä»˜æˆåŠŸé¡µé¢ï¼‰</span>            notify_url<span class="token operator">=</span>settings<span class="token punctuation">.</span>NOTIFY_URL   <span class="token comment" spellcheck="true"># postå›è°ƒï¼Œåå°åœ°å€ï¼ˆç»™åç«¯å»åˆ¤æ–­æ˜¯å¦æ”¯ä»˜æˆåŠŸï¼Œæ”¯ä»˜æˆåŠŸè¿”å›successï¼‰</span>        <span class="token punctuation">)</span>        <span class="token keyword">return</span> gateway<span class="token operator">+</span>order_string    <span class="token keyword">def</span> <span class="token function">_before_create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>attrs<span class="token punctuation">,</span>user<span class="token punctuation">,</span>pay_url<span class="token punctuation">,</span>out_trade_no<span class="token punctuation">)</span><span class="token punctuation">:</span>        attrs<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token operator">=</span>user        attrs<span class="token punctuation">[</span><span class="token string">'out_trade_no'</span><span class="token punctuation">]</span><span class="token operator">=</span>out_trade_no        self<span class="token punctuation">.</span>context<span class="token punctuation">[</span><span class="token string">'pay_url'</span><span class="token punctuation">]</span><span class="token operator">=</span>pay_url    <span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">'''        # 1ï¼‰è®¢å•æ€»ä»·æ ¡éªŒ        # 2ï¼‰ç”Ÿæˆè®¢å•å·        # 3ï¼‰æ”¯ä»˜ç”¨æˆ·ï¼šrequest.user        # 4ï¼‰æ”¯ä»˜é“¾æ¥ç”Ÿæˆ        # 5ï¼‰å…¥åº“(ä¸¤ä¸ªè¡¨)çš„ä¿¡æ¯å‡†å¤‡        '''</span>        <span class="token comment" spellcheck="true"># 1ï¼‰è®¢å•æ€»ä»·æ ¡éªŒ</span>        total_amout <span class="token operator">=</span> self<span class="token punctuation">.</span>_check_price<span class="token punctuation">(</span>attrs<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 2ï¼‰ç”Ÿæˆè®¢å•å·</span>        out_trade_no<span class="token operator">=</span>self<span class="token punctuation">.</span>_gen_out_trade_no<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 3ï¼‰æ”¯ä»˜ç”¨æˆ·ï¼šrequest.user</span>        user<span class="token operator">=</span>self<span class="token punctuation">.</span>_get_user<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 4ï¼‰æ”¯ä»˜é“¾æ¥ç”Ÿæˆ</span>        pay_url<span class="token operator">=</span>self<span class="token punctuation">.</span>_gen_pay_url<span class="token punctuation">(</span>out_trade_no<span class="token punctuation">,</span>total_amout<span class="token punctuation">,</span>attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'subject'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># 5ï¼‰å…¥åº“(ä¸¤ä¸ªè¡¨)çš„ä¿¡æ¯å‡†å¤‡</span>        self<span class="token punctuation">.</span>_before_create<span class="token punctuation">(</span>attrs<span class="token punctuation">,</span>user<span class="token punctuation">,</span>pay_url<span class="token punctuation">,</span>out_trade_no<span class="token punctuation">)</span>        <span class="token keyword">return</span> attrs    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>        course_list<span class="token operator">=</span>validated_data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'course'</span><span class="token punctuation">)</span>        order<span class="token operator">=</span>models<span class="token punctuation">.</span>Order<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token operator">**</span>validated_data<span class="token punctuation">)</span>        <span class="token keyword">for</span> course <span class="token keyword">in</span> course_list<span class="token punctuation">:</span>            models<span class="token punctuation">.</span>OrderDetail<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>order<span class="token operator">=</span>order<span class="token punctuation">,</span>course<span class="token operator">=</span>course<span class="token punctuation">,</span>price<span class="token operator">=</span>course<span class="token punctuation">.</span>price<span class="token punctuation">,</span>real_price<span class="token operator">=</span>course<span class="token punctuation">.</span>price<span class="token punctuation">)</span>        <span class="token keyword">return</span> order</code></pre><p>æ”¯ä»˜æˆåŠŸåï¼Œå‰ç«¯ä¼šç›´æ¥è·³è½¬åˆ°æ”¯ä»˜æˆåŠŸçš„é¡µé¢ï¼Œæ”¯ä»˜å®ä¼šå‘åç«¯å‘é€postè¯·æ±‚ï¼Œè®©æˆ‘ä»¬éªŒè¯æ‰€æœ‰çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®</p><pre class=" language-python"><code class="language-python"> <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">'''        æ”¯ä»˜å®å›è°ƒæ¥å£        '''</span>        <span class="token keyword">from</span> luffyapi<span class="token punctuation">.</span>libs<span class="token punctuation">.</span>al_pay <span class="token keyword">import</span> alipay        <span class="token keyword">from</span> luffyapi<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>logger <span class="token keyword">import</span> log        data <span class="token operator">=</span> request<span class="token punctuation">.</span>data        out_trade_no<span class="token operator">=</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'out_trade_no'</span><span class="token punctuation">,</span>None<span class="token punctuation">)</span>        gmt_payment<span class="token operator">=</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'gmt_payment'</span><span class="token punctuation">,</span>None<span class="token punctuation">)</span>        signature <span class="token operator">=</span> data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">"sign"</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># éªŒè¯ç­¾å</span>        success <span class="token operator">=</span> alipay<span class="token punctuation">.</span>verify<span class="token punctuation">(</span>data<span class="token punctuation">,</span> signature<span class="token punctuation">)</span>        <span class="token keyword">if</span> success <span class="token operator">and</span> data<span class="token punctuation">[</span><span class="token string">"trade_status"</span><span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">"TRADE_SUCCESS"</span><span class="token punctuation">,</span> <span class="token string">"TRADE_FINISHED"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            models<span class="token punctuation">.</span>Order<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>out_trade_no<span class="token operator">=</span>out_trade_no<span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>order_status<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>pay_time<span class="token operator">=</span>gmt_payment<span class="token punctuation">)</span>            log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'%sè®¢å•æ”¯ä»˜æˆåŠŸ'</span><span class="token operator">%</span>out_trade_no<span class="token punctuation">)</span>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'%sè®¢å•æœ‰é—®é¢˜'</span> <span class="token operator">%</span> out_trade_no<span class="token punctuation">)</span>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span></code></pre><p>å‰ç«¯åˆ°äº†æ”¯ä»˜æˆåŠŸçš„é¡µé¢ï¼Œå…¶å®ä¹Ÿä¸å®Œå…¨æ˜¯æ”¯ä»˜æˆåŠŸï¼Œå› ä¸ºè¿˜æ²¡æœ‰å¾—åˆ°åç«¯çš„ç¡®è®¤ï¼Œæ‰€ä»¥å¯ä»¥å‘é€ä¸€ä¸ªgetè¯·æ±‚å»æ ¡éªŒä¸€ä¸‹æ˜¯å¦æˆåŠŸ</p><pre class=" language-python"><code class="language-python">    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">,</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        out_trade_no<span class="token operator">=</span>request<span class="token punctuation">.</span>query_params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'out_trade_no'</span><span class="token punctuation">)</span>        order<span class="token operator">=</span>models<span class="token punctuation">.</span>Order<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>out_trade_no<span class="token operator">=</span>out_trade_no<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> order<span class="token punctuation">.</span>order_status<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€SDK-APIæ¥å£çš„è°ƒç”¨&quot;&gt;&lt;a href=&quot;#ä¸€ã€SDK-APIæ¥å£çš„è°ƒç”¨&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€SDK/APIæ¥å£çš„è°ƒç”¨&quot;&gt;&lt;/a&gt;ä¸€ã€SDK/APIæ¥å£çš„è°ƒç”¨&lt;/h2&gt;&lt;p&gt;æ”¯ä»˜å®å¹³å°ä¸æä¾›pythonçš„sdkï¼Œåªæœ‰a</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="django" scheme="http://huang_zhao.gitee.io/task/tags/django/"/>
    
    <category term="python" scheme="http://huang_zhao.gitee.io/task/tags/python/"/>
    
    <category term="ç¬¬ä¸‰æ–¹æ¥å£" scheme="http://huang_zhao.gitee.io/task/tags/%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8E%A5%E5%8F%A3/"/>
    
  </entry>
  
  <entry>
    <title>XpathåŸºæœ¬ç”¨æ³•</title>
    <link href="http://huang_zhao.gitee.io/task/2020/04/25/Xpath%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/"/>
    <id>http://huang_zhao.gitee.io/task/2020/04/25/Xpath%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/</id>
    <published>2020-04-25T05:20:11.000Z</published>
    <updated>2020-08-26T01:01:48.059Z</updated>
    
    <content type="html"><![CDATA[<p>XPath æ˜¯ä¸€é—¨åœ¨ XML æ–‡æ¡£ä¸­æŸ¥æ‰¾ä¿¡æ¯çš„è¯­è¨€ï¼Œæœ¬è´¨ä¸Šå’Œbs4å·®ä¸å¤š</p><p>ä¸»è¦é€‰å–èŠ‚ç‚¹çš„è¡¨è¾¾å¼æ˜¯<code>/</code>å’Œ<code>//</code>ç»„æˆ</p><p>æ•™ç¨‹ï¼š<a href="https://www.runoob.com/xpath/xpath-syntax.html">https://www.runoob.com/xpath/xpath-syntax.html</a></p><table><thead><tr><th align="left">è¡¨è¾¾å¼</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">nodename</td><td align="left">é€‰å–æ­¤èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚</td></tr><tr><td align="left">/</td><td align="left">ä»æ ¹èŠ‚ç‚¹é€‰å–ã€‚</td></tr><tr><td align="left">//</td><td align="left">ä»åŒ¹é…é€‰æ‹©çš„å½“å‰èŠ‚ç‚¹é€‰æ‹©æ–‡æ¡£ä¸­çš„èŠ‚ç‚¹ï¼Œè€Œä¸è€ƒè™‘å®ƒä»¬çš„ä½ç½®ã€‚</td></tr><tr><td align="left">.</td><td align="left">é€‰å–å½“å‰èŠ‚ç‚¹ã€‚</td></tr><tr><td align="left">..</td><td align="left">é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚</td></tr><tr><td align="left">@</td><td align="left">é€‰å–å±æ€§ã€‚</td></tr></tbody></table><table><thead><tr><th align="left">è·¯å¾„è¡¨è¾¾å¼</th><th align="left">ç»“æœ</th></tr></thead><tbody><tr><td align="left">bookstore</td><td align="left">é€‰å– bookstore å…ƒç´ çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€‚</td></tr><tr><td align="left">/bookstore</td><td align="left">é€‰å–æ ¹å…ƒç´  bookstoreã€‚æ³¨é‡Šï¼šå‡å¦‚è·¯å¾„èµ·å§‹äºæ­£æ–œæ ( / )ï¼Œåˆ™æ­¤è·¯å¾„å§‹ç»ˆä»£è¡¨åˆ°æŸå…ƒç´ çš„ç»å¯¹è·¯å¾„ï¼</td></tr><tr><td align="left">bookstore/book</td><td align="left">é€‰å–å±äº bookstore çš„å­å…ƒç´ çš„æ‰€æœ‰ book å…ƒç´ ã€‚</td></tr><tr><td align="left">//book</td><td align="left">é€‰å–æ‰€æœ‰ book å­å…ƒç´ ï¼Œè€Œä¸ç®¡å®ƒä»¬åœ¨æ–‡æ¡£ä¸­çš„ä½ç½®ã€‚</td></tr><tr><td align="left">bookstore//book</td><td align="left">é€‰æ‹©å±äº bookstore å…ƒç´ çš„åä»£çš„æ‰€æœ‰ book å…ƒç´ ï¼Œè€Œä¸ç®¡å®ƒä»¬ä½äº bookstore ä¹‹ä¸‹çš„ä»€ä¹ˆä½ç½®ã€‚</td></tr><tr><td align="left">//@lang</td><td align="left">é€‰å–åä¸º lang çš„æ‰€æœ‰å±æ€§ã€‚</td></tr></tbody></table><pre class=" language-python"><code class="language-python">doc <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;html>&lt;head>&lt;title>The Dormouse's story&lt;/title>&lt;/head>&lt;body>&lt;p id="my_p" class="title">hello&lt;b id="bbb" class="boldest">The Dormouse's story&lt;/b>&lt;/p>&lt;p class="story li">Once upon a time there were three little sisters; and their names were&lt;a href="http://example.com/elsie" class="sister" id="link1">Elsie&lt;/a>&lt;a href="http://example.com/lacie" class="sister" id="link2">Lacie&lt;/a> and&lt;a href="http://example.com/tillie" class="sister" id="link3">Tillie&lt;/a>;and they lived at the bottom of a well.&lt;/p>&lt;p class="story">...&lt;/p>"""</span></code></pre><p>æµ‹è¯•æ¡ˆä¾‹ï¼š</p><pre class=" language-python"><code class="language-python">html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># æ‰€æœ‰èŠ‚ç‚¹ï¼Œåˆ—è¡¨åŒ…å«ä¸€ä¸ªä¸ªtagå¯¹è±¡</span><span class="token comment" spellcheck="true"># a = html.xpath('//*')</span><span class="token comment" spellcheck="true"># åœ¨bodyä¸‹çš„æ‰€æœ‰bæ ‡ç­¾ï¼ˆåŒ…å«å­å­å­™å­™ï¼‰</span><span class="token comment" spellcheck="true"># a = html.xpath('body//b')</span><span class="token comment" spellcheck="true"># åœ¨bdoyä¸‹çš„å­æ ‡ç­¾ä¸­çš„bæ ‡ç­¾ï¼ˆåªæœ‰å­æ ‡ç­¾ï¼‰</span><span class="token comment" spellcheck="true"># a = html.xpath('body/b')</span><span class="token comment" spellcheck="true"># å±æ€§åŒ¹é…,åªèƒ½å®Œå…¨åŒ¹é…ï¼Œå¦‚æœæœ‰å¤šä¸ª</span><span class="token comment" spellcheck="true"># a = html.xpath('body//p[@class="title"]')</span><span class="token comment" spellcheck="true"># å±æ€§åŒ¹é…æ¨¡ç³Šï¼Œåªè¦æœ‰å°±èƒ½åŒ¹é…</span><span class="token comment" spellcheck="true"># a = html.xpath('body//p[contains(@class,"li")]')</span><span class="token comment" spellcheck="true"># å¤šå±æ€§åŒ¹é…</span><span class="token comment" spellcheck="true"># a = html.xpath('body//p[contains(@class,"li") or @id="my_p"]')</span><span class="token comment" spellcheck="true"># è·å–å½“å‰æ ‡ç­¾çš„æ–‡æœ¬ï¼ˆä¸åŒ…å«å…¶å­èŠ‚ç‚¹å†…éƒ¨çš„ï¼‰ï¼ˆåˆ—è¡¨ï¼‰</span><span class="token comment" spellcheck="true"># a = html.xpath('body//p[@class="title"]/text()')</span><span class="token comment" spellcheck="true"># è·å–æ ‡ç­¾çš„å±æ€§</span><span class="token comment" spellcheck="true"># a = html.xpath('body//p[@class="title"]/@id')</span><span class="token comment" spellcheck="true"># ç´¢å¼•å–å‡ºä¸€ä¸ªæ ‡ç­¾ï¼ˆæ³¨æ„ç¬¬ä¸€ä¸ªå°±æ˜¯ã€1ã€‘ä¸æ˜¯0ï½ï¼‰</span><span class="token comment" spellcheck="true"># a = html.xpath('body//p[1]/text()')</span><span class="token comment" spellcheck="true"># å–å‡ºæœ€åä¸€ä¸ª</span><span class="token comment" spellcheck="true"># a = html.xpath('body//p[last()]/text()')</span><span class="token comment" spellcheck="true"># å–å‡ºä½ç½®å°äº3çš„</span><span class="token comment" spellcheck="true"># a = html.xpath('body//p[position()&lt;3]')</span><span class="token comment" spellcheck="true"># å–å‡ºå€’æ•°ç¬¬äºŒä¸ª</span><span class="token comment" spellcheck="true"># a = html.xpath('body//p[last()-2]')</span><span class="token comment" spellcheck="true"># 11 èŠ‚ç‚¹è½´é€‰æ‹©</span><span class="token comment" spellcheck="true"># ancestorï¼šç¥–å…ˆèŠ‚ç‚¹</span><span class="token comment" spellcheck="true"># ä½¿ç”¨äº†* è·å–æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹</span><span class="token comment" spellcheck="true"># a=html.xpath('//a/ancestor::*')</span><span class="token comment" spellcheck="true"># # è·å–ç¥–å…ˆèŠ‚ç‚¹ä¸­çš„div</span><span class="token comment" spellcheck="true"># a=html.xpath('//a/ancestor::div')</span><span class="token comment" spellcheck="true"># attributeï¼šå±æ€§å€¼</span><span class="token comment" spellcheck="true"># a=html.xpath('//a[1]/attribute::*')</span><span class="token comment" spellcheck="true"># a=html.xpath('//a[1]/@aa')</span><span class="token comment" spellcheck="true"># childï¼šç›´æ¥å­èŠ‚ç‚¹</span><span class="token comment" spellcheck="true"># a=html.xpath('//a[1]/child::*')</span><span class="token comment" spellcheck="true"># a=html.xpath('//a[1]/child::img/@src')</span><span class="token comment" spellcheck="true"># descendantï¼šæ‰€æœ‰å­å­™èŠ‚ç‚¹</span><span class="token comment" spellcheck="true"># a=html.xpath('//a[6]/descendant::*')</span><span class="token comment" spellcheck="true"># a=html.xpath('//a[6]/descendant::h5/text()')</span><span class="token comment" spellcheck="true"># following:å½“å‰èŠ‚ç‚¹ä¹‹åæ‰€æœ‰èŠ‚ç‚¹(å…„å¼ŸèŠ‚ç‚¹å’Œå…„å¼Ÿå†…éƒ¨çš„èŠ‚ç‚¹)</span><span class="token comment" spellcheck="true"># a=html.xpath('//a[1]/following::*')</span><span class="token comment" spellcheck="true"># a=html.xpath('//a[1]/following::*[1]/@href')</span><span class="token comment" spellcheck="true"># following-sibling:å½“å‰èŠ‚ç‚¹ä¹‹ååŒçº§èŠ‚ç‚¹ï¼ˆåªæ‰¾å…„å¼Ÿï¼‰</span><span class="token comment" spellcheck="true"># a=html.xpath('//a[1]/following-sibling::*')</span><span class="token comment" spellcheck="true"># a=html.xpath('//a[1]/following-sibling::a')</span><span class="token comment" spellcheck="true"># a=html.xpath('//a[1]/following-sibling::*[2]')</span><span class="token comment" spellcheck="true"># a=html.xpath('//a[1]/following-sibling::*[2]/@href')</span></code></pre><h3 id="æœ€å¸¸ç”¨"><a href="#æœ€å¸¸ç”¨" class="headerlink" title="æœ€å¸¸ç”¨"></a>æœ€å¸¸ç”¨</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># è·å–æ–‡æœ¬</span>a <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'body//p[1]/text()'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># è·å–å±æ€§å€¼</span>a<span class="token operator">=</span>html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span>'<span class="token operator">//</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span>@href<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># è¦æ³¨æ„ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯æ‰¾åˆ°ä¸€ä¸ªæ ‡ç­¾å†é€šè¿‡è¿™ä¸ªæ ‡ç­¾è¿›è¡Œxpathç­›é€‰</span>tag<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//a[1]/@href'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># è¿™è¡¨ç¤ºè¿˜æ˜¯ä»æ ¹å¾€ä¸‹æ‰¾</span>tag<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'.//a[1]/@href'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># è¿™è¡¨ç¤ºä»å½“å‰æ ‡ç­¾ä½ç½®ä¸ºæ ¹å¾€ä¸‹æ‰¾</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;XPath æ˜¯ä¸€é—¨åœ¨ XML æ–‡æ¡£ä¸­æŸ¥æ‰¾ä¿¡æ¯çš„è¯­è¨€ï¼Œæœ¬è´¨ä¸Šå’Œbs4å·®ä¸å¤š&lt;/p&gt;
&lt;p&gt;ä¸»è¦é€‰å–èŠ‚ç‚¹çš„è¡¨è¾¾å¼æ˜¯&lt;code&gt;/&lt;/code&gt;å’Œ&lt;code&gt;//&lt;/code&gt;ç»„æˆ&lt;/p&gt;
&lt;p&gt;æ•™ç¨‹ï¼š&lt;a href=&quot;https://www.runoob.com/xpath/x</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="python" scheme="http://huang_zhao.gitee.io/task/tags/python/"/>
    
    <category term="çˆ¬è™«" scheme="http://huang_zhao.gitee.io/task/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>celeryåŸºç¡€</title>
    <link href="http://huang_zhao.gitee.io/task/2020/04/25/celery/"/>
    <id>http://huang_zhao.gitee.io/task/2020/04/25/celery/</id>
    <published>2020-04-25T05:20:11.000Z</published>
    <updated>2020-08-26T01:02:17.121Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€celeryä»‹ç»"><a href="#ä¸€ã€celeryä»‹ç»" class="headerlink" title="ä¸€ã€celeryä»‹ç»"></a>ä¸€ã€celeryä»‹ç»</h2><p>Celery å®˜ç½‘ï¼š<a href="http://www.celeryproject.org/">http://www.celeryproject.org/</a></p><p>Celery å®˜æ–¹æ–‡æ¡£è‹±æ–‡ç‰ˆï¼š<a href="http://docs.celeryproject.org/en/latest/index.html">http://docs.celeryproject.org/en/latest/index.html</a></p><p>Celery å®˜æ–¹æ–‡æ¡£ä¸­æ–‡ç‰ˆï¼š<a href="http://docs.jinkan.org/docs/celery/">http://docs.jinkan.org/docs/celery/</a></p><ul><li>å¼‚æ­¥ä»»åŠ¡æ¡†æ¶</li><li>æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡</li><li>æ‰§è¡Œå»¶è¿Ÿä»»åŠ¡</li><li>æ‰§è¡Œå®šæ—¶ä»»åŠ¡</li></ul><h2 id="äºŒã€celeryæ¶æ„"><a href="#äºŒã€celeryæ¶æ„" class="headerlink" title="äºŒã€celeryæ¶æ„"></a>äºŒã€celeryæ¶æ„</h2><p><img src="https://gitee.com/huang_zhao/hz/raw/master/hz/007S8ZIlgy1ggqw0f7bltj30q80c174d.jpg" alt="007S8ZIlgy1ggqw0f7bltj30q80c174d" loading="lazy"></p><h4 id="æ¶ˆæ¯ä¸­é—´ä»¶"><a href="#æ¶ˆæ¯ä¸­é—´ä»¶" class="headerlink" title="æ¶ˆæ¯ä¸­é—´ä»¶"></a>æ¶ˆæ¯ä¸­é—´ä»¶</h4><p>Celeryæœ¬èº«ä¸æä¾›æ¶ˆæ¯æœåŠ¡ï¼Œä½†æ˜¯å¯ä»¥æ–¹ä¾¿çš„å’Œç¬¬ä¸‰æ–¹æä¾›çš„æ¶ˆæ¯ä¸­é—´ä»¶é›†æˆã€‚åŒ…æ‹¬ï¼ŒRabbitMQ, Redisç­‰ç­‰</p><h4 id="ä»»åŠ¡æ‰§è¡Œå•å…ƒ"><a href="#ä»»åŠ¡æ‰§è¡Œå•å…ƒ" class="headerlink" title="ä»»åŠ¡æ‰§è¡Œå•å…ƒ"></a>ä»»åŠ¡æ‰§è¡Œå•å…ƒ</h4><p>Workeræ˜¯Celeryæä¾›çš„ä»»åŠ¡æ‰§è¡Œçš„å•å…ƒï¼Œworkerå¹¶å‘çš„è¿è¡Œåœ¨åˆ†å¸ƒå¼çš„ç³»ç»ŸèŠ‚ç‚¹ä¸­ã€‚</p><h4 id="ä»»åŠ¡ç»“æœå­˜å‚¨"><a href="#ä»»åŠ¡ç»“æœå­˜å‚¨" class="headerlink" title="ä»»åŠ¡ç»“æœå­˜å‚¨"></a>ä»»åŠ¡ç»“æœå­˜å‚¨</h4><p>Task result storeç”¨æ¥å­˜å‚¨Workeræ‰§è¡Œçš„ä»»åŠ¡çš„ç»“æœï¼ŒCeleryæ”¯æŒä»¥ä¸åŒæ–¹å¼å­˜å‚¨ä»»åŠ¡çš„ç»“æœï¼ŒåŒ…æ‹¬AMQP, redisç­‰</p><h4 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h4><p>å¼‚æ­¥æ‰§è¡Œï¼šè§£å†³è€—æ—¶ä»»åŠ¡,å°†è€—æ—¶æ“ä½œä»»åŠ¡æäº¤ç»™Celeryå»å¼‚æ­¥æ‰§è¡Œï¼Œæ¯”å¦‚å‘é€çŸ­ä¿¡/é‚®ä»¶ã€æ¶ˆæ¯æ¨é€ã€éŸ³è§†é¢‘å¤„ç†ç­‰ç­‰</p><p>å»¶è¿Ÿæ‰§è¡Œï¼šè§£å†³å»¶è¿Ÿä»»åŠ¡</p><p>å®šæ—¶æ‰§è¡Œï¼šè§£å†³å‘¨æœŸ(å‘¨æœŸ)ä»»åŠ¡,æ¯”å¦‚æ¯å¤©æ•°æ®ç»Ÿè®¡</p><h2 id="ä¸‰ã€celeryä½¿ç”¨"><a href="#ä¸‰ã€celeryä½¿ç”¨" class="headerlink" title="ä¸‰ã€celeryä½¿ç”¨"></a>ä¸‰ã€celeryä½¿ç”¨</h2><p>å®‰è£…ï¼š<code>pip install celery</code></p><p>æ ¹æ®celeryæ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œworkerå°±åƒæ˜¯ä¸€ä¸ªå·¥äººï¼Œä¸€ç›´åœ¨å·¥ä½œï¼Œå¦‚æœæœ‰å·¥ä½œçš„æ—¶å€™å°±ä¼šä»brokerï¼ˆRedistï¼‰é‡Œå»æ‹¿è¿‡æ¥æ‰§è¡Œï¼Œå¹¶æ”¾åˆ°pakendï¼ˆredistï¼‰ä¸­å­˜æ”¾ç»“æœ</p><h3 id="æ–¹å¼ä¸€ï¼šåœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹å†…çš„ä¸‰ä¸ªé¡µé¢"><a href="#æ–¹å¼ä¸€ï¼šåœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹å†…çš„ä¸‰ä¸ªé¡µé¢" class="headerlink" title="æ–¹å¼ä¸€ï¼šåœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹å†…çš„ä¸‰ä¸ªé¡µé¢"></a>æ–¹å¼ä¸€ï¼šåœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹å†…çš„ä¸‰ä¸ªé¡µé¢</h3><p><strong>workeræ‰§è¡Œé¡µé¢</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> celery<span class="token comment" spellcheck="true"># brokerå­˜å‚¨çš„ä½ç½®</span>broker <span class="token operator">=</span> <span class="token string">'redis://127.0.0.1:6379/1'</span><span class="token comment" spellcheck="true"># backendå­˜å‚¨çš„ä½ç½®</span>backend <span class="token operator">=</span><span class="token string">'redis://127.0.0.1:6379/2'</span><span class="token comment" spellcheck="true"># å®ä¾‹åŒ–çš„celeryå¯¹è±¡</span>app<span class="token operator">=</span>celery<span class="token punctuation">.</span>Celery<span class="token punctuation">(</span>__name__<span class="token punctuation">,</span>broker<span class="token operator">=</span>broker<span class="token punctuation">,</span>backend<span class="token operator">=</span>backend<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># éœ€è¦æ·»åŠ çš„ä»»åŠ¡</span>@app<span class="token punctuation">.</span>task<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token operator">*</span>y<span class="token punctuation">)</span>    <span class="token keyword">return</span> x<span class="token operator">+</span>y</code></pre><p><strong>brokeræäº¤ä»»åŠ¡çš„é¡µé¢</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> celery_test <span class="token keyword">import</span> add<span class="token comment" spellcheck="true"># æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œå°±æ˜¯æŠŠè¿™ä¸ªä»»åŠ¡æ·»åŠ åˆ°æ•°æ®åº“ä¸­ï¼Œåªè¦workeråœ¨å·¥ä½œ</span><span class="token comment" spellcheck="true"># å°±ä¼šæŠŠè¿™ä¸ªä»»åŠ¡ä»æ•°æ®åº“1ä¸­æ‹¿å‡ºæ¥æ‰§è¡Œï¼Œå¹¶æŠŠç»“æœæ”¾åˆ°æ•°æ®åº“2ä¸­</span>ret <span class="token operator">=</span> add<span class="token punctuation">.</span>delay<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># ret æ˜¯è¿™ä¸ªä»»åŠ¡çš„uuidï¼Œç”¨äºè·å–ä»»åŠ¡ç»“æœ</span></code></pre><p><strong>backendè·å–ä»»åŠ¡ç»“æœçš„é¡µé¢</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> celery_test <span class="token keyword">import</span> app<span class="token keyword">from</span> celery<span class="token punctuation">.</span>result <span class="token keyword">import</span> AsyncResult<span class="token comment" spellcheck="true"># ä»»åŠ¡å¯¹è±¡çš„å”¯ä¸€æ ‡è¯†ï¼šuuid</span>id <span class="token operator">=</span> <span class="token string">'19dc2faa-39f9-47b6-af77-e9d3a4d05d2e'</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    async1 <span class="token operator">=</span> AsyncResult<span class="token punctuation">(</span>id<span class="token operator">=</span>id<span class="token punctuation">,</span> app<span class="token operator">=</span>app<span class="token punctuation">)</span>    <span class="token keyword">if</span> async1<span class="token punctuation">.</span>successful<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        result <span class="token operator">=</span> async1<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>    <span class="token keyword">elif</span> async1<span class="token punctuation">.</span>failed<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ä»»åŠ¡å¤±è´¥'</span><span class="token punctuation">)</span>    <span class="token keyword">elif</span> async1<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token string">'PENDING'</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ä»»åŠ¡ç­‰å¾…ä¸­è¢«æ‰§è¡Œ'</span><span class="token punctuation">)</span>    <span class="token keyword">elif</span> async1<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token string">'RETRY'</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ä»»åŠ¡å¼‚å¸¸åæ­£åœ¨é‡è¯•'</span><span class="token punctuation">)</span>    <span class="token keyword">elif</span> async1<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token string">'STARTED'</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ä»»åŠ¡å·²ç»å¼€å§‹è¢«æ‰§è¡Œ'</span><span class="token punctuation">)</span></code></pre><h3 id="æ–¹å¼äºŒï¼šworkerå•ç‹¬åšä¸€ä¸ªé¡¹ç›®æ–‡ä»¶ï¼Œæ·»åŠ ä»»åŠ¡å’Œè·å–ç»“æœåˆ†ç¦»å‡ºæ¥ï¼ˆæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼‰"><a href="#æ–¹å¼äºŒï¼šworkerå•ç‹¬åšä¸€ä¸ªé¡¹ç›®æ–‡ä»¶ï¼Œæ·»åŠ ä»»åŠ¡å’Œè·å–ç»“æœåˆ†ç¦»å‡ºæ¥ï¼ˆæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼‰" class="headerlink" title="æ–¹å¼äºŒï¼šworkerå•ç‹¬åšä¸€ä¸ªé¡¹ç›®æ–‡ä»¶ï¼Œæ·»åŠ ä»»åŠ¡å’Œè·å–ç»“æœåˆ†ç¦»å‡ºæ¥ï¼ˆæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼‰"></a>æ–¹å¼äºŒï¼šworkerå•ç‹¬åšä¸€ä¸ªé¡¹ç›®æ–‡ä»¶ï¼Œæ·»åŠ ä»»åŠ¡å’Œè·å–ç»“æœåˆ†ç¦»å‡ºæ¥ï¼ˆæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼‰</h3><p>åˆ›å»ºä¸€ä¸ªceleryé¡¹ç›®ï¼ˆåŒ…ï¼‰ï¼Œå†…éƒ¨å¿…é¡»å«æœ‰åå­—ä¸ºceleryçš„pyæ–‡ä»¶ï¼Œåœ¨å†…éƒ¨åˆ›å»ºceleryå¯¹è±¡</p><p><strong>celery.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> celerybroker <span class="token operator">=</span> <span class="token string">'redis://127.0.0.1:6379/1'</span>backend <span class="token operator">=</span><span class="token string">'redis://127.0.0.1:6379/2'</span>app<span class="token operator">=</span>celery<span class="token punctuation">.</span>Celery<span class="token punctuation">(</span>__name__<span class="token punctuation">,</span>broker<span class="token operator">=</span>broker<span class="token punctuation">,</span>backend<span class="token operator">=</span>backend<span class="token punctuation">,</span>include<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'celery_task.task1'</span><span class="token punctuation">,</span><span class="token string">'celery_task.task2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>ç¼–å†™éœ€è¦æ·»åŠ çš„ä»»åŠ¡ä¹Ÿåœ¨è¿™ä¸ªåŒ…å†…ï¼Œå¯åˆ›å»ºä¸åŒçš„ä»»åŠ¡æ–‡ä»¶ï¼Œå¯æ·»åŠ å¤šä¸ª</p><p><strong>task1.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> <span class="token punctuation">.</span>celery <span class="token keyword">import</span> app@app<span class="token punctuation">.</span>task<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>    <span class="token keyword">return</span> x<span class="token operator">+</span>y</code></pre><h3 id="æ‰§è¡Œå»¶è¿Ÿä»»åŠ¡"><a href="#æ‰§è¡Œå»¶è¿Ÿä»»åŠ¡" class="headerlink" title="æ‰§è¡Œå»¶è¿Ÿä»»åŠ¡"></a>æ‰§è¡Œå»¶è¿Ÿä»»åŠ¡</h3><p>æ·»åŠ ä»»åŠ¡é¡µé¢</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># æ‰§è¡Œå»¶è¿Ÿä»»åŠ¡å°±æ˜¯å¤šä¸ªä¸€ä¸ªæ—¶é—´å‚æ•°</span><span class="token comment" spellcheck="true"># è¿™é‡Œæ³¨æ„ï¼Œæ—¶é—´å‚æ•°æ˜¯æ ¹æ®utcæ—¶é—´ï¼Œå¹¶ä¸æ˜¯ä¸­å›½æ—¶é—´</span><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta<span class="token comment" spellcheck="true"># æ—¶é—´å¯¹è±¡å¿…é¡»å’Œæ—¶é—´å¯¹è±¡ç›¸åŠ </span>eta<span class="token operator">=</span>datetime<span class="token punctuation">.</span>utcnow<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> timedelta<span class="token punctuation">(</span>seconds<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>add<span class="token punctuation">.</span>apply_async<span class="token punctuation">(</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> eta<span class="token operator">=</span>eta<span class="token punctuation">)</span></code></pre><h3 id="æ·»åŠ å®šæ—¶ä»»åŠ¡"><a href="#æ·»åŠ å®šæ—¶ä»»åŠ¡" class="headerlink" title="æ·»åŠ å®šæ—¶ä»»åŠ¡"></a>æ·»åŠ å®šæ—¶ä»»åŠ¡</h3><p>celeryé¡µé¢</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># æ—¶åŒº</span>app<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>timezone <span class="token operator">=</span> <span class="token string">'Asia/Shanghai'</span><span class="token comment" spellcheck="true"># æ˜¯å¦ä½¿ç”¨UTC</span>app<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>enable_utc <span class="token operator">=</span> <span class="token boolean">False</span><span class="token comment" spellcheck="true"># ä»»åŠ¡çš„å®šæ—¶é…ç½®</span><span class="token keyword">from</span> datetime <span class="token keyword">import</span> timedelta<span class="token keyword">from</span> celery<span class="token punctuation">.</span>schedules <span class="token keyword">import</span> crontabapp<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>beat_schedule <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    <span class="token string">'low-task'</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>        <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'celery_task.tasks.low'</span><span class="token punctuation">,</span>        <span class="token string">'schedule'</span><span class="token punctuation">:</span> timedelta<span class="token punctuation">(</span>seconds<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 'schedule': crontab(hour=8, day_of_week=1),  # æ¯å‘¨ä¸€æ—©å…«ç‚¹</span>        <span class="token string">'args'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token comment" spellcheck="true"># å®šæ—¶ä»»åŠ¡çš„æ·»åŠ å¿…é¡»è¦æ–°å¯åŠ¨ä¸€ä¸ªbeatå‘½ä»¤å»å·¥ä½œ</span><span class="token comment" spellcheck="true"># celery beat -A pc_celery -l info</span><span class="token comment" spellcheck="true"># celery -A pc_celery worker -l info -P eventlet</span></code></pre><h2 id="å››ã€djangoä¸­é…ç½®celery"><a href="#å››ã€djangoä¸­é…ç½®celery" class="headerlink" title="å››ã€djangoä¸­é…ç½®celery"></a>å››ã€djangoä¸­é…ç½®celery</h2><p>celeryåŒ…æœ€å¥½æ”¾åœ¨æ ¹è·¯å¾„ä¸‹</p><p><strong>æ·»åŠ å®šæ—¶ä»»åŠ¡</strong></p><p>celery.py</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> os<span class="token comment" spellcheck="true"># é…ç½®djangoé…ç½®</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'DJANGO_SETTINGS_MODULE'</span><span class="token punctuation">,</span> <span class="token string">'luffyapi.settings.dev'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># é…ç½®celeryçš„workerç¯å¢ƒ</span><span class="token keyword">from</span> celery <span class="token keyword">import</span> Celerybroker <span class="token operator">=</span> <span class="token string">'redis://127.0.0.1:6379/1'</span>backend <span class="token operator">=</span> <span class="token string">'redis://127.0.0.1:6379/2'</span><span class="token comment" spellcheck="true"># å®ä¾‹åŒ–workerå¯¹è±¡appï¼Œç”¨includeæ·»åŠ å®šæ—¶ä»»åŠ¡</span>app<span class="token operator">=</span>Celery<span class="token punctuation">(</span>__name__<span class="token punctuation">,</span>broker<span class="token operator">=</span>broker<span class="token punctuation">,</span>backend<span class="token operator">=</span>backend<span class="token punctuation">,</span>include<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'celery_task.task2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># æ—¶åŒº</span>app<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>timezone <span class="token operator">=</span> <span class="token string">'Asia/Shanghai'</span><span class="token comment" spellcheck="true"># æ˜¯å¦ä½¿ç”¨UTC</span>app<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>enable_utc <span class="token operator">=</span> <span class="token boolean">False</span><span class="token comment" spellcheck="true"># ä»»åŠ¡çš„å®šæ—¶é…ç½®</span><span class="token keyword">from</span> datetime <span class="token keyword">import</span> timedelta<span class="token keyword">from</span> celery<span class="token punctuation">.</span>schedules <span class="token keyword">import</span> crontabapp<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>beat_schedule <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    <span class="token string">'low-task'</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>        <span class="token string">'task'</span><span class="token punctuation">:</span> <span class="token string">'celery_task.task2.update_banner'</span><span class="token punctuation">,</span>        <span class="token string">'schedule'</span><span class="token punctuation">:</span> timedelta<span class="token punctuation">(</span>seconds<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token comment" spellcheck="true"># 'schedule': crontab(hour=8, day_of_week=1),  # æ¯å‘¨ä¸€æ—©å…«ç‚¹</span>        <span class="token comment" spellcheck="true"># 'args': (),</span>    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token comment" spellcheck="true"># å®šæ—¶ä»»åŠ¡çš„æ·»åŠ å¿…é¡»è¦æ–°å¯åŠ¨ä¸€ä¸ªbeatå‘½ä»¤å»å·¥ä½œ</span><span class="token comment" spellcheck="true"># celery beat -A celery_task -l info</span></code></pre><p><strong>taskå®šæ—¶ä»»åŠ¡</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> <span class="token punctuation">.</span>celery <span class="token keyword">import</span> app<span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>cache <span class="token keyword">import</span> cache<span class="token comment" spellcheck="true"># æ¯ä¸‰ç§’è·Ÿæ–°ä¸€æ¬¡ç¼“å­˜</span><span class="token comment" spellcheck="true"># æ·»åŠ ä¸€ä¸ªä»»åŠ¡ï¼Œceleryå†…è®¾å®šé—´éš”æ—¶é—´3ç§’</span><span class="token comment" spellcheck="true"># ä»»åŠ¡å†…å»cacheè·Ÿæ–°banner_listï¼Œä»æ•°æ®åº“ä¸­æ‹¿åˆ°banneræ”¾åˆ°cacheä¸­çš„banner_listä¸­</span><span class="token keyword">from</span> home<span class="token punctuation">.</span>models <span class="token keyword">import</span> Banner<span class="token comment" spellcheck="true"># from luffyapi.settings import const</span><span class="token comment" spellcheck="true"># [OrderedDict(</span><span class="token comment" spellcheck="true">#     [('image', 'http://127.0.0.1:8000/media/banner/banner1.png'), ('link', '/free-courses'), ('name', 'banner1')]),</span><span class="token comment" spellcheck="true">#  OrderedDict(</span><span class="token comment" spellcheck="true">#      [('image', 'http://127.0.0.1:8000/media/banner/banner2.png'), ('link', '/light-courses'), ('name', 'banner2')]),</span><span class="token comment" spellcheck="true">#  OrderedDict(</span><span class="token comment" spellcheck="true">#      [('image', 'http://127.0.0.1:8000/media/banner/banner3.png'), ('link', '/actual-courses'), ('name', 'banner3')])]</span><span class="token keyword">from</span> home<span class="token punctuation">.</span>sers <span class="token keyword">import</span> BannerSer@app<span class="token punctuation">.</span>task<span class="token keyword">def</span> <span class="token function">update_banner</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    queryset <span class="token operator">=</span> Banner<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>is_delete<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>    banner_ser <span class="token operator">=</span> BannerSer<span class="token punctuation">(</span>queryset<span class="token punctuation">,</span>many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> banner <span class="token keyword">in</span> banner_ser<span class="token punctuation">.</span>data<span class="token punctuation">:</span>        banner<span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'http://127.0.0.1:8000'</span> <span class="token operator">+</span> banner<span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">]</span>    cache<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">'banner_list'</span><span class="token punctuation">,</span> banner_ser<span class="token punctuation">.</span>data<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>banner_ser<span class="token punctuation">.</span>data<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string">'æ›´æ–°banneræˆåŠŸ'</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€celeryä»‹ç»&quot;&gt;&lt;a href=&quot;#ä¸€ã€celeryä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€celeryä»‹ç»&quot;&gt;&lt;/a&gt;ä¸€ã€celeryä»‹ç»&lt;/h2&gt;&lt;p&gt;Celery å®˜ç½‘ï¼š&lt;a href=&quot;http://www.celerypr</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="å¼‚æ­¥ä»»åŠ¡æ¡†æ¶" scheme="http://huang_zhao.gitee.io/task/tags/%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E6%A1%86%E6%9E%B6/"/>
    
    <category term="django" scheme="http://huang_zhao.gitee.io/task/tags/django/"/>
    
    <category term="python" scheme="http://huang_zhao.gitee.io/task/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Redisç®¡é“ï¼Œä½å›¾ï¼Œgeoï¼ŒHyperLogLogï¼Œå‘å¸ƒè®¢é˜…</title>
    <link href="http://huang_zhao.gitee.io/task/2020/04/23/Redis%E7%AE%A1%E9%81%93%EF%BC%8C%E4%BD%8D%E5%9B%BE%EF%BC%8Cgeo%EF%BC%8CHyperLogLog%EF%BC%8C%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/"/>
    <id>http://huang_zhao.gitee.io/task/2020/04/23/Redis%E7%AE%A1%E9%81%93%EF%BC%8C%E4%BD%8D%E5%9B%BE%EF%BC%8Cgeo%EF%BC%8CHyperLogLog%EF%BC%8C%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/</id>
    <published>2020-04-23T12:13:11.000Z</published>
    <updated>2020-09-13T14:51:52.165Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€æ…¢æŸ¥è¯¢"><a href="#ä¸€ã€æ…¢æŸ¥è¯¢" class="headerlink" title="ä¸€ã€æ…¢æŸ¥è¯¢"></a>ä¸€ã€æ…¢æŸ¥è¯¢</h2><p>å› ä¸ºredisæ˜¯ä¸ªå•çº¿ç¨‹æ¶æ„ï¼Œæ‰€ä»¥åªè¦æœ‰æ…¢æŸ¥è¯¢å¤¯ä½ä¼šéå¸¸å½±å“æ€§èƒ½ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥é¿å…å‡ºç°æ…¢æŸ¥è¯¢æˆ–è€…é™åˆ¶æ…¢æŸ¥è¯¢</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># redis.conf</span>slowlog<span class="token operator">-</span>log<span class="token operator">-</span>slower<span class="token operator">-</span>than<span class="token operator">=</span><span class="token number">0</span>ï¼Œè®°å½•æ‰€æœ‰å‘½ä»¤slowlog<span class="token operator">-</span>log<span class="token operator">-</span>slower<span class="token operator">-</span>than <span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">,</span>ä¸è®°å½•ä»»ä½•å‘½ä»¤<span class="token comment" spellcheck="true"># ä¹Ÿå¯ä»¥ç›´æ¥åœ¨é“¾æ¥è¿‡ç¨‹ä¸­ä¿®æ”¹é…ç½®</span>config get slowlog<span class="token operator">-</span>max<span class="token operator">-</span>len<span class="token operator">=</span><span class="token number">128</span> <span class="token comment" spellcheck="true"># æ…¢æŸ¥è¯¢æœ€å¤§æ¥æ”¶æ•°</span>Config get slowly<span class="token operator">-</span>log<span class="token operator">-</span>slower<span class="token operator">-</span>than<span class="token operator">=</span><span class="token number">10000</span> <span class="token comment" spellcheck="true"># æ¥å—å°äº1æ¯«ç§’çš„å‘½ä»¤</span></code></pre><p>æ€»ç»“ï¼š</p><ol><li>slowlog-max-len ä¸è¦è®¾ç½®è¿‡å¤§ï¼Œé»˜è®¤10msï¼Œé€šå¸¸è®¾ç½®1ms</li><li>slowlog-log-slower-thanä¸è¦è®¾ç½®è¿‡å°ï¼Œé€šå¸¸è®¾ç½®1000å·¦å³</li><li>ç†è§£å‘½ä»¤ç”Ÿå‘½å‘¨æœŸ</li><li>å®šæœŸæŒä¹…åŒ–æ…¢æŸ¥è¯¢</li></ol><h2 id="äºŒã€piplineå’Œwatch"><a href="#äºŒã€piplineå’Œwatch" class="headerlink" title="äºŒã€piplineå’Œwatch"></a>äºŒã€piplineå’Œwatch</h2><h3 id="1-pipline"><a href="#1-pipline" class="headerlink" title="1 pipline"></a>1 pipline</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># piplineåœ¨rediså‘½ä»¤ä¸­ä¸æ”¯æŒï¼Œä½†æ˜¯åœ¨ç¼–ç¨‹è¯­è¨€ä¸­æ”¯æŒ</span><span class="token comment" spellcheck="true"># å…¶å®å°±æ˜¯æ‰¹é‡æ‰§è¡Œå‘½ä»¤çš„ä¸€ç§æ–¹å¼ï¼Œrediså‘½ä»¤å¯ä»¥ç”¨äº‹åŠ¡æ¥å®ç°è¿™ç§åŠŸèƒ½</span><span class="token comment" spellcheck="true"># å®¢æˆ·ç«¯å®ç°</span><span class="token keyword">import</span> redispool <span class="token operator">=</span> redis<span class="token punctuation">.</span>ConnectionPool<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'10.211.55.4'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">)</span>r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># pipe = r.pipeline(transaction=False)</span><span class="token comment" spellcheck="true">#åˆ›å»ºpipeline</span>pipe <span class="token operator">=</span> r<span class="token punctuation">.</span>pipeline<span class="token punctuation">(</span>transaction<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#å¼€å¯äº‹åŠ¡</span>pipe<span class="token punctuation">.</span>multi<span class="token punctuation">(</span><span class="token punctuation">)</span>pipe<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'lqz'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#å…¶ä»–ä»£ç ï¼Œå¯èƒ½å‡ºå¼‚å¸¸</span>pipe<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">'role'</span><span class="token punctuation">,</span> <span class="token string">'nb'</span><span class="token punctuation">)</span>pipe<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="2-åŸç”Ÿäº‹åŠ¡"><a href="#2-åŸç”Ÿäº‹åŠ¡" class="headerlink" title="2 åŸç”Ÿäº‹åŠ¡"></a>2 åŸç”Ÿäº‹åŠ¡</h3><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> multi <span class="token comment" spellcheck="true"># å¼€å¯äº‹åŠ¡åæ‰€æœ‰çš„å‘½ä»¤éƒ½ä¼šæ”¾åˆ°Queeä¸­ï¼Œç›´åˆ°æ‰§è¡Œexecç»“æŸäº‹åŠ¡æ‰ä¼šæ‰§è¡Œ</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">exec</span> </code></pre><h3 id="3-watch"><a href="#3-watch" class="headerlink" title="3 watch"></a>3 watch</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># redisä¸­å¯ä»¥é€šè¿‡watchå®ç°ä¹è§‚é”</span><span class="token comment" spellcheck="true"># æ¼”ç¤ºï¼šwatchä¸€ä¸ªkeyï¼Œåœ¨å¼€å¯äº‹åŠ¡åå¯ä»¥ä¿®æ”¹è¿™ä¸ªkeyï¼Œä½†æ˜¯å¦‚æœåœ¨äº‹åŠ¡å¤–åŒæ—¶æœ‰ä¿®æ”¹è¿™ä¸ªkeyçš„è¯·æ±‚ï¼Œå†ä¿®æ”¹äº‹åŠ¡ä¸­çš„keyå°±ä¼šå¤±è´¥</span></code></pre><h2 id="ä¸‰ã€ä½å›¾"><a href="#ä¸‰ã€ä½å›¾" class="headerlink" title="ä¸‰ã€ä½å›¾"></a>ä¸‰ã€ä½å›¾</h2><p>å› ä¸ºrediså¯ä»¥é€šè¿‡byteè¿›è¡Œå­˜å‚¨ï¼Œå½’å±å­—ç¬¦ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡bitmapåšä¸€äº›æ“ä½œï¼šç‹¬ç«‹ç”¨æˆ·ç»Ÿè®¡</p><p>éœ€è¦ç”¨æˆ·é‡éå¸¸å¤§å¤§æ¦‚ä¸€äº¿å·¦å³çš„ç”¨æˆ·é‡æ‰ä¼šå’Œç”¨é›†åˆå­˜å‚¨æœ‰å·®åˆ«</p><pre class=" language-python"><code class="language-python">set hello big <span class="token comment" spellcheck="true">#æ”¾å…¥keyä½hello å€¼ä¸ºbigçš„å­—ç¬¦ä¸²</span>getbit hello <span class="token number">0</span> <span class="token comment" spellcheck="true">#å–ä½å›¾çš„ç¬¬0ä¸ªä½ç½®ï¼Œè¿”å›0</span>getbit hello <span class="token number">1</span> <span class="token comment" spellcheck="true">#å–ä½å›¾çš„ç¬¬1ä¸ªä½ç½®ï¼Œè¿”å›1 å¦‚ä¸Šå›¾</span><span class="token comment" spellcheck="true">##æˆ‘ä»¬å¯ä»¥ç›´æ¥æ“çºµä½</span>setbit key offset value <span class="token comment" spellcheck="true">#ç»™ä½å›¾æŒ‡å®šç´¢å¼•è®¾ç½®å€¼</span>setbit hello <span class="token number">7</span> <span class="token number">1</span> <span class="token comment" spellcheck="true">#æŠŠhelloçš„ç¬¬7ä¸ªä½ç½®è®¾ä¸º1 è¿™æ ·ï¼Œbigå°±å˜æˆäº†cig</span>setbit test <span class="token number">50</span> <span class="token number">1</span> <span class="token comment" spellcheck="true">#testä¸å­˜åœ¨ï¼Œåœ¨keyä¸ºtestçš„valueçš„ç¬¬50ä½è®¾ä¸º1ï¼Œé‚£å…¶ä»–ä½éƒ½ä»¥0è¡¥</span>bitcount key <span class="token punctuation">[</span>start end<span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#è·å–ä½å›¾æŒ‡å®šèŒƒå›´(startåˆ°end,å•ä½ä¸ºå­—èŠ‚,æ³¨æ„æŒ‰å­—èŠ‚ä¸€ä¸ªå­—èŠ‚8ä¸ªbitä¸ºï¼Œå¦‚æœä¸æŒ‡å®šå°±æ˜¯è·å–å…¨éƒ¨)ä½å€¼ä¸º1çš„ä¸ªæ•°</span>bitop op destkey key <span class="token punctuation">[</span>key<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#åšå¤šä¸ªBitmapçš„and(äº¤é›†)/or(å¹¶é›†)/not(é)/xor(å¼‚æˆ–)ï¼Œæ“ä½œå¹¶å°†ç»“æœä¿å­˜åœ¨destkeyä¸­ </span>bitop <span class="token operator">and</span> after_lqz lqz lqz2 <span class="token comment" spellcheck="true">#æŠŠlqzå’Œlqz2æŒ‰ä½ä¸æ“ä½œï¼Œæ”¾åˆ°after_lqzä¸­</span>bitpos key targetBit start end <span class="token comment" spellcheck="true">#è®¡ç®—ä½å›¾æŒ‡å®šèŒƒå›´(startåˆ°endï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œå¦‚æœä¸æŒ‡å®šæ˜¯è·å–å…¨éƒ¨)ç¬¬ä¸€ä¸ªåç§»é‡å¯¹åº”çš„å€¼ç­‰äºtargetBitçš„ä½ç½®</span>bitpos lqz <span class="token number">1</span> <span class="token comment" spellcheck="true">#big å¯¹åº”ä½å›¾ä¸­ç¬¬ä¸€ä¸ª1çš„ä½ç½®ï¼Œåœ¨ç¬¬äºŒä¸ªä½ç½®ä¸Šï¼Œç”±äºä»0å¼€å§‹è¿”å›1</span>bitpos lqz <span class="token number">0</span> <span class="token comment" spellcheck="true">#big å¯¹åº”ä½å›¾ä¸­ç¬¬ä¸€ä¸ª0çš„ä½ç½®ï¼Œåœ¨ç¬¬ä¸€ä¸ªä½ç½®ä¸Šï¼Œç”±äºä»0å¼€å§‹è¿”å›0</span>bitpos lqz <span class="token number">1</span> <span class="token number">1</span> <span class="token number">2</span> <span class="token comment" spellcheck="true">#è¿”å›9ï¼šè¿”å›ä»ç¬¬ä¸€ä¸ªå­—èŠ‚åˆ°ç¬¬äºŒä¸ªå­—èŠ‚ä¹‹é—´ ç¬¬ä¸€ä¸ª1çš„ä½ç½®ï¼Œçœ‹ä¸Šå›¾ï¼Œä¸º9</span></code></pre><h2 id="å››ã€HyperLogLog"><a href="#å››ã€HyperLogLog" class="headerlink" title="å››ã€HyperLogLog"></a>å››ã€HyperLogLog</h2><p>æœ¬è´¨ï¼šå¸ƒéš†è¿‡æ»¤å™¨</p><p>å­˜å‚¨æ•°æ®é‡æå°ï¼Œåªæœ‰å­˜åœ¨å’Œä¸å­˜åœ¨çš„çŠ¶æ€ï¼Œæœ¬èº«å†…å®¹æ— æ³•è¯»å–</p><p>ç™¾ä¸‡çº§ç‹¬ç«‹ç”¨æˆ·ç»Ÿè®¡ï¼Œä½†æ˜¯å¯èƒ½ä¼šå‡ºé”™ï¼Œå¯ä»¥åšæ—¥æ´»ç”¨æˆ·ç»Ÿè®¡</p><p>å®é™…ä¸Šå°±ä¸‰ä¸ªæ“ä½œï¼šæ·»åŠ ï¼Œåˆå¹¶ï¼Œç»Ÿè®¡</p><pre class=" language-python"><code class="language-python">pfadd key element <span class="token comment" spellcheck="true">#å‘hyperloglogæ·»åŠ å…ƒç´ ,å¯ä»¥åŒæ—¶æ·»åŠ å¤šä¸ª</span>pfcount key <span class="token comment" spellcheck="true">#è®¡ç®—hyperloglogçš„ç‹¬ç«‹æ€»æ•°</span>pfmerge destroy sourcekey1 sourcekey2<span class="token comment" spellcheck="true">#åˆå¹¶å¤šä¸ªhyperloglogï¼ŒæŠŠsourcekey1å’Œsourcekey2åˆå¹¶ä¸ºdestroy</span>pfadd uuids <span class="token string">"uuid1"</span> <span class="token string">"uuid2"</span> <span class="token string">"uuid3"</span> <span class="token string">"uuid4"</span> <span class="token comment" spellcheck="true">#å‘uuidsä¸­æ·»åŠ 4ä¸ªuuid</span>pfcount uuids <span class="token comment" spellcheck="true">#è¿”å›4</span>pfadd uuids <span class="token string">"uuid1"</span> <span class="token string">"uuid5"</span><span class="token comment" spellcheck="true">#æœ‰ä¸€ä¸ªä¹‹å‰å­˜åœ¨äº†ï¼Œå…¶å®åªæŠŠuuid5æ·»åŠ äº†</span>pfcount uuids <span class="token comment" spellcheck="true">#è¿”å›5</span>pfadd uuids1 <span class="token string">"uuid1"</span> <span class="token string">"uuid2"</span> <span class="token string">"uuid3"</span> <span class="token string">"uuid4"</span>pfadd uuids2 <span class="token string">"uuid3"</span> <span class="token string">"uuid4"</span> <span class="token string">"uuid5"</span> <span class="token string">"uuid6"</span>pfmerge uuidsall uuids1 uuids2 <span class="token comment" spellcheck="true">#åˆå¹¶</span>pfcount uuidsall <span class="token comment" spellcheck="true">#ç»Ÿè®¡ä¸ªæ•° è¿”å›6</span></code></pre><h2 id="äº”ã€geo"><a href="#äº”ã€geo" class="headerlink" title="äº”ã€geo"></a>äº”ã€geo</h2><p>æ ¹æ®ç»çº¬åº¦è®¡ç®—è·ç¦»ï¼Œç»Ÿè®¡èŒƒå›´å†…çš„äºº</p><p>æ“ä½œï¼šæ·»åŠ ï¼Œè·å–ï¼ˆåœ°ç†ä½ç½®ï¼Œä¸¤åœ°è·ç¦»ï¼‰ï¼ŒæŸ¥çœ‹èŒƒå›´å†…çš„äºº</p><pre class=" language-python"><code class="language-python">geoadd key longitude latitude member <span class="token comment" spellcheck="true">#å¢åŠ åœ°ç†ä½ç½®ä¿¡æ¯</span>geoadd cities<span class="token punctuation">:</span>locations <span class="token number">116.28</span> <span class="token number">39.55</span> beijing <span class="token comment" spellcheck="true">#æŠŠåŒ—äº¬åœ°ç†ä¿¡æ¯å¤©æ´¥åˆ°cities:locationsä¸­</span>geoadd cities<span class="token punctuation">:</span>locations <span class="token number">117.12</span> <span class="token number">39.08</span> tianjingeoadd cities<span class="token punctuation">:</span>locations <span class="token number">114.29</span> <span class="token number">38.02</span> shijiazhuanggeoadd cities<span class="token punctuation">:</span>locations <span class="token number">118.01</span> <span class="token number">39.38</span> tangshangeoadd cities<span class="token punctuation">:</span>locations <span class="token number">115.29</span> <span class="token number">38.51</span> baodinggeopos key member <span class="token comment" spellcheck="true">#è·å–åœ°ç†ä½ç½®ä¿¡æ¯</span>geopos cities<span class="token punctuation">:</span>locations beijing <span class="token comment" spellcheck="true">#è·å–åŒ—äº¬åœ°ç†ä¿¡æ¯</span>geodist key member1 member2 <span class="token punctuation">[</span>unit<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#è·å–ä¸¤ä¸ªåœ°ç†ä½ç½®çš„è·ç¦» unit:m(ç±³) km(åƒç±³) mi(è‹±é‡Œ) ft(å°º)</span>geodist cities<span class="token punctuation">:</span>locations beijing tianjin km <span class="token comment" spellcheck="true">#åŒ—äº¬åˆ°å¤©æ´¥çš„è·ç¦»ï¼Œ89å…¬é‡Œ</span>georadius key logitude latitude radiusm<span class="token operator">|</span>km<span class="token operator">|</span>ft<span class="token operator">|</span>mi <span class="token punctuation">[</span>withcoord<span class="token punctuation">]</span> <span class="token punctuation">[</span>withdist<span class="token punctuation">]</span> <span class="token punctuation">[</span>withhash<span class="token punctuation">]</span> <span class="token punctuation">[</span>COUNT count<span class="token punctuation">]</span> <span class="token punctuation">[</span>asc<span class="token operator">|</span>desc<span class="token punctuation">]</span> <span class="token punctuation">[</span>store key<span class="token punctuation">]</span><span class="token punctuation">[</span>storedist key<span class="token punctuation">]</span>georadiusbymember key member radiusm<span class="token operator">|</span>km<span class="token operator">|</span>ft<span class="token operator">|</span>mi <span class="token punctuation">[</span>withcoord<span class="token punctuation">]</span> <span class="token punctuation">[</span>withdist<span class="token punctuation">]</span> <span class="token punctuation">[</span>withhash<span class="token punctuation">]</span> <span class="token punctuation">[</span>COUNT count<span class="token punctuation">]</span> <span class="token punctuation">[</span>asc<span class="token operator">|</span>desc<span class="token punctuation">]</span> <span class="token punctuation">[</span>store key<span class="token punctuation">]</span><span class="token punctuation">[</span>storedist key<span class="token punctuation">]</span><span class="token comment" spellcheck="true">#è·å–æŒ‡å®šä½ç½®èŒƒå›´å†…çš„åœ°ç†ä½ç½®ä¿¡æ¯é›†åˆ</span><span class="token triple-quoted-string string">'''withcoord:è¿”å›ç»“æœä¸­åŒ…å«ç»çº¬åº¦withdistï¼šè¿”å›ç»“æœä¸­åŒ…å«è·ç¦»ä¸­å¿ƒèŠ‚ç‚¹ä½ç½®withhashï¼šè¿”å›è§£é›‡ä¸­åŒ…å«geohashCOUNT countï¼šæŒ‡å®šè¿”å›ç»“æœçš„æ•°é‡asc|descï¼šè¿”å›ç»“æœæŒ‰ç…§è·ç¦»ä¸­å¿ƒåº—çš„è·ç¦»åšå‡åº/é™åºæ’åˆ—store keyï¼šå°†è¿”å›ç»“æœçš„åœ°ç†ä½ç½®ä¿¡æ¯ä¿å­˜åˆ°æŒ‡å®šé”®storedist keyï¼šå°†è¿”å›ç»“æœè·ç¦»ä¸­å¿ƒç‚¹çš„è·ç¦»ä¿å­˜åˆ°æŒ‡å®šé”®'''</span>georadiusbymember cities<span class="token punctuation">:</span>locations beijing <span class="token number">150</span> km<span class="token triple-quoted-string string">'''1) "beijing"2) "tianjin"3) "tangshan"4) "baoding"'''</span></code></pre><h2 id="å…­ã€å‘å¸ƒè®¢é˜…ï¼ˆåŸºæœ¬ä¸ç”¨ï¼‰"><a href="#å…­ã€å‘å¸ƒè®¢é˜…ï¼ˆåŸºæœ¬ä¸ç”¨ï¼‰" class="headerlink" title="å…­ã€å‘å¸ƒè®¢é˜…ï¼ˆåŸºæœ¬ä¸ç”¨ï¼‰"></a>å…­ã€å‘å¸ƒè®¢é˜…ï¼ˆåŸºæœ¬ä¸ç”¨ï¼‰</h2><p>å‘å¸ƒè€…å‘å¸ƒäº†æ¶ˆæ¯ï¼Œæ‰€æœ‰è®¢é˜…è€…éƒ½èƒ½æ¥å—åˆ°ï¼Œæœ¬è´¨æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹</p><pre class=" language-python"><code class="language-python">publish channel message <span class="token comment" spellcheck="true">#å‘å¸ƒå‘½ä»¤</span>publish souhu<span class="token punctuation">:</span>tv <span class="token string">"hello world"</span> <span class="token comment" spellcheck="true">#åœ¨souhu:tvé¢‘é“å‘å¸ƒä¸€æ¡hello world  è¿”å›è®¢é˜…è€…ä¸ªæ•°</span>subscribe <span class="token punctuation">[</span>channel<span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#è®¢é˜…å‘½ä»¤ï¼Œå¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ª</span>subscribe souhu<span class="token punctuation">:</span>tv  <span class="token comment" spellcheck="true">#è®¢é˜…sohu:tvé¢‘é“</span>unsubscribe <span class="token punctuation">[</span>channel<span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#å–æ¶ˆè®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“</span>unsubscribe sohu<span class="token punctuation">:</span>tv  <span class="token comment" spellcheck="true">#å–æ¶ˆè®¢é˜…sohu:tvé¢‘é“</span>psubscribe <span class="token punctuation">[</span>pattern<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#è®¢é˜…æ¨¡å¼åŒ¹é…</span>psubscribe c<span class="token operator">*</span>  <span class="token comment" spellcheck="true">#è®¢é˜…ä»¥cå¼€å¤´çš„é¢‘é“</span>unpsubscribe <span class="token punctuation">[</span>pattern<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#æŒ‰æ¨¡å¼é€€è®¢æŒ‡å®šé¢‘é“</span>pubsub channels <span class="token comment" spellcheck="true">#åˆ—å‡ºè‡³å°‘æœ‰ä¸€ä¸ªè®¢é˜…è€…çš„é¢‘é“,åˆ—å‡ºæ´»è·ƒçš„é¢‘é“</span>pubsub numsub <span class="token punctuation">[</span>channel<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#åˆ—å‡ºç»™å®šé¢‘é“çš„è®¢é˜…è€…æ•°é‡</span>pubsub numpat <span class="token comment" spellcheck="true">#åˆ—å‡ºè¢«è®¢é˜…æ¨¡å¼çš„æ•°é‡</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€æ…¢æŸ¥è¯¢&quot;&gt;&lt;a href=&quot;#ä¸€ã€æ…¢æŸ¥è¯¢&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€æ…¢æŸ¥è¯¢&quot;&gt;&lt;/a&gt;ä¸€ã€æ…¢æŸ¥è¯¢&lt;/h2&gt;&lt;p&gt;å› ä¸ºredisæ˜¯ä¸ªå•çº¿ç¨‹æ¶æ„ï¼Œæ‰€ä»¥åªè¦æœ‰æ…¢æŸ¥è¯¢å¤¯ä½ä¼šéå¸¸å½±å“æ€§èƒ½ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥é¿å…å‡ºç°æ…¢æŸ¥è¯¢æˆ–è€…é™åˆ¶æ…¢æŸ¥è¯¢&lt;/p</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="æ•°æ®åº“" scheme="http://huang_zhao.gitee.io/task/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Redisé«˜çº§" scheme="http://huang_zhao.gitee.io/task/tags/Redis%E9%AB%98%E7%BA%A7/"/>
    
  </entry>
  
  <entry>
    <title>Scrapyæ¡†æ¶</title>
    <link href="http://huang_zhao.gitee.io/task/2020/04/22/scrapy%E7%88%AC%E8%99%AB%E6%A1%86%E6%9E%B6/"/>
    <id>http://huang_zhao.gitee.io/task/2020/04/22/scrapy%E7%88%AC%E8%99%AB%E6%A1%86%E6%9E%B6/</id>
    <published>2020-04-22T04:30:31.000Z</published>
    <updated>2020-09-04T11:23:22.586Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€å®‰è£…"><a href="#ä¸€ã€å®‰è£…" class="headerlink" title="ä¸€ã€å®‰è£…"></a>ä¸€ã€å®‰è£…</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#1 pip3 install scrapyï¼ˆmacï¼Œlinuxï¼‰</span><span class="token comment" spellcheck="true">#2 windowsä¸Šï¼ˆ80%èƒ½æˆåŠŸï¼Œå°‘éƒ¨åˆ†äººæˆåŠŸä¸äº†ï¼‰</span>    <span class="token number">1</span>ã€pip3 install wheel <span class="token comment" spellcheck="true">#å®‰è£…åï¼Œä¾¿æ”¯æŒé€šè¿‡wheelæ–‡ä»¶å®‰è£…è½¯ä»¶ï¼Œwheelæ–‡ä»¶å®˜ç½‘ï¼šhttps://www.lfd.uci.edu/~gohlke/pythonlibs</span>    <span class="token number">3</span>ã€pip3 install lxml    <span class="token number">4</span>ã€pip3 install pyopenssl    <span class="token number">5</span>ã€ä¸‹è½½å¹¶å®‰è£…pywin32ï¼šhttps<span class="token punctuation">:</span><span class="token operator">//</span>sourceforge<span class="token punctuation">.</span>net<span class="token operator">/</span>projects<span class="token operator">/</span>pywin32<span class="token operator">/</span>files<span class="token operator">/</span>pywin32<span class="token operator">/</span>    <span class="token number">6</span>ã€ä¸‹è½½twistedçš„wheelæ–‡ä»¶ï¼šhttp<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>lfd<span class="token punctuation">.</span>uci<span class="token punctuation">.</span>edu<span class="token operator">/</span><span class="token operator">~</span>gohlke<span class="token operator">/</span>pythonlibs<span class="token operator">/</span><span class="token comment" spellcheck="true">#twisted</span>    <span class="token number">7</span>ã€æ‰§è¡Œpip3 install ä¸‹è½½ç›®å½•\Twisted<span class="token number">-17.9</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">-</span>cp36<span class="token operator">-</span>cp36m<span class="token operator">-</span>win_amd64<span class="token punctuation">.</span>whl    <span class="token number">8</span>ã€pip3 install scrapy<span class="token comment" spellcheck="true"># 3 å°±æœ‰scrapyå‘½ä»¤</span>    <span class="token operator">-</span>D<span class="token punctuation">:</span>\Python36\Scripts\scrapy<span class="token punctuation">.</span>exe  ç”¨äºåˆ›å»ºé¡¹ç›®</code></pre><h2 id="äºŒã€æ¡†æ¶ç®€ä»‹"><a href="#äºŒã€æ¡†æ¶ç®€ä»‹" class="headerlink" title="äºŒã€æ¡†æ¶ç®€ä»‹"></a>äºŒã€æ¡†æ¶ç®€ä»‹</h2><p><strong>æ‰§è¡Œæµç¨‹å›¾</strong></p><p><img src="https://gitee.com/huang_zhao/hz/raw/master/hz/1036857-20171109221422778-1731419400.png" alt="1036857-20171109221422778-1731419400" loading="lazy"></p><ol><li><p>å¼•æ“(EGINE)</p><p>å¼•æ“è´Ÿè´£æ§åˆ¶ç³»ç»Ÿæ‰€æœ‰ç»„ä»¶ä¹‹é—´çš„æ•°æ®æµï¼Œå¹¶åœ¨æŸäº›åŠ¨ä½œå‘ç”Ÿæ—¶è§¦å‘äº‹ä»¶ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ä¸Šé¢çš„æ•°æ®æµéƒ¨åˆ†ã€‚</p><p>ï¼ˆscrapyçš„æ ¸å¿ƒï¼Œç”¨äºè½¬å‘æ•°æ®æˆ–è¯·æ±‚ï¼Œå¦‚æœæ˜¯æ•°æ®ï¼Œè½¬åˆ°ç®¡é“å»ä¿å­˜ï¼Œå¦‚æœæ˜¯è¯·æ±‚ï¼Œè½¬åˆ°è°ƒåº¦å™¨ï¼Œå¦‚æœæ¥çš„æ˜¯å“åº”å¯¹è±¡ï¼Œè½¬ç»™çˆ¬è™«ï¼‰</p></li><li><p><strong>è°ƒåº¦å™¨(SCHEDULER)</strong><br>ç”¨æ¥æ¥å—å¼•æ“å‘è¿‡æ¥çš„è¯·æ±‚, å‹å…¥é˜Ÿåˆ—ä¸­, å¹¶åœ¨å¼•æ“å†æ¬¡è¯·æ±‚çš„æ—¶å€™è¿”å›. å¯ä»¥æƒ³åƒæˆä¸€ä¸ªURLçš„ä¼˜å…ˆçº§é˜Ÿåˆ—, ç”±å®ƒæ¥å†³å®šä¸‹ä¸€ä¸ªè¦æŠ“å–çš„ç½‘å€æ˜¯ä»€ä¹ˆ, åŒæ—¶å»é™¤é‡å¤çš„ç½‘å€</p><p>ï¼ˆç”¨äºå¤„ç†è¦çˆ¬å–çš„urlçš„é¡ºåºï¼Œæ·±åº¦ä¼˜å…ˆ/è¡¨ç¤ºä¸€æ¡è·¯èµ°åˆ°é»‘ï¼Œè¿˜æ˜¯å¹¿åº¦ä¼˜å…ˆ/è¡¨ç¤ºåŒä¸€å±‚å…ˆçˆ¬ä¸‹æ¥ï¼Œï¼Œå»é‡ï¼‰</p></li><li><p><strong>ä¸‹è½½å™¨(DOWLOADER)</strong><br>ç”¨äºä¸‹è½½ç½‘é¡µå†…å®¹, å¹¶å°†ç½‘é¡µå†…å®¹è¿”å›ç»™EGINEï¼Œä¸‹è½½å™¨æ˜¯å»ºç«‹åœ¨twistedè¿™ä¸ªé«˜æ•ˆçš„å¼‚æ­¥æ¨¡å‹ä¸Šçš„</p><p>ï¼ˆå‘å¤–è¦çˆ¬å–çš„åœ°å€å‘é€è¯·æ±‚ï¼‰</p></li><li><p><strong>çˆ¬è™«(SPIDERS)</strong><br>SPIDERSæ˜¯å¼€å‘äººå‘˜è‡ªå®šä¹‰çš„ç±»ï¼Œç”¨æ¥è§£æresponsesï¼Œå¹¶ä¸”æå–itemsï¼Œæˆ–è€…å‘é€æ–°çš„è¯·æ±‚</p></li><li><p><strong>é¡¹ç›®ç®¡é“(ITEM PIPLINES)</strong><br>åœ¨itemsè¢«æå–åè´Ÿè´£å¤„ç†å®ƒä»¬ï¼Œä¸»è¦åŒ…æ‹¬æ¸…ç†ã€éªŒè¯ã€æŒä¹…åŒ–ï¼ˆæ¯”å¦‚å­˜åˆ°æ•°æ®åº“ï¼‰ç­‰æ“ä½œ</p><p>ï¼ˆéœ€è¦åœ¨settingsä¸­é…ç½®ï¼‰</p></li><li><p>ä¸‹è½½å™¨ä¸­é—´ä»¶(Downloader Middlewares)</p><p>ä½äºScrapyå¼•æ“å’Œä¸‹è½½å™¨ä¹‹é—´ï¼Œä¸»è¦ç”¨æ¥å¤„ç†ä»EGINEä¼ åˆ°DOWLOADERçš„è¯·æ±‚requestï¼Œå·²ç»ä»DOWNLOADERä¼ åˆ°EGINEçš„å“åº”responseï¼Œä½ å¯ç”¨è¯¥ä¸­é—´ä»¶åšä»¥ä¸‹å‡ ä»¶äº‹</p><ol><li>process a request just before it is sent to the Downloader (i.e. right before Scrapy sends the request to the website);</li><li>change received response before passing it to a spider;</li><li>send a new Request instead of passing received response to a spider;</li><li>pass response to a spider without fetching a web page;</li><li>silently drop some requests.</li></ol></li><li><p><strong>çˆ¬è™«ä¸­é—´ä»¶(Spider Middlewares)</strong><br>ä½äºEGINEå’ŒSPIDERSä¹‹é—´ï¼Œä¸»è¦å·¥ä½œæ˜¯å¤„ç†SPIDERSçš„è¾“å…¥ï¼ˆå³responsesï¼‰å’Œè¾“å‡ºï¼ˆå³requestsï¼‰</p></li></ol><p>æ‰§è¡Œé¡ºåºï¼šçˆ¬è™«æŠŠè¦çˆ¬çš„urlè½¬å‘ç»™å¼•æ“ï¼Œå¼•æ“å†è½¬å‘ç»™è°ƒåº¦å™¨ï¼Œç”±è°ƒåº¦å™¨å†³å®šé¡ºåºï¼Œè¿”å›ç»™å¼•æ“ï¼Œå¼•æ“å†æŠŠè¦çˆ¬å–çš„urlé€šè¿‡ä¸‹è½½ä¸­é—´ä»¶ï¼ˆç”¨äºåŠ ä¸ªå¤´ï¼Œcookieå•¥çš„ï¼‰å‘éœ€è¦çˆ¬å–çš„æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œå“åº”å›æ¥ä¹‹åä¹Ÿé€šè¿‡ä¸‹è½½ä¸­é—´ä»¶ç»™å¼•æ“ï¼Œå¼•æ“åˆ¤æ–­æ˜¯å“åº”æ•°æ®ä¹‹åï¼Œè½¬å‘ç»™çˆ¬è™«ï¼Œçˆ¬è™«å¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„éœ€è¦çˆ¬çš„åœ°å€ï¼ˆå°±ç»§ç»­ä¸Šé¢çš„æµç¨‹ï¼‰æˆ–è€…éœ€è¦ä¿å­˜çš„æ•°æ®ï¼Œæ•°æ®éƒ¨åˆ†ç”±å¼•æ“è½¬å‘ç»™ç®¡é“ï¼Œä¿å­˜æ•°æ®</p><p><strong>ç›®å½•ä»‹ç»</strong></p><pre class=" language-python"><code class="language-python">    firstscrapy  <span class="token comment" spellcheck="true"># é¡¹ç›®åå­—</span>        firstscrapy <span class="token comment" spellcheck="true"># åŒ…</span>            <span class="token operator">-</span>spiders <span class="token comment" spellcheck="true"># æ‰€æœ‰çš„çˆ¬è™«æ–‡ä»¶æ”¾åœ¨é‡Œé¢</span>                <span class="token operator">-</span>baidu<span class="token punctuation">.</span>py <span class="token comment" spellcheck="true"># ä¸€ä¸ªä¸ªçš„çˆ¬è™«ï¼ˆä»¥ååŸºæœ¬ä¸Šéƒ½åœ¨è¿™å†™ä¸œè¥¿ï¼‰</span>                <span class="token operator">-</span>chouti<span class="token punctuation">.</span>py            <span class="token operator">-</span>middlewares<span class="token punctuation">.</span>py <span class="token comment" spellcheck="true"># ä¸­é—´ä»¶ï¼ˆçˆ¬è™«ï¼Œä¸‹è½½ä¸­é—´ä»¶éƒ½å†™åœ¨è¿™ï¼‰</span>            <span class="token operator">-</span>pipelines<span class="token punctuation">.</span>py   <span class="token comment" spellcheck="true"># æŒä¹…åŒ–ç›¸å…³å†™åœ¨è¿™ï¼ˆitems.pyä¸­ç±»çš„å¯¹è±¡ï¼‰</span>            <span class="token operator">-</span>main<span class="token punctuation">.</span>py        <span class="token comment" spellcheck="true"># è‡ªå·±åŠ çš„ï¼Œæ‰§è¡Œçˆ¬è™«</span>            <span class="token operator">-</span>items<span class="token punctuation">.</span>py       <span class="token comment" spellcheck="true"># ä¸€ä¸ªä¸€ä¸ªçš„ç±»ï¼Œ</span>            <span class="token operator">-</span>settings<span class="token punctuation">.</span>py    <span class="token comment" spellcheck="true"># é…ç½®æ–‡ä»¶</span>        scrapy<span class="token punctuation">.</span>cfg          <span class="token comment" spellcheck="true"># ä¸Šçº¿ç›¸å…³</span></code></pre><p><strong>settingså‚æ•°ä»‹ç»</strong></p><pre class=" language-python"><code class="language-python"><span class="token number">1</span> é»˜è®¤æƒ…å†µï¼Œscrapyä¼šå»éµå¾ªçˆ¬è™«åè®®<span class="token number">2</span> ä¿®æ”¹é…ç½®æ–‡ä»¶å‚æ•°ï¼Œå¼ºè¡Œçˆ¬å–ï¼Œä¸éµå¾ªåè®®    <span class="token operator">-</span>ROBOTSTXT_OBEY <span class="token operator">=</span> <span class="token boolean">False</span><span class="token number">3</span> USER_AGENT <span class="token operator">=</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36'</span><span class="token number">4</span> LOG_LEVEL<span class="token operator">=</span><span class="token string">'ERROR'</span> <span class="token comment" spellcheck="true"># è¿è¡Œçš„æ—¶å€™å°±ä¸ä¼šæŠŠå…¶ä»–æ—¥å¿—å±•ç¤ºå‡ºæ¥</span></code></pre><h2 id="ä¸‰ã€åŸºæœ¬ä½¿ç”¨"><a href="#ä¸‰ã€åŸºæœ¬ä½¿ç”¨" class="headerlink" title="ä¸‰ã€åŸºæœ¬ä½¿ç”¨"></a>ä¸‰ã€åŸºæœ¬ä½¿ç”¨</h2><h3 id="1-åŸºæœ¬å‘½ä»¤"><a href="#1-åŸºæœ¬å‘½ä»¤" class="headerlink" title="1 åŸºæœ¬å‘½ä»¤"></a>1 åŸºæœ¬å‘½ä»¤</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># åˆ›å»ºé¡¹ç›®</span>scrapy startproject firstscrapy<span class="token comment" spellcheck="true"># åˆ›å»ºçˆ¬è™«</span>scrapy genspider çˆ¬è™«å çˆ¬è™«åœ°å€scrapy genspider chouti dig<span class="token punctuation">.</span>chouti<span class="token punctuation">.</span>com<span class="token comment" spellcheck="true"># ä¸€æ‰§è¡Œå°±ä¼šåœ¨spideræ–‡ä»¶å¤¹ä¸‹åˆ›å»ºå‡ºä¸€ä¸ªpyæ–‡ä»¶</span><span class="token comment" spellcheck="true"># è¿è¡Œçˆ¬è™«</span>scrapy crawl chouti   <span class="token comment" spellcheck="true"># å¸¦è¿è¡Œæ—¥å¿—</span>scrapy crawl chouti <span class="token operator">-</span><span class="token operator">-</span>nolog  <span class="token comment" spellcheck="true"># ä¸å¸¦æ—¥å¿—</span><span class="token comment" spellcheck="true"># æ”¯æŒå³é”®æ‰§è¡Œçˆ¬è™«</span><span class="token comment" spellcheck="true"># åœ¨é¡¹ç›®è·¯å¾„ä¸‹æ–°å»ºä¸€ä¸ªmain.py</span><span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>cmdline <span class="token keyword">import</span> executeexecute<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'scrapy'</span><span class="token punctuation">,</span><span class="token string">'crawl'</span><span class="token punctuation">,</span><span class="token string">'chouti'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><h3 id="2-æ•°æ®è§£æ"><a href="#2-æ•°æ®è§£æ" class="headerlink" title="2 æ•°æ®è§£æ"></a>2 æ•°æ®è§£æ</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#xpathï¼š</span>    <span class="token operator">-</span>response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//a[contains(@class,"link-title")]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># å–æ–‡æœ¬</span>    <span class="token operator">-</span>response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//a[contains(@class,"link-title")]/@href'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">#å–å±æ€§</span><span class="token comment" spellcheck="true">#css</span>    <span class="token operator">-</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'.link-title::text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># å–æ–‡æœ¬</span>    <span class="token operator">-</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'.link-title::attr(href)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># å–å±æ€§</span></code></pre><h3 id="3-æ•°æ®æŒä¹…åŒ–"><a href="#3-æ•°æ®æŒä¹…åŒ–" class="headerlink" title="3 æ•°æ®æŒä¹…åŒ–"></a>3 æ•°æ®æŒä¹…åŒ–</h3><p><strong>items.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># æŒä¹…åŒ–åŒ¹é…çš„å­—æ®µ</span><span class="token keyword">class</span> <span class="token class-name">ChoutiItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># define the fields for your item here like:</span>    title <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>    laiyuan <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><strong>spiders/chouti.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> scrapy<span class="token keyword">class</span> <span class="token class-name">ChoutiSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> <span class="token string">'chouti'</span>    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'dig.chouti.com'</span><span class="token punctuation">]</span>    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'http://dig.chouti.com/'</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># è¿”å›è¦çˆ¬å–çš„é¡µé¢ï¼Œæˆ–è€…è¿”å›è¦ä¿å­˜çš„æ•°æ®</span>        <span class="token comment" spellcheck="true"># ä¸‹é¢ä¸¤è€…æ•ˆæœç›¸åŒ</span>        <span class="token keyword">from</span> pachong<span class="token punctuation">.</span>items <span class="token keyword">import</span> ChoutiItem        item <span class="token operator">=</span> ChoutiItem<span class="token punctuation">(</span><span class="token punctuation">)</span>        div_list <span class="token operator">=</span> response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'.link-con .link-item'</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># div_list = response.xpath('//div[contains(@class,"link-item")]')</span>        <span class="token keyword">for</span> div <span class="token keyword">in</span> div_list<span class="token punctuation">:</span>            title <span class="token operator">=</span> div<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'.link-title::text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>            laiyuan <span class="token operator">=</span> div<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'.link-from::text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># title = div.xpath('//a[contains(@class,"link-title")]/text()').extract()</span>            <span class="token keyword">if</span> <span class="token operator">not</span> laiyuan<span class="token punctuation">:</span>                laiyuan <span class="token operator">=</span> <span class="token string">''</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span>laiyuan<span class="token punctuation">)</span>            item<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span> <span class="token operator">=</span> title            item<span class="token punctuation">[</span><span class="token string">'laiyuan'</span><span class="token punctuation">]</span> <span class="token operator">=</span> laiyuan            <span class="token keyword">yield</span> item</code></pre><p><strong>pipelines.py</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pymysql<span class="token keyword">class</span> <span class="token class-name">PachongPipeline</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">open_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>spider<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>conn <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>                 database<span class="token operator">=</span><span class="token string">'pachong'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>        cursor <span class="token operator">=</span> self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>        sql <span class="token operator">=</span> <span class="token string">'insert into chouti (title,laiyuan)values(%s,%s)'</span>        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span><span class="token punctuation">[</span>item<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>item<span class="token punctuation">[</span><span class="token string">'laiyuan'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> item    <span class="token keyword">def</span> <span class="token function">close_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>spider<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><strong>settings.py</strong></p><pre class=" language-python"><code class="language-python">ITEM_PIPELINES <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>   <span class="token string">'pachong.pipelines.PachongPipeline'</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token comment" spellcheck="true"># é…ç½®ä¼˜å…ˆçº§</span></code></pre><h2 id="å››ã€scrapyé«˜çº§"><a href="#å››ã€scrapyé«˜çº§" class="headerlink" title="å››ã€scrapyé«˜çº§"></a>å››ã€scrapyé«˜çº§</h2><h3 id="1-æå‡scrapyçˆ¬å–æ•°æ®çš„æ•ˆç‡"><a href="#1-æå‡scrapyçˆ¬å–æ•°æ®çš„æ•ˆç‡" class="headerlink" title="1 æå‡scrapyçˆ¬å–æ•°æ®çš„æ•ˆç‡"></a>1 æå‡scrapyçˆ¬å–æ•°æ®çš„æ•ˆç‡</h3><pre class=" language-python"><code class="language-python"><span class="token operator">-</span> åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œç›¸å…³çš„é…ç½®å³å¯<span class="token punctuation">:</span><span class="token punctuation">(</span>é»˜è®¤è¿˜æœ‰ä¸€å¥—setting<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#1 å¢åŠ å¹¶å‘ï¼š</span>é»˜è®¤scrapyå¼€å¯çš„å¹¶å‘çº¿ç¨‹ä¸º<span class="token number">32</span>ä¸ªï¼Œå¯ä»¥é€‚å½“è¿›è¡Œå¢åŠ ã€‚åœ¨settingsé…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹CONCURRENT_REQUESTS <span class="token operator">=</span> <span class="token number">100</span>å€¼ä¸º<span class="token number">100</span><span class="token punctuation">,</span>å¹¶å‘è®¾ç½®æˆäº†ä¸º<span class="token number">100</span>ã€‚<span class="token comment" spellcheck="true">#2 é™ä½æ—¥å¿—çº§åˆ«ï¼š</span>åœ¨è¿è¡Œscrapyæ—¶ï¼Œä¼šæœ‰å¤§é‡æ—¥å¿—ä¿¡æ¯çš„è¾“å‡ºï¼Œä¸ºäº†å‡å°‘CPUçš„ä½¿ç”¨ç‡ã€‚å¯ä»¥è®¾ç½®logè¾“å‡ºä¿¡æ¯ä¸ºINFOæˆ–è€…ERRORå³å¯ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™ï¼šLOG_LEVEL <span class="token operator">=</span> â€˜INFOâ€™<span class="token comment" spellcheck="true"># 3 ç¦æ­¢cookieï¼š</span>å¦‚æœä¸æ˜¯çœŸçš„éœ€è¦cookieï¼Œåˆ™åœ¨scrapyçˆ¬å–æ•°æ®æ—¶å¯ä»¥ç¦æ­¢cookieä»è€Œå‡å°‘CPUçš„ä½¿ç”¨ç‡ï¼Œæå‡çˆ¬å–æ•ˆç‡ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™ï¼šCOOKIES_ENABLED <span class="token operator">=</span> <span class="token boolean">False</span><span class="token comment" spellcheck="true"># 4ç¦æ­¢é‡è¯•ï¼š</span>å¯¹å¤±è´¥çš„HTTPè¿›è¡Œé‡æ–°è¯·æ±‚ï¼ˆé‡è¯•ï¼‰ä¼šå‡æ…¢çˆ¬å–é€Ÿåº¦ï¼Œå› æ­¤å¯ä»¥ç¦æ­¢é‡è¯•ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ç¼–å†™ï¼šRETRY_ENABLED <span class="token operator">=</span> <span class="token boolean">False</span><span class="token comment" spellcheck="true"># 5 å‡å°‘ä¸‹è½½è¶…æ—¶ï¼š</span>å¦‚æœå¯¹ä¸€ä¸ªéå¸¸æ…¢çš„é“¾æ¥è¿›è¡Œçˆ¬å–ï¼Œå‡å°‘ä¸‹è½½è¶…æ—¶å¯ä»¥èƒ½è®©å¡ä½çš„é“¾æ¥å¿«é€Ÿè¢«æ”¾å¼ƒï¼Œä»è€Œæå‡æ•ˆç‡ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œç¼–å†™ï¼šDOWNLOAD_TIMEOUT <span class="token operator">=</span> <span class="token number">10</span> è¶…æ—¶æ—¶é—´ä¸º10s</code></pre><h3 id="2-scrapyçš„ä¸­é—´ä»¶ï¼ˆä¸‹è½½ä¸­é—´ä»¶ï¼‰"><a href="#2-scrapyçš„ä¸­é—´ä»¶ï¼ˆä¸‹è½½ä¸­é—´ä»¶ï¼‰" class="headerlink" title="2 scrapyçš„ä¸­é—´ä»¶ï¼ˆä¸‹è½½ä¸­é—´ä»¶ï¼‰"></a>2 scrapyçš„ä¸­é—´ä»¶ï¼ˆä¸‹è½½ä¸­é—´ä»¶ï¼‰</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 1 éƒ½å†™åœ¨middlewares.py</span><span class="token comment" spellcheck="true"># 2 çˆ¬è™«ä¸­é—´ä»¶</span><span class="token comment" spellcheck="true"># 3 ä¸‹è½½ä¸­é—´ä»¶</span><span class="token comment" spellcheck="true"># 4 è¦ç”Ÿæ•ˆï¼Œä¸€å®šè¦é…ç½®ï¼Œé…ç½®æ–‡ä»¶</span><span class="token comment" spellcheck="true"># ä¸‹è½½ä¸­é—´ä»¶</span><span class="token operator">-</span>process_requestï¼šè¿”å›ä¸åŒçš„å¯¹è±¡ï¼Œåç»­å¤„ç†ä¸åŒï¼ˆåŠ ä»£ç†<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>ï¼‰          <span class="token comment" spellcheck="true"># 1 æ›´æ¢è¯·æ±‚å¤´</span>        <span class="token comment" spellcheck="true"># print(type(request.headers))</span>        <span class="token comment" spellcheck="true"># print(request.headers)</span>        <span class="token comment" spellcheck="true">#</span>        <span class="token comment" spellcheck="true"># from scrapy.http.headers import Headers</span>        <span class="token comment" spellcheck="true"># request.headers['User-Agent']=''</span>        <span class="token comment" spellcheck="true"># 2 åŠ cookie ---cookieæ± </span>        <span class="token comment" spellcheck="true"># å‡è®¾ä½ ä½ å·²ç»æ­å»ºå¥½cookie æ± äº†ï¼Œ</span>        <span class="token comment" spellcheck="true"># print('00000--',request.cookies)</span>        <span class="token comment" spellcheck="true"># request.cookies=&amp;#123;'username':'asdfasdf'&amp;#125;</span>        <span class="token comment" spellcheck="true"># 3 åŠ ä»£ç†</span>        <span class="token comment" spellcheck="true"># print(request.meta)</span>        <span class="token comment" spellcheck="true"># request.meta['download_timeout'] = 20</span>        <span class="token comment" spellcheck="true"># request.meta["proxy"] = 'http://27.188.62.3:8060'</span><span class="token operator">-</span>process_responseï¼šè¿”å›ä¸åŒçš„å¯¹è±¡ï¼Œåç»­å¤„ç†ä¸åŒ<span class="token operator">-</span> process_exception<span class="token keyword">def</span> <span class="token function">process_exception</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> exception<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'xxxx'</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># ä¸å…è®¸ç›´æ¥æ”¹url</span>        <span class="token comment" spellcheck="true"># request.url='https://www.baidu.com'</span>        <span class="token keyword">from</span> scrapy <span class="token keyword">import</span> Request        request<span class="token operator">=</span>Request<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">,</span>callback<span class="token operator">=</span>spider<span class="token punctuation">.</span>parser<span class="token punctuation">)</span>        <span class="token keyword">return</span> request</code></pre><h3 id="3-seleniumåœ¨scrapyä¸­çš„ä½¿ç”¨æµç¨‹"><a href="#3-seleniumåœ¨scrapyä¸­çš„ä½¿ç”¨æµç¨‹" class="headerlink" title="3 seleniumåœ¨scrapyä¸­çš„ä½¿ç”¨æµç¨‹"></a>3 seleniumåœ¨scrapyä¸­çš„ä½¿ç”¨æµç¨‹</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># å½“å‰çˆ¬è™«ç”¨çš„seleniumæ˜¯åŒä¸€ä¸ª</span><span class="token comment" spellcheck="true"># 1 åœ¨çˆ¬è™«ä¸­åˆå§‹åŒ–webdriverå¯¹è±¡</span>    <span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver    <span class="token keyword">class</span> <span class="token class-name">CnblogSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>        name <span class="token operator">=</span> <span class="token string">'cnblog'</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> bro<span class="token operator">=</span>webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>executable_path<span class="token operator">=</span><span class="token string">'../chromedriver.exe'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 2 åœ¨ä¸­é—´ä»¶ä¸­ä½¿ç”¨ï¼ˆprocess_requestï¼‰</span>spider<span class="token punctuation">.</span>bro<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://dig.chouti.com/'</span><span class="token punctuation">)</span>   response<span class="token operator">=</span>HtmlResponse<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'https://dig.chouti.com/'</span><span class="token punctuation">,</span>body<span class="token operator">=</span>spider<span class="token punctuation">.</span>bro<span class="token punctuation">.</span>page_source<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>request<span class="token operator">=</span>request<span class="token punctuation">)</span>    <span class="token keyword">return</span> response<span class="token comment" spellcheck="true"># 3 åœ¨çˆ¬è™«ä¸­å…³é—­</span>    <span class="token keyword">def</span> <span class="token function">close</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> reason<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"æˆ‘ç»“æŸäº†"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>bro<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="4-åˆ†å¸ƒå¼çˆ¬è™«ï¼ˆscrapy-redisï¼‰"><a href="#4-åˆ†å¸ƒå¼çˆ¬è™«ï¼ˆscrapy-redisï¼‰" class="headerlink" title="4 åˆ†å¸ƒå¼çˆ¬è™«ï¼ˆscrapy-redisï¼‰"></a>4 åˆ†å¸ƒå¼çˆ¬è™«ï¼ˆscrapy-redisï¼‰</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 1 pip3 install scrapy-redis</span><span class="token comment" spellcheck="true"># 2 åŸæ¥ç»§æ‰¿Spiderï¼Œç°åœ¨ç»§æ‰¿RedisSpider</span><span class="token comment" spellcheck="true"># 3 ä¸èƒ½å†™start_urls = ['https:/www.cnblogs.com/']</span><span class="token comment" spellcheck="true"># 4 éœ€è¦å†™redis_key = 'myspider:start_urls'</span><span class="token comment" spellcheck="true"># 5 settingä¸­é…ç½®ï¼š</span><span class="token comment" spellcheck="true"># redisçš„è¿æ¥</span>REDIS_HOST <span class="token operator">=</span> <span class="token string">'localhost'</span>                            <span class="token comment" spellcheck="true"># ä¸»æœºå</span>REDIS_PORT <span class="token operator">=</span> <span class="token number">6379</span>                                   <span class="token comment" spellcheck="true"># ç«¯å£</span>    <span class="token comment" spellcheck="true"># ä½¿ç”¨scrapy-redisçš„å»é‡</span>DUPEFILTER_CLASS <span class="token operator">=</span> <span class="token string">"scrapy_redis.dupefilter.RFPDupeFilter"</span><span class="token comment" spellcheck="true"># ä½¿ç”¨scrapy-redisçš„Scheduler</span><span class="token comment" spellcheck="true"># åˆ†å¸ƒå¼çˆ¬è™«çš„é…ç½®</span>SCHEDULER <span class="token operator">=</span> <span class="token string">"scrapy_redis.scheduler.Scheduler"</span><span class="token comment" spellcheck="true"># æŒä¹…åŒ–çš„å¯ä»¥é…ç½®ï¼Œä¹Ÿå¯ä»¥ä¸é…ç½®</span>ITEM_PIPELINES <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>   <span class="token string">'scrapy_redis.pipelines.RedisPipeline'</span><span class="token punctuation">:</span> <span class="token number">299</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span><span class="token comment" spellcheck="true"># 9ç°åœ¨è¦è®©çˆ¬è™«è¿è¡Œèµ·æ¥ï¼Œéœ€è¦å»redisä¸­ä»¥myspider:start_urlsä¸ºkeyï¼Œæ’å…¥ä¸€ä¸ªèµ·å§‹åœ°å€lpush myspider:start_urls https://www.cnblogs.com/</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€å®‰è£…&quot;&gt;&lt;a href=&quot;#ä¸€ã€å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€å®‰è£…&quot;&gt;&lt;/a&gt;ä¸€ã€å®‰è£…&lt;/h2&gt;&lt;pre class=&quot; language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="çˆ¬è™«" scheme="http://huang_zhao.gitee.io/task/tags/%E7%88%AC%E8%99%AB/"/>
    
    <category term="pythonæ¡†æ¶" scheme="http://huang_zhao.gitee.io/task/tags/python%E6%A1%86%E6%9E%B6/"/>
    
    <category term="çˆ¬è™«é«˜çº§" scheme="http://huang_zhao.gitee.io/task/tags/%E7%88%AC%E8%99%AB%E9%AB%98%E7%BA%A7/"/>
    
  </entry>
  
  <entry>
    <title>BeautifulSoupæ¨¡å—çš„ä½¿ç”¨</title>
    <link href="http://huang_zhao.gitee.io/task/2020/04/21/BeautifulSoup%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <id>http://huang_zhao.gitee.io/task/2020/04/21/BeautifulSoup%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/</id>
    <published>2020-04-21T06:10:11.000Z</published>
    <updated>2020-09-04T11:23:29.202Z</updated>
    
    <content type="html"><![CDATA[<h2 id="BeautifulSoupæ¨¡å—çš„ä½¿ç”¨"><a href="#BeautifulSoupæ¨¡å—çš„ä½¿ç”¨" class="headerlink" title="BeautifulSoupæ¨¡å—çš„ä½¿ç”¨"></a>BeautifulSoupæ¨¡å—çš„ä½¿ç”¨</h2><h4 id="1-å‚æ•°ä»‹ç»"><a href="#1-å‚æ•°ä»‹ç»" class="headerlink" title="1 å‚æ•°ä»‹ç»"></a>1 å‚æ•°ä»‹ç»</h4><pre class=" language-python"><code class="language-python">html_doc <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;html>&lt;head>&lt;title>The Dormouse's story&lt;/title>&lt;/head>&lt;body>&lt;p id="my_p" class="title">hello&lt;b id="bbb" class="boldest">The Dormouse's story&lt;/b>&lt;/p>&lt;p class="story">Once upon a time there were three little sisters; and their names were&lt;a href="http://example.com/elsie" class="sister" id="link1">Elsie&lt;/a>&lt;a href="http://example.com/lacie" class="sister" id="link2">Lacie&lt;/a> and&lt;a href="http://example.com/tillie" class="sister" id="link3">Tillie&lt;/a>;and they lived at the bottom of a well.&lt;/p>&lt;p class="story">...&lt;/p>"""</span>soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html_doc<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è§£æçš„htmlé¡µé¢ï¼Œé€šå¸¸æ˜¯æˆ‘ä»¬é€šè¿‡è¯·æ±‚å¾—åˆ°çš„é¡µé¢æ•°æ®</span><span class="token comment" spellcheck="true"># ç¬¬äºŒä¸ªå‚æ•°æ˜¯è§£æçš„è§£æå™¨é€‰æ‹©</span><span class="token comment" spellcheck="true"># pythonå†…ç½®çš„html.parser</span><span class="token comment" spellcheck="true"># å…¶ä»–è§£é‡Šå™¨ï¼šlxmlï¼ˆé€šå¸¸ä½¿ç”¨ï¼‰ï¼Œxmlï¼Œhtml5lib</span></code></pre><p>æ–‡æ¡£ï¼š<a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/index.zh.html">https://www.crummy.com/software/BeautifulSoup/bs4/doc/index.zh.html</a></p><h4 id="2-åŸºæœ¬ä½¿ç”¨"><a href="#2-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2 åŸºæœ¬ä½¿ç”¨"></a>2 åŸºæœ¬ä½¿ç”¨</h4><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 1 æ ‡ç­¾æŸ¥æ‰¾</span>soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html_doc<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># å¦‚æœæœ‰å¤šä¸ªåªä¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ª</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>pres <span class="token operator">=</span> soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>b<span class="token comment" spellcheck="true"># 2 æ ‡ç­¾å±æ€§</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>b<span class="token punctuation">.</span>attrs<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'id': 'bbb', 'class': ['boldest']&amp;#125;</span><span class="token comment" spellcheck="true"># 3 è·å–æ–‡æœ¬å†…å®¹</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>string <span class="token comment" spellcheck="true"># å½“pä¸‹åªæœ‰æ–‡æœ¬å–åˆ°ï¼Œå¦åˆ™ä¸ºNone</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>strings <span class="token comment" spellcheck="true"># è·å–å…¨éƒ¨æ–‡æœ¬å¾—åˆ°ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>text <span class="token comment" spellcheck="true"># å–åˆ°æ ‡ç­¾ä¸‹æ‰€æœ‰çš„æ–‡æœ¬å†…å®¹æ‹¼æ¥èµ·æ¥</span><span class="token comment" spellcheck="true"># 4 åµŒå¥—é€‰æ‹©</span><span class="token comment" spellcheck="true"># å¯ä»¥è®©é€‰æ‹©æ›´åŠ å‡†ç¡®</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>b<span class="token punctuation">.</span>string<span class="token comment" spellcheck="true"># 5 å­èŠ‚ç‚¹ã€å­å­™èŠ‚ç‚¹</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>contents <span class="token comment" spellcheck="true"># è·å¾—på†…æ‰€æœ‰å­èŠ‚ç‚¹</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>b <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"boldest"</span> id<span class="token operator">=</span><span class="token string">"bbb"</span><span class="token operator">></span>The Dormouse<span class="token string">'s story&lt;/b>, '</span>\n'<span class="token punctuation">]</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>children <span class="token comment" spellcheck="true"># å¾—åˆ°ä¸€ä¸ªè¿­ä»£å™¨ï¼ŒåŒ…å«på†…æ‰€æœ‰å­èŠ‚ç‚¹</span><span class="token triple-quoted-string string">'''å­èŠ‚ç‚¹hello&lt;b class="boldest" id="bbb">The Dormouse's story&lt;/b>'''</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>descendants <span class="token comment" spellcheck="true"># å¾—åˆ°ä¸€ä¸ªç”Ÿæˆå™¨ï¼ŒåŒ…å«på†…æ‰€æœ‰å­å­™èŠ‚ç‚¹</span><span class="token triple-quoted-string string">'''å­å­™èŠ‚ç‚¹hello&lt;b class="boldest" id="bbb">The Dormouse's story&lt;/b>The Dormouse's story'''</span><span class="token comment" spellcheck="true"># 6 çˆ¶èŠ‚ç‚¹ã€ç¥–èŠ‚ç‚¹</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>parent <span class="token comment" spellcheck="true"># è·å¾—pçš„çˆ¶èŠ‚ç‚¹</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>parents <span class="token comment" spellcheck="true"># è·å¾—pçš„çˆ¶èŠ‚ç‚¹ï¼Œå’Œçˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚ã€‚ã€‚çš„ç”Ÿæˆå™¨</span><span class="token comment" spellcheck="true"># 7 å…„å¼ŸèŠ‚ç‚¹</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>next_sibling <span class="token comment" spellcheck="true"># ä¸‹ä¸€ä¸ªå…„å¼Ÿ</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>next_previous_sibling <span class="token comment" spellcheck="true"># ä¸Šä¸€ä¸ªå…„å¼Ÿ</span></code></pre><h4 id="3-æœç´¢æ–‡æ¡£æ ‘"><a href="#3-æœç´¢æ–‡æ¡£æ ‘" class="headerlink" title="3 æœç´¢æ–‡æ¡£æ ‘"></a>3 æœç´¢æ–‡æ¡£æ ‘</h4><h5 id="3-1-äº”ç§è¿‡æ»¤å™¨"><a href="#3-1-äº”ç§è¿‡æ»¤å™¨" class="headerlink" title="3.1 äº”ç§è¿‡æ»¤å™¨"></a>3.1 äº”ç§è¿‡æ»¤å™¨</h5><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 1 å­—ç¬¦ä¸²</span><span class="token comment" spellcheck="true"># å¦‚æœæœ‰å¤šä¸ªå–ç¬¬ä¸€ä¸ª</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># è·å–å…¨éƒ¨ï¼Œåªæœ‰ä¸€ä¸ªä¹Ÿæ˜¯æ”¾åœ¨åˆ—è¡¨ä¸­</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 2 æ­£åˆ™è¡¨è¾¾å¼</span><span class="token comment" spellcheck="true"># è·å¾—æ‰€æœ‰ä»¥bå¼€å¤´çš„æ ‡ç­¾ï¼šbodyï¼Œb</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">'^b'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 3 åˆ—è¡¨</span><span class="token comment" spellcheck="true"># aæ ‡ç­¾ï¼Œbæ ‡ç­¾éƒ½ä¼šå–</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 4 å¸ƒå°”</span><span class="token comment" spellcheck="true"># ä¼šæŸ¥æ‰¾åˆ°æ‰€æœ‰æ ‡ç­¾ï¼Œä¸åŒ…æ‹¬æ–‡æœ¬èŠ‚ç‚¹</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 5 è‡ªå®šä¹‰è¿‡æ»¤å™¨</span><span class="token comment" spellcheck="true"># ä¼šæŠŠæ•´ä¸ªé¡µé¢ä¼ ç»™tag</span><span class="token keyword">def</span> <span class="token function">has_class_not_id</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> tag<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token operator">not</span> tag<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>has_class_not_id<span class="token punctuation">)</span></code></pre><h5 id="3-2-find-all"><a href="#3-2-find-all" class="headerlink" title="3.2 find_all()"></a>3.2 find_all()</h5><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># nameï¼šå¯ä»¥æ”¾ä»»æ„ç±»å‹çš„è¿‡æ»¤å™¨</span><span class="token comment" spellcheck="true"># keywordï¼šæ”¾é”®å€¼å¯¹</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>id <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">'^my'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># å¦‚æœæœ‰ç‰¹æ®Šå‚æ•°ä¸èƒ½é€šè¿‡kï¼Œvæ¥è¡¨ç¤º</span><span class="token comment" spellcheck="true"># æ¯”å¦‚data-foo = value</span>soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;"data-foo":"value"&amp;#125;)</span><span class="token comment" spellcheck="true"># æŒ‰ç±»åçš„æ—¶å€™ï¼Œå…³é”®å­—æ˜¯class_</span><span class="token comment" spellcheck="true"># æŸ¥æ‰¾ç”±sisterå’Œsssç±»çš„aæ ‡ç­¾</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'sister sss'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># limitå‚æ•°</span><span class="token comment" spellcheck="true"># æ‰¾å‰è¿ä¸ªaæ ‡ç­¾</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span>limit<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># recursive = False ä¼šæŸ¥æ‰¾tagä¸‹çš„ç›´æ¥çš„å­èŠ‚ç‚¹</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>html<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>recursive <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span></code></pre><h5 id="3-3-cssé€‰æ‹©å™¨"><a href="#3-3-cssé€‰æ‹©å™¨" class="headerlink" title="3.3 cssé€‰æ‹©å™¨"></a>3.3 cssé€‰æ‹©å™¨</h5><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># é€‰æ‹©å™¨</span><span class="token comment" spellcheck="true"># ç±»</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'.sister'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># å«æœ‰sisterç±»ä¸‹çš„bæ ‡ç­¾</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'.title b'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># id</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'#sister'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># è·å–å±æ€§</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'.title b'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>attrs<span class="token comment" spellcheck="true"># è·å–å†…å®¹</span>res <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'.title b'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;BeautifulSoupæ¨¡å—çš„ä½¿ç”¨&quot;&gt;&lt;a href=&quot;#BeautifulSoupæ¨¡å—çš„ä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;BeautifulSoupæ¨¡å—çš„ä½¿ç”¨&quot;&gt;&lt;/a&gt;BeautifulSoupæ¨¡å—çš„ä½¿ç”¨&lt;/h2&gt;&lt;h4 id=&quot;1</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="çˆ¬è™«" scheme="http://huang_zhao.gitee.io/task/tags/%E7%88%AC%E8%99%AB/"/>
    
    <category term="pythonæ¨¡å—" scheme="http://huang_zhao.gitee.io/task/tags/python%E6%A8%A1%E5%9D%97/"/>
    
  </entry>
  
  <entry>
    <title>RedisæŒä¹…åŒ–ï¼Œä¸»ä»ï¼Œå“¨å…µï¼Œé›†ç¾¤</title>
    <link href="http://huang_zhao.gitee.io/task/2020/04/21/Redis%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%8C%E4%B8%BB%E4%BB%8E%EF%BC%8C%E5%93%A8%E5%85%B5%EF%BC%8C%E9%9B%86%E7%BE%A4/"/>
    <id>http://huang_zhao.gitee.io/task/2020/04/21/Redis%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%8C%E4%B8%BB%E4%BB%8E%EF%BC%8C%E5%93%A8%E5%85%B5%EF%BC%8C%E9%9B%86%E7%BE%A4/</id>
    <published>2020-04-21T06:10:11.000Z</published>
    <updated>2020-09-04T11:15:13.112Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€æŒä¹…åŒ–"><a href="#ä¸€ã€æŒä¹…åŒ–" class="headerlink" title="ä¸€ã€æŒä¹…åŒ–"></a>ä¸€ã€æŒä¹…åŒ–</h2><p>æŒä¹…åŒ–è¡¨ç¤ºæŠŠæ•°æ®å­˜å‚¨åˆ°ç¡¬ç›˜çš„è¿‡ç¨‹</p><p>æŒä¹…åŒ–çš„ä¸¤ç§æ–¹å¼</p><ul><li>å¿«ç…§ï¼šæŸäº‹æŸåˆ»æ•°æ®åº“çš„å®Œæ•´å¤‡ä»½ redisçš„RDB</li><li>å†™æ—¥å¿—ï¼šä»»ä½•æ“ä½œéƒ½è®°å½•ä¸‹æ¥ï¼Œè¦æ¢å¤æ•°æ®å°±é‡æ–°èµ°ä¸€éæµç¨‹å³å¯ redisçš„AOF</li></ul><h3 id="1-RDB"><a href="#1-RDB" class="headerlink" title="1 RDB"></a>1 RDB</h3><p>RDBçš„ä¸‰ç§è§¦å‘æœºåˆ¶</p><pre class=" language-python"><code class="language-python"><span class="token triple-quoted-string string">'''save(åŒæ­¥)1 å®¢æˆ·ç«¯æ‰§è¡Œsaveå‘½ä»¤----ã€‹redisæœåŠ¡ç«¯----ã€‹åŒæ­¥åˆ›å»ºRDBäºŒè¿›åˆ¶æ–‡ä»¶2 ä¼šé€ æˆredisçš„é˜»å¡ï¼ˆæ•°æ®é‡éå¸¸å¤§çš„æ—¶å€™ï¼‰3 æ–‡ä»¶ç­–ç•¥ï¼šå¦‚æœè€çš„RDBå­˜åœ¨ï¼Œä¼šæ›¿æ¢è€çš„4 å¤æ‚åº¦ o(n)'''</span><span class="token triple-quoted-string string">'''bgsave(å¼‚æ­¥ï¼ŒBackgroud saving started)1 å®¢æˆ·ç«¯æ‰§è¡Œsaveå‘½ä»¤----ã€‹redisæœåŠ¡ç«¯----ã€‹å¼‚æ­¥åˆ›å»ºRDBäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆforkå‡½æ•°ç”Ÿæˆä¸€ä¸ªå­è¿›ç¨‹ï¼ˆforkä¼šé˜»å¡reidsï¼‰ï¼Œæ‰§è¡ŒcreateRDBï¼Œæ‰§è¡ŒæˆåŠŸï¼Œè¿”å›ç»™reidsæ¶ˆæ¯ï¼‰2 æ­¤æ—¶è®¿é—®redisï¼Œä¼šæ­£å¸¸å“åº”å®¢æˆ·ç«¯3 æ–‡ä»¶ç­–ç•¥ï¼šè·Ÿsaveç›¸åŒï¼Œå¦‚æœè€çš„RDBå­˜åœ¨ï¼Œä¼šæ›¿æ¢è€çš„4 å¤æ‚åº¦ o(n)'''</span><span class="token triple-quoted-string string">'''è‡ªåŠ¨ï¼ˆé€šè¿‡é…ç½®ï¼‰é…ç½®   seconds   changessave   900        1save   300        10save   60         10000å¦‚æœ60sä¸­æ”¹å˜äº†1wæ¡æ•°æ®ï¼Œè‡ªåŠ¨ç”Ÿæˆrdbå¦‚æœ300sä¸­æ”¹å˜äº†10æ¡æ•°æ®ï¼Œè‡ªåŠ¨ç”Ÿæˆrdbå¦‚æœ900sä¸­æ”¹å˜äº†1æ¡æ•°æ®ï¼Œè‡ªåŠ¨ç”Ÿæˆrdbä»¥ä¸Šä¸‰æ¡ç¬¦åˆä»»æ„ä¸€æ¡ï¼Œå°±è‡ªåŠ¨ç”Ÿæˆrdbï¼Œå†…éƒ¨ä½¿ç”¨bgsave'''</span><span class="token comment" spellcheck="true">#é…ç½®ï¼š</span>save <span class="token number">900</span> <span class="token number">1</span> <span class="token comment" spellcheck="true">#é…ç½®ä¸€æ¡</span>save <span class="token number">300</span> <span class="token number">10</span> <span class="token comment" spellcheck="true">#é…ç½®ä¸€æ¡</span>save <span class="token number">60</span> <span class="token number">10000</span> <span class="token comment" spellcheck="true">#é…ç½®ä¸€æ¡</span>dbfilename dump<span class="token punctuation">.</span>rdb  <span class="token comment" spellcheck="true">#rdbæ–‡ä»¶çš„åå­—ï¼Œé»˜è®¤ä¸ºdump.rdb</span>dir <span class="token punctuation">.</span><span class="token operator">/</span> <span class="token comment" spellcheck="true">#rdbæ–‡ä»¶å­˜åœ¨å½“å‰ç›®å½•</span>stop<span class="token operator">-</span>writes<span class="token operator">-</span>on<span class="token operator">-</span>bgsave<span class="token operator">-</span>error yes <span class="token comment" spellcheck="true">#å¦‚æœbgsaveå‡ºç°é”™è¯¯ï¼Œæ˜¯å¦åœæ­¢å†™å…¥ï¼Œé»˜è®¤ä¸ºyes</span>rdbcompression yes <span class="token comment" spellcheck="true">#é‡‡ç”¨å‹ç¼©æ ¼å¼</span>rdbchecksum yes <span class="token comment" spellcheck="true">#æ˜¯å¦å¯¹rdbæ–‡ä»¶è¿›è¡Œæ ¡éªŒå’Œæ£€éªŒ</span><span class="token comment" spellcheck="true">#æœ€ä½³é…ç½®</span>save <span class="token number">900</span> <span class="token number">1</span> save <span class="token number">300</span> <span class="token number">10</span> save <span class="token number">60</span> <span class="token number">10000</span> dbfilename dump<span class="token operator">-</span>$<span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;port&amp;#125;.rdb  #ä»¥ç«¯å£å·ä½œä¸ºæ–‡ä»¶åï¼Œå¯èƒ½ä¸€å°æœºå™¨ä¸Šå¾ˆå¤šreidsï¼Œä¸ä¼šä¹±</span>dir <span class="token operator">/</span>bigdiskpath <span class="token comment" spellcheck="true">#ä¿å­˜è·¯å¾„æ”¾åˆ°ä¸€ä¸ªå¤§ç¡¬ç›˜ä½ç½®ç›®å½•</span>stop<span class="token operator">-</span>writes<span class="token operator">-</span>on<span class="token operator">-</span>bgsave<span class="token operator">-</span>error yes <span class="token comment" spellcheck="true">#å‡ºç°é”™è¯¯åœæ­¢</span>rdbcompression yes <span class="token comment" spellcheck="true">#å‹ç¼©</span>rdbchecksum yes <span class="token comment" spellcheck="true">#æ ¡éªŒ</span></code></pre><p><strong>è§¦å‘æœºåˆ¶</strong></p><pre><code>1 å…¨é‡å¤åˆ¶ #æ²¡æœ‰æ‰§è¡Œsaveå’Œbgsaveæ²¡æœ‰æ·»åŠ rdbç­–ç•¥ï¼Œè¿˜ä¼šç”Ÿæˆrdbæ–‡ä»¶ï¼Œå¦‚æœå¼€å¯ä¸»ä»å¤åˆ¶ï¼Œä¸»ä¼šè‡ªåŠ¨ç”Ÿæˆrdb2 debug reload #debugçº§åˆ«çš„é‡å¯ï¼Œä¸ä¼šå°†å†…å­˜ä¸­çš„æ•°æ®æ¸…ç©º3 shutdown save#å…³é—­ä¼šå‡ºå‘rdbçš„ç”Ÿæˆ</code></pre><p><strong>å­˜åœ¨çš„é—®é¢˜</strong>ï¼šè€—æ—¶ï¼Œè€—æ€§èƒ½ï¼Œä¸å¯æ§ï¼Œæ•°æ®å¯èƒ½ä¼šä¸¢å¤±</p><h3 id="2-AOF"><a href="#2-AOF" class="headerlink" title="2 AOF"></a>2 AOF</h3><p>åŸç†ï¼šå®¢æˆ·ç«¯æ¯å†™å…¥ä¸€æ¡å‘½ä»¤å°±ä¼šè®°å½•ä¸€æ¡æ—¥å¿—ï¼Œæ”¾åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå¦‚æœå‡ºç°å®•æœºå®Œå…¨å¯ä»¥æ¢å¤</p><p><strong>AOFä¸‰ç§ä¿å­˜ç­–ç•¥</strong></p><p>æ—¥å¿—ä¸æ˜¯ç›´æ¥å†™åˆ°ç¡¬ç›˜ä¸Šï¼Œè€Œæ˜¯å…ˆæ”¾åœ¨ç¼“å†²åŒºï¼Œç¼“å†²åŒºæ ¹æ®ä¸€äº›ç­–ç•¥ï¼Œå†™åˆ°ç¡¬ç›˜ä¸Š</p><ul><li><p>alwaysï¼šredisâ€“ã€‹å†™å‘½ä»¤åˆ·æ–°çš„ç¼“å†²åŒºâ€”ã€‹æ¯æ¡å‘½ä»¤fsyncåˆ°ç¡¬ç›˜â€”ã€‹AOFæ–‡ä»¶</p></li><li><p>everysecï¼ˆé»˜è®¤å€¼ï¼‰ï¼šredisâ€”â€”ã€‹å†™å‘½ä»¤åˆ·æ–°çš„ç¼“å†²åŒºâ€”ã€‹æ¯ç§’æŠŠç¼“å†²åŒºfsyncåˆ°ç¡¬ç›˜â€“ã€‹AOFæ–‡ä»¶</p></li><li><p>no:redisâ€”â€”ã€‹å†™å‘½ä»¤åˆ·æ–°çš„ç¼“å†²åŒºâ€”ã€‹æ“ä½œç³»ç»Ÿå†³å®šï¼Œç¼“å†²åŒºfsyncåˆ°ç¡¬ç›˜â€“ã€‹AOFæ–‡ä»¶</p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>always</th><th>everysec</th><th>no</th></tr></thead><tbody><tr><td>ä¼˜ç‚¹</td><td>ä¸ä¸¢å¤±æ•°æ®</td><td>æ¯ç§’ä¸€æ¬¡fsyncï¼Œä¸¢å¤±1ç§’æ•°æ®</td><td>ä¸ç”¨ç®¡</td></tr><tr><td>ç¼ºç‚¹</td><td>IOå¼€é”€å¤§ï¼Œä¸€èˆ¬çš„sataç›˜åªæœ‰å‡ ç™¾TPS</td><td>ä¸¢1ç§’æ•°æ®</td><td>ä¸å¯æ§</td></tr></tbody></table><h4 id="3-1-AOFé‡å†™"><a href="#3-1-AOFé‡å†™" class="headerlink" title="3.1 AOFé‡å†™"></a>3.1 AOFé‡å†™</h4><p>æ˜¯aofä¸­çš„ä¸€ä¸ªæ¨¡å¼ï¼Œæ—¥å¿—æ–‡ä»¶è¶Šå †è¶Šå¤šå°±ä¼šå­˜åœ¨å¾ˆå¤šæ²¡ç”¨çš„å‘½ä»¤</p><p>æ¯”å¦‚ç»™helloèµ‹å€¼äº†10æ¬¡ï¼Œå®é™…ä¸Šåªæœ‰ç¬¬10æ¬¡æœ‰æ„ä¹‰ï¼Œæ‰€ä»¥å‰é¢9æ¬¡éƒ½å¯ä»¥åˆ æ‰ï¼Œæˆ–è€…æ˜¯rpush aï¼Œrpush b ï¼Œrpush cï¼Œå¯ä»¥å†™æˆrpush aï¼Œbï¼Œc</p><p>æœ¬è´¨å°±æ˜¯æŠŠè¿‡æœŸçš„ï¼Œæ— ç”¨çš„ï¼Œé‡å¤çš„ï¼Œå¯ä»¥ä¼˜åŒ–çš„å‘½ä»¤ï¼Œæ¥ä¼˜åŒ–</p><p>è¿™æ ·å¯ä»¥å‡å°‘ç£ç›˜å ç”¨é‡ï¼ŒåŠ é€Ÿæ¢å¤é€Ÿåº¦</p><p><strong>å®ç°æ–¹å¼</strong></p><p>bgrewriteaofï¼š</p><p>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€bgrewriteaofå‘½ä»¤ï¼ŒæœåŠ¡ç«¯ä¼šèµ·ä¸€ä¸ªforkè¿›ç¨‹ï¼Œå®ŒæˆAOFé‡å†™</p><p><strong>é…ç½®æ–¹å¼</strong></p><pre class=" language-python"><code class="language-python">appendonly yes <span class="token comment" spellcheck="true">#å°†è¯¥é€‰é¡¹è®¾ç½®ä¸ºyesï¼Œæ‰“å¼€</span>appendfilename <span class="token string">"appendonly-$&amp;#123;port&amp;#125;.aof"</span> #æ–‡ä»¶ä¿å­˜çš„åå­—appendfsync everysec <span class="token comment" spellcheck="true">#é‡‡ç”¨ç¬¬äºŒç§ç­–ç•¥</span>dir <span class="token operator">/</span>bigdiskpath <span class="token comment" spellcheck="true">#å­˜æ”¾çš„è·¯å¾„</span>no<span class="token operator">-</span>appendfsync<span class="token operator">-</span>on<span class="token operator">-</span>rewrite yes <span class="token comment" spellcheck="true">#åœ¨aofé‡å†™çš„æ—¶å€™ï¼Œæ˜¯å¦è¦åšaofçš„appendæ“ä½œï¼Œå› ä¸ºaofé‡å†™æ¶ˆè€—æ€§èƒ½ï¼Œç£ç›˜æ¶ˆè€—ï¼Œæ­£å¸¸aofå†™ç£ç›˜æœ‰ä¸€å®šçš„å†²çªï¼Œè¿™æ®µæœŸé—´çš„æ•°æ®ï¼Œå…è®¸ä¸¢å¤±</span></code></pre><h2 id="äºŒã€ä¸»ä»å¤åˆ¶"><a href="#äºŒã€ä¸»ä»å¤åˆ¶" class="headerlink" title="äºŒã€ä¸»ä»å¤åˆ¶"></a>äºŒã€ä¸»ä»å¤åˆ¶</h2><p>QPSè¾¾åˆ°ç“¶é¢ˆå°±å¯ä»¥åšä¸»ä»å¤åˆ¶</p><ul><li><p>ä¸€ä¸»ä¸€ä»æˆ–è€…ä¸€ä¸»å¤šä»</p></li><li><p>åšè¯»å†™åˆ†ç¦»ï¼Œæ•°æ®å‰¯æœ¬</p></li><li><p>æ‰©å±•æ“ä½œæ•°æ®çš„æ–°èƒ½</p></li><li><p>ä¸€ä¸ªmasterï¼ˆä¸»ï¼‰å¯ä»¥æœ‰å¤šä¸ªslaveï¼ˆä»ï¼‰</p></li><li><p>ä¸€ä¸ªä»æ™ºèƒ½å±äºä¸€ä¸ªä¸»</p></li><li><p>æ•°æ®æµå‘æ˜¯å•å‘çš„ï¼Œä»ä¸»åˆ°ä»</p></li></ul><p><strong>åŸç†</strong></p><pre><code>1 ä»åº“é€šè¿‡ slaveof ip ç«¯å£è¿æ¥ä¸»åº“ï¼Œå¹¶å‘é€ä¸€ä¸ªSYNCè¯·æ±‚ç»™ä¸»åº“2 ä¸»åº“æ¥å—åˆ°SYNCï¼Œä¼šç«‹å³å‡ºå‘bgsaveï¼ˆæŒä¹…åŒ–ï¼‰ï¼Œåå°ä¿å­˜RDBï¼Œå‘é€ç»™ä»åº“3 ä»åº“æ¥æ”¶åˆ°RDBæ–‡ä»¶ä¼šæ‰§è¡Œï¼ˆå°±æ˜¯æŠŠæ•°æ®è¯»å‡ºæ¥ï¼‰4 æ­¤æ—¶ä¸»ä»å¤åˆ¶å°±èƒ½æ­£å¸¸å·¥ä½œäº†ï¼Œä¸»åº“ä¼šå°†æ–°çš„æ“ä½œä»¥å‘½ä»¤çš„å½¢å¼é™†ç»­å‘ç»™ä»åº“5 æ‰€æœ‰çš„å¤åˆ¶ä¿¡æ¯éƒ½å¯ä»¥ä»infoä¸­æŸ¥åˆ°6 å¦‚æœå‘ç”Ÿä¸»ä»å…³ç³»æ–­å¼€æ—¶,ä»åº“æ•°æ®æ²¡æœ‰ä»»ä½•æŸå,åœ¨ä¸‹æ¬¡é‡è¿ä¹‹å,ä»åº“å‘é€PSYNCç»™ä¸»åº“7 ä¸»åº“åªä¼šå°†ä»åº“ç¼ºå¤±éƒ¨åˆ†çš„æ•°æ®åŒæ­¥ç»™ä»åº“åº”ç”¨,è¾¾åˆ°å¿«é€Ÿæ¢å¤ä¸»ä»çš„ç›®çš„</code></pre><h3 id="1-è¾…åŠ©é…ç½®"><a href="#1-è¾…åŠ©é…ç½®" class="headerlink" title="1 è¾…åŠ©é…ç½®"></a>1 è¾…åŠ©é…ç½®</h3><pre class=" language-python"><code class="language-python">min<span class="token operator">-</span>slaves<span class="token operator">-</span>to<span class="token operator">-</span>write <span class="token number">1</span>min<span class="token operator">-</span>slaves<span class="token operator">-</span>max<span class="token operator">-</span>lag <span class="token number">3</span><span class="token comment" spellcheck="true">#é‚£ä¹ˆåœ¨ä»æœåŠ¡å™¨çš„æ•°é‡å°‘äº1ä¸ªï¼Œæˆ–è€…ä¸‰ä¸ªä»æœåŠ¡å™¨çš„å»¶è¿Ÿï¼ˆlagï¼‰å€¼éƒ½å¤§äºæˆ–ç­‰äº3ç§’æ—¶ï¼Œä¸»æœåŠ¡å™¨å°†æ‹’ç»æ‰§è¡Œå†™å‘½ä»¤</span></code></pre><h3 id="2-å¤åˆ¶é…ç½®"><a href="#2-å¤åˆ¶é…ç½®" class="headerlink" title="2 å¤åˆ¶é…ç½®"></a>2 å¤åˆ¶é…ç½®</h3><h4 id="2-1-slaveå‘½ä»¤"><a href="#2-1-slaveå‘½ä»¤" class="headerlink" title="2.1 slaveå‘½ä»¤"></a>2.1 slaveå‘½ä»¤</h4><pre class=" language-python"><code class="language-python"><span class="token number">6380</span>æ˜¯ä»ï¼Œ<span class="token number">6379</span>æ˜¯ä¸»åœ¨<span class="token number">6380</span>ä¸Šæ‰§è¡Œï¼ˆå»ä»åº“é…ç½®ï¼Œé…ç½®ä¸»åº“ï¼‰slaveof <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span> <span class="token number">6379</span> <span class="token comment" spellcheck="true">#å¼‚æ­¥</span>slaveof no one <span class="token comment" spellcheck="true">#å–æ¶ˆå¤åˆ¶ï¼Œä¸ä¼šæŠŠä¹‹å‰çš„æ•°æ®æ¸…é™¤</span></code></pre><h4 id="2-2-é…ç½®æ–‡ä»¶"><a href="#2-2-é…ç½®æ–‡ä»¶" class="headerlink" title="2.2 é…ç½®æ–‡ä»¶"></a>2.2 é…ç½®æ–‡ä»¶</h4><pre class=" language-python"><code class="language-python">slaveof ip port <span class="token comment" spellcheck="true">#é…ç½®ä»èŠ‚ç‚¹ipå’Œç«¯å£</span>slave<span class="token operator">-</span>read<span class="token operator">-</span>only yes <span class="token comment" spellcheck="true">#ä»èŠ‚ç‚¹åªè¯»ï¼Œå› ä¸ºå¯è¯»å¯å†™ï¼Œæ•°æ®ä¼šä¹±</span><span class="token triple-quoted-string string">'''mkdir -p redis1/conf redis1/data redis2/conf redis2/data redis3/conf redis3/datavim redis.confdaemonize nopidfile redis.pidbind 0.0.0.0protected-mode noport 6379timeout 0logfile redis.logdbfilename dump.rdbdir /dataslaveof 10.0.0.101 6379slave-read-only yescp redis.conf /home/redis2/conf/docker run -p 6379:6379 --name redis_6379 -v /home/redis1/conf/redis.conf:/etc/redis/redis.conf -v /home/redis1/data:/data -d redis redis-server /etc/redis/redis.confdocker run -p 6378:6379 --name redis_6378 -v /home/redis2/conf/redis.conf:/etc/redis/redis.conf -v /home/redis2/data:/data -d redis redis-server /etc/redis/redis.confdocker run -p 6377:6379 --name redis_6377 -v /home/redis3/conf/redis.conf:/etc/redis/redis.conf -v /home/redis3/data:/data -d redis redis-server /etc/redis/redis.confinfo replication'''</span></code></pre><h4 id="2-3-å¤åˆ¶å¸¸è§çš„é—®é¢˜"><a href="#2-3-å¤åˆ¶å¸¸è§çš„é—®é¢˜" class="headerlink" title="2.3 å¤åˆ¶å¸¸è§çš„é—®é¢˜"></a>2.3 å¤åˆ¶å¸¸è§çš„é—®é¢˜</h4><pre class=" language-python"><code class="language-python"><span class="token number">1</span> è¯»å†™åˆ†ç¦»è¯»æµé‡åˆ†æ‘Šåˆ°ä»èŠ‚ç‚¹å¯èƒ½é‡åˆ°é—®é¢˜ï¼šå¤åˆ¶æ•°æ®å»¶è¿Ÿï¼Œè¯»åˆ°è¿‡æœŸæ•°æ®ï¼Œä»èŠ‚ç‚¹æ•…éšœ<span class="token number">2</span> ä¸»ä»é…ç½®ä¸ä¸€è‡´maxmemoryä¸ä¸€è‡´ï¼šä¸¢å¤±æ•°æ®æ•°æ®ç»“æ„ä¼˜åŒ–å‚æ•°ï¼šä¸»èŠ‚ç‚¹åšäº†ä¼˜åŒ–ï¼Œä»èŠ‚ç‚¹æ²¡æœ‰è®¾ç½®ä¼˜åŒ–ï¼Œä¼šå‡ºç°ä¸€äº›é—®é¢˜<span class="token number">3</span> è§„é¿å…¨é‡å¤åˆ¶ç¬¬ä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼Œä¸å¯é¿å…ï¼šå°ä¸»èŠ‚ç‚¹ï¼Œä½å³°<span class="token punctuation">(</span>å¤œé—´<span class="token punctuation">)</span>èŠ‚ç‚¹è¿è¡Œidä¸åŒ¹é…ï¼šä¸»èŠ‚ç‚¹é‡å¯<span class="token punctuation">(</span>è¿è¡Œidå˜åŒ–<span class="token punctuation">)</span>å¤åˆ¶æŒ¤å‹ç¼“å†²åŒºä¸è¶³ï¼šå¢å¤§å¤åˆ¶ç¼“å†²åŒºå¤§å°ï¼Œrel_backlog_size<span class="token number">4</span> è§„é¿å¤åˆ¶é£æš´å•ä¸»èŠ‚ç‚¹å¤åˆ¶é£æš´ï¼Œä¸»èŠ‚ç‚¹é‡å¯ï¼Œæ‰€æœ‰ä»èŠ‚ç‚¹å¤åˆ¶</code></pre><h2 id="ä¸‰ã€redis-Sentinelï¼ˆå“¨å…µï¼‰"><a href="#ä¸‰ã€redis-Sentinelï¼ˆå“¨å…µï¼‰" class="headerlink" title="ä¸‰ã€redis-Sentinelï¼ˆå“¨å…µï¼‰"></a>ä¸‰ã€redis-Sentinelï¼ˆå“¨å…µï¼‰</h2><p>å“¨å…µå°±æ˜¯ä¸ºäº†å®ç°ä¸»ä»å¤åˆ¶çš„é«˜å¯ç”¨</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#ä¸»ä»å¤åˆ¶å­˜åœ¨çš„é—®é¢˜ï¼š</span><span class="token comment" spellcheck="true">#1 ä¸»ä»å¤åˆ¶ï¼Œä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œéœ€è¦åšæ•…éšœè½¬ç§»ï¼Œå¯ä»¥æ‰‹åŠ¨è½¬ç§»ï¼šè®©å…¶ä¸­ä¸€ä¸ªslaveå˜æˆmaster</span><span class="token comment" spellcheck="true">#2 ä¸»ä»å¤åˆ¶ï¼Œåªèƒ½ä¸»å†™æ•°æ®ï¼Œæ‰€ä»¥å†™èƒ½åŠ›å’Œå­˜å‚¨èƒ½åŠ›æœ‰é™</span></code></pre><p><strong>æ¶æ„è¯´æ˜</strong></p><p>1 å¤šä¸ªsentinelå‘ç°å¹¶ç¡®è®¤masteræœ‰é—®é¢˜</p><p>2 é€‰ä¸¾è§¦ä¸€ä¸ªsentinelä½œä¸ºé¢†å¯¼</p><p>3 é€‰å–ä¸€ä¸ªslaveä½œä¸ºæ–°çš„master</p><p>4 é€šçŸ¥å…¶ä½™slaveæˆä¸ºæ–°çš„masterçš„slave</p><p>5 é€šçŸ¥å®¢æˆ·ç«¯ä¸»ä»å˜åŒ–</p><p>6 ç­‰å¾…è€çš„masterå¤æ´»æˆä¸ºæ–°masterçš„slave</p><h3 id="1-å®‰è£…é…ç½®"><a href="#1-å®‰è£…é…ç½®" class="headerlink" title="1 å®‰è£…é…ç½®"></a>1 å®‰è£…é…ç½®</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#é…ç½®å¼€å¯sentinelç›‘æ§ä¸»èŠ‚ç‚¹</span>mkdir <span class="token operator">-</span>p redis4<span class="token operator">/</span>conf redis4<span class="token operator">/</span>data redis5<span class="token operator">/</span>conf redis5<span class="token operator">/</span>data redis6<span class="token operator">/</span>data redis6<span class="token operator">/</span>confvi sentinel<span class="token punctuation">.</span>confport <span class="token number">26379</span>daemonize yesdir dataprotected<span class="token operator">-</span>mode nobind <span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">0.0</span>logfile <span class="token string">"redis_sentinel.log"</span>sentinel monitor mymaster <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span> <span class="token number">6379</span> <span class="token number">2</span>sentinel down<span class="token operator">-</span>after<span class="token operator">-</span>milliseconds mymaster <span class="token number">30000</span>sentinel parallel<span class="token operator">-</span>syncs mymaster <span class="token number">1</span>sentinel failover<span class="token operator">-</span>timeout mymaster <span class="token number">180000</span>docker run <span class="token operator">-</span>p <span class="token number">26379</span><span class="token punctuation">:</span><span class="token number">26379</span> <span class="token operator">-</span><span class="token operator">-</span>name redis_26379 <span class="token operator">-</span>v <span class="token operator">/</span>home<span class="token operator">/</span>redis4<span class="token operator">/</span>conf<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf<span class="token punctuation">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf <span class="token operator">-</span>v <span class="token operator">/</span>home<span class="token operator">/</span>redis4<span class="token operator">/</span>data<span class="token punctuation">:</span><span class="token operator">/</span>data <span class="token operator">-</span>d redis redis<span class="token operator">-</span>sentinel <span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>confdocker run <span class="token operator">-</span>p <span class="token number">26378</span><span class="token punctuation">:</span><span class="token number">26379</span> <span class="token operator">-</span><span class="token operator">-</span>name redis_26378 <span class="token operator">-</span>v <span class="token operator">/</span>home<span class="token operator">/</span>redis5<span class="token operator">/</span>conf<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf<span class="token punctuation">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf <span class="token operator">-</span>v <span class="token operator">/</span>home<span class="token operator">/</span>redis5<span class="token operator">/</span>data<span class="token punctuation">:</span><span class="token operator">/</span>data <span class="token operator">-</span>d redis redis<span class="token operator">-</span>sentinel <span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>confdocker run <span class="token operator">-</span>p <span class="token number">26377</span><span class="token punctuation">:</span><span class="token number">26379</span> <span class="token operator">-</span><span class="token operator">-</span>name redis_26377 <span class="token operator">-</span>v <span class="token operator">/</span>home<span class="token operator">/</span>redis6<span class="token operator">/</span>conf<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf<span class="token punctuation">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf <span class="token operator">-</span>v <span class="token operator">/</span>home<span class="token operator">/</span>redis6<span class="token operator">/</span>data<span class="token punctuation">:</span><span class="token operator">/</span>data <span class="token operator">-</span>d redis redis<span class="token operator">-</span>sentinel <span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>confredis<span class="token operator">-</span>sentinel sentinel<span class="token punctuation">.</span>confinfoé…ç½®ä¼šé‡å†™ï¼Œè‡ªåŠ¨å‘ç°slave</code></pre><pre class=" language-python"><code class="language-python">sentinel monitor mymaster <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span> <span class="token number">6379</span> <span class="token number">2</span>sentinel down<span class="token operator">-</span>after<span class="token operator">-</span>milliseconds mymaster <span class="token number">30000</span>sentinel parallel<span class="token operator">-</span>syncs mymaster <span class="token number">1</span>sentinel failover<span class="token operator">-</span>timeout mymaster <span class="token number">180000</span>sentinel monitor <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>ip<span class="token operator">></span> <span class="token operator">&lt;</span>redis<span class="token operator">-</span>port<span class="token operator">></span> <span class="token operator">&lt;</span>quorum<span class="token operator">></span>å‘Šè¯‰sentinelå»ç›‘å¬åœ°å€ä¸ºip<span class="token punctuation">:</span>portçš„ä¸€ä¸ªmasterï¼Œè¿™é‡Œçš„master<span class="token operator">-</span>nameå¯ä»¥è‡ªå®šä¹‰ï¼Œquorumæ˜¯ä¸€ä¸ªæ•°å­—ï¼ŒæŒ‡æ˜å½“æœ‰å¤šå°‘ä¸ªsentinelè®¤ä¸ºä¸€ä¸ªmasterå¤±æ•ˆæ—¶ï¼Œmasteræ‰ç®—çœŸæ­£å¤±æ•ˆsentinel auth<span class="token operator">-</span><span class="token keyword">pass</span> <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>password<span class="token operator">></span>è®¾ç½®è¿æ¥masterå’Œslaveæ—¶çš„å¯†ç ï¼Œæ³¨æ„çš„æ˜¯sentinelä¸èƒ½åˆ†åˆ«ä¸ºmasterå’Œslaveè®¾ç½®ä¸åŒçš„å¯†ç ï¼Œå› æ­¤masterå’Œslaveçš„å¯†ç åº”è¯¥è®¾ç½®ç›¸åŒã€‚sentinel down<span class="token operator">-</span>after<span class="token operator">-</span>milliseconds <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>milliseconds<span class="token operator">></span> è¿™ä¸ªé…ç½®é¡¹æŒ‡å®šäº†éœ€è¦å¤šå°‘å¤±æ•ˆæ—¶é—´ï¼Œä¸€ä¸ªmasteræ‰ä¼šè¢«è¿™ä¸ªsentinelä¸»è§‚åœ°è®¤ä¸ºæ˜¯ä¸å¯ç”¨çš„ã€‚ å•ä½æ˜¯æ¯«ç§’ï¼Œé»˜è®¤ä¸º<span class="token number">30</span>ç§’sentinel parallel<span class="token operator">-</span>syncs <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>numslaves<span class="token operator">></span> è¿™ä¸ªé…ç½®é¡¹æŒ‡å®šäº†åœ¨å‘ç”Ÿfailoverä¸»å¤‡åˆ‡æ¢æ—¶æœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªslaveåŒæ—¶å¯¹æ–°çš„masterè¿›è¡Œ åŒæ­¥ï¼Œè¿™ä¸ªæ•°å­—è¶Šå°ï¼Œå®Œæˆfailoveræ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªæ•°å­—è¶Šå¤§ï¼Œå°±æ„å‘³ç€è¶Š å¤šçš„slaveå› ä¸ºreplicationè€Œä¸å¯ç”¨ã€‚å¯ä»¥é€šè¿‡å°†è¿™ä¸ªå€¼è®¾ä¸º <span class="token number">1</span> æ¥ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªslave å¤„äºä¸èƒ½å¤„ç†å‘½ä»¤è¯·æ±‚çš„çŠ¶æ€ã€‚sentinel failover<span class="token operator">-</span>timeout <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>milliseconds<span class="token operator">></span>failover<span class="token operator">-</span>timeout å¯ä»¥ç”¨åœ¨ä»¥ä¸‹è¿™äº›æ–¹é¢ï¼š     <span class="token number">1</span><span class="token punctuation">.</span> åŒä¸€ä¸ªsentinelå¯¹åŒä¸€ä¸ªmasterä¸¤æ¬¡failoverä¹‹é—´çš„é—´éš”æ—¶é—´ã€‚   <span class="token number">2</span><span class="token punctuation">.</span> å½“ä¸€ä¸ªslaveä»ä¸€ä¸ªé”™è¯¯çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®å¼€å§‹è®¡ç®—æ—¶é—´ã€‚ç›´åˆ°slaveè¢«çº æ­£ä¸ºå‘æ­£ç¡®çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®æ—¶ã€‚    <span class="token number">3</span><span class="token punctuation">.</span>å½“æƒ³è¦å–æ¶ˆä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„failoveræ‰€éœ€è¦çš„æ—¶é—´ã€‚    <span class="token number">4</span><span class="token punctuation">.</span>å½“è¿›è¡Œfailoveræ—¶ï¼Œé…ç½®æ‰€æœ‰slavesæŒ‡å‘æ–°çš„masteræ‰€éœ€çš„æœ€å¤§æ—¶é—´ã€‚ä¸è¿‡ï¼Œå³ä½¿è¿‡äº†è¿™ä¸ªè¶…æ—¶ï¼Œslavesä¾ç„¶ä¼šè¢«æ­£ç¡®é…ç½®ä¸ºæŒ‡å‘masterï¼Œä½†æ˜¯å°±ä¸æŒ‰parallel<span class="token operator">-</span>syncsæ‰€é…ç½®çš„è§„åˆ™æ¥äº†ã€‚</code></pre><pre class=" language-python"><code class="language-python"><span class="token number">1</span> æ­ä¸€ä¸ªä¸€ä¸»ä¸¤ä»<span class="token comment" spellcheck="true">#åˆ›å»ºä¸‰ä¸ªé…ç½®æ–‡ä»¶ï¼š</span><span class="token comment" spellcheck="true">#ç¬¬ä¸€ä¸ªæ˜¯ä¸»é…ç½®æ–‡ä»¶</span>daemonize yespidfile <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>redis<span class="token punctuation">.</span>pidport <span class="token number">6379</span>dir <span class="token string">"/opt/soft/redis/data"</span>logfile â€œ<span class="token number">6379.</span>logâ€<span class="token comment" spellcheck="true">#ç¬¬äºŒä¸ªæ˜¯ä»é…ç½®æ–‡ä»¶</span>daemonize yespidfile <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>redis2<span class="token punctuation">.</span>pidport <span class="token number">6378</span>dir <span class="token string">"/opt/soft/redis/data2"</span>logfile â€œ<span class="token number">6378.</span>logâ€slaveof <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span> <span class="token number">6379</span>slave<span class="token operator">-</span>read<span class="token operator">-</span>only yes<span class="token comment" spellcheck="true">#ç¬¬ä¸‰ä¸ªæ˜¯ä»é…ç½®æ–‡ä»¶</span>daemonize yespidfile <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>redis3<span class="token punctuation">.</span>pidport <span class="token number">6377</span>dir <span class="token string">"/opt/soft/redis/data3"</span>logfile â€œ<span class="token number">6377.</span>logâ€slaveof <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span> <span class="token number">6379</span>slave<span class="token operator">-</span>read<span class="token operator">-</span>only yes<span class="token comment" spellcheck="true">#æŠŠä¸‰ä¸ªredisæœåŠ¡éƒ½å¯åŠ¨èµ·æ¥</span><span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>redis<span class="token operator">-</span>server redis_6379<span class="token punctuation">.</span>conf<span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>redis<span class="token operator">-</span>server redis_6378<span class="token punctuation">.</span>conf<span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>redis<span class="token operator">-</span>server redis_6377<span class="token punctuation">.</span>conf<span class="token number">2</span> æ­å»ºå“¨å…µ<span class="token comment" spellcheck="true"># sentinel.confè¿™ä¸ªæ–‡ä»¶</span><span class="token comment" spellcheck="true"># æŠŠå“¨å…µä¹Ÿå½“æˆä¸€ä¸ªredisæœåŠ¡å™¨</span>åˆ›å»ºä¸‰ä¸ªé…ç½®æ–‡ä»¶åˆ†åˆ«å«sentinel_26379<span class="token punctuation">.</span>conf sentinel_26378<span class="token punctuation">.</span>conf  sentinel_26377<span class="token punctuation">.</span>conf<span class="token comment" spellcheck="true"># å½“å‰è·¯å¾„ä¸‹åˆ›å»º data1 data2 data3 ä¸ªæ–‡ä»¶å¤¹</span><span class="token comment" spellcheck="true">#å†…å®¹å¦‚ä¸‹(éœ€è¦ä¿®æ”¹ç«¯å£ï¼Œæ–‡ä»¶åœ°å€æ—¥å¿—æ–‡ä»¶åå­—)</span>port <span class="token number">26379</span>daemonize yesdir <span class="token punctuation">.</span><span class="token operator">/</span>data3protected<span class="token operator">-</span>mode nobind <span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">0.0</span>logfile <span class="token string">"redis_sentinel3.log"</span>sentinel monitor mymaster <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span> <span class="token number">6379</span> <span class="token number">2</span>sentinel down<span class="token operator">-</span>after<span class="token operator">-</span>milliseconds mymaster <span class="token number">30000</span>sentinel parallel<span class="token operator">-</span>syncs mymaster <span class="token number">1</span>sentinel failover<span class="token operator">-</span>timeout mymaster <span class="token number">180000</span><span class="token comment" spellcheck="true">#å¯åŠ¨ä¸‰ä¸ªå“¨å…µ</span><span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>redis<span class="token operator">-</span>sentinel sentinel_26379<span class="token punctuation">.</span>conf<span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>redis<span class="token operator">-</span>sentinel sentinel_26378<span class="token punctuation">.</span>conf<span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>redis<span class="token operator">-</span>sentinel sentinel_26377<span class="token punctuation">.</span>conf<span class="token comment" spellcheck="true"># ç™»é™†å“¨å…µ</span><span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>redis<span class="token operator">-</span>cli <span class="token operator">-</span>p <span class="token number">26377</span><span class="token comment" spellcheck="true"># è¾“å…¥ info</span><span class="token comment" spellcheck="true"># æŸ¥çœ‹å“¨å…µçš„é…ç½®æ–‡ä»¶è¢«ä¿®æ”¹äº†ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„</span><span class="token comment" spellcheck="true"># ä¸»åŠ¨åœæ‰ä¸»redis 6379ï¼Œå“¨å…µä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªä»åº“ä½œä¸ºä¸»åº“</span>redis<span class="token operator">-</span>cli <span class="token operator">-</span>p <span class="token number">6379</span>shutdown<span class="token comment" spellcheck="true">#ç­‰å¾…åŸæ¥çš„ä¸»åº“å¯åŠ¨ï¼Œè¯¥ä¸»åº“ä¼šå˜æˆä»åº“</span></code></pre><h3 id="2-å®¢æˆ·ç«¯é“¾æ¥"><a href="#2-å®¢æˆ·ç«¯é“¾æ¥" class="headerlink" title="2 å®¢æˆ·ç«¯é“¾æ¥"></a>2 å®¢æˆ·ç«¯é“¾æ¥</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> redis<span class="token keyword">from</span> redis<span class="token punctuation">.</span>sentinel <span class="token keyword">import</span> Sentinel<span class="token comment" spellcheck="true"># è¿æ¥å“¨å…µæœåŠ¡å™¨(ä¸»æœºåä¹Ÿå¯ä»¥ç”¨åŸŸå)</span><span class="token comment" spellcheck="true"># 10.0.0.101:26379</span>sentinel <span class="token operator">=</span> Sentinel<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'10.0.0.101'</span><span class="token punctuation">,</span> <span class="token number">26379</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token punctuation">(</span><span class="token string">'10.0.0.101'</span><span class="token punctuation">,</span> <span class="token number">26378</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                     <span class="token punctuation">(</span><span class="token string">'10.0.0.101'</span><span class="token punctuation">,</span> <span class="token number">26377</span><span class="token punctuation">)</span>             <span class="token punctuation">]</span><span class="token punctuation">,</span>                    socket_timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>sentinel<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># è·å–ä¸»æœåŠ¡å™¨åœ°å€</span>master <span class="token operator">=</span> sentinel<span class="token punctuation">.</span>discover_master<span class="token punctuation">(</span><span class="token string">'mymaster'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>master<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># è·å–ä»æœåŠ¡å™¨åœ°å€</span>slave <span class="token operator">=</span> sentinel<span class="token punctuation">.</span>discover_slaves<span class="token punctuation">(</span><span class="token string">'mymaster'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>slave<span class="token punctuation">)</span><span class="token comment" spellcheck="true">##### è¯»å†™åˆ†ç¦»</span><span class="token comment" spellcheck="true"># è·å–ä¸»æœåŠ¡å™¨è¿›è¡Œå†™å…¥</span><span class="token comment" spellcheck="true"># master = sentinel.master_for('mymaster', socket_timeout=0.5)</span><span class="token comment" spellcheck="true"># w_ret = master.set('foo', 'bar')</span><span class="token comment" spellcheck="true"># slave = sentinel.slave_for('mymaster', socket_timeout=0.5)</span><span class="token comment" spellcheck="true"># r_ret = slave.get('foo')</span><span class="token comment" spellcheck="true"># print(r_ret)</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€æŒä¹…åŒ–&quot;&gt;&lt;a href=&quot;#ä¸€ã€æŒä¹…åŒ–&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€æŒä¹…åŒ–&quot;&gt;&lt;/a&gt;ä¸€ã€æŒä¹…åŒ–&lt;/h2&gt;&lt;p&gt;æŒä¹…åŒ–è¡¨ç¤ºæŠŠæ•°æ®å­˜å‚¨åˆ°ç¡¬ç›˜çš„è¿‡ç¨‹&lt;/p&gt;
&lt;p&gt;æŒä¹…åŒ–çš„ä¸¤ç§æ–¹å¼&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¿«ç…§ï¼šæŸäº‹æŸåˆ»æ•°æ®åº“çš„å®Œ</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="æ•°æ®åº“" scheme="http://huang_zhao.gitee.io/task/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="Redisé«˜çº§" scheme="http://huang_zhao.gitee.io/task/tags/Redis%E9%AB%98%E7%BA%A7/"/>
    
  </entry>
  
  <entry>
    <title>Rabbitmqã€Rpc</title>
    <link href="http://huang_zhao.gitee.io/task/2020/03/24/Rabbitmq%EF%BC%8CRpc/"/>
    <id>http://huang_zhao.gitee.io/task/2020/03/24/Rabbitmq%EF%BC%8CRpc/</id>
    <published>2020-03-24T12:30:17.000Z</published>
    <updated>2020-09-09T11:19:32.791Z</updated>
    
    <content type="html"><![CDATA[<p>æ¶ˆæ¯é˜Ÿåˆ—ä»‹ç»ï¼š<strong><a href="http://mrw.so/6m21VY">http://mrw.so/6m21VY</a></strong></p><h3 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1 å®‰è£…"></a>1 å®‰è£…</h3><pre class=" language-python"><code class="language-python"><span class="token number">1</span> åŸç”Ÿå®‰è£…    <span class="token operator">-</span>å®‰è£…æ‰©å±•epelæº    <span class="token operator">-</span>yum <span class="token operator">-</span>y install erlang    <span class="token operator">-</span>yum <span class="token operator">-</span>y install rabbitmq<span class="token operator">-</span>server    <span class="token operator">-</span>systemctl start rabbitmq<span class="token operator">-</span>server<span class="token number">2</span> dockeræ‹‰å–    <span class="token operator">-</span>docker pull rabbitmq<span class="token punctuation">:</span>managementï¼ˆè‡ªåŠ¨å¼€å¯äº†webç®¡ç†ç•Œé¢ï¼‰    <span class="token operator">-</span>docker run <span class="token operator">-</span>di <span class="token operator">-</span><span class="token operator">-</span>name rabbitmq <span class="token operator">-</span>e RABBITMQ_DEFAULT_USER<span class="token operator">=</span>admin <span class="token operator">-</span>e RABBITMQ_DEFAULT_PASS<span class="token operator">=</span>admin <span class="token operator">-</span>p <span class="token number">15672</span><span class="token punctuation">:</span><span class="token number">15672</span> <span class="token operator">-</span>p <span class="token number">5672</span><span class="token punctuation">:</span><span class="token number">5672</span> rabbitmq<span class="token punctuation">:</span>management<span class="token number">3</span> <span class="token number">5672</span>ï¼šæ˜¯rabbitmqçš„é»˜è®¤ç«¯å£  <span class="token number">15672</span>ï¼šwebç®¡ç†ç•Œé¢çš„ç«¯å£<span class="token number">4</span> åˆ›å»ºç”¨æˆ·rabbitmqctl add_user lqz <span class="token number">123</span><span class="token number">5</span> åˆ†é…æƒé™rabbitmqctl set_user_tags lqz administratorrabbitmqctl set_permissions <span class="token operator">-</span>p <span class="token string">"/"</span> lqz <span class="token string">".*"</span> <span class="token string">".*"</span> <span class="token string">".*"</span></code></pre><h3 id="2-åŸºæœ¬ä½¿ç”¨"><a href="#2-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2 åŸºæœ¬ä½¿ç”¨"></a>2 åŸºæœ¬ä½¿ç”¨</h3><h4 id="2-1-æ¶ˆæ¯å®‰å…¨â˜ack"><a href="#2-1-æ¶ˆæ¯å®‰å…¨â˜ack" class="headerlink" title="2.1 æ¶ˆæ¯å®‰å…¨â˜ack"></a>2.1 æ¶ˆæ¯å®‰å…¨â˜ack</h4><p>æ˜¯å¦å“åº”æ•°æ®å·²ç»è¢«æ¥å—</p><p>å°±æ˜¯æ¶ˆè´¹è€…ä¸­æ¥å—æ•°æ®çš„æ—¶å€™é…ç½®ä¸€ä¸ªå‚æ•°auto_ack=Falseï¼Œå°±ä¼šå¯¼è‡´æ‹¿åˆ°æ•°æ®äº†ï¼Œä½†æ˜¯æ•°æ®è¿˜åœ¨é˜Ÿåˆ—ä¸­</p><p><strong>æ¶ˆè´¹è€…</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pika<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># åˆ›å»ºä¸€ä¸ªç”¨æˆ·å¯¹è±¡</span>    credentials <span class="token operator">=</span> pika<span class="token punctuation">.</span>PlainCredentials<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span> <span class="token string">"admin"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># åˆ›å»ºä¸€ä¸ªé“¾æ¥å¯¹è±¡</span>    connection <span class="token operator">=</span> pika<span class="token punctuation">.</span>BlockingConnection<span class="token punctuation">(</span>pika<span class="token punctuation">.</span>ConnectionParameters<span class="token punctuation">(</span><span class="token string">'121.36.98.49'</span><span class="token punctuation">,</span> credentials<span class="token operator">=</span>credentials<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># åˆ›å»ºæ“ä½œå¯¹è±¡</span>    channel <span class="token operator">=</span> connection<span class="token punctuation">.</span>channel<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼ˆé»˜è®¤æ˜¯åœ¨ç”Ÿäº§è€…ä¸­åˆ›å»ºï¼Œä¸ºäº†é˜²æ­¢æ¶ˆè´¹è€…å…ˆå¯åŠ¨ï¼Œå¤šå†™ä¹Ÿä¸ä¼šé‡å¤åˆ›å»ºï¼‰</span>    channel<span class="token punctuation">.</span>queue_declare<span class="token punctuation">(</span>queue<span class="token operator">=</span><span class="token string">'hello'</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">callback</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> method<span class="token punctuation">,</span> properties<span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" [x] Received %r"</span> <span class="token operator">%</span> body<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># ç­‰åˆ°helloé˜Ÿåˆ—ä¸­å‡ºç°æ•°æ®ï¼Œå¦‚æœå‡ºç°åˆ™æ‰§è¡Œcallback</span>    channel<span class="token punctuation">.</span>basic_consume<span class="token punctuation">(</span>queue<span class="token operator">=</span><span class="token string">'hello'</span><span class="token punctuation">,</span> on_message_callback<span class="token operator">=</span>callback<span class="token punctuation">,</span> auto_ack<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># ä¸€ç›´å¯åŠ¨ç­‰å¾…æ¥æ”¶æ¶ˆæ¯</span>    channel<span class="token punctuation">.</span>start_consuming<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><strong>ç”Ÿäº§è€…</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pika<span class="token comment" spellcheck="true"># æ‹¿åˆ°è¿æ¥å¯¹è±¡</span><span class="token comment" spellcheck="true"># connection = pika.BlockingConnection(pika.ConnectionParameters('101.133.225.166'))</span><span class="token comment" spellcheck="true"># æœ‰ç”¨æˆ·åå¯†ç çš„æƒ…å†µ</span>credentials <span class="token operator">=</span> pika<span class="token punctuation">.</span>PlainCredentials<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span>connection <span class="token operator">=</span> pika<span class="token punctuation">.</span>BlockingConnection<span class="token punctuation">(</span>pika<span class="token punctuation">.</span>ConnectionParameters<span class="token punctuation">(</span><span class="token string">'121.36.98.49'</span><span class="token punctuation">,</span>credentials<span class="token operator">=</span>credentials<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># æ‹¿åˆ°channelå¯¹è±¡</span>channel <span class="token operator">=</span> connection<span class="token punctuation">.</span>channel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—</span>channel<span class="token punctuation">.</span>queue_declare<span class="token punctuation">(</span>queue<span class="token operator">=</span><span class="token string">'hello'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># æŒ‡å®šé˜Ÿåˆ—åå­—</span><span class="token comment" spellcheck="true"># ç”Ÿäº§è€…å‘helloé˜Ÿåˆ—ä¸­æ”¾ä¸€æ¡æ¶ˆæ¯"lqz js nb"</span>channel<span class="token punctuation">.</span>basic_publish<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>                      routing_key<span class="token operator">=</span><span class="token string">'hello'</span><span class="token punctuation">,</span>                      body<span class="token operator">=</span><span class="token string">'lqz js nb'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" Sent 'Hello World!'"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># å…³é—­è¿æ¥</span>connection<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h4 id="2-2-æ¶ˆæ¯å®‰å…¨â˜durableæŒä¹…åŒ–"><a href="#2-2-æ¶ˆæ¯å®‰å…¨â˜durableæŒä¹…åŒ–" class="headerlink" title="2.2 æ¶ˆæ¯å®‰å…¨â˜durableæŒä¹…åŒ–"></a>2.2 æ¶ˆæ¯å®‰å…¨â˜durableæŒä¹…åŒ–</h4><p>durableæŒä¹…åŒ–æ¶ˆè´¹è€…ä¸éœ€è¦åŠ¨ï¼Œåªè¦åœ¨ç”Ÿäº§è€…äº§ç”Ÿæ•°æ®çš„æ—¶å€™é…ç½®ä¸€ä¸ªå‚æ•°å³å¯</p><p>æ³¨æ„ï¼šé…ç½®æŒä¹…åŒ–å¿…é¡»æ˜¯æ–°çš„é˜Ÿåˆ—</p><p><strong>ç”Ÿäº§è€…</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pikacredentials <span class="token operator">=</span> pika<span class="token punctuation">.</span>PlainCredentials<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span>connection <span class="token operator">=</span> pika<span class="token punctuation">.</span>BlockingConnection<span class="token punctuation">(</span>pika<span class="token punctuation">.</span>ConnectionParameters<span class="token punctuation">(</span><span class="token string">'101.133.225.166'</span><span class="token punctuation">,</span>credentials<span class="token operator">=</span>credentials<span class="token punctuation">)</span><span class="token punctuation">)</span>channel <span class="token operator">=</span> connection<span class="token punctuation">.</span>channel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—(åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—),durable=Trueæ”¯æŒæŒä¹…åŒ–ï¼Œé˜Ÿåˆ—å¿…é¡»æ˜¯æ–°çš„æ‰å¯ä»¥</span>channel<span class="token punctuation">.</span>queue_declare<span class="token punctuation">(</span>queue<span class="token operator">=</span><span class="token string">'lqz1'</span><span class="token punctuation">,</span>durable<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>channel<span class="token punctuation">.</span>basic_publish<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>                      routing_key<span class="token operator">=</span><span class="token string">'lqz1'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># æ¶ˆæ¯é˜Ÿåˆ—åç§°</span>                      body<span class="token operator">=</span><span class="token string">'111'</span><span class="token punctuation">,</span>                      properties<span class="token operator">=</span>pika<span class="token punctuation">.</span>BasicProperties<span class="token punctuation">(</span>                          delivery_mode<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>  <span class="token comment" spellcheck="true"># make message persistent,æ¶ˆæ¯ä¹ŸæŒä¹…åŒ–</span>                      <span class="token punctuation">)</span>                      <span class="token punctuation">)</span>connection<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h4 id="2-3-é—²ç½®æ¶ˆè´¹"><a href="#2-3-é—²ç½®æ¶ˆè´¹" class="headerlink" title="2.3 é—²ç½®æ¶ˆè´¹"></a>2.3 é—²ç½®æ¶ˆè´¹</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œæ˜¯æŒ‰ç…§é¡ºåºç¬¬ä¸€ä¸ªæ¶ˆæ¯ç»™ç¬¬ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œç¬¬äºŒä¸ªæ¶ˆæ¯ç»™ç¬¬äºŒä¸ªæ¶ˆè´¹è€…</p><p>ä½†æ˜¯å¯èƒ½ç¬¬ä¸€ä¸ªæ¶ˆæ¯çš„æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯å¾ˆè€—æ—¶ï¼Œä¸€ç›´æ²¡ç»“æŸï¼Œå°±å¯ä»¥è®©ç¬¬äºŒä¸ªæ¶ˆè´¹è€…ä¼˜å…ˆè·å¾—é—²ç½®çš„æ¶ˆæ¯</p><p>å°±æ˜¯åœ¨æ¶ˆè´¹è€…æ¥å—æ•°æ®å‰é…ç½®ä¸€ä¸ªå‚æ•°</p><p><strong>æ¶ˆè´¹è€…</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pikacredentials <span class="token operator">=</span> pika<span class="token punctuation">.</span>PlainCredentials<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span>connection <span class="token operator">=</span> pika<span class="token punctuation">.</span>BlockingConnection<span class="token punctuation">(</span>pika<span class="token punctuation">.</span>ConnectionParameters<span class="token punctuation">(</span><span class="token string">'101.133.225.166'</span><span class="token punctuation">,</span>credentials<span class="token operator">=</span>credentials<span class="token punctuation">)</span><span class="token punctuation">)</span>channel <span class="token operator">=</span> connection<span class="token punctuation">.</span>channel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—(åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—)</span><span class="token comment" spellcheck="true"># channel.queue_declare(queue='lqz123')</span><span class="token keyword">def</span> <span class="token function">callback</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> method<span class="token punctuation">,</span> properties<span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹è€…æ¥å—åˆ°äº†ä»»åŠ¡: %r"</span> <span class="token operator">%</span> body<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># é€šçŸ¥æœåŠ¡ç«¯ï¼Œæ¶ˆæ¯å–èµ°äº†ï¼Œå¦‚æœauto_ack=Falseï¼Œä¸åŠ ä¸‹é¢ï¼Œæ¶ˆæ¯ä¼šä¸€ç›´å­˜åœ¨</span>    ch<span class="token punctuation">.</span>basic_ack<span class="token punctuation">(</span>delivery_tag<span class="token operator">=</span>method<span class="token punctuation">.</span>delivery_tag<span class="token punctuation">)</span>channel<span class="token punctuation">.</span>basic_qos<span class="token punctuation">(</span>prefetch_count<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#####å°±åªæœ‰è¿™ä¸€å¥è¯ è°é—²ç½®è°è·å–ï¼Œæ²¡å¿…è¦æŒ‰ç…§é¡ºåºä¸€ä¸ªä¸€ä¸ªæ¥</span>channel<span class="token punctuation">.</span>basic_consume<span class="token punctuation">(</span>queue<span class="token operator">=</span><span class="token string">'lqz123'</span><span class="token punctuation">,</span>on_message_callback<span class="token operator">=</span>callback<span class="token punctuation">,</span>auto_ack<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>channel<span class="token punctuation">.</span>start_consuming<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h4 id="2-4-å‘å¸ƒè®¢é˜…"><a href="#2-4-å‘å¸ƒè®¢é˜…" class="headerlink" title="2.4 å‘å¸ƒè®¢é˜…"></a>2.4 å‘å¸ƒè®¢é˜…</h4><p>å‘å¸ƒè®¢é˜…çš„æœ¬è´¨æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå‘å¸ƒè€…å‘å¸ƒäº†å†…å®¹ï¼Œè®¢é˜…è€…åªè¦è®¢é˜…äº†å‘å¸ƒè€…å°±ä¼šæ¥å—å‘å¸ƒè€…æ¨é€çš„å†…å®¹</p><p><strong>å‘å¸ƒè€…</strong></p><p>ä¸ä¸Šé¢ç”Ÿäº§è€…æ¨¡å¼çš„ä¸åŒï¼Œè¿™é‡Œå‘å¸ƒè€…æ˜¯é€šè¿‡ä¸€ä¸ªä¸­é—´è€…ï¼Œæ‰€æœ‰ç»‘å®šäº†è¿™ä¸ªä¸­é—´è€…çš„è®¢é˜…è€…ç»‘å®šçš„é˜Ÿåˆ—éƒ½ä¼šæ¥å—åˆ°è¿™ä¸ªæ¨é€</p><p>å°±åƒa,b,cï¼ˆè®¢é˜…è€…ï¼‰éƒ½å…³æ³¨äº†ä¸€ä¸ªå…¬ä¼—å·ï¼ˆå‘å¸ƒè€…ï¼‰ï¼Œåªè¦å…¬ä¼—å·å‘äº†æ¶ˆæ¯ï¼Œéƒ½ä¼šç”±å¾®ä¿¡çš„æœåŠ¡å™¨ï¼ˆä¸­é—´è€…ï¼‰è½¬å‘è¿™ä¸ªæ¶ˆæ¯åˆ°a,b,cçš„è´¦å·ï¼ˆé˜Ÿåˆ—ï¼‰ä¸Š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pikacredentials <span class="token operator">=</span> pika<span class="token punctuation">.</span>PlainCredentials<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span>connection <span class="token operator">=</span> pika<span class="token punctuation">.</span>BlockingConnection<span class="token punctuation">(</span>pika<span class="token punctuation">.</span>ConnectionParameters<span class="token punctuation">(</span><span class="token string">'101.133.225.166'</span><span class="token punctuation">,</span>credentials<span class="token operator">=</span>credentials<span class="token punctuation">)</span><span class="token punctuation">)</span>channel <span class="token operator">=</span> connection<span class="token punctuation">.</span>channel<span class="token punctuation">(</span><span class="token punctuation">)</span>channel<span class="token punctuation">.</span>exchange_declare<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">'m1'</span><span class="token punctuation">,</span>exchange_type<span class="token operator">=</span><span class="token string">'fanout'</span><span class="token punctuation">)</span>channel<span class="token punctuation">.</span>basic_publish<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">'m1'</span><span class="token punctuation">,</span>                      routing_key<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>                      body<span class="token operator">=</span><span class="token string">'lqz nb'</span><span class="token punctuation">)</span>connection<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><strong>è®¢é˜…è€…</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pikacredentials <span class="token operator">=</span> pika<span class="token punctuation">.</span>PlainCredentials<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span>connection <span class="token operator">=</span> pika<span class="token punctuation">.</span>BlockingConnection<span class="token punctuation">(</span>pika<span class="token punctuation">.</span>ConnectionParameters<span class="token punctuation">(</span><span class="token string">'101.133.225.166'</span><span class="token punctuation">,</span>credentials<span class="token operator">=</span>credentials<span class="token punctuation">)</span><span class="token punctuation">)</span>channel <span class="token operator">=</span> connection<span class="token punctuation">.</span>channel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># exchange='m1',exchange(ç§˜ä¹¦)çš„åç§°</span><span class="token comment" spellcheck="true"># exchange_type='fanout' , ç§˜ä¹¦å·¥ä½œæ–¹å¼å°†æ¶ˆæ¯å‘é€ç»™æ‰€æœ‰çš„é˜Ÿåˆ—</span>channel<span class="token punctuation">.</span>exchange_declare<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">'m1'</span><span class="token punctuation">,</span>exchange_type<span class="token operator">=</span><span class="token string">'fanout'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># éšæœºç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—</span>result <span class="token operator">=</span> channel<span class="token punctuation">.</span>queue_declare<span class="token punctuation">(</span>queue<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>exclusive<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>queue_name <span class="token operator">=</span> result<span class="token punctuation">.</span>method<span class="token punctuation">.</span>queue<span class="token keyword">print</span><span class="token punctuation">(</span>queue_name<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># è®©exchangeå’Œquequeè¿›è¡Œç»‘å®š.</span>channel<span class="token punctuation">.</span>queue_bind<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">'m1'</span><span class="token punctuation">,</span>queue<span class="token operator">=</span>queue_name<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">callback</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> method<span class="token punctuation">,</span> properties<span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹è€…æ¥å—åˆ°äº†ä»»åŠ¡: %r"</span> <span class="token operator">%</span> body<span class="token punctuation">)</span>channel<span class="token punctuation">.</span>basic_consume<span class="token punctuation">(</span>queue<span class="token operator">=</span>queue_name<span class="token punctuation">,</span>on_message_callback<span class="token operator">=</span>callback<span class="token punctuation">,</span>auto_ack<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>channel<span class="token punctuation">.</span>start_consuming<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h4 id="2-5-å‘å¸ƒè®¢é˜…æ‰©â˜Routing-æŒ‰å…³é”®å­—åŒ¹é…"><a href="#2-5-å‘å¸ƒè®¢é˜…æ‰©â˜Routing-æŒ‰å…³é”®å­—åŒ¹é…" class="headerlink" title="2.5 å‘å¸ƒè®¢é˜…æ‰©â˜Routing(æŒ‰å…³é”®å­—åŒ¹é…)"></a>2.5 å‘å¸ƒè®¢é˜…æ‰©â˜Routing(æŒ‰å…³é”®å­—åŒ¹é…)</h4><p>å‘å¸ƒè®¢é˜…æ¥å—æ¨é€çš„æ¡ä»¶é»˜è®¤æ˜¯åªæœ‰è®¢é˜…è€…èƒ½æ¥å—ï¼Œroutingé™å®šäº†è®¢é˜…è€…å¿…é¡»è¦æœ‰ç»‘å®šè¿™ä¸ªå…³é”®å­—</p><p><strong>å‘å¸ƒè€…</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pikacredentials <span class="token operator">=</span> pika<span class="token punctuation">.</span>PlainCredentials<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span>connection <span class="token operator">=</span> pika<span class="token punctuation">.</span>BlockingConnection<span class="token punctuation">(</span>pika<span class="token punctuation">.</span>ConnectionParameters<span class="token punctuation">(</span><span class="token string">'101.133.225.166'</span><span class="token punctuation">,</span>credentials<span class="token operator">=</span>credentials<span class="token punctuation">)</span><span class="token punctuation">)</span>channel <span class="token operator">=</span> connection<span class="token punctuation">.</span>channel<span class="token punctuation">(</span><span class="token punctuation">)</span>channel<span class="token punctuation">.</span>exchange_declare<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">'m2'</span><span class="token punctuation">,</span>exchange_type<span class="token operator">=</span><span class="token string">'direct'</span><span class="token punctuation">)</span>channel<span class="token punctuation">.</span>basic_publish<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">'m2'</span><span class="token punctuation">,</span>                      routing_key<span class="token operator">=</span><span class="token string">'bnb'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># å¤šä¸ªå…³é”®å­—ï¼ŒæŒ‡å®šrouting_key</span>                      body<span class="token operator">=</span><span class="token string">'lqz nb'</span><span class="token punctuation">)</span>connection<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><strong>è®¢é˜…è€…</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pikacredentials <span class="token operator">=</span> pika<span class="token punctuation">.</span>PlainCredentials<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span>connection <span class="token operator">=</span> pika<span class="token punctuation">.</span>BlockingConnection<span class="token punctuation">(</span>pika<span class="token punctuation">.</span>ConnectionParameters<span class="token punctuation">(</span><span class="token string">'101.133.225.166'</span><span class="token punctuation">,</span>credentials<span class="token operator">=</span>credentials<span class="token punctuation">)</span><span class="token punctuation">)</span>channel <span class="token operator">=</span> connection<span class="token punctuation">.</span>channel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># exchange='m1',exchange(ç§˜ä¹¦)çš„åç§°</span><span class="token comment" spellcheck="true"># exchange_type='direct' , ç§˜ä¹¦å·¥ä½œæ–¹å¼å°†æ¶ˆæ¯å‘é€ç»™ä¸åŒçš„å…³é”®å­—</span>channel<span class="token punctuation">.</span>exchange_declare<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">'m2'</span><span class="token punctuation">,</span>exchange_type<span class="token operator">=</span><span class="token string">'direct'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># éšæœºç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—</span>result <span class="token operator">=</span> channel<span class="token punctuation">.</span>queue_declare<span class="token punctuation">(</span>queue<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>exclusive<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>queue_name <span class="token operator">=</span> result<span class="token punctuation">.</span>method<span class="token punctuation">.</span>queue<span class="token keyword">print</span><span class="token punctuation">(</span>queue_name<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># è®©exchangeå’Œquequeè¿›è¡Œç»‘å®š. å¯ä»¥æœ‰å¤šä¸ª</span>channel<span class="token punctuation">.</span>queue_bind<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">'m2'</span><span class="token punctuation">,</span>queue<span class="token operator">=</span>queue_name<span class="token punctuation">,</span>routing_key<span class="token operator">=</span><span class="token string">'nb'</span><span class="token punctuation">)</span>channel<span class="token punctuation">.</span>queue_bind<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">'m2'</span><span class="token punctuation">,</span>queue<span class="token operator">=</span>queue_name<span class="token punctuation">,</span>routing_key<span class="token operator">=</span><span class="token string">'bnb'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">callback</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> method<span class="token punctuation">,</span> properties<span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹è€…æ¥å—åˆ°äº†ä»»åŠ¡: %r"</span> <span class="token operator">%</span> body<span class="token punctuation">)</span>channel<span class="token punctuation">.</span>basic_consume<span class="token punctuation">(</span>queue<span class="token operator">=</span>queue_name<span class="token punctuation">,</span>on_message_callback<span class="token operator">=</span>callback<span class="token punctuation">,</span>auto_ack<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>channel<span class="token punctuation">.</span>start_consuming<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h4 id="2-6-å‘å¸ƒè®¢é˜…é«˜çº§â˜Topic-æŒ‰å…³é”®å­—æ¨¡ç³ŠåŒ¹é…"><a href="#2-6-å‘å¸ƒè®¢é˜…é«˜çº§â˜Topic-æŒ‰å…³é”®å­—æ¨¡ç³ŠåŒ¹é…" class="headerlink" title="2.6 å‘å¸ƒè®¢é˜…é«˜çº§â˜Topic(æŒ‰å…³é”®å­—æ¨¡ç³ŠåŒ¹é…)"></a>2.6 å‘å¸ƒè®¢é˜…é«˜çº§â˜Topic(æŒ‰å…³é”®å­—æ¨¡ç³ŠåŒ¹é…)</h4><p><strong>å‘å¸ƒè€…</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pikacredentials <span class="token operator">=</span> pika<span class="token punctuation">.</span>PlainCredentials<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span>connection <span class="token operator">=</span> pika<span class="token punctuation">.</span>BlockingConnection<span class="token punctuation">(</span>pika<span class="token punctuation">.</span>ConnectionParameters<span class="token punctuation">(</span><span class="token string">'101.133.225.166'</span><span class="token punctuation">,</span>credentials<span class="token operator">=</span>credentials<span class="token punctuation">)</span><span class="token punctuation">)</span>channel <span class="token operator">=</span> connection<span class="token punctuation">.</span>channel<span class="token punctuation">(</span><span class="token punctuation">)</span>channel<span class="token punctuation">.</span>exchange_declare<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">'m3'</span><span class="token punctuation">,</span>exchange_type<span class="token operator">=</span><span class="token string">'topic'</span><span class="token punctuation">)</span>channel<span class="token punctuation">.</span>basic_publish<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">'m3'</span><span class="token punctuation">,</span>                      <span class="token comment" spellcheck="true"># routing_key='lqz.handsome', #éƒ½èƒ½æ”¶åˆ°</span>                      routing_key<span class="token operator">=</span><span class="token string">'lqz.handsome.xx'</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">#åªæœ‰lqz.#èƒ½æ”¶åˆ°</span>                      body<span class="token operator">=</span><span class="token string">'lqz nb'</span><span class="token punctuation">)</span>connection<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>*åªèƒ½åŠ ä¸€ä¸ªå•è¯</p><p>#å¯ä»¥åŠ ä»»æ„å•è¯å­—ç¬¦</p><p><strong>è®¢é˜…è€…</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pikacredentials <span class="token operator">=</span> pika<span class="token punctuation">.</span>PlainCredentials<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span>connection <span class="token operator">=</span> pika<span class="token punctuation">.</span>BlockingConnection<span class="token punctuation">(</span>pika<span class="token punctuation">.</span>ConnectionParameters<span class="token punctuation">(</span><span class="token string">'101.133.225.166'</span><span class="token punctuation">,</span>credentials<span class="token operator">=</span>credentials<span class="token punctuation">)</span><span class="token punctuation">)</span>channel <span class="token operator">=</span> connection<span class="token punctuation">.</span>channel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># exchange='m1',exchange(ç§˜ä¹¦)çš„åç§°</span><span class="token comment" spellcheck="true"># exchange_type='direct' , ç§˜ä¹¦å·¥ä½œæ–¹å¼å°†æ¶ˆæ¯å‘é€ç»™ä¸åŒçš„å…³é”®å­—</span>channel<span class="token punctuation">.</span>exchange_declare<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">'m3'</span><span class="token punctuation">,</span>exchange_type<span class="token operator">=</span><span class="token string">'topic'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># éšæœºç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—</span>result <span class="token operator">=</span> channel<span class="token punctuation">.</span>queue_declare<span class="token punctuation">(</span>queue<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>exclusive<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>queue_name <span class="token operator">=</span> result<span class="token punctuation">.</span>method<span class="token punctuation">.</span>queue<span class="token keyword">print</span><span class="token punctuation">(</span>queue_name<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># è®©exchangeå’Œquequeè¿›è¡Œç»‘å®š.</span>channel<span class="token punctuation">.</span>queue_bind<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">'m3'</span><span class="token punctuation">,</span>queue<span class="token operator">=</span>queue_name<span class="token punctuation">,</span>routing_key<span class="token operator">=</span><span class="token string">'lqz.#'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">callback</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> method<span class="token punctuation">,</span> properties<span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹è€…æ¥å—åˆ°äº†ä»»åŠ¡: %r"</span> <span class="token operator">%</span> body<span class="token punctuation">)</span>channel<span class="token punctuation">.</span>basic_consume<span class="token punctuation">(</span>queue<span class="token operator">=</span>queue_name<span class="token punctuation">,</span>on_message_callback<span class="token operator">=</span>callback<span class="token punctuation">,</span>auto_ack<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>channel<span class="token punctuation">.</span>start_consuming<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h3 id="3-rpcè¿œç¨‹è¿‡ç¨‹è°ƒç”¨"><a href="#3-rpcè¿œç¨‹è¿‡ç¨‹è°ƒç”¨" class="headerlink" title="3 rpcè¿œç¨‹è¿‡ç¨‹è°ƒç”¨"></a>3 rpcè¿œç¨‹è¿‡ç¨‹è°ƒç”¨</h3><p>æ˜¯å¾®æœåŠ¡çš„ä¸€ç§æ¦‚å¿µï¼Œé€šè¿‡httpè¯·æ±‚æˆ–è€…socketè¯·æ±‚å»æœåŠ¡ç«¯è°ƒç”¨å‡½æ•°æˆ–è€…ç±»çš„æ–¹æ³•</p><h4 id="3-1-rabbitmqå®ç°rpc"><a href="#3-1-rabbitmqå®ç°rpc" class="headerlink" title="3.1 rabbitmqå®ç°rpc"></a>3.1 rabbitmqå®ç°rpc</h4><p><strong>æœåŠ¡ç«¯</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pikacredentials <span class="token operator">=</span> pika<span class="token punctuation">.</span>PlainCredentials<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span> <span class="token string">"admin"</span><span class="token punctuation">)</span>connection <span class="token operator">=</span> pika<span class="token punctuation">.</span>BlockingConnection<span class="token punctuation">(</span>pika<span class="token punctuation">.</span>ConnectionParameters<span class="token punctuation">(</span><span class="token string">'101.133.225.166'</span><span class="token punctuation">,</span> credentials<span class="token operator">=</span>credentials<span class="token punctuation">)</span><span class="token punctuation">)</span>channel <span class="token operator">=</span> connection<span class="token punctuation">.</span>channel<span class="token punctuation">(</span><span class="token punctuation">)</span>channel<span class="token punctuation">.</span>queue_declare<span class="token punctuation">(</span>queue<span class="token operator">=</span><span class="token string">'rpc_queue'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">fib</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">0</span>    <span class="token keyword">elif</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> fib<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> fib<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">on_request</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span> method<span class="token punctuation">,</span> props<span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">:</span>    n <span class="token operator">=</span> int<span class="token punctuation">(</span>body<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" [.] fib(%s)"</span> <span class="token operator">%</span> n<span class="token punctuation">)</span>    response <span class="token operator">=</span> fib<span class="token punctuation">(</span>n<span class="token punctuation">)</span>    ch<span class="token punctuation">.</span>basic_publish<span class="token punctuation">(</span>exchange<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>                     routing_key<span class="token operator">=</span>props<span class="token punctuation">.</span>reply_to<span class="token punctuation">,</span>                     properties<span class="token operator">=</span>pika<span class="token punctuation">.</span>BasicProperties<span class="token punctuation">(</span>correlation_id <span class="token operator">=</span> \                                                         props<span class="token punctuation">.</span>correlation_id<span class="token punctuation">)</span><span class="token punctuation">,</span>                     body<span class="token operator">=</span>str<span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span>    ch<span class="token punctuation">.</span>basic_ack<span class="token punctuation">(</span>delivery_tag<span class="token operator">=</span>method<span class="token punctuation">.</span>delivery_tag<span class="token punctuation">)</span>channel<span class="token punctuation">.</span>basic_qos<span class="token punctuation">(</span>prefetch_count<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>channel<span class="token punctuation">.</span>basic_consume<span class="token punctuation">(</span>queue<span class="token operator">=</span><span class="token string">'rpc_queue'</span><span class="token punctuation">,</span> on_message_callback<span class="token operator">=</span>on_request<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" [x] Awaiting RPC requests"</span><span class="token punctuation">)</span>channel<span class="token punctuation">.</span>start_consuming<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><strong>å®¢æˆ·ç«¯</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> pika<span class="token keyword">import</span> uuid<span class="token keyword">class</span> <span class="token class-name">FibonacciRpcClient</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>credentials <span class="token operator">=</span> pika<span class="token punctuation">.</span>PlainCredentials<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span> <span class="token string">"admin"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>connection <span class="token operator">=</span> pika<span class="token punctuation">.</span>BlockingConnection<span class="token punctuation">(</span>pika<span class="token punctuation">.</span>ConnectionParameters<span class="token punctuation">(</span><span class="token string">'101.133.225.166'</span><span class="token punctuation">,</span> credentials<span class="token operator">=</span>self<span class="token punctuation">.</span>credentials<span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>channel <span class="token operator">=</span> self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>channel<span class="token punctuation">(</span><span class="token punctuation">)</span>        result <span class="token operator">=</span> self<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>queue_declare<span class="token punctuation">(</span>queue<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> exclusive<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>callback_queue <span class="token operator">=</span> result<span class="token punctuation">.</span>method<span class="token punctuation">.</span>queue        self<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>basic_consume<span class="token punctuation">(</span>            queue<span class="token operator">=</span>self<span class="token punctuation">.</span>callback_queue<span class="token punctuation">,</span>            on_message_callback<span class="token operator">=</span>self<span class="token punctuation">.</span>on_response<span class="token punctuation">,</span>            auto_ack<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">on_response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> method<span class="token punctuation">,</span> props<span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>corr_id <span class="token operator">==</span> props<span class="token punctuation">.</span>correlation_id<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>response <span class="token operator">=</span> body    <span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>response <span class="token operator">=</span> None        self<span class="token punctuation">.</span>corr_id <span class="token operator">=</span> str<span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>basic_publish<span class="token punctuation">(</span>            exchange<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>            routing_key<span class="token operator">=</span><span class="token string">'rpc_queue'</span><span class="token punctuation">,</span>            properties<span class="token operator">=</span>pika<span class="token punctuation">.</span>BasicProperties<span class="token punctuation">(</span>                reply_to<span class="token operator">=</span>self<span class="token punctuation">.</span>callback_queue<span class="token punctuation">,</span>                correlation_id<span class="token operator">=</span>self<span class="token punctuation">.</span>corr_id<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            body<span class="token operator">=</span>str<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">while</span> self<span class="token punctuation">.</span>response <span class="token keyword">is</span> None<span class="token punctuation">:</span>            self<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>process_data_events<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> int<span class="token punctuation">(</span>self<span class="token punctuation">.</span>response<span class="token punctuation">)</span>fibonacci_rpc <span class="token operator">=</span> FibonacciRpcClient<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" [x] Requesting fib(30)"</span><span class="token punctuation">)</span>response <span class="token operator">=</span> fibonacci_rpc<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># å¤–ç•Œçœ‹ä¸Šå»ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°çš„call()å‡½æ•°ä¸€æ ·</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" [.] Got %r"</span> <span class="token operator">%</span> response<span class="token punctuation">)</span></code></pre><h4 id="3-2-SimpleXMLRPCServerå®ç°rpc"><a href="#3-2-SimpleXMLRPCServerå®ç°rpc" class="headerlink" title="3.2 SimpleXMLRPCServerå®ç°rpc"></a>3.2 SimpleXMLRPCServerå®ç°rpc</h4><p><strong>æœåŠ¡ç«¯</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> xmlrpc<span class="token punctuation">.</span>server <span class="token keyword">import</span> SimpleXMLRPCServer<span class="token keyword">class</span> <span class="token class-name">RPCServer</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span>RPCServer<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>send_data <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'server:'+str(i): i for i in range(100)&amp;#125;</span>        self<span class="token punctuation">.</span>recv_data <span class="token operator">=</span> None    <span class="token keyword">def</span> <span class="token function">getObj</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'get data'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>send_data    <span class="token keyword">def</span> <span class="token function">sendObj</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'send data'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>recv_data <span class="token operator">=</span> data        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>recv_data<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># SimpleXMLRPCServer</span>server <span class="token operator">=</span> SimpleXMLRPCServer<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'localhost'</span><span class="token punctuation">,</span><span class="token number">4242</span><span class="token punctuation">)</span><span class="token punctuation">,</span> allow_none<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>server<span class="token punctuation">.</span>register_introspection_functions<span class="token punctuation">(</span><span class="token punctuation">)</span>server<span class="token punctuation">.</span>register_instance<span class="token punctuation">(</span>RPCServer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>server<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><strong>å®¢æˆ·ç«¯</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> time<span class="token keyword">from</span> xmlrpc<span class="token punctuation">.</span>client <span class="token keyword">import</span> ServerProxy<span class="token comment" spellcheck="true"># SimpleXMLRPCServer</span><span class="token keyword">def</span> <span class="token function">xmlrpc_client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'xmlrpc client'</span><span class="token punctuation">)</span>    c <span class="token operator">=</span> ServerProxy<span class="token punctuation">(</span><span class="token string">'http://localhost:4242'</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'client:'+str(i): i for i in range(100)&amp;#125;</span>    start <span class="token operator">=</span> time<span class="token punctuation">.</span>clock<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        a<span class="token operator">=</span>c<span class="token punctuation">.</span>getObj<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        c<span class="token punctuation">.</span>sendObj<span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'xmlrpc total time %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>time<span class="token punctuation">.</span>clock<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    xmlrpc_client<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h4 id="3-3-ZeroRPCå®ç°rpc"><a href="#3-3-ZeroRPCå®ç°rpc" class="headerlink" title="3.3 ZeroRPCå®ç°rpc"></a>3.3 ZeroRPCå®ç°rpc</h4><p><strong>æœåŠ¡ç«¯</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> zerorpc<span class="token keyword">class</span> <span class="token class-name">RPCServer</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        super<span class="token punctuation">(</span>RPCServer<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>send_data <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'server:'+str(i): i for i in range(100)&amp;#125;</span>        self<span class="token punctuation">.</span>recv_data <span class="token operator">=</span> None    <span class="token keyword">def</span> <span class="token function">getObj</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'get data'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>send_data    <span class="token keyword">def</span> <span class="token function">sendObj</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'send data'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>recv_data <span class="token operator">=</span> data        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>recv_data<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># zerorpc</span>s <span class="token operator">=</span> zerorpc<span class="token punctuation">.</span>Server<span class="token punctuation">(</span>RPCServer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token string">'tcp://0.0.0.0:4243'</span><span class="token punctuation">)</span>s<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><strong>å®¢æˆ·ç«¯</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> zerorpc<span class="token keyword">import</span> time<span class="token comment" spellcheck="true"># zerorpc</span><span class="token keyword">def</span> <span class="token function">zerorpc_client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'zerorpc client'</span><span class="token punctuation">)</span>    c <span class="token operator">=</span> zerorpc<span class="token punctuation">.</span>Client<span class="token punctuation">(</span><span class="token punctuation">)</span>    c<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">'tcp://127.0.0.1:4243'</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'client:'+str(i): i for i in range(100)&amp;#125;</span>    start <span class="token operator">=</span> time<span class="token punctuation">.</span>clock<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        a<span class="token operator">=</span>c<span class="token punctuation">.</span>getObj<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        c<span class="token punctuation">.</span>sendObj<span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'total time %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>time<span class="token punctuation">.</span>clock<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    zerorpc_client<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æ¶ˆæ¯é˜Ÿåˆ—ä»‹ç»ï¼š&lt;strong&gt;&lt;a href=&quot;http://mrw.so/6m21VY&quot;&gt;http://mrw.so/6m21VY&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;1-å®‰è£…&quot;&gt;&lt;a href=&quot;#1-å®‰è£…&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="Rabbitmq" scheme="http://huang_zhao.gitee.io/task/tags/Rabbitmq/"/>
    
    <category term="Rpc" scheme="http://huang_zhao.gitee.io/task/tags/Rpc/"/>
    
    <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="http://huang_zhao.gitee.io/task/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>æ¶ˆæ¯é˜Ÿåˆ—</title>
    <link href="http://huang_zhao.gitee.io/task/2020/03/24/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    <id>http://huang_zhao.gitee.io/task/2020/03/24/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/</id>
    <published>2020-03-24T12:30:17.000Z</published>
    <updated>2020-09-09T11:19:07.186Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-å®šä¹‰"><a href="#1-å®šä¹‰" class="headerlink" title="1 å®šä¹‰"></a>1 å®šä¹‰</h3><p>æ¶ˆæ¯é˜Ÿåˆ—ï¼šæ˜¯ä¸€ç§æ•°æ®ç»“æ„</p><p>ç”Ÿäº§è€…ï¼šæŠŠæ•°æ®æ”¾å…¥åˆ°é˜Ÿåˆ—ä¸­çš„ä¸€æ–¹</p><p>æ¶ˆè´¹è€…ï¼šæŠŠæ•°æ®ä»é˜Ÿåˆ—ä¸­å–å‡ºçš„ä¸€æ–¹</p><h3 id="2-å­˜åœ¨çš„æ„ä¹‰"><a href="#2-å­˜åœ¨çš„æ„ä¹‰" class="headerlink" title="2 å­˜åœ¨çš„æ„ä¹‰"></a>2 å­˜åœ¨çš„æ„ä¹‰</h3><h4 id="2-1-è§£è€¦"><a href="#2-1-è§£è€¦" class="headerlink" title="2.1 è§£è€¦"></a>2.1 è§£è€¦</h4><p>åœºæ™¯ä¸€ï¼š</p><p>å­˜åœ¨ä¸‰ä¸ªç³»ç»Ÿ</p><p>aç³»ç»Ÿè¦ç»™bç³»ç»Ÿå‘é€æ•°æ®ï¼Œè°ƒç”¨ç³»ç»Ÿbçš„æ¥å£</p><p>aç³»ç»Ÿè¦ç»™cç³»ç»Ÿå‘é€æ•°æ®ï¼Œè°ƒç”¨ç³»ç»Ÿcçš„æ¥å£</p><p>å¦‚æœæœ‰ä¸€å¤©bä¸éœ€è¦açš„æ•°æ®äº†ï¼Œå°±éœ€è¦è®©aæ³¨é‡Šæ‰æ‰bæ¥å£çš„ä»£ç </p><p>å¦‚æœæ–°å¢ç³»ç»Ÿdè¦æ¥å—æ•°æ®ï¼Œåˆè¦å¢åŠ è°ƒç”¨ç³»ç»Ÿdçš„ä»£ç </p><p><strong>è¿™äº›è°ƒç”¨é€»è¾‘éƒ½æ˜¯ä¸€äº›é‡å¤çš„ä¸å¯é¿å…çš„åŠ³åŠ¨</strong></p><p>æ­¤å¤„çš„aç³»ç»Ÿä¸bcdç³»ç»Ÿé«˜åº¦è€¦åˆäº†ï¼Œå› ä¸ºä¹‹é—´çš„æ•°æ®äº¤äº’å¦‚æœéœ€è¦ä¿®æ”¹ï¼Œæˆ–è€…æ¥å—æ•°æ®çš„ç³»ç»Ÿå‡ºç°äº†é—®é¢˜ï¼Œé‚£ä¹ˆaç³»ç»Ÿçš„è°ƒç”¨é€»è¾‘è¿˜è¦æ€è€ƒéœ€ä¸éœ€è¦ç»§ç»­å‘é€æ•°æ®</p><p>åœºæ™¯äºŒï¼š</p><p>åœ¨ä¸Šè¿°åœºæ™¯åŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ç”Ÿäº§è€…ï¼ˆaç³»ç»Ÿï¼‰ä¸æ¶ˆè´¹è€…ï¼ˆbcdç³»ç»Ÿï¼‰ä¹‹é—´çš„ä¸€ä¸ªæ•°æ®äº¤äº’ä¸­è½¬ç«™</p><p>aç³»ç»Ÿå‘å¸ƒæ¶ˆæ¯ï¼Œbcdè®¢é˜…æ¶ˆæ¯ï¼Œå¦‚æœä¸éœ€è¦è®¢é˜…å°±å–æ¶ˆè®¢é˜…å³å¯ï¼Œå¹¶ä¸éœ€è¦ä¿®æ”¹å‘å¸ƒæ¶ˆæ¯çš„ä»£ç </p><h4 id="2-2-å¼‚æ­¥"><a href="#2-2-å¼‚æ­¥" class="headerlink" title="2.2 å¼‚æ­¥"></a>2.2 å¼‚æ­¥</h4><p>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå¦‚æœaç³»ç»Ÿè¦å®Œæˆ<strong>äº§ç”Ÿæ•°æ®ï¼ˆ100msï¼‰</strong>ï¼Œ<strong>å‘é€æ•°æ®è‡³ç³»ç»Ÿbï¼ˆ300msï¼‰</strong>ï¼Œ<strong>å‘é€æ•°æ®è‡³ç³»ç»Ÿcï¼ˆ300msï¼‰</strong></p><p>æ­¤æ—¶aç³»ç»Ÿå®Œæˆæ¶ˆæ¯å‘é€æ˜¯ä¸€ä¸ªåŒæ­¥ä»»åŠ¡ï¼Œå®Œæˆæ—¶é—´æ˜¯100+300+300=700ms</p><p>å¦‚æœç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œaç³»ç»Ÿåªè¦äº§ç”Ÿæ¶ˆæ¯ï¼Œå¹¶å‘é€è‡³æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”±æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å›è°ƒè®¢é˜…è¿‡çš„ç³»ç»Ÿæ¥å£</p><p>æ­¤æ—¶aç³»ç»Ÿå®Œæˆå‘é€æ¶ˆæ¯çš„æ—¶é—´æ˜¯100ms</p><h4 id="2-3-å‰Šå³°-é™æµ"><a href="#2-3-å‰Šå³°-é™æµ" class="headerlink" title="2.3 å‰Šå³°/é™æµ"></a>2.3 å‰Šå³°/é™æµ</h4><p>å¦‚æœæœ‰ä¸€ä¸ªå•†åœºç½‘ç«™å‡ºäº†ä¿ƒé”€æ´»åŠ¨ï¼Œæ­¤æ—¶æ¯ç§’çš„è¯·æ±‚æ•°æ˜¯5000ï¼Œä¸€èˆ¬çš„mysqlåªèƒ½å¤„ç†2000ä¸ªå·¦å³çš„å¹¶å‘ã€‚</p><p>æ­¤æ—¶åœ¨ç”¨æˆ·ä¸mysqlä¹‹é—´åŠ å…¥mqï¼Œå®ƒå¯ä»¥æ¥å—è€…5000ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯åªç»™mysqlå‘é€2000ä¸ªã€‚</p><p>å°±åƒä¸€ä¸ªå–·æ°´çš„ç®¡å­ï¼Œå¦‚æœçªç„¶æµæ°´é‡è¿‡å¤§ï¼Œç®¡å­å°±ä¼šè£‚å¼€ï¼Œæˆ‘ä»¬é€šè¿‡å¼€å…³æŠŠæ°´æµé‡æ”¾å°ä¸€ç‚¹å°±é—®é¢˜ä¸å¤§ï¼Œä½†æ˜¯æˆ‘ä»¬è¦çŸ¥é“ï¼Œåœ¨è¿™ä¸ªå¼€å…³åæ°´å‹è¿˜æ˜¯è¿™ä¹ˆå¤§ï¼Œmqåšåˆ°çš„åªæ˜¯é™åˆ¶æœ€å¤§é‡ã€‚</p><h4 id="2-4-å…¶ä»–åº”ç”¨åœºæ™¯"><a href="#2-4-å…¶ä»–åº”ç”¨åœºæ™¯" class="headerlink" title="2.4 å…¶ä»–åº”ç”¨åœºæ™¯"></a>2.4 å…¶ä»–åº”ç”¨åœºæ™¯</h4><ul><li><strong>æ—¥å¿—å¤„ç†</strong>ï¼šå°†å¤§é‡æ—¥å¿—å­˜å‚¨åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼ˆä¸€èˆ¬é‡‡ç”¨åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—kafkaï¼‰ï¼Œè§£å†³å¤§é‡æ—¥å¿—ä¼ è¾“çš„é—®é¢˜ã€‚å…¶ä¸­ï¼Œæ¶ˆæ¯é˜Ÿåˆ—è´Ÿè´£æ—¥å¿—æ•°æ®çš„æ¥æ”¶ï¼Œå­˜å‚¨å’Œè½¬å‘ï¼›</li><li><strong>æ¶ˆæ¯é€šè®¯</strong>ï¼šç‚¹å¯¹ç‚¹é€šè®¯æˆ–èŠå¤©å®¤é€šè®¯ã€‚</li></ul><h3 id="3-ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¼šæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹"><a href="#3-ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¼šæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹" class="headerlink" title="3 ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¼šæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹"></a>3 ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ä¼šæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹</h3><p>ä¼˜ç‚¹å…¶å®å°±æ˜¯ä¸Šæ–‡ä¸­è°ˆåˆ°çš„ï¼Œåœ¨ç‰¹æ®Šåœºæ™¯ä¸‹çš„åº”ç”¨å¥½å¤„ï¼Œè§£è€¦ã€å¼‚æ­¥ä¸å‰Šå³°ç­‰ã€‚</p><p><strong>ç³»ç»Ÿå¯ç”¨æ€§</strong>ï¼š<br> ç³»ç»Ÿå› ä¸ºä¾èµ–ä¸MQæ¶ˆæ¯é˜Ÿåˆ—è¿™ä¸ªæœåŠ¡ï¼Œè‹¥è¿™ä¸ªæœåŠ¡å´©æºƒäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„æ•´ä¸ªç³»ç»Ÿå°†ä¸å¯ç”¨ã€‚ä¸ºæ­¤å¾€å¾€æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡é›†ç¾¤/åˆ†å¸ƒå¼éƒ¨ç½²æ¥å®ç°MQé«˜å¯ç”¨çš„ã€‚</p><p>é«˜å¯ç”¨ï¼šé€šå¸¸æ¥æè¿°ä¸€ä¸ªç³»ç»Ÿç»è¿‡ä¸“é—¨çš„è®¾è®¡ï¼Œä»è€Œå‡å°‘åœå·¥æ—¶é—´ï¼Œè€Œä¿æŒå…¶æœåŠ¡çš„é«˜åº¦å¯ç”¨æ€§</p><p><strong>ç³»ç»Ÿå¤æ‚åº¦</strong>ï¼š<br> æˆ‘ä»¬å°†æ•°æ®å†™åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸Šï¼Œå°±æœ‰å¯èƒ½ä¼šå­˜åœ¨æ•°æ®ä¸¢å¤±çš„æƒ…å†µã€‚ä»¥åŠæˆ‘ä»¬å¦‚ä½•ä¿è¯æ¶ˆæ¯æ²¡æœ‰è¢«é‡å¤æ¶ˆè´¹ç­‰é—®é¢˜ã€‚</p><p><strong>ä¸€è‡´æ€§é—®é¢˜</strong>ï¼š<br> Aç³»ç»Ÿå°†è¯·æ±‚å†™å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—åå°±è¿”å›è¯·æ±‚æˆåŠŸäº†ï¼Œå‡è®¾åœ¨å¤šæœºéƒ¨ç½²çš„æ—¶å€™ï¼Œç³»ç»ŸBã€Cå†™åº“æˆåŠŸï¼Œå‡è®¾Då†™å…¥å¤±è´¥äº†ï¼Œè¿™ç§æƒ…å†µä¸‹å°±ä¼šäº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><p><a href="https://www.jianshu.com/p/ec7c2503c3ef">https://www.jianshu.com/p/ec7c2503c3ef</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;1-å®šä¹‰&quot;&gt;&lt;a href=&quot;#1-å®šä¹‰&quot; class=&quot;headerlink&quot; title=&quot;1 å®šä¹‰&quot;&gt;&lt;/a&gt;1 å®šä¹‰&lt;/h3&gt;&lt;p&gt;æ¶ˆæ¯é˜Ÿåˆ—ï¼šæ˜¯ä¸€ç§æ•°æ®ç»“æ„&lt;/p&gt;
&lt;p&gt;ç”Ÿäº§è€…ï¼šæŠŠæ•°æ®æ”¾å…¥åˆ°é˜Ÿåˆ—ä¸­çš„ä¸€æ–¹&lt;/p&gt;
&lt;p&gt;æ¶ˆè´¹è€…ï¼šæŠŠæ•°æ®ä»é˜Ÿåˆ—ä¸­å–å‡ºçš„ä¸€æ–¹&lt;/</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="http://huang_zhao.gitee.io/task/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>requestsæ¨¡å—ä½¿ç”¨</title>
    <link href="http://huang_zhao.gitee.io/task/2020/03/21/requests%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8/"/>
    <id>http://huang_zhao.gitee.io/task/2020/03/21/requests%E6%A8%A1%E5%9D%97%E4%BD%BF%E7%94%A8/</id>
    <published>2020-03-21T05:20:11.000Z</published>
    <updated>2020-08-26T01:00:39.257Z</updated>
    
    <content type="html"><![CDATA[<h4 id="1-å‘é€è¯·æ±‚"><a href="#1-å‘é€è¯·æ±‚" class="headerlink" title="1 å‘é€è¯·æ±‚"></a>1 å‘é€è¯·æ±‚</h4><pre class=" language-python"><code class="language-python">r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://images.cnblogs.com/cnblogs_com/xuexianqi/1749514/o_20042405405202.png'</span><span class="token punctuation">)</span></code></pre><h4 id="2-è¯·æ±‚åœ°å€ä¸­æºå¸¦æ•°æ®"><a href="#2-è¯·æ±‚åœ°å€ä¸­æºå¸¦æ•°æ®" class="headerlink" title="2 è¯·æ±‚åœ°å€ä¸­æºå¸¦æ•°æ®"></a>2 è¯·æ±‚åœ°å€ä¸­æºå¸¦æ•°æ®</h4><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># urlçš„ç¼–ç å’Œè§£ç </span><span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> urlencode<span class="token punctuation">,</span>unquoteheader <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>     <span class="token string">'user-agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36'</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>res<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com/s'</span><span class="token punctuation">,</span>headers<span class="token operator">=</span>header<span class="token punctuation">,</span>params<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'wd':'ç¾å¥³'&amp;#125;)</span></code></pre><h4 id="3-è¯·æ±‚ä¸­å¸¦cookie"><a href="#3-è¯·æ±‚ä¸­å¸¦cookie" class="headerlink" title="3 è¯·æ±‚ä¸­å¸¦cookie"></a>3 è¯·æ±‚ä¸­å¸¦cookie</h4><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># æ–¹å¼ä¸€ï¼šåœ¨headersä¸­æºå¸¦</span>header <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    <span class="token string">'cookie'</span><span class="token punctuation">:</span><span class="token string">'name=hz'</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8000/test/'</span><span class="token punctuation">,</span>headers<span class="token operator">=</span>header<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># æ–¹å¼äºŒï¼šæ·»åŠ cookieså‚æ•°</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8000/test/'</span><span class="token punctuation">,</span>cookies<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'name':'hz'&amp;#125;)</span></code></pre><h4 id="4-postè¯·æ±‚å‘é€urlå’Œjsonæ ¼å¼æ•°æ®"><a href="#4-postè¯·æ±‚å‘é€urlå’Œjsonæ ¼å¼æ•°æ®" class="headerlink" title="4 postè¯·æ±‚å‘é€urlå’Œjsonæ ¼å¼æ•°æ®"></a>4 postè¯·æ±‚å‘é€urlå’Œjsonæ ¼å¼æ•°æ®</h4><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># urlæ ¼å¼</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8000/test/'</span><span class="token punctuation">,</span>data<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'name':'hz'&amp;#125;)</span><span class="token comment" spellcheck="true"># postè¯·æ±‚å‘é€jsonæ ¼å¼æ•°æ®</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8000/test/'</span><span class="token punctuation">,</span>json<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'name':'hz'&amp;#125;)</span></code></pre><h4 id="5-sessionå‡½æ•°è‡ªåŠ¨å¤„ç†æºå¸¦cookie"><a href="#5-sessionå‡½æ•°è‡ªåŠ¨å¤„ç†æºå¸¦cookie" class="headerlink" title="5 sessionå‡½æ•°è‡ªåŠ¨å¤„ç†æºå¸¦cookie"></a>5 sessionå‡½æ•°è‡ªåŠ¨å¤„ç†æºå¸¦cookie</h4><pre class=" language-python"><code class="language-python">session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>r <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8000/login/'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span>r2 <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8000/order/'</span><span class="token punctuation">)</span></code></pre><h4 id="6-responseå¯¹è±¡çš„æ–¹æ³•"><a href="#6-responseå¯¹è±¡çš„æ–¹æ³•" class="headerlink" title="6 responseå¯¹è±¡çš„æ–¹æ³•"></a>6 responseå¯¹è±¡çš„æ–¹æ³•</h4><pre class=" language-python"><code class="language-python">respone<span class="token punctuation">.</span>text <span class="token comment" spellcheck="true"># å“åº”çš„æ–‡æœ¬ä¿¡æ¯</span><span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>content<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># å“åº”ä½“çš„äºŒè¿›åˆ¶</span><span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># å“åº”çŠ¶æ€ç </span><span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># å“åº”å¤´</span><span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true"># cookie</span><span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#  æŠŠcookieè½¬æˆå­—å…¸</span><span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># keyå’Œvalue</span><span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>url<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># è¯·æ±‚çš„url</span><span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>history<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">#[]æ”¾é‡å®šå‘ä¹‹å‰çš„åœ°å€</span><span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>encoding<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># å“åº”çš„ç¼–ç æ–¹å¼</span>respone<span class="token punctuation">.</span>iter_content<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># å›¾ç‰‡ï¼Œè§†é¢‘ï¼Œå¤§æ–‡ä»¶ï¼Œä¸€ç‚¹ä¸€ç‚¹å¾ªç¯å–å‡ºæ¥</span></code></pre><h4 id="7-ç¼–ç é—®é¢˜"><a href="#7-ç¼–ç é—®é¢˜" class="headerlink" title="7 ç¼–ç é—®é¢˜"></a>7 ç¼–ç é—®é¢˜</h4><pre class=" language-python"><code class="language-python">res<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://www.autohome.com/news'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># ä¸€æ—¦æ‰“å°å‡ºæ¥å‡ºç°ä¹±ç é—®é¢˜</span><span class="token comment" spellcheck="true"># æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨è®¾å®šç¼–ç æ ¼å¼</span>res<span class="token punctuation">.</span>encoding<span class="token operator">=</span><span class="token string">'gb2312'</span><span class="token comment" spellcheck="true"># æ–¹å¼äºŒ</span>res<span class="token punctuation">.</span>encoding<span class="token operator">=</span>res<span class="token punctuation">.</span>apparent_encoding<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><h4 id="8-jsonè§£æ"><a href="#8-jsonè§£æ" class="headerlink" title="8 jsonè§£æ"></a>8 jsonè§£æ</h4><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> jsonrespone<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8000/index/'</span><span class="token punctuation">,</span>data<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'name':'lqz'&amp;#125;)</span><span class="token keyword">print</span><span class="token punctuation">(</span>type<span class="token punctuation">(</span>respone<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># å“åº”çš„æ–‡æœ¬</span><span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>respone<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>respone<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ç›¸å½“äºä¸Šé¢é‚£å¥è¯</span></code></pre><h4 id="9-ä½¿ç”¨ä»£ç†"><a href="#9-ä½¿ç”¨ä»£ç†" class="headerlink" title="9 ä½¿ç”¨ä»£ç†"></a>9 ä½¿ç”¨ä»£ç†</h4><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># respone=requests.get('http://127.0.0.1:8000/index/',proxies=&amp;#123;'http':'ä»£ç†çš„åœ°å€å’Œç«¯å£å·',&amp;#125;)</span><span class="token comment" spellcheck="true"># ä»£ç†ï¼Œå…è´¹ä»£ç†ï¼Œæ”¶è´¹ä»£ç†èŠ±é’±ä¹°</span><span class="token comment" spellcheck="true"># ä»£ç†æ± ï¼šåˆ—è¡¨æ”¾äº†ä¸€å †ä»£ç†ipï¼Œæ¯æ¬¡éšæœºå–ä¸€ä¸ªï¼Œå†å‘è¯·æ±‚å°±ä¸ä¼šå°ipäº†</span><span class="token comment" spellcheck="true"># é«˜åŒ¿å’Œé€æ˜ä»£ç†ï¼Ÿå¦‚æœä½¿ç”¨é«˜åŒ¿ä»£ç†ï¼Œåç«¯æ— è®ºå¦‚ä½•æ‹¿ä¸åˆ°ä½ çš„ipï¼Œä½¿ç”¨é€æ˜ï¼Œåç«¯èƒ½å¤Ÿæ‹¿åˆ°ä½ çš„ip</span><span class="token comment" spellcheck="true"># åç«¯å¦‚ä½•æ‹¿åˆ°é€æ˜ä»£ç†çš„ipï¼Œ  åç«¯ï¼šX-Forwarded-For</span><span class="token comment" spellcheck="true"># respone=requests.get('https://www.baidu.com/',proxies=&amp;#123;'http':'27.46.20.226:8888',&amp;#125;)</span><span class="token comment" spellcheck="true"># print(respone.text)</span></code></pre><h4 id="10-å…¶ä»–æ“ä½œ"><a href="#10-å…¶ä»–æ“ä½œ" class="headerlink" title="10 å…¶ä»–æ“ä½œ"></a>10 å…¶ä»–æ“ä½œ</h4><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 11 è¶…æ—¶è®¾ç½®</span><span class="token comment" spellcheck="true"># import requests</span><span class="token comment" spellcheck="true"># respone=requests.get('https://www.baidu.com',</span><span class="token comment" spellcheck="true">#                      timeout=0.0001)</span><span class="token comment" spellcheck="true"># 12 è®¤è¯è®¾ç½®ï¼ˆä½ è§ä¸åˆ°äº†ï¼‰</span><span class="token comment" spellcheck="true"># import requests</span><span class="token comment" spellcheck="true"># r=requests.get('xxx',auth=('user','password'))</span><span class="token comment" spellcheck="true"># print(r.status_code)</span><span class="token comment" spellcheck="true"># 13 å¼‚å¸¸å¤„ç†</span><span class="token comment" spellcheck="true"># import requests</span><span class="token comment" spellcheck="true"># from requests.exceptions import * #å¯ä»¥æŸ¥çœ‹requests.exceptionsè·å–å¼‚å¸¸ç±»å‹</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true"># try:</span><span class="token comment" spellcheck="true">#     r=requests.get('http://www.baidu.com',timeout=0.00001)</span><span class="token comment" spellcheck="true"># # except ReadTimeout:</span><span class="token comment" spellcheck="true"># #     print('===:')</span><span class="token comment" spellcheck="true"># except Exception as e:</span><span class="token comment" spellcheck="true">#     print(e)</span><span class="token comment" spellcheck="true"># 14 ä¸Šä¼ æ–‡ä»¶</span><span class="token comment" spellcheck="true"># res=requests.post('http://127.0.0.1:8000/index/',files=&amp;#123;'myfile':open('a.jpg','rb')&amp;#125;)</span><span class="token comment" spellcheck="true"># print(res.text)</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h4 id=&quot;1-å‘é€è¯·æ±‚&quot;&gt;&lt;a href=&quot;#1-å‘é€è¯·æ±‚&quot; class=&quot;headerlink&quot; title=&quot;1 å‘é€è¯·æ±‚&quot;&gt;&lt;/a&gt;1 å‘é€è¯·æ±‚&lt;/h4&gt;&lt;pre class=&quot; language-python&quot;&gt;&lt;code class=&quot;language-pytho</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="çˆ¬è™«" scheme="http://huang_zhao.gitee.io/task/tags/%E7%88%AC%E8%99%AB/"/>
    
    <category term="pythonæ¨¡å—" scheme="http://huang_zhao.gitee.io/task/tags/python%E6%A8%A1%E5%9D%97/"/>
    
  </entry>
  
  <entry>
    <title>è·¨åŸŸé—®é¢˜åŠè§£å†³</title>
    <link href="http://huang_zhao.gitee.io/task/2020/03/15/%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3/"/>
    <id>http://huang_zhao.gitee.io/task/2020/03/15/%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3/</id>
    <published>2020-03-15T05:33:43.000Z</published>
    <updated>2020-08-26T01:01:58.672Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€åŒæºç­–ç•¥"><a href="#ä¸€ã€åŒæºç­–ç•¥" class="headerlink" title="ä¸€ã€åŒæºç­–ç•¥"></a>ä¸€ã€åŒæºç­–ç•¥</h2><p>åŒæºç­–ç•¥ï¼šè¯·æ±‚çš„urlåœ°å€,å¿…é¡»ä¸æµè§ˆå™¨ä¸Šçš„urlåœ°å€å¤„äºåŒåŸŸä¸Š,ä¹Ÿå°±æ˜¯åŸŸå,ç«¯å£,åè®®ç›¸åŒ</p><p>æ¯”å¦‚:æˆ‘åœ¨æœ¬åœ°ä¸Šçš„åŸŸåæ˜¯127.0.0.1:8000,è¯·æ±‚å¦å¤–ä¸€ä¸ªåŸŸåï¼š127.0.0.1:8001ä¸€æ®µæ•°æ®</p><p>æµè§ˆå™¨ä¸Šå°±ä¼šæŠ¥é”™ï¼Œè¿™å°±æ˜¯åŒæºç­–ç•¥çš„ä¿æŠ¤,å¦‚æœæµè§ˆå™¨å¯¹javascriptæ²¡æœ‰åŒæºç­–ç•¥çš„ä¿æŠ¤,é‚£ä¹ˆä¸€äº›é‡è¦çš„æœºå¯†ç½‘ç«™å°†ä¼šå¾ˆå±é™©</p><h2 id="äºŒã€CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰ç®€ä»‹"><a href="#äºŒã€CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰ç®€ä»‹" class="headerlink" title="äºŒã€CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰ç®€ä»‹"></a>äºŒã€CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰ç®€ä»‹</h2><p><strong>æœåŠ¡ç«¯å¯¹æŸä¸ªæ¥æºçš„è¯·æ±‚å¼€æ”¾è¯·æ±‚èµ„æºçš„æ¥å£ï¼Œå°±æ˜¯cors</strong></p><p>æ•´ä¸ªCORSé€šä¿¡è¿‡ç¨‹ï¼Œéƒ½æ˜¯æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼Œä¸éœ€è¦ç”¨æˆ·å‚ä¸ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´ï¼ŒCORSé€šä¿¡ä¸åŒæºçš„AJAXé€šä¿¡æ²¡æœ‰å·®åˆ«ï¼Œä»£ç å®Œå…¨ä¸€æ ·ã€‚æµè§ˆå™¨ä¸€æ—¦å‘ç°AJAXè¯·æ±‚è·¨æºï¼Œå°±ä¼šè‡ªåŠ¨æ·»åŠ ä¸€äº›é™„åŠ çš„å¤´ä¿¡æ¯ï¼Œæœ‰æ—¶è¿˜ä¼šå¤šå‡ºä¸€æ¬¡é™„åŠ çš„è¯·æ±‚ï¼Œä½†ç”¨æˆ·ä¸ä¼šæœ‰æ„Ÿè§‰ã€‚</p><p><strong>å› æ­¤ï¼Œå®ç°CORSé€šä¿¡çš„å…³é”®æ˜¯æœåŠ¡å™¨ã€‚åªè¦æœåŠ¡å™¨å®ç°äº†CORSæ¥å£ï¼Œå°±å¯ä»¥è·¨æºé€šä¿¡ã€‚</strong></p><h2 id="ä¸‰ã€CORSä¸¤ç§è¯·æ±‚è¯¦è§£"><a href="#ä¸‰ã€CORSä¸¤ç§è¯·æ±‚è¯¦è§£" class="headerlink" title="ä¸‰ã€CORSä¸¤ç§è¯·æ±‚è¯¦è§£"></a>ä¸‰ã€CORSä¸¤ç§è¯·æ±‚è¯¦è§£</h2><p>åªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ï¼Œåªè¦å…¶ä¸­ä¸€ä¸ªä¸æ»¡è¶³å°±æ˜¯éç®€å•è¯·æ±‚</p><pre class=" language-python"><code class="language-python"><span class="token triple-quoted-string string">"""ï¼ˆ1) è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š    HEAD    GET    POST"""</span><span class="token triple-quoted-string string">"""ï¼ˆ2ï¼‰HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š    Accept    Accept-Language    Content-Language    Last-Event-ID    Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼application/x-www-form-urlencodedã€multipart/form-dataã€text/plain"""</span></code></pre><p><strong>ä¸¤ç§è¯·æ±‚çš„åŒºåˆ«</strong></p><ul><li>ç®€å•è¯·æ±‚ï¼šä¸€æ¬¡è¯·æ±‚</li><li>éç®€å•è¯·æ±‚ï¼šä¸¤æ¬¡è¯·æ±‚ï¼Œä¼šåœ¨æ•°æ®è¯·æ±‚å‘é€ä¹‹å‰ï¼Œå…ˆå‘é€ä¸€æ¬¡â€˜é¢„æ£€â€™è¯·æ±‚ï¼Œå¦‚æœé€šè¿‡äº†åˆ™å¯ä»¥å‘é€çœŸæ­£çš„è¯·æ±‚</li></ul><p><strong>é¢„æ£€</strong></p><pre class=" language-python"><code class="language-python"> <span class="token operator">=</span><span class="token operator">></span> å¦‚æœå¤æ‚è¯·æ±‚æ˜¯PUTç­‰è¯·æ±‚ï¼Œåˆ™æœåŠ¡ç«¯éœ€è¦è®¾ç½®å…è®¸æŸè¯·æ±‚ï¼Œå¦åˆ™â€œé¢„æ£€â€ä¸é€šè¿‡        Access<span class="token operator">-</span>Control<span class="token operator">-</span>Request<span class="token operator">-</span>Method <span class="token operator">=</span><span class="token operator">></span> å¦‚æœå¤æ‚è¯·æ±‚è®¾ç½®äº†è¯·æ±‚å¤´ï¼Œåˆ™æœåŠ¡ç«¯éœ€è¦è®¾ç½®å…è®¸æŸè¯·æ±‚å¤´ï¼Œå¦åˆ™â€œé¢„æ£€â€ä¸é€šè¿‡        Access<span class="token operator">-</span>Control<span class="token operator">-</span>Request<span class="token operator">-</span>Headers</code></pre><p><strong>æ”¯æŒè·¨åŸŸï¼Œç®€å•è¯·æ±‚</strong></p><p>æœåŠ¡å™¨è®¾ç½®å“åº”å¤´ï¼šAccess-Control-Allow-Origin = â€˜åŸŸåâ€™ æˆ– â€˜*â€™</p><p><strong>æ”¯æŒè·¨åŸŸï¼Œå¤æ‚è¯·æ±‚</strong></p><p>ç”±äºå¤æ‚è¯·æ±‚æ—¶ï¼Œé¦–å…ˆä¼šå‘é€â€œé¢„æ£€â€è¯·æ±‚ï¼Œå¦‚æœâ€œé¢„æ£€â€æˆåŠŸï¼Œåˆ™å‘é€çœŸå®æ•°æ®ã€‚</p><ul><li>â€œé¢„æ£€â€è¯·æ±‚æ—¶ï¼Œå…è®¸è¯·æ±‚æ–¹å¼åˆ™éœ€æœåŠ¡å™¨è®¾ç½®å“åº”å¤´ï¼šAccess-Control-Request-Method</li><li>â€œé¢„æ£€â€è¯·æ±‚æ—¶ï¼Œå…è®¸è¯·æ±‚å¤´åˆ™éœ€æœåŠ¡å™¨è®¾ç½®å“åº”å¤´ï¼šAccess-Control-Request-Headers</li></ul><h2 id="å››ã€djangoä¸­è§£å†³è·¨åŸŸçš„ä¸¤ç§æ–¹å¼"><a href="#å››ã€djangoä¸­è§£å†³è·¨åŸŸçš„ä¸¤ç§æ–¹å¼" class="headerlink" title="å››ã€djangoä¸­è§£å†³è·¨åŸŸçš„ä¸¤ç§æ–¹å¼"></a>å››ã€djangoä¸­è§£å†³è·¨åŸŸçš„ä¸¤ç§æ–¹å¼</h2><h3 id="1-è‡ªå®šä¹‰ä¸­é—´ä»¶"><a href="#1-è‡ªå®šä¹‰ä¸­é—´ä»¶" class="headerlink" title="1 è‡ªå®šä¹‰ä¸­é—´ä»¶"></a>1 è‡ªå®šä¹‰ä¸­é—´ä»¶</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># å®šåˆ¶ä¸­é—´ä»¶</span><span class="token keyword">from</span> django<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>deprecation <span class="token keyword">import</span> MiddlewareMixin<span class="token keyword">class</span> <span class="token class-name">CorsMiddleWare</span><span class="token punctuation">(</span>MiddlewareMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">process_response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method<span class="token operator">==</span><span class="token string">"OPTIONS"</span><span class="token punctuation">:</span>            <span class="token comment" spellcheck="true">#å¯ä»¥åŠ *</span>            response<span class="token punctuation">[</span><span class="token string">"Access-Control-Allow-Headers"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"Content-Type"</span>        response<span class="token punctuation">[</span><span class="token string">"Access-Control-Allow-Origin"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"http://localhost:8080"</span>        <span class="token keyword">return</span> response</code></pre><h3 id="2-ä½¿ç”¨django-cors-headers-è§£å†³è·¨åŸŸé—®é¢˜"><a href="#2-ä½¿ç”¨django-cors-headers-è§£å†³è·¨åŸŸé—®é¢˜" class="headerlink" title="2 ä½¿ç”¨django-cors-headers è§£å†³è·¨åŸŸé—®é¢˜"></a>2 ä½¿ç”¨django-cors-headers è§£å†³è·¨åŸŸé—®é¢˜</h3><ul><li><p>å®‰è£…ï¼špip install django-cors-headers</p></li><li><p>æ³¨å†Œappï¼šâ€™corsheadersâ€™</p></li><li><p>æ·»åŠ ä¸­é—´ä»¶ï¼šâ€™corsheaders.middleware.CorsMiddlewareâ€™,</p></li><li><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># åŸºæœ¬é…ç½®</span>CORS_ALLOW_CREDENTIALS <span class="token operator">=</span> <span class="token boolean">True</span>CORS_ORIGIN_ALLOW_ALL <span class="token operator">=</span> <span class="token boolean">True</span>CORS_ORIGIN_WHITELIST <span class="token operator">=</span> <span class="token punctuation">(</span>    <span class="token string">'*'</span><span class="token punctuation">)</span>CORS_ALLOW_METHODS <span class="token operator">=</span> <span class="token punctuation">(</span>    <span class="token string">'DELETE'</span><span class="token punctuation">,</span>    <span class="token string">'GET'</span><span class="token punctuation">,</span>    <span class="token string">'OPTIONS'</span><span class="token punctuation">,</span>    <span class="token string">'PATCH'</span><span class="token punctuation">,</span>    <span class="token string">'POST'</span><span class="token punctuation">,</span>    <span class="token string">'PUT'</span><span class="token punctuation">,</span>    <span class="token string">'VIEW'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>CORS_ALLOW_HEADERS <span class="token operator">=</span> <span class="token punctuation">(</span>    <span class="token string">'XMLHttpRequest'</span><span class="token punctuation">,</span>    <span class="token string">'X_FILENAME'</span><span class="token punctuation">,</span>    <span class="token string">'accept-encoding'</span><span class="token punctuation">,</span>    <span class="token string">'authorization'</span><span class="token punctuation">,</span>    <span class="token string">'content-type'</span><span class="token punctuation">,</span>    <span class="token string">'dnt'</span><span class="token punctuation">,</span>    <span class="token string">'origin'</span><span class="token punctuation">,</span>    <span class="token string">'user-agent'</span><span class="token punctuation">,</span>    <span class="token string">'x-csrftoken'</span><span class="token punctuation">,</span>    <span class="token string">'x-requested-with'</span><span class="token punctuation">,</span>    <span class="token string">'Pragma'</span><span class="token punctuation">,</span><span class="token punctuation">)</span></code></pre></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€åŒæºç­–ç•¥&quot;&gt;&lt;a href=&quot;#ä¸€ã€åŒæºç­–ç•¥&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€åŒæºç­–ç•¥&quot;&gt;&lt;/a&gt;ä¸€ã€åŒæºç­–ç•¥&lt;/h2&gt;&lt;p&gt;åŒæºç­–ç•¥ï¼šè¯·æ±‚çš„urlåœ°å€,å¿…é¡»ä¸æµè§ˆå™¨ä¸Šçš„urlåœ°å€å¤„äºåŒåŸŸä¸Š,ä¹Ÿå°±æ˜¯åŸŸå,ç«¯å£,åè®®ç›¸åŒ&lt;/p&gt;
&lt;p&gt;</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="django" scheme="http://huang_zhao.gitee.io/task/tags/django/"/>
    
    <category term="è·¨åŸŸé—®é¢˜" scheme="http://huang_zhao.gitee.io/task/tags/%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>sqlæœç´¢å˜æ…¢çš„åŸå› </title>
    <link href="http://huang_zhao.gitee.io/task/2020/03/15/sql%E6%90%9C%E7%B4%A2%E5%8F%98%E6%85%A2%E7%9A%84%E5%8E%9F%E5%9B%A0/"/>
    <id>http://huang_zhao.gitee.io/task/2020/03/15/sql%E6%90%9C%E7%B4%A2%E5%8F%98%E6%85%A2%E7%9A%84%E5%8E%9F%E5%9B%A0/</id>
    <published>2020-03-15T05:33:43.000Z</published>
    <updated>2020-08-26T01:13:13.169Z</updated>
    
    <content type="html"><![CDATA[<pre class=" language-mysql"><code class="language-mysql">mysql>Â CREATEÂ TABLEÂ `t_tweet`Â (Â Â `id`Â int(11)Â NOTÂ NULL,Â Â `tweet_id`Â varchar(32)Â DEFAULTÂ NULL,Â Â `user_id`Â int(11)Â DEFAULTÂ NULL,Â Â `gmt_create`Â datetimeÂ DEFAULTÂ NULL,Â Â PRIMARYÂ KEYÂ (`id`),Â Â KEYÂ `tweet_id`Â (`tweet_id`),Â Â KEYÂ `gmt_create`Â (`gmt_create`))Â ENGINE=InnoDBÂ DEFAULTÂ CHARSET=utf8mb4;</code></pre><h5 id="1-ç”¨å‡½æ•°å¤„ç†ç´¢å¼•"><a href="#1-ç”¨å‡½æ•°å¤„ç†ç´¢å¼•" class="headerlink" title="1 ç”¨å‡½æ•°å¤„ç†ç´¢å¼•"></a>1 ç”¨å‡½æ•°å¤„ç†ç´¢å¼•</h5><p>Qï¼šä¸ºä»€ä¹ˆæ¡ä»¶æ˜¯<code>where gmt_create=&#39;2018-7-1â€™</code>çš„æ—¶å€™å¯ä»¥ç”¨ä¸Šç´¢å¼•ï¼Œè€Œæ”¹æˆ<code>where month(gmt_create)=7</code>çš„æ—¶å€™å°±ä¸è¡Œäº†ï¼Ÿ</p><p>Aï¼šsqlæœç´¢æ˜¯æ ¹æ®B+æ ‘å¿«é€Ÿå®šä½çš„ï¼Œè¿™ç§èƒ½åŠ›æ¥æºäºåŒä¸€å±‚å…„å¼ŸèŠ‚ç‚¹çš„æœ‰åºæ€§ã€‚</p><p>ç®€å•æ¥è¯´å¦‚æœæ˜¯<code>where gmt_create=&#39;2018-7-1â€™</code>é‚£ä¹ˆæ ¹æ®èŠ‚ç‚¹çš„æœ‰åºæ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€ŸçŸ¥é“æ‰€è¦æ‰¾çš„å¶å­èŠ‚ç‚¹çš„è·¯å¾„</p><p>å¦‚æœæ˜¯<code>where month(gmt_create)=7</code>ï¼Œæ ‘åœ¨ç¬¬ä¸€å±‚å°±ä¸çŸ¥é“å¦‚ä½•åˆ¤æ–­å­èŠ‚ç‚¹çš„èµ°å‘ï¼Œå°±ä¼šæ”¾å¼ƒæ ‘æœç´¢åŠŸèƒ½ï¼Œèµ°å…¨æ–‡éå†ã€‚</p><p>æ€»ç»“ï¼šå¯¹ç´¢å¼•å­—æ®µè¿›è¡Œå‡½æ•°æ“ä½œï¼Œä¼šç ´åç´¢å¼•çš„å€¼çš„æœ‰åºæ€§</p><p>ä½†å¹¶ä¸æ˜¯ç›´æ¥éå†ä¸»é”®äº†ï¼Œä¼˜åŒ–å™¨ä¼šå¯¹æ¯”ä¸¤è€…ä¹‹é—´çš„ç´¢å¼•å¤§å°ï¼Œæœ€åè¿˜æ˜¯ä¼šå†³å®šç´¢å¼•gmt_create</p><p><strong>ä¼˜åŒ–å™¨åœ¨æŸäº›é—®é¢˜ä¸Šç¡®å®æœ‰â€œå·æ‡’â€è¡Œä¸ºï¼Œå³ä½¿æ˜¯å¯¹äºä¸æ”¹å˜æœ‰åºæ€§çš„å‡½æ•°ï¼Œä¹Ÿä¸ä¼šè€ƒè™‘ä½¿ç”¨ç´¢ å¼•ã€‚</strong></p><p>æ¯”å¦‚ï¼Œå¯¹äº<code>select * from t_tweet where id + 1 = 10000</code>è¿™ä¸ªSQLè¯­å¥ï¼Œè¿™ä¸ªåŠ 1æ“ä½œå¹¶ä¸ä¼šæ”¹å˜æœ‰åºæ€§ï¼Œä½†æ˜¯MySQLä¼˜åŒ–å™¨è¿˜æ˜¯ä¸èƒ½ç”¨idç´¢å¼•å¿«é€Ÿå®šä½åˆ°9999è¿™ä¸€è¡Œã€‚æ‰€ä»¥ï¼Œéœ€è¦ä½ åœ¨å†™ SQLè¯­å¥çš„æ—¶å€™ï¼Œæ‰‹åŠ¨æ”¹å†™æˆ <code>where id = 10000 -1</code>æ‰å¯ä»¥ã€‚</p><h5 id="2-ç´¢å¼•çš„æ•°æ®ç±»å‹éœ€è¦ç±»å‹è½¬åŒ–"><a href="#2-ç´¢å¼•çš„æ•°æ®ç±»å‹éœ€è¦ç±»å‹è½¬åŒ–" class="headerlink" title="2 ç´¢å¼•çš„æ•°æ®ç±»å‹éœ€è¦ç±»å‹è½¬åŒ–"></a>2 ç´¢å¼•çš„æ•°æ®ç±»å‹éœ€è¦ç±»å‹è½¬åŒ–</h5><pre class=" language-python"><code class="language-python">select <span class="token operator">*</span> <span class="token keyword">from</span> t_tweet where tweet_id<span class="token operator">=</span><span class="token number">110717</span><span class="token punctuation">;</span></code></pre><p>é€šè¿‡ä¸Šè¿°ç´¢å¼•æˆ‘ä»¬ä¼šå‘ç°è¿˜æ˜¯è¿›è¡Œäº†å…¨è¡¨æ‰«æï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¼ å…¥çš„å€¼æ˜¯ 110717æ˜¯æ•´å½¢ï¼Œä½†æ˜¯è¡¨ä¸­å­—æ®µéœ€è¦çš„æ•°æ®ç±»å‹æ˜¯varchar</p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><p>Q1ï¼šæ•°æ®ç±»å‹è½¬åŒ–çš„è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>Q2ï¼šä¸ºä»€ä¹ˆæœ‰æ•°æ®ç±»å‹è½¬æ¢ï¼Œå°±ä¼šèµ°å…¨è¡¨ç´¢å¼•ï¼Ÿ</p><p>é—®é¢˜1çš„ç­”æ¡ˆæ˜¯å½“æ•°å­—ç±»å‹å’Œå­—ç¬¦ç±»å‹æ¯”è¾ƒæ—¶ä¼šæŠŠå­—ç¬¦ç±»å‹è½¬åŒ–æˆæ•´å½¢åš<strong>æ•´å½¢æ¯”è¾ƒ</strong></p><p>å¯ä»¥é€šè¿‡<code>select &#39;10&#39;&gt;9</code>å¦‚æœè¿”å›1ï¼Œåˆ™æ˜¯è½¬åŒ–æˆæ•´å½¢ï¼Œå¦‚æœè¿”å›0åˆ™æ˜¯è½¬åŒ–æˆå­—ç¬¦ä¸²</p><p>æ‰€ä»¥é—®é¢˜2çš„ç­”æ¡ˆä¹Ÿæ²¹ç„¶è€Œç”Ÿï¼Œè¿™ä¸ªè¯­å¥å†™å…¨äº†</p><pre class=" language-mysql"><code class="language-mysql">selectÂ *Â fromÂ t_tweetÂ whereÂ CAST(tweet_idÂ ASÂ tweetIdÂ int)Â =Â 110717;</code></pre><p>æœ¬è´¨ä¸Šè¿˜æ˜¯å¯¹å­—æ®µåšäº†å‡½æ•°æ“ä½œï¼Œå¯¼è‡´ä¼˜åŒ–å™¨æ”¾å¼ƒèµ°æ ‘æœç´¢åŠŸèƒ½</p><p>è½¬è‡ªï¼š<a href="https://juejin.im/post/6860513755000733709#heading-1">https://juejin.im/post/6860513755000733709#heading-1</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;pre class=&quot; language-mysql&quot;&gt;&lt;code class=&quot;language-mysql&quot;&gt;mysql&gt;Â CREATEÂ TABLEÂ `t_tweet`Â (Â Â `id`Â int(11)Â NOTÂ NULL,Â Â `tweet_id`Â varchar(32)Â DE</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="æ•°æ®åº“" scheme="http://huang_zhao.gitee.io/task/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="mysql" scheme="http://huang_zhao.gitee.io/task/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>seleniumåŸºæœ¬ä½¿ç”¨</title>
    <link href="http://huang_zhao.gitee.io/task/2020/03/15/selenium%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
    <id>http://huang_zhao.gitee.io/task/2020/03/15/selenium%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</id>
    <published>2020-03-15T05:33:43.000Z</published>
    <updated>2020-08-26T01:14:56.019Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€å®‰è£…"><a href="#ä¸€ã€å®‰è£…" class="headerlink" title="ä¸€ã€å®‰è£…"></a>ä¸€ã€å®‰è£…</h2><ul><li>æ¨¡å—å®‰è£…ï¼š<code>pip install selenium</code></li><li>é©±åŠ¨å®‰è£…ï¼Œå®‰è£…å’Œæµè§ˆå™¨é€‚é…çš„é©±åŠ¨exeï¼Œæ”¾åˆ°è§£é‡Šå™¨çš„scriptæ–‡ä»¶å¤¹ä¸­ï¼ˆ<a href="http://npm.taobao.org/mirrors/chromedriver/%EF%BC%89">http://npm.taobao.org/mirrors/chromedriver/ï¼‰</a></li></ul><h2 id="äºŒã€åŸºæœ¬ä½¿ç”¨"><a href="#äºŒã€åŸºæœ¬ä½¿ç”¨" class="headerlink" title="äºŒã€åŸºæœ¬ä½¿ç”¨"></a>äºŒã€åŸºæœ¬ä½¿ç”¨</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># æ¡ˆä¾‹ï¼šæ‰“å¼€ç™¾åº¦è¾“å…¥æœç´¢æµ·è´¼ç‹</span><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>keys <span class="token keyword">import</span> Keys<span class="token keyword">import</span> time<span class="token comment" spellcheck="true"># å¾—åˆ°ä¸€ä¸ªè°·æ­Œæµè§ˆå™¨é©±åŠ¨å¯¹è±¡</span>browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>browser<span class="token punctuation">.</span>implicitly_wait<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># éšå¼ç­‰å¾…ï¼šé¡µé¢ä¸­æŸ¥æ‰¾æ ‡ç­¾æ—¶ç­‰å¾…ï¼Œå¦‚æœè¶…å‡ºæ—¶é—´è¿˜æ²¡æ‰¾åˆ°å°±æŠ¥é”™</span>browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"https://www.baidu.com/"</span><span class="token punctuation">)</span>input_tag <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'kw'</span><span class="token punctuation">)</span>input_tag<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'æµ·è´¼ç‹'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># input_tag.send_keys(Keys.ENTER)</span>commit_tag <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element_by_id<span class="token punctuation">(</span><span class="token string">'su'</span><span class="token punctuation">)</span>commit_tag<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><strong>æ‰€æœ‰æ–¹æ³•</strong></p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># ##############é€‰æ‹©å™¨ï¼ˆfindç³»åˆ—ï¼‰</span><span class="token comment" spellcheck="true"># ===============æ‰€æœ‰æ–¹æ³•===================</span><span class="token comment" spellcheck="true"># 1ã€find_element_by_id   # é€šè¿‡idæŸ¥æ‰¾æ§ä»¶</span><span class="token comment" spellcheck="true"># 2ã€find_element_by_link_text  # é€šè¿‡aæ ‡ç­¾å†…å®¹æ‰¾</span><span class="token comment" spellcheck="true"># 3ã€find_element_by_partial_link_text  # é€šè¿‡aæ ‡ç­¾å†…å®¹æ‰¾ï¼Œæ¨¡ç³ŠåŒ¹é…</span><span class="token comment" spellcheck="true"># 4ã€find_element_by_tag_name   # æ ‡ç­¾å</span><span class="token comment" spellcheck="true"># 5ã€find_element_by_class_name  # ç±»å</span><span class="token comment" spellcheck="true"># 6ã€find_element_by_name      # nameå±æ€§</span><span class="token comment" spellcheck="true"># 7ã€find_element_by_css_selector  # é€šè¿‡cssé€‰æ‹©å™¨</span><span class="token comment" spellcheck="true"># 8ã€find_element_by_xpath       # é€šè¿‡xpahté€‰æ‹©å™¨</span>cssé€‰æ‹©ä¸­<span class="token operator">-</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'.link-title::text'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># å–æ–‡æœ¬</span><span class="token operator">-</span>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'.link-title::attr(href)'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># å–æ ‡ç­¾</span><span class="token comment" spellcheck="true"># ä»¥ä¸Šå…¨éƒ½å¯ä»¥æ”¹æˆfind_elements_xxxè·å–å¤šä¸ª</span></code></pre><p><strong>è·å–å±æ€§</strong></p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># é‡ç‚¹</span><span class="token comment" spellcheck="true"># tag.get_attribute('href')  # æ‰¾å½“å‰æ§ä»¶ çš„hrefå±æ€§å¯¹çš„å€¼</span><span class="token comment" spellcheck="true"># tag.text   # è·å–æ–‡æœ¬å†…å®¹</span><span class="token comment" spellcheck="true"># äº†è§£</span><span class="token comment" spellcheck="true"># print(tag.id)   # å½“å‰æ§ä»¶idå·</span><span class="token comment" spellcheck="true"># print(tag.location)  # å½“å‰æ§ä»¶åœ¨é¡µé¢ä½ç½®</span><span class="token comment" spellcheck="true"># print(tag.tag_name)  # æ ‡ç­¾å</span><span class="token comment" spellcheck="true"># print(tag.size)      #æ ‡ç­¾çš„å¤§å°</span></code></pre><p><strong>å…¶ä»–</strong></p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">####æ— ç•Œé¢æµè§ˆå™¨ï¼ˆphantomjsï¼‰</span><span class="token comment" spellcheck="true">#è°·æ­Œæµè§ˆå™¨æ”¯æŒä¸æ‰“å¼€é¡µé¢</span><span class="token comment" spellcheck="true"># from selenium.webdriver.chrome.options import Options</span><span class="token comment" spellcheck="true"># from selenium import webdriver</span><span class="token comment" spellcheck="true"># chrome_options = Options()</span><span class="token comment" spellcheck="true"># chrome_options.add_argument('window-size=1920x3000') #æŒ‡å®šæµè§ˆå™¨åˆ†è¾¨ç‡</span><span class="token comment" spellcheck="true"># chrome_options.add_argument('--disable-gpu') #è°·æ­Œæ–‡æ¡£æåˆ°éœ€è¦åŠ ä¸Šè¿™ä¸ªå±æ€§æ¥è§„é¿bug</span><span class="token comment" spellcheck="true"># chrome_options.add_argument('--hide-scrollbars') #éšè—æ»šåŠ¨æ¡, åº”å¯¹ä¸€äº›ç‰¹æ®Šé¡µé¢</span><span class="token comment" spellcheck="true"># chrome_options.add_argument('blink-settings=imagesEnabled=false') #ä¸åŠ è½½å›¾ç‰‡, æå‡é€Ÿåº¦</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true"># chrome_options.add_argument('--headless') #æµè§ˆå™¨ä¸æä¾›å¯è§†åŒ–é¡µé¢. linuxä¸‹å¦‚æœç³»ç»Ÿä¸æ”¯æŒå¯è§†åŒ–ä¸åŠ è¿™æ¡ä¼šå¯åŠ¨å¤±è´¥</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true"># bro=webdriver.Chrome(chrome_options=chrome_options,executable_path='./chromedriver.exe')</span><span class="token comment" spellcheck="true"># bro.get('https://www.baidu.com/')</span><span class="token comment" spellcheck="true"># print(bro.page_source)</span><span class="token comment" spellcheck="true"># bro.close()</span><span class="token comment" spellcheck="true">######å…ƒç´ äº¤äº’</span><span class="token comment" spellcheck="true"># tag.send_keys()  # å¾€é‡Œé¢å†™å†…å®¹</span><span class="token comment" spellcheck="true"># tag.click()      # ç‚¹å‡»æ§ä»¶</span><span class="token comment" spellcheck="true"># tag.clear()      # æ¸…ç©ºæ§ä»¶å†…å®¹</span><span class="token comment" spellcheck="true">#####æ‰§è¡Œjs(æœ‰ä»€ä¹ˆç”¨?)</span><span class="token comment" spellcheck="true"># from selenium import webdriver</span><span class="token comment" spellcheck="true"># import time</span><span class="token comment" spellcheck="true"># bro=webdriver.Chrome(executable_path='./chromedriver.exe')</span><span class="token comment" spellcheck="true"># bro.implicitly_wait(5)  # éšå£«ç­‰å¾…ï¼šæ‰¾ä¸€ä¸ªæ§ä»¶ï¼Œå¦‚æœæ§ä»¶æ²¡æœ‰åŠ è½½å‡ºæ¥ï¼Œç­‰å¾…5sä¸­  ç­‰å¾…æ‰€æœ‰ï¼Œåªéœ€è¦å†™ç€ä¸€å¥ï¼Œä»¥åæ‰¾æ‰€æœ‰æ§ä»¶éƒ½æŒ‰è¿™ä¸ªæ“ä½œæ¥</span><span class="token comment" spellcheck="true"># bro.get('https://www.baidu.com/')</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true"># bro.execute_script('window.open()')</span><span class="token comment" spellcheck="true"># bro.execute_script('window.open()')</span><span class="token comment" spellcheck="true"># time.sleep(2)</span><span class="token comment" spellcheck="true"># bro.close()</span><span class="token comment" spellcheck="true">####æ¨¡æ‹Ÿæµè§ˆå™¨å‰è¿›åé€€</span><span class="token comment" spellcheck="true"># from selenium import webdriver</span><span class="token comment" spellcheck="true"># import time</span><span class="token comment" spellcheck="true"># browser=webdriver.Chrome(executable_path='./chromedriver.exe')</span><span class="token comment" spellcheck="true"># browser.get('https://www.baidu.com')</span><span class="token comment" spellcheck="true"># browser.get('https://www.taobao.com')</span><span class="token comment" spellcheck="true"># browser.get('http://www.sina.com.cn/')</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true"># browser.back()</span><span class="token comment" spellcheck="true"># time.sleep(1)</span><span class="token comment" spellcheck="true"># browser.forward()</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true"># browser.close()</span><span class="token comment" spellcheck="true">#####è·å–cookie</span><span class="token comment" spellcheck="true"># bro.get_cookies()</span><span class="token comment" spellcheck="true">#### é€‰é¡¹å¡ç®¡ç†(äº†è§£)</span><span class="token comment" spellcheck="true"># from selenium import webdriver</span><span class="token comment" spellcheck="true"># import time</span><span class="token comment" spellcheck="true"># browser=webdriver.Chrome()</span><span class="token comment" spellcheck="true"># browser.get('https://www.baidu.com')</span><span class="token comment" spellcheck="true"># browser.execute_script('window.open()')</span><span class="token comment" spellcheck="true">#</span><span class="token comment" spellcheck="true"># print(browser.window_handles) #è·å–æ‰€æœ‰çš„é€‰é¡¹å¡</span><span class="token comment" spellcheck="true"># browser.switch_to_window(browser.window_handles[1])</span><span class="token comment" spellcheck="true"># browser.get('https://www.taobao.com')</span><span class="token comment" spellcheck="true"># time.sleep(2)</span><span class="token comment" spellcheck="true"># browser.switch_to_window(browser.window_handles[0])</span><span class="token comment" spellcheck="true"># browser.get('https://www.sina.com.cn')</span><span class="token comment" spellcheck="true"># browser.close()</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€å®‰è£…&quot;&gt;&lt;a href=&quot;#ä¸€ã€å®‰è£…&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€å®‰è£…&quot;&gt;&lt;/a&gt;ä¸€ã€å®‰è£…&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;æ¨¡å—å®‰è£…ï¼š&lt;code&gt;pip install selenium&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é©±åŠ¨å®‰è£…ï¼Œå®‰è£…å’Œ</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="python" scheme="http://huang_zhao.gitee.io/task/tags/python/"/>
    
    <category term="çˆ¬è™«" scheme="http://huang_zhao.gitee.io/task/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>drfå†…ç½®æ’åºæºç </title>
    <link href="http://huang_zhao.gitee.io/task/2020/02/15/drf%E5%86%85%E7%BD%AE%E6%8E%92%E5%BA%8F%E6%BA%90%E7%A0%81/"/>
    <id>http://huang_zhao.gitee.io/task/2020/02/15/drf%E5%86%85%E7%BD%AE%E6%8E%92%E5%BA%8F%E6%BA%90%E7%A0%81/</id>
    <published>2020-02-15T12:10:57.000Z</published>
    <updated>2020-08-26T00:58:50.274Z</updated>
    
    <content type="html"><![CDATA[<p>å¦‚æœæˆ‘ä»¬è¦ç”¨æ’åºï¼Œé‚£ä¹ˆå†™çš„è§†å›¾ç±»å°±å¿…é¡»ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿ListModelMixinï¼Œå› ä¸ºå…¶å†…éƒ¨æœ‰å¸®æˆ‘ä»¬æ’åºçš„æ”¾æ–¹æ³•</p><p>ListModelMixin</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># è°ƒç”¨äº†è§†å›¾ç±»å¯¹è±¡çš„filter_querysetæ–¹æ³•</span>queryset <span class="token operator">=</span> self<span class="token punctuation">.</span>filter_queryset<span class="token punctuation">(</span>self<span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>ä½†æ˜¯æˆ‘ä»¬è§†å›¾ç±»æœ¬èº«æ²¡æœ‰ï¼Œæ ¹æ®ormæŸ¥æ‰¾é¡ºåºï¼Œæˆ‘ä»¬å°±è¦çœ‹ç¬¬ä¸€ä½çˆ¶ç±»</p><p>æœ€åæ‰¾åˆ°GenericAPIViewçš„filter_querysetæ–¹æ³•</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">filter_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> queryset<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># filter_backendså°±æ˜¯æˆ‘ä»¬åœ¨è§†å›¾ç±»ä¸­å†™çš„drfå†…ç½®çš„æ’åºç±»</span>    <span class="token keyword">for</span> backend <span class="token keyword">in</span> list<span class="token punctuation">(</span>self<span class="token punctuation">.</span>filter_backends<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># å®ä¾‹åŒ–æ’åºç±»å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„filter_querysetæ–¹æ³•</span>        queryset <span class="token operator">=</span> backend<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>filter_queryset<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">,</span> queryset<span class="token punctuation">,</span> self<span class="token punctuation">)</span>        <span class="token keyword">return</span> queryset<span class="token comment" spellcheck="true"># è§†å›¾ç±»ä¸­æˆ‘ä»¬æ˜¯è¿™æ ·è®¾ç½®çš„</span>    filter_backends <span class="token operator">=</span> <span class="token punctuation">[</span>OrderingFilter<span class="token punctuation">]</span></code></pre><p>OrderingFilterçš„filter_querysetæ–¹æ³•</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">filter_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> queryset<span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># è°ƒç”¨äº†è‡ªå·±çš„get_orderingæ–¹æ³•è¿”å›å€¼åº”åˆ°æ˜¯åŸæœ¬çš„querysetå¯¹è±¡</span>    ordering <span class="token operator">=</span> self<span class="token punctuation">.</span>get_ordering<span class="token punctuation">(</span>request<span class="token punctuation">,</span> queryset<span class="token punctuation">,</span> view<span class="token punctuation">)</span>    <span class="token keyword">if</span> ordering<span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># ä¸‹é¢æ˜¯å¾—åˆ°orderingçš„æ–¹æ³•ï¼Œè¿”å›çš„ç»“æœæ˜¯('id', 'price')ï¼Œç›´æ¥é€šè¿‡è¿™ä¸ªæ’åº</span>        <span class="token keyword">return</span> queryset<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token operator">*</span>ordering<span class="token punctuation">)</span>    <span class="token keyword">return</span> queryset</code></pre><p>OrderingFilterçš„get_orderingæ–¹æ³•</p><pre class=" language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_ordering</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> queryset<span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># ordering_paramæ˜¯åœ¨drfçš„é…ç½®æ–‡ä»¶ä¸­çš„å­—ç¬¦ä¸²ï¼šordering</span>    <span class="token comment" spellcheck="true"># paramså°±æ˜¯ä»urlåorderingè·Ÿçš„æ’åºå­—ç¬¦ä¸²</span>    <span class="token comment" spellcheck="true"># paramsï¼šâ€˜idï¼Œnameï¼Œpriceâ€™</span>    params <span class="token operator">=</span> request<span class="token punctuation">.</span>query_params<span class="token punctuation">.</span>get<span class="token punctuation">(</span>self<span class="token punctuation">.</span>ordering_param<span class="token punctuation">)</span>    <span class="token keyword">if</span> params<span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># é€šè¿‡ä¸€ä¸ªåˆ—è¡¨ç”Ÿæˆå¼å¾—åˆ°['id','name','price']</span>        fields <span class="token operator">=</span> <span class="token punctuation">[</span>param<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> param <span class="token keyword">in</span> params<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token comment" spellcheck="true"># é€šè¿‡å†…éƒ¨remove_invalid_fieldså»ç§»é™¤fieldsä¸­å’Œè§†å›¾ç±»ä¸­è®¾ç½®ä¸åŒ¹é…çš„</span>        <span class="token comment" spellcheck="true"># è§†å›¾ç±»æ˜¯è¿™æ ·è®¾ç½®çš„ordering_fields = ('id', 'price')</span>        <span class="token comment" spellcheck="true"># æ‰€ä»¥è¿™é‡Œnameæ˜¯æ— æ•ˆæ’åºï¼Œå°±ä¼šé€šè¿‡è¿™ä¸ªæ–¹æ³•ç§»é™¤</span>           ordering <span class="token operator">=</span> self<span class="token punctuation">.</span>remove_invalid_fields<span class="token punctuation">(</span>queryset<span class="token punctuation">,</span> fields<span class="token punctuation">,</span> view<span class="token punctuation">,</span> request<span class="token punctuation">)</span>        <span class="token keyword">if</span> ordering<span class="token punctuation">:</span>            <span class="token keyword">return</span> ordering</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å¦‚æœæˆ‘ä»¬è¦ç”¨æ’åºï¼Œé‚£ä¹ˆå†™çš„è§†å›¾ç±»å°±å¿…é¡»ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿ListModelMixinï¼Œå› ä¸ºå…¶å†…éƒ¨æœ‰å¸®æˆ‘ä»¬æ’åºçš„æ”¾æ–¹æ³•&lt;/p&gt;
&lt;p&gt;ListModelMixin&lt;/p&gt;
&lt;pre class=&quot; language-python&quot;&gt;&lt;code class=&quot;language-py</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="drf" scheme="http://huang_zhao.gitee.io/task/tags/drf/"/>
    
    <category term="pythonå‡½æ•°" scheme="http://huang_zhao.gitee.io/task/tags/python%E5%87%BD%E6%95%B0/"/>
    
    <category term="é¢è¯•" scheme="http://huang_zhao.gitee.io/task/tags/%E9%9D%A2%E8%AF%95/"/>
    
    <category term="æºç " scheme="http://huang_zhao.gitee.io/task/tags/%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>drfâ˜jwtè‡ªåŠ¨ç­¾å‘ä¸æ‰‹åŠ¨ç­¾å‘</title>
    <link href="http://huang_zhao.gitee.io/task/2020/02/15/drf%E2%98%9Ejwt%E8%87%AA%E5%8A%A8%E7%AD%BE%E5%8F%91%E4%B8%8E%E6%89%8B%E5%8A%A8%E7%AD%BE%E5%8F%91/"/>
    <id>http://huang_zhao.gitee.io/task/2020/02/15/drf%E2%98%9Ejwt%E8%87%AA%E5%8A%A8%E7%AD%BE%E5%8F%91%E4%B8%8E%E6%89%8B%E5%8A%A8%E7%AD%BE%E5%8F%91/</id>
    <published>2020-02-15T07:33:45.000Z</published>
    <updated>2020-08-26T00:59:07.492Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€è‡ªåŠ¨ç­¾å‘"><a href="#ä¸€ã€è‡ªåŠ¨ç­¾å‘" class="headerlink" title="ä¸€ã€è‡ªåŠ¨ç­¾å‘"></a>ä¸€ã€è‡ªåŠ¨ç­¾å‘</h2><p><strong>urls</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rest_framework_jwt<span class="token punctuation">.</span>views <span class="token keyword">import</span> obtain_jwt_token<span class="token comment" spellcheck="true"># ä½¿ç”¨jwtè‡ªå¸¦çš„ç™»å½•è§†å›¾</span>urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>    path<span class="token punctuation">(</span><span class="token string">'login/'</span><span class="token punctuation">,</span> obtain_jwt_token<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span></code></pre><p><strong>settings</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> datetimeJWT_AUTH<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    <span class="token comment" spellcheck="true"># é…ç½®å“åº”æ ¼å¼ï¼Œå¿…é¡»å’Œè‡ªåŠ¨ç­¾å‘ä½¿ç”¨</span>  <span class="token string">'JWT_RESPONSE_PAYLOAD_HANDLER'</span><span class="token punctuation">:</span><span class="token string">'app01.utils.my_jwt_response_payload_handler'</span><span class="token punctuation">,</span>    <span class="token string">'JWT_EXPIRATION_DELTA'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true"># è¿‡æœŸæ—¶é—´ï¼Œæ‰‹åŠ¨é…ç½®</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span></code></pre><p><strong>utils</strong></p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># é‡å†™jwtå“åº”æ ¼å¼ï¼ˆéœ€è¦åˆ°settingsé…ç½®ï¼‰</span><span class="token comment" spellcheck="true"># ä¸ä¹‹é…åˆä½¿ç”¨çš„å¿…é¡»æ˜¯è‡ªåŠ¨ç­¾å‘</span><span class="token keyword">def</span> <span class="token function">my_jwt_response_payload_handler</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> user<span class="token operator">=</span>None<span class="token punctuation">,</span> request<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># è¿”å›ä»€ä¹ˆï¼Œå‰ç«¯å°±èƒ½çœ‹åˆ°ä»€ä¹ˆæ ·å­</span>    <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>        <span class="token string">'token'</span><span class="token punctuation">:</span> token<span class="token punctuation">,</span>        <span class="token string">'msg'</span><span class="token punctuation">:</span><span class="token string">'ç™»å½•æˆåŠŸ'</span><span class="token punctuation">,</span>        <span class="token string">'status'</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span>        <span class="token string">'username'</span><span class="token punctuation">:</span>user<span class="token punctuation">.</span>username    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span></code></pre><p>ç„¶åç›´æ¥åœ¨å‰ç«¯æäº¤postè¯·æ±‚å‘é€è´¦å·å’Œå¯†ç ï¼Œä¼šè¿”å›æˆ‘ä»¬å®šä¹‰å¥½çš„å“åº”æ ¼å¼</p><pre class=" language-python"><code class="language-python"><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>    <span class="token string">"token"</span><span class="token punctuation">:</span> <span class="token string">"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6Imh6IiwiZXhwIjoxNTk1NDE1MTEyLCJlbWFpbCI6IiJ9.BxBdsm6oBz8iPAwSSpo_7IaU4pBp6RjK4c0GJ_FYN1E"</span><span class="token punctuation">,</span>    <span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"ç™»å½•æˆåŠŸ"</span><span class="token punctuation">,</span>    <span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>    <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"hz"</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span></code></pre><p>ç„¶åæ‹¿å‡ºtokenå¯¹æµ‹è¯•ç±»å‘é€æµ‹è¯•è¯·æ±‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">TestAPI</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>user<span class="token punctuation">)</span>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># å› ä¸ºå†…ç½®çš„ä»–æ²¡æœ‰å¯¹åŒ¿åç”¨æˆ·è®¾ç½®æ‹¦æˆªï¼Œç´ ä»¥åŒ¿åç”¨æˆ·ä¹Ÿèƒ½çœ‹åˆ°ok</span><span class="token comment" spellcheck="true"># æˆ‘ä»¬ç”¨request.useræ¥åŒºåˆ†</span><span class="token comment" spellcheck="true"># è¿™é‡Œå¯èƒ½ä¼šå‡ºç°æˆ‘ç™»å½•äº†å¾ˆå¤šæ¬¡ï¼Œç”¨æ¯æ¬¡ä¸åŒçš„tokenéƒ½èƒ½ç™»å½•</span><span class="token comment" spellcheck="true"># è¿™æ˜¯å› ä¸ºtokenæ ¡éªŒçš„æ˜¯è§„åˆ™ï¼Œæ˜¯è¦åŠ å¯†è§„åˆ™ç¬¦åˆä¸”æ²¡æœ‰è¶…æ—¶ï¼Œé‚£ç”¨å“ªæ¬¡tokenéƒ½ä¸€æ ·çš„</span></code></pre><h2 id="äºŒã€æ‰‹åŠ¨ç­¾å‘"><a href="#äºŒã€æ‰‹åŠ¨ç­¾å‘" class="headerlink" title="äºŒã€æ‰‹åŠ¨ç­¾å‘"></a>äºŒã€æ‰‹åŠ¨ç­¾å‘</h2><p><strong>utils</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rest_framework_jwt<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> BaseJSONWebTokenAuthentication<span class="token punctuation">,</span>jwt_decode_handler<span class="token keyword">import</span> jwt<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> AuthenticationFailed<span class="token keyword">class</span> <span class="token class-name">MyAuthentication</span><span class="token punctuation">(</span>BaseJSONWebTokenAuthentication<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># è¿™é‡Œé‡å†™çš„é€»è¾‘å’ŒBaseJSONWebTokenAuthenticationé‡Œçš„authenticateä¸€æ¨¡ä¸€æ ·</span>    <span class="token keyword">def</span> <span class="token function">authenticate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>        jwt_token <span class="token operator">=</span> request<span class="token punctuation">.</span>META<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'HTTP_AUTHORIZATION'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># è·å–æµè§ˆå™¨ä¼ æ¥çš„token</span>        <span class="token keyword">if</span> jwt_token<span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                payload <span class="token operator">=</span> jwt_decode_handler<span class="token punctuation">(</span>jwt_token<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># ä¼ å…¥tokenï¼Œæ‹¿å‡ºç¬¬äºŒæ®µç”¨æˆ·ä¿¡æ¯,æœ‰å†…ç½®çš„æ ¡éªŒtokenåŠŸèƒ½</span>            <span class="token keyword">except</span> jwt<span class="token punctuation">.</span>ExpiredSignature<span class="token punctuation">:</span>                <span class="token keyword">raise</span> AuthenticationFailed<span class="token punctuation">(</span><span class="token string">'ç­¾åè¿‡æœŸ'</span><span class="token punctuation">)</span>            <span class="token keyword">except</span> jwt<span class="token punctuation">.</span>InvalidTokenError<span class="token punctuation">:</span>                <span class="token keyword">raise</span> AuthenticationFailed<span class="token punctuation">(</span><span class="token string">'ç”¨æˆ·éæ³•'</span><span class="token punctuation">)</span>            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token comment" spellcheck="true"># æ‰€æœ‰å¼‚å¸¸éƒ½ä¼šèµ°åˆ°è¿™</span>                <span class="token keyword">raise</span> AuthenticationFailed<span class="token punctuation">(</span>str<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token comment" spellcheck="true"># é€šè¿‡å†…ç½®çš„æ–¹æ³•æŠŠpayloadè½¬æ¢æˆç”¨æˆ·å¯¹è±¡</span>            user <span class="token operator">=</span> self<span class="token punctuation">.</span>authenticate_credentials<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>            <span class="token keyword">return</span> user<span class="token punctuation">,</span>None <span class="token comment" spellcheck="true"># ===ã€‹request.user,request.auth</span>        <span class="token keyword">raise</span> AuthenticationFailed<span class="token punctuation">(</span><span class="token string">'æ‚¨æ²¡æœ‰æºå¸¦è®¤è¯ä¿¡æ¯'</span><span class="token punctuation">)</span></code></pre><p><strong>sers</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers<span class="token comment" spellcheck="true"># å¤šæ–¹åºåˆ—åŒ–æ ¡éªŒç™»å½•</span><span class="token keyword">import</span> re<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ValidationError<span class="token keyword">from</span> app01 <span class="token keyword">import</span> models<span class="token keyword">from</span> rest_framework_jwt<span class="token punctuation">.</span>utils <span class="token keyword">import</span> jwt_encode_handler<span class="token punctuation">,</span>jwt_payload_handler<span class="token keyword">class</span> <span class="token class-name">LoginSer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># æˆ‘ä»¬è¦æäº¤æ ¡éªŒæ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœç›´æ¥ç”¨ä¸‹é¢Metaç»‘å®šç»™æ¨¡å‹ç±»çš„è¯</span>    <span class="token comment" spellcheck="true"># å…³é”®ç‚¹2ï¼šè¿™é‡Œå¦‚æœä¸å†™usernameçš„è¯ï¼Œåºåˆ—åŒ–å™¨ç›´æ¥ç”¨çš„æ˜¯æ¨¡å‹ç±»çš„username</span>    <span class="token comment" spellcheck="true"># è¿™ä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼Œå¦‚æœè¦†ç›–å†™äº†usernameï¼Œä»–è¡¨ç¤ºçš„å¯ä»¥æ˜¯ä»»ä½•å‰ç«¯ä¼ æ¥çš„æ•°æ®ï¼Œå¦‚æœæ˜¯æ¨¡å‹ç±»ç»‘å®šï¼Œé‚£åªèƒ½æ˜¯ç”¨æˆ·åäº†</span>    <span class="token comment" spellcheck="true"># æˆ‘ä»¬è¿™é‡Œusernameç”¨äºå¤šæ–¹ç™»å½•çš„æ ¡éªŒæ•°æ®ï¼Œå¿…é¡»è¦é‡å†™</span>    <span class="token comment" spellcheck="true"># è€Œpasswordä¸ç”¨é‡å†™ï¼Œå› ä¸ºpasswordç”¨çš„å°±æ˜¯æ¨¡å‹ç±»æœ¬èº«çš„</span>    username <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>        model <span class="token operator">=</span> models<span class="token punctuation">.</span>User        fields <span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">,</span><span class="token string">'password'</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>        password <span class="token operator">=</span> attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> username<span class="token punctuation">:</span>            <span class="token keyword">if</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">'^1[3-9][0-9]&amp;#123;9&amp;#125;$'</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">:</span>                user <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>mobile<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">elif</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">'^.+@.+$'</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># é‚®ç®±</span>                user <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>email<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                user <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> user<span class="token punctuation">:</span>                <span class="token keyword">if</span> user<span class="token punctuation">.</span>check_password<span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token comment" spellcheck="true"># å…³é”®ç‚¹3ï¼šjwt_payload_handleræŠŠç”¨æˆ·æ•°æ®å¯¹è±¡è½¬åŒ–æˆç”¨æˆ·ä¿¡æ¯çš„å­—å…¸</span>                    <span class="token comment" spellcheck="true"># jwt_encode_handleræŠŠç”¨æˆ·ä¿¡æ¯çš„å­—å…¸è½¬åŒ–æˆtoken</span>                    payload <span class="token operator">=</span> jwt_payload_handler<span class="token punctuation">(</span>user<span class="token punctuation">)</span>                    <span class="token comment" spellcheck="true"># print('user:',user,type(user))</span>                    token <span class="token operator">=</span> jwt_encode_handler<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>                    <span class="token comment" spellcheck="true"># print('payload:',payload,type(payload))</span>                    <span class="token comment" spellcheck="true"># print('token:',token)</span>                    <span class="token comment" spellcheck="true"># å…³é”®ç‚¹4ï¼šå¦‚æœæˆ‘ä»¬è¦ç»™åºåˆ—åŒ–å™¨æ·»åŠ æ•°æ®ï¼Œè®©è§†å›¾å‡½æ•°å»ä½¿ç”¨</span>                    <span class="token comment" spellcheck="true"># é€šå¸¸éƒ½æ˜¯ä¼ ç»™å¯¹è±¡çš„contextå±æ€§,å½“ç„¶ç›´æ¥èµ‹å€¼ä¹Ÿå¯ä»¥ï¼Œè¿™åªæ˜¯ä»–ç»™æˆ‘ä»¬æä¾›çš„ä¼ å€¼æ¥å£</span>                    self<span class="token punctuation">.</span>context<span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span> <span class="token operator">=</span> token                    self<span class="token punctuation">.</span>context<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span> <span class="token operator">=</span> user                    self<span class="token punctuation">.</span>user <span class="token operator">=</span> user                    <span class="token keyword">return</span> attrs                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">'å¯†ç é”™è¯¯'</span><span class="token punctuation">)</span>            <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">'ä¸å­˜åœ¨ç”¨æˆ·'</span><span class="token punctuation">)</span>        <span class="token keyword">raise</span> ValidationError<span class="token punctuation">(</span><span class="token string">'è¯·è¾“å…¥ç”¨æˆ·å'</span><span class="token punctuation">)</span></code></pre><p><strong>views</strong></p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">LoginApi</span><span class="token punctuation">(</span>ViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>    authentication_classes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># åœ¨è°ƒç”¨åºåˆ—åŒ–ç±»ç»™contextä¼ æ•°æ®ï¼Œå¯ä»¥ç›´æ¥åœ¨åºåˆ—åŒ–ç±»ä¸­è°ƒç”¨</span>        <span class="token comment" spellcheck="true"># å…³é”®ç‚¹1ï¼šæ³¨æ„åŒºåˆ†åºåˆ—åŒ–ä¼ å€¼ä¸ååºåˆ—åŒ–</span>        <span class="token comment" spellcheck="true"># è¿™é‡Œåªè¦æ‹¿å­—å…¸å–æ ¡éªŒæ•°æ®ï¼Œé‚£å°±ä¼ ç»™data</span>        <span class="token comment" spellcheck="true"># å¦‚æœæ˜¯è¦æŠŠæ•°æ®å¯¹è±¡è½¬åŒ–æˆå­—å…¸å°±ä¼ ç»™instance</span>        user_ser <span class="token operator">=</span> sers<span class="token punctuation">.</span>LoginSer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">,</span> context<span class="token operator">=</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'request': request&amp;#125;)</span>        user_ser<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span>raise_exception<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>        token <span class="token operator">=</span> user_ser<span class="token punctuation">.</span>context<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span>        user <span class="token operator">=</span> user_ser<span class="token punctuation">.</span>context<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>user_ser<span class="token punctuation">.</span>user<span class="token punctuation">)</span>        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;'code': 100, 'msg': 'ç™»å½•æˆåŠŸ', 'token': token, 'username': user.username&amp;#125;)</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€è‡ªåŠ¨ç­¾å‘&quot;&gt;&lt;a href=&quot;#ä¸€ã€è‡ªåŠ¨ç­¾å‘&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€è‡ªåŠ¨ç­¾å‘&quot;&gt;&lt;/a&gt;ä¸€ã€è‡ªåŠ¨ç­¾å‘&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;urls&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot; language-python</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="drf" scheme="http://huang_zhao.gitee.io/task/tags/drf/"/>
    
    <category term="jwt" scheme="http://huang_zhao.gitee.io/task/tags/jwt/"/>
    
  </entry>
  
  <entry>
    <title>é­”æ³•æ–¹æ³•</title>
    <link href="http://huang_zhao.gitee.io/task/2020/01/25/python%20%E9%AD%94%E6%B3%95%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/"/>
    <id>http://huang_zhao.gitee.io/task/2020/01/25/python%20%E9%AD%94%E6%B3%95%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/</id>
    <published>2020-01-25T02:30:17.000Z</published>
    <updated>2020-08-26T00:59:30.078Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€-str"><a href="#ä¸€ã€-str" class="headerlink" title="ä¸€ã€__str__"></a>ä¸€ã€<code>__str__</code></h2><p>æ”¹å˜å¯¹è±¡çš„å­—ç¬¦ä¸²æ˜¾ç¤ºï¼Œå¯ä»¥ç†è§£ä¸ºprintæ‰“å°å¯¹è±¡çš„æ˜¾ç¤º</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age    <span class="token comment" spellcheck="true"># å®šä¹‰å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤º</span>    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>names1 <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'å¼ ä¸‰'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ä¼šè°ƒç”¨s1çš„__str__æ–¹æ³•</span><span class="token operator">>></span><span class="token operator">></span> å¼ ä¸‰</code></pre><h2 id="äºŒã€-repr"><a href="#äºŒã€-repr" class="headerlink" title="äºŒã€__repr__"></a>äºŒã€<code>__repr__</code></h2><p>åœ¨pythonè§£é‡Šå™¨ç¯å¢ƒä¸‹ï¼Œä¼šé»˜è®¤æ˜¾ç¤ºå¯¹è±¡çš„reprè¡¨ç¤ºã€‚</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         self<span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         self<span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">return</span> self<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">>></span><span class="token operator">></span> s1 <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'å¼ ä¸‰'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> s1å¼ ä¸‰</code></pre><p><strong>æ€»ç»“ï¼š</strong></p><p>strå‡½æ•°æˆ–è€…printå‡½æ•°è°ƒç”¨çš„æ˜¯obj.<strong>str</strong>()<br>reprå‡½æ•°æˆ–è€…äº¤äº’å¼è§£é‡Šå™¨è°ƒç”¨çš„æ˜¯obj.<strong>repr</strong>()</p><p>æ³¨æ„ï¼š<br>å¦‚æœ__str__æ²¡æœ‰è¢«å®šä¹‰ï¼Œé‚£ä¹ˆå°±ä¼šä½¿ç”¨__repr__æ¥ä»£æ›¿è¾“å‡ºã€‚<br>__str__å’Œ__repr__æ–¹æ³•çš„è¿”å›å€¼éƒ½å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚</p><h2 id="ä¸‰ã€-format"><a href="#ä¸‰ã€-format" class="headerlink" title="ä¸‰ã€__format__"></a>ä¸‰ã€<code>__format__</code></h2><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age    __format_dict <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#123;</span>        <span class="token string">'n-a'</span><span class="token punctuation">:</span> <span class="token string">'åå­—æ˜¯ï¼š&amp;#123;obj.name&amp;#125;-å¹´é¾„æ˜¯ï¼š&amp;#123;obj.age&amp;#125;'</span><span class="token punctuation">,</span>  # åå­—æ˜¯ï¼šlqz<span class="token operator">-</span>å¹´é¾„æ˜¯ï¼š<span class="token number">18</span>        <span class="token string">'n:a'</span><span class="token punctuation">:</span> <span class="token string">'åå­—æ˜¯ï¼š&amp;#123;obj.name&amp;#125;ï¼šå¹´é¾„æ˜¯ï¼š&amp;#123;obj.age&amp;#125;'</span><span class="token punctuation">,</span>  # åå­—æ˜¯ï¼šlqzï¼šå¹´é¾„æ˜¯ï¼š<span class="token number">18</span>        <span class="token string">'n/a'</span><span class="token punctuation">:</span> <span class="token string">'åå­—æ˜¯ï¼š&amp;#123;obj.name&amp;#125;/å¹´é¾„æ˜¯ï¼š&amp;#123;obj.age&amp;#125;'</span><span class="token punctuation">,</span>  # åå­—æ˜¯ï¼š<span class="token operator">/</span>å¹´é¾„æ˜¯ï¼š<span class="token number">18</span>    <span class="token operator">&amp;</span><span class="token comment" spellcheck="true">#125;</span>    <span class="token keyword">def</span> <span class="token function">__format__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> format_spec<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token operator">not</span> format_spec <span class="token operator">or</span> format_spec <span class="token operator">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>__format_dict<span class="token punctuation">:</span>            format_spec <span class="token operator">=</span> <span class="token string">'n-a'</span>        fmt <span class="token operator">=</span> self<span class="token punctuation">.</span>__format_dict<span class="token punctuation">[</span>format_spec<span class="token punctuation">]</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>fmt<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#&amp;#123;obj.name&amp;#125;:&amp;#123;obj.age&amp;#125;</span>        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span>format<span class="token punctuation">(</span>obj<span class="token operator">=</span>self<span class="token punctuation">)</span>s1 <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'lqz'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span>ret <span class="token operator">=</span> format<span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">'n/a'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># lqz/24</span></code></pre><h2 id="å››ã€-del"><a href="#å››ã€-del" class="headerlink" title="å››ã€__del__"></a>å››ã€<code>__del__</code></h2><p>å½“å¯¹è±¡çš„å†…å­˜è¢«æ–½æ”¾çš„æ—¶å€™æ‰§è¡Œ</p><p>æ³¨ï¼šæ­¤æ–¹æ³•ä¸€èˆ¬æ— é¡»å®šä¹‰ï¼Œå› ä¸ºPythonæ˜¯ä¸€é—¨é«˜çº§è¯­è¨€ï¼Œç¨‹åºå‘˜åœ¨ä½¿ç”¨æ—¶æ— éœ€å…³å¿ƒå†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾ï¼Œå› ä¸ºæ­¤å·¥ä½œéƒ½æ˜¯äº¤ç»™Pythonè§£é‡Šå™¨æ¥æ‰§è¡Œï¼Œæ‰€ä»¥ææ„å‡½æ•°çš„è°ƒç”¨æ˜¯ç”±è§£é‡Šå™¨åœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶è‡ªåŠ¨è§¦å‘æ‰§è¡Œçš„ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__del__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'åˆ é™¤äº†...'</span><span class="token punctuation">)</span>a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># &lt;__main__.A object at 0x10164fb00></span><span class="token keyword">del</span> a  <span class="token comment" spellcheck="true"># åˆ é™¤äº†...</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># NameError: name 'a' is not defined</span></code></pre><h2 id="äº”ã€-dict-å’Œ-slots"><a href="#äº”ã€-dict-å’Œ-slots" class="headerlink" title="äº”ã€__dict__å’Œ__slots__"></a>äº”ã€<code>__dict__å’Œ__slots__</code></h2><p>Pythonä¸­çš„ç±»ï¼Œéƒ½ä¼šä»objecté‡Œç»§æ‰¿ä¸€ä¸ª__dict__å±æ€§ï¼Œè¿™ä¸ªå±æ€§ä¸­å­˜æ”¾ç€ç±»çš„å±æ€§å’Œæ–¹æ³•å¯¹åº”çš„é”®å€¼å¯¹ã€‚ä¸€ä¸ªç±»å®ä¾‹åŒ–ä¹‹åï¼Œè¿™ä¸ªç±»çš„å®ä¾‹ä¹Ÿå…·æœ‰è¿™ä¹ˆä¸€ä¸ª__dict__å±æ€§ã€‚ä½†æ˜¯äºŒè€…å¹¶ä¸ç›¸åŒã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>    some <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>num <span class="token operator">=</span> numa <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># &amp;#123;'num': 10&amp;#125;</span>a<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">10</span><span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># &amp;#123;'num': 10, 'age': 10&amp;#125;</span></code></pre><p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºæ¥ï¼Œå®ä¾‹åªä¿å­˜å®ä¾‹çš„å±æ€§å’Œæ–¹æ³•ï¼Œç±»çš„å±æ€§å’Œæ–¹æ³•å®ƒæ˜¯ä¸ä¿å­˜çš„ã€‚æ­£æ˜¯ç”±äºç±»å’Œå®ä¾‹æœ‰__dict__å±æ€§ï¼Œæ‰€ä»¥ç±»å’Œå®ä¾‹å¯ä»¥åœ¨è¿è¡Œè¿‡ç¨‹åŠ¨æ€æ·»åŠ å±æ€§å’Œæ–¹æ³•ã€‚</p><p>ä½†æ˜¯ç”±äºæ¯å®ä¾‹åŒ–ä¸€ä¸ªç±»éƒ½è¦åˆ†é…ä¸€ä¸ª__dict__å˜é‡ï¼Œå®¹æ˜“æµªè´¹å†…å­˜ã€‚å› æ­¤åœ¨Pythonä¸­æœ‰ä¸€ä¸ªå†…ç½®çš„__slots__å±æ€§ã€‚å½“ä¸€ä¸ªç±»è®¾ç½®äº†__slots__å±æ€§åï¼Œè¿™ä¸ªç±»çš„__dict__å±æ€§å°±ä¸å­˜åœ¨äº†ï¼ˆåŒç†ï¼Œè¯¥ç±»çš„å®ä¾‹ä¹Ÿä¸å­˜åœ¨__dict__å±æ€§ï¼‰ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œè®¾ç½®äº†__slots__å±æ€§çš„ç±»çš„å±æ€§ï¼Œåªèƒ½æ˜¯é¢„å…ˆè®¾å®šå¥½çš„ã€‚</p><p>å½“ä½ å®šä¹‰__slots__åï¼Œ__slots__å°±ä¼šä¸ºå®ä¾‹ä½¿ç”¨ä¸€ç§æ›´åŠ ç´§å‡‘çš„å†…éƒ¨è¡¨ç¤ºã€‚å®ä¾‹é€šè¿‡ä¸€ä¸ªå¾ˆå°çš„å›ºå®šå¤§å°çš„å°å‹æ•°ç»„æ¥æ„å»ºçš„ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªå®ä¾‹éƒ½å®šä¹‰ä¸€ä¸ª__dict__å­—å…¸ï¼Œåœ¨__slots__ä¸­åˆ—å‡ºçš„å±æ€§ååœ¨å†…éƒ¨è¢«æ˜ å°„åˆ°è¿™ä¸ªæ•°ç»„çš„ç‰¹å®šç´¢å¼•ä¸Šã€‚ä½¿ç”¨__slots__å¸¦æ¥çš„å‰¯ä½œç”¨æ˜¯æˆ‘ä»¬æ²¡æœ‰åŠæ³•ç»™å®ä¾‹æ·»åŠ ä»»ä½•æ–°çš„å±æ€§äº†ã€‚</p><p>æ³¨æ„ï¼šå°½ç®¡__slots__çœ‹èµ·æ¥æ˜¯ä¸ªéå¸¸æœ‰ç”¨çš„ç‰¹æ€§ï¼Œä½†æ˜¯é™¤éä½ ååˆ†ç¡®åˆ‡çš„çŸ¥é“è¦ä½¿ç”¨å®ƒï¼Œå¦åˆ™å°½é‡ä¸è¦ä½¿ç”¨å®ƒã€‚æ¯”å¦‚å®šä¹‰äº†__slots__å±æ€§çš„ç±»å°±ä¸æ”¯æŒå¤šç»§æ‰¿ã€‚__slots__é€šå¸¸éƒ½æ˜¯ä½œä¸ºä¸€ç§ä¼˜åŒ–å·¥å…·æ¥ä½¿ç”¨ã€‚â€“æ‘˜è‡ªã€ŠPython Cookbookã€‹8.4</p><p>æ³¨æ„äº‹é¡¹ï¼š<br>__slots__çš„å¾ˆå¤šç‰¹æ€§éƒ½ä¾èµ–äºæ™®é€šçš„åŸºäºå­—å…¸çš„å®ç°ã€‚<br>å¦å¤–ï¼Œå®šä¹‰äº†__slots__åçš„ç±»ä¸å† æ”¯æŒä¸€äº›æ™®é€šç±»ç‰¹æ€§äº†,æ¯”å¦‚å¤šç»§æ‰¿ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹,ä½ åº”è¯¥åªåœ¨é‚£äº›ç»å¸¸è¢«ä½¿ç”¨åˆ°çš„ç”¨ä½œæ•°æ®ç»“æ„çš„ç±»ä¸Šå®šä¹‰__slots__ï¼Œæ¯”å¦‚åœ¨ç¨‹åºä¸­éœ€è¦åˆ›å»ºæŸä¸ªç±»çš„å‡ ç™¾ä¸‡ä¸ªå®ä¾‹å¯¹è±¡ ã€‚<br>å…³äº__slots__çš„ä¸€ä¸ªå¸¸è§è¯¯åŒºæ˜¯å®ƒå¯ä»¥ä½œä¸ºä¸€ä¸ªå°è£…å·¥å…·æ¥é˜²æ­¢ç”¨æˆ·ç»™å®ä¾‹å¢åŠ æ–°çš„å±æ€§ã€‚å°½ç®¡ä½¿ç”¨__slots__å¯ä»¥è¾¾åˆ°è¿™æ ·çš„ç›®çš„,ä½†æ˜¯è¿™ä¸ªå¹¶ä¸æ˜¯å®ƒçš„åˆè¡·ã€‚å®ƒæ›´å¤šçš„æ˜¯ç”¨æ¥ä½œä¸ºä¸€ä¸ªå†…å­˜ä¼˜åŒ–å·¥å…·ã€‚</p><h2 id="å…­ã€-item-ã€-attr-ç³»åˆ—"><a href="#å…­ã€-item-ã€-attr-ç³»åˆ—" class="headerlink" title="å…­ã€__item__ã€__attr__ç³»åˆ—"></a>å…­ã€<code>__item__ã€__attr__ç³»åˆ—</code></h2><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__setitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'obj[key]=lqzèµ‹å€¼æ—¶ï¼Œæ‰§è¡Œæˆ‘'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value    <span class="token keyword">def</span> <span class="token function">__delitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'del obj[key]æ—¶ï¼Œæ‰§è¡Œæˆ‘'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>__dict__<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>key<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__delattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'del obj.keyæ—¶ï¼Œæ‰§è¡Œæˆ‘'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>__dict__<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>item<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__setattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'obj.key = valueçš„æ—¶å€™æ‰§è¡Œæˆ‘'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value    <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'obj.get(key)çš„æ—¶å€™æ‰§è¡Œæˆ‘'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">[</span>item<span class="token punctuation">]</span>f1 <span class="token operator">=</span> Foo<span class="token punctuation">(</span><span class="token string">'sb'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>f1<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>f1<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">18</span>f1<span class="token punctuation">.</span>hobby <span class="token operator">=</span> <span class="token string">'æ³¡å¦'</span><span class="token keyword">del</span> f1<span class="token punctuation">.</span>hobby<span class="token keyword">del</span> f1<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span>f1<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'lqz'</span><span class="token keyword">print</span><span class="token punctuation">(</span>f1<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span></code></pre><h2 id="ä¸ƒã€-init"><a href="#ä¸ƒã€-init" class="headerlink" title="ä¸ƒã€__init__"></a>ä¸ƒã€<code>__init__</code></h2><p>ä½¿ç”¨Pythonå†™é¢å‘å¯¹è±¡çš„ä»£ç çš„æ—¶å€™æˆ‘ä»¬éƒ½ä¼šä¹ æƒ¯æ€§å†™ä¸€ä¸ª <strong>init</strong> æ–¹æ³•ï¼Œ<strong>init</strong> æ–¹æ³•é€šå¸¸ç”¨åœ¨åˆå§‹åŒ–ä¸€ä¸ªç±»å®ä¾‹çš„æ—¶å€™ã€‚ä¾‹å¦‚ï¼š</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'&lt;Person: &amp;#123;&amp;#125;(&amp;#123;&amp;#125;)>'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>age<span class="token punctuation">)</span>p1 <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">'å¼ ä¸‰'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span></code></pre><p>ä¸Šé¢æ˜¯<strong>init__æœ€æ™®é€šçš„ç”¨æ³•äº†ã€‚ä½†æ˜¯__init__å…¶å®ä¸æ˜¯å®ä¾‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ç¬¬ä¸€ä¸ªè¢«è°ƒç”¨çš„æ–¹æ³•ã€‚å½“ä½¿ç”¨ Persion(name, age) æ¥å®ä¾‹åŒ–ä¸€ä¸ªç±»æ—¶ï¼Œæœ€å…ˆè¢«è°ƒç”¨çš„æ–¹æ³•å…¶å®æ˜¯ __new</strong> æ–¹æ³•ã€‚</p><h2 id="å…«ã€-new"><a href="#å…«ã€-new" class="headerlink" title="å…«ã€__new__"></a>å…«ã€<code>__new__</code></h2><p>å…¶å®__init__æ˜¯åœ¨ç±»å®ä¾‹è¢«åˆ›å»ºä¹‹åè°ƒç”¨çš„ï¼Œå®ƒå®Œæˆçš„æ˜¯ç±»å®ä¾‹çš„åˆå§‹åŒ–æ“ä½œï¼Œè€Œ __new__æ–¹æ³•æ­£æ˜¯åˆ›å»ºè¿™ä¸ªç±»å®ä¾‹çš„æ–¹æ³•</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è°ƒç”¨__new__ï¼Œåˆ›å»ºç±»å®ä¾‹'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>Person<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è°ƒç”¨__init__ï¼Œåˆå§‹åŒ–å®ä¾‹'</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">'&lt;Person: &amp;#123;&amp;#125;(&amp;#123;&amp;#125;)>'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>age<span class="token punctuation">)</span>p1 <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">'å¼ ä¸‰'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span></code></pre><p>è¾“å‡ºï¼š</p><pre class=" language-python"><code class="language-python">è°ƒç”¨__new__ï¼Œåˆ›å»ºç±»å®ä¾‹è°ƒç”¨__init__ï¼Œåˆå§‹åŒ–å®ä¾‹<span class="token operator">&lt;</span>Person<span class="token punctuation">:</span> å¼ ä¸‰<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token operator">></span></code></pre><p>__new__æ–¹æ³•åœ¨ç±»å®šä¹‰ä¸­ä¸æ˜¯å¿…é¡»å†™çš„ï¼Œå¦‚æœæ²¡å®šä¹‰çš„è¯é»˜è®¤ä¼šè°ƒç”¨object.__new__å»åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ˆå› ä¸ºåˆ›å»ºç±»çš„æ—¶å€™é»˜è®¤ç»§æ‰¿çš„å°±æ˜¯objectï¼‰ã€‚</p><p>å¦‚æœæˆ‘ä»¬åœ¨ç±»ä¸­å®šä¹‰äº†__new__æ–¹æ³•ï¼Œå°±æ˜¯é‡å†™äº†é»˜è®¤çš„__new__æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å€Ÿæ­¤è‡ªå®šä¹‰åˆ›å»ºå¯¹è±¡çš„è¡Œä¸ºã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>é‡å†™ç±»çš„__new__æ–¹æ³•æ¥å®ç°å•ä¾‹æ¨¡å¼ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Singleton</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true"># é‡å†™__new__æ–¹æ³•ï¼Œå®ç°æ¯ä¸€æ¬¡å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œè¿”å›åŒä¸€ä¸ªinstanceå¯¹è±¡</span>    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token operator">not</span> hasattr<span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token string">'_instance'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            cls<span class="token punctuation">.</span>_instance <span class="token operator">=</span> super<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>Singleton<span class="token punctuation">)</span>        <span class="token keyword">return</span> cls<span class="token punctuation">.</span>_instance    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>age <span class="token operator">=</span> ages1 <span class="token operator">=</span> Singleton<span class="token punctuation">(</span><span class="token string">'å¼ ä¸‰'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span>s2 <span class="token operator">=</span> Singleton<span class="token punctuation">(</span><span class="token string">'æå››'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># è¿™ä¸¤å®ä¾‹éƒ½ä¸€æ ·</span><span class="token keyword">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> s2<span class="token punctuation">.</span>name<span class="token punctuation">)</span></code></pre><h2 id="ä¹ã€-call"><a href="#ä¹ã€-call" class="headerlink" title="ä¹ã€__call__"></a>ä¹ã€<code>__call__</code></h2><p><strong>call</strong> æ–¹æ³•çš„æ‰§è¡Œæ˜¯ç”±å¯¹è±¡ååŠ æ‹¬å·è§¦å‘çš„ï¼Œå³ï¼šå¯¹è±¡()ã€‚æ‹¥æœ‰æ­¤æ–¹æ³•çš„å¯¹è±¡å¯ä»¥åƒå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è°ƒç”¨å¯¹è±¡çš„__call__æ–¹æ³•'</span><span class="token punctuation">)</span>a <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">'å¼ ä¸‰'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># ç±»Personå¯è°ƒç”¨</span>a<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># å¯¹è±¡aå¯ä»¥è°ƒç”¨</span></code></pre><p><strong>æ³¨æ„ï¼š</strong> </p><p>__new__ã€__init__ã€__call__ç­‰æ–¹æ³•éƒ½ä¸æ˜¯å¿…é¡»å†™çš„ã€‚</p><h2 id="åã€-doc"><a href="#åã€-doc" class="headerlink" title="åã€__doc__"></a>åã€<code>__doc__</code></h2><p>å®šä¹‰ç±»çš„æè¿°ä¿¡æ¯ï¼ˆæ³¨é‡Šï¼‰</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""æˆ‘æ˜¯Aç±»çš„æè¿°ä¿¡æ¯"""</span>    <span class="token keyword">pass</span><span class="token keyword">print</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span>__doc__<span class="token punctuation">)</span></code></pre><h2 id="åä¸€ã€-iter-å’Œ-next"><a href="#åä¸€ã€-iter-å’Œ-next" class="headerlink" title="åä¸€ã€__iter__å’Œ__next__"></a>åä¸€ã€<code>__iter__å’Œ__next__</code></h2><p>å¦‚æœä¸€ä¸ªå¯¹è±¡æ‹¥æœ‰äº†__iter__å’Œ__next__æ–¹æ³•ï¼Œé‚£è¿™ä¸ªå¯¹è±¡å°±æ˜¯è¿­ä»£å™¨</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> start<span class="token punctuation">,</span> stop<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token operator">not</span> stop<span class="token punctuation">:</span>            start<span class="token punctuation">,</span> stop <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> start        self<span class="token punctuation">.</span>start <span class="token operator">=</span> start        self<span class="token punctuation">.</span>stop <span class="token operator">=</span> stop    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self    <span class="token keyword">def</span> <span class="token function">__next__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>start <span class="token operator">>=</span> self<span class="token punctuation">.</span>stop<span class="token punctuation">:</span>            <span class="token keyword">raise</span> StopIteration        n <span class="token operator">=</span> self<span class="token punctuation">.</span>start        self<span class="token punctuation">.</span>start <span class="token operator">+=</span> <span class="token number">1</span>        <span class="token keyword">return</span> na <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token keyword">from</span> collections <span class="token keyword">import</span> Iterator<span class="token keyword">print</span><span class="token punctuation">(</span>isinstance<span class="token punctuation">(</span>a<span class="token punctuation">,</span> Iterator<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> A<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> A<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>aaa<span class="token operator">=</span>A<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>next<span class="token punctuation">(</span>aaa<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>next<span class="token punctuation">(</span>aaa<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#æŠ›å¼‚å¸¸</span></code></pre><h2 id="åäºŒã€-enter-å’Œ-exit"><a href="#åäºŒã€-enter-å’Œ-exit" class="headerlink" title="åäºŒã€__enter__å’Œ__exit__"></a>åäºŒã€<code>__enter__å’Œ__exit__</code></h2><p>ä¸€ä¸ªå¯¹è±¡å¦‚æœå®ç°äº†__enter__å’Œ___exit__æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±æ”¯æŒä¸Šä¸‹æ–‡ç®¡ç†åè®®ï¼Œå³withè¯­å¥</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è¿›å…¥withè¯­å¥å—æ—¶æ‰§è¡Œæ­¤æ–¹æ³•ï¼Œæ­¤æ–¹æ³•å¦‚æœæœ‰è¿”å›å€¼ä¼šèµ‹å€¼ç»™aså£°æ˜çš„å˜é‡'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">'oo'</span>    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_val<span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'é€€å‡ºwithä»£ç å—æ—¶æ‰§è¡Œæ­¤æ–¹æ³•'</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> exc_type<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> exc_val<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span><span class="token keyword">with</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è¿›å…¥withè¯­å¥å—'</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># withè¯­å¥ä¸­ä»£ç å—å‡ºç°å¼‚å¸¸ï¼Œåˆ™withåçš„ä»£ç éƒ½æ— æ³•æ‰§è¡Œã€‚</span>    <span class="token comment" spellcheck="true"># raise AttributeError('sb')</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#fæ‰“å°å‡ºoo</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'å˜¿å˜¿å˜¿'</span><span class="token punctuation">)</span></code></pre><h2 id="åä¸‰ã€-len"><a href="#åä¸‰ã€-len" class="headerlink" title="åä¸‰ã€__len__"></a>åä¸‰ã€<code>__len__</code></h2><p>æ‹¥æœ‰__len__æ–¹æ³•çš„å¯¹è±¡æ”¯æŒlen(obj)æ“ä½œã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span>        self<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">2</span>    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> len<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="åå››ã€-hash"><a href="#åå››ã€-hash" class="headerlink" title="åå››ã€__hash__"></a>åå››ã€<code>__hash__</code></h2><p>æ‹¥æœ‰__hash__æ–¹æ³•çš„å¯¹è±¡æ”¯æŒhash(obj)æ“ä½œã€‚</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span>        self<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">2</span>    <span class="token keyword">def</span> <span class="token function">__hash__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> hash<span class="token punctuation">(</span>str<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>hash<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="åäº”ã€-eq"><a href="#åäº”ã€-eq" class="headerlink" title="åäº”ã€__eq__"></a>åäº”ã€<code>__eq__</code></h2><p>æ‹¥æœ‰__eq__æ–¹æ³•çš„å¯¹è±¡æ”¯æŒç›¸ç­‰çš„æ¯”è¾ƒæ“ä½œ</p><pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x        self<span class="token punctuation">.</span>y <span class="token operator">=</span> y    <span class="token keyword">def</span> <span class="token function">__eq__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>obj<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true"># æ‰“å°å‡ºæ¯”è¾ƒçš„ç¬¬äºŒä¸ªå¯¹è±¡çš„xå€¼</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>x<span class="token punctuation">)</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span>self<span class="token punctuation">.</span>y <span class="token operator">==</span> obj<span class="token punctuation">.</span>x<span class="token operator">+</span>obj<span class="token punctuation">.</span>y<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">True</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>b <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸€ã€-str&quot;&gt;&lt;a href=&quot;#ä¸€ã€-str&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€__str__&quot;&gt;&lt;/a&gt;ä¸€ã€&lt;code&gt;__str__&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;æ”¹å˜å¯¹è±¡çš„å­—ç¬¦ä¸²æ˜¾ç¤ºï¼Œå¯ä»¥ç†è§£ä¸ºprintæ‰“å°å¯¹è±¡çš„æ˜¾ç¤º&lt;/p&gt;
&lt;p</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="é¢è¯•" scheme="http://huang_zhao.gitee.io/task/tags/%E9%9D%A2%E8%AF%95/"/>
    
    <category term="pythoné¢å‘å¯¹è±¡" scheme="http://huang_zhao.gitee.io/task/tags/python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/"/>
    
  </entry>
  
  <entry>
    <title>GoåŸºç¡€è¯­æ³•</title>
    <link href="http://huang_zhao.gitee.io/task/2020/01/10/Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/"/>
    <id>http://huang_zhao.gitee.io/task/2020/01/10/Go%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/</id>
    <published>2020-01-10T11:58:57.000Z</published>
    <updated>2020-09-10T11:59:02.688Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-åŒ…ç®¡ç†"><a href="#1-åŒ…ç®¡ç†" class="headerlink" title="1 åŒ…ç®¡ç†"></a>1 åŒ…ç®¡ç†</h3><h4 id="1-1-è‡ªå®šä¹‰åŒ…çš„è§„åˆ™"><a href="#1-1-è‡ªå®šä¹‰åŒ…çš„è§„åˆ™" class="headerlink" title="1.1 è‡ªå®šä¹‰åŒ…çš„è§„åˆ™"></a>1.1 è‡ªå®šä¹‰åŒ…çš„è§„åˆ™</h4><ul><li>goè¯­è¨€ä»£ç å¿…é¡»æ”¾åœ¨gopathçš„stcè·¯å¾„ä¸‹</li><li>åŒ…å¯¼å…¥æ˜¯ä»gopathçš„srcè·¯å¾„ä¸‹å¼€å§‹æ£€ç´¢</li><li>é™¤äº†mianåŒ…ï¼Œå…¶ä»–åŒ…åå»ºè®®éƒ½å«æ‰€åœ¨æ–‡ä»¶å¤¹å</li><li>åŒä¸€ä¸ªåŒ…ä¸‹ï¼Œå˜é‡ï¼Œå‡½æ•°åªèƒ½å®šä¹‰ä¸€æ¬¡</li><li>åŒä¸€ä¸ªåŒ…ä¸‹å˜é‡å‡½æ•°å¯ä»¥ç›´æ¥ä½¿ç”¨</li><li><strong>åŒ…å†…çš„å‡½æ•°å’Œå˜é‡ï¼Œæƒ³è®©å¤–éƒ¨åŒ…ä½¿ç”¨ï¼Œå¿…é¡»é¦–å­—æ¯å¤§å†™</strong></li></ul><p><strong>æ‰©å±•</strong></p><p>åŒ…å†…çš„ç‰¹æ®Šå‡½æ•° init</p><ul><li>ä¸éœ€è¦è°ƒç”¨å°±ä¼šæ‰§è¡Œï¼Œå¯ä»¥è®¾ç½®å¤šä¸ª</li></ul><p>goè¯­è¨€æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„åŒ…ç®¡ç†çš„åœ°å€ï¼Œéƒ½æ”¾åœ¨githubä¸Š</p><h4 id="1-2-åŒ…å¯¼å…¥çš„å‡ ç§æ–¹å¼"><a href="#1-2-åŒ…å¯¼å…¥çš„å‡ ç§æ–¹å¼" class="headerlink" title="1.2 åŒ…å¯¼å…¥çš„å‡ ç§æ–¹å¼"></a>1.2 åŒ…å¯¼å…¥çš„å‡ ç§æ–¹å¼</h4><pre class=" language-go"><code class="language-go"><span class="token operator">-</span><span class="token keyword">import</span> <span class="token string">"day02/mypackage"</span>    <span class="token operator">-</span>ç»™åŒ…é‡å‘½å        <span class="token operator">-</span><span class="token keyword">import</span> åå­— <span class="token string">"day02/mypackage"</span>        åå­—<span class="token punctuation">.</span>å˜é‡<span class="token operator">/</span>å‡½æ•°    <span class="token operator">-</span>åŒ…åªå¯¼å…¥ï¼Œä¸ä½¿ç”¨    <span class="token keyword">import</span> <span class="token boolean">_</span> <span class="token string">"day02/mypackage"</span></code></pre><h4 id="1-3-go-modeæ¨¡å¼"><a href="#1-3-go-modeæ¨¡å¼" class="headerlink" title="1.3 go modeæ¨¡å¼"></a>1.3 go modeæ¨¡å¼</h4><pre class=" language-go"><code class="language-go"><span class="token operator">-</span>ä¸¤ç§åˆ›å»ºæ–¹å¼    <span class="token number">1</span>        <span class="token operator">-</span>å‘½ä»¤è¡Œä¸‹è¾“å…¥ï¼š<span class="token keyword">go</span> mod init é¡¹ç›®å   åœ¨å½“å‰è·¯å¾„ä¸‹åˆ›å»ºå‡º<span class="token keyword">go</span><span class="token punctuation">.</span><span class="token function">mod</span><span class="token punctuation">(</span>è¯¥é¡¹ç›®ä¾èµ–<span class="token keyword">go</span>çš„ç‰ˆæœ¬ï¼Œç¬¬ä¸‰æ–¹åŒ…ç‰ˆæœ¬<span class="token punctuation">)</span>        <span class="token operator">-</span>é¡¹ç›®è·¯å¾„çš„cmdçª—å£ï¼Œ<span class="token keyword">go</span> get ç¬¬ä¸‰æ–¹åŒ…ï¼Œå°±ä¼šåœ¨<span class="token keyword">go</span><span class="token punctuation">.</span>modä¸­åŠ å…¥ä¾èµ–        <span class="token operator">-</span>ä»¥åæŠŠé¡¹ç›®<span class="token builtin">copy</span>ç»™åˆ«äººï¼Œ<span class="token keyword">go</span> install        <span class="token operator">-</span>è‡ªå·±å†™çš„åŒ…ï¼Œå°±æ”¾åœ¨è‡ªå·±é¡¹ç›®è·¯å¾„ä¸‹        <span class="token operator">-</span>åŠ ä»£ç†çš„æ–¹å¼ï¼šæ‰‹åŠ¨å†™ï¼Œgolandä¸­é…ç½®    <span class="token number">2</span>       <span class="token operator">-</span>åœ¨golandä¸­åˆ›å»ºé¡¹ç›®æ—¶ï¼Œç›´æ¥æŒ‡å®šmodulesï¼Œå¯ä»¥é…ç½®ç¯å¢ƒå˜é‡ï¼ˆåŠ ä»£ç†ï¼‰ä»£ç†è®¾ç½®ï¼šGOPROXY<span class="token operator">=</span>https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>goproxy<span class="token punctuation">.</span>cn<span class="token punctuation">,</span>directä¸‹è½½ä¸€ä¸ªåŒ…æµ‹è¯•ä¸€ä¸‹ï¼š<span class="token keyword">go</span> get <span class="token operator">-</span>u github<span class="token punctuation">.</span>com<span class="token operator">/</span>astaxie<span class="token operator">/</span>beegoä¸‹è½½å®Œæˆåä¼šè‡ªåŠ¨åœ¨modæ–‡ä»¶å†…å†™å…¥ä¾èµ–</code></pre><h3 id="2-if-else"><a href="#2-if-else" class="headerlink" title="2 if-else"></a>2 if-else</h3><pre class=" language-go"><code class="language-go"><span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">14</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token function">changeAge</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> age<span class="token operator">>=</span><span class="token number">15</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"gt15"</span><span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">else</span> <span class="token keyword">if</span> age<span class="token operator">&lt;=</span><span class="token number">14</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"lte15"</span><span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">else</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"éƒ½ä¸æ˜¯"</span><span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">func</span> <span class="token function">changeAge</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    age <span class="token operator">=</span> <span class="token number">19</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><h3 id="3-å¾ªç¯"><a href="#3-å¾ªç¯" class="headerlink" title="3 å¾ªç¯"></a>3 å¾ªç¯</h3><p>åªæœ‰ä¸€ç§å¾ªç¯for</p><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// åŸºæœ¬å¾ªç¯</span><span class="token comment" spellcheck="true">//for i:=0;i&lt;10;i++&amp;#123;</span><span class="token comment" spellcheck="true">//    fmt.Println(i)</span><span class="token comment" spellcheck="true">//&amp;#125;</span><span class="token comment" spellcheck="true">// çœç•¥ä¸­é—´</span><span class="token comment" spellcheck="true">//for i:=0;;i++&amp;#123;</span><span class="token comment" spellcheck="true">//    fmt.Println(i)</span><span class="token comment" spellcheck="true">//&amp;#125;</span><span class="token comment" spellcheck="true">// çœç•¥å¤´</span><span class="token comment" spellcheck="true">//i:=0</span><span class="token comment" spellcheck="true">//for ;;i++&amp;#123;</span><span class="token comment" spellcheck="true">//    fmt.Println(i)</span><span class="token comment" spellcheck="true">//&amp;#125;</span><span class="token comment" spellcheck="true">// çœç•¥å¤´å’Œå°¾ ï¼ˆwhileï¼‰</span><span class="token comment" spellcheck="true">//i:=2</span><span class="token comment" spellcheck="true">//for i>1&amp;#123;</span><span class="token comment" spellcheck="true">//    fmt.Println(i)</span><span class="token comment" spellcheck="true">//    i++</span><span class="token comment" spellcheck="true">//&amp;#125;</span></code></pre><h3 id="4-switch"><a href="#4-switch" class="headerlink" title="4 switch"></a>4 switch</h3><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// åŸºæœ¬ä½¿ç”¨</span><span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">15</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">switch</span> age <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">15</span><span class="token punctuation">:</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"15"</span><span class="token punctuation">)</span>    <span class="token keyword">case</span> <span class="token number">16</span><span class="token punctuation">:</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"16"</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// é»˜è®¤å€¼ï¼Œåªè¦ä¸Šé¢æ²¡æœ‰åŒ¹é…å°±ä¼šèµ°è¿™ä¸ª</span>    <span class="token keyword">default</span><span class="token punctuation">:</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// å¤šæ¡ä»¶è¡¨è¾¾å¼</span><span class="token keyword">switch</span> age <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">:</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>    <span class="token keyword">case</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">:</span>           fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span>    <span class="token keyword">case</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">:</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// æ— è¡¨è¾¾å¼çš„ switch</span>num<span class="token operator">:=</span><span class="token number">12</span>num2<span class="token operator">:=</span><span class="token number">55</span><span class="token keyword">switch</span>  <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// æ¡ä»¶å…³ç³»ä¸ºor</span>    <span class="token keyword">case</span> num<span class="token operator">+</span>num2<span class="token operator">></span><span class="token number">100</span><span class="token punctuation">,</span>num<span class="token operator">==</span><span class="token number">13</span><span class="token punctuation">:</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token keyword">case</span> num<span class="token operator">+</span>num2<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">,</span>num2<span class="token operator">==</span><span class="token number">13</span><span class="token punctuation">:</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// Fallthrough</span>age<span class="token operator">:=</span><span class="token number">11</span><span class="token keyword">switch</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> age<span class="token operator">></span><span class="token number">1</span><span class="token punctuation">:</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">fallthrough</span>    <span class="token keyword">case</span> age<span class="token operator">></span><span class="token number">2</span><span class="token punctuation">:</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token keyword">fallthrough</span> <span class="token comment" spellcheck="true">// åªè¦å­˜åœ¨fallthroughå°±ä¼šæ— æ¡ä»¶æ‰§è¡Œä¸‹ä¸€æ¡</span>    <span class="token keyword">case</span> age<span class="token operator">==</span><span class="token number">12</span><span class="token punctuation">:</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><h3 id="5-æ•°ç»„"><a href="#5-æ•°ç»„" class="headerlink" title="5 æ•°ç»„"></a>5 æ•°ç»„</h3><p>æ•°ç»„ï¼šæ•°ç»„æ˜¯åŒä¸€ç±»å…ƒç´ çš„é›†åˆï¼Œå¯ä»¥æ”¾å¤šä¸ªå€¼ï¼Œä½†æ˜¯ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œåœ¨å†…å­˜ä¸­è¿ç»­å­˜å‚¨</p><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// 1 å®šä¹‰æ•°ç»„</span><span class="token keyword">var</span> name  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">string</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token operator">--</span> ä¸€ä¸ªé•¿åº¦ä¸º<span class="token number">3</span>çš„ç©ºæ•°ç»„<span class="token comment" spellcheck="true">// 2 ç»™æ•°ç»„ä¸­çš„å…ƒç´ èµ‹å€¼</span>name<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"hz"</span>name<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"hz"</span>name<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"hz"</span><span class="token comment" spellcheck="true">// 3 å®šä¹‰å¹¶åˆå§‹åŒ–</span><span class="token keyword">var</span> name <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token string">"hz"</span><span class="token punctuation">,</span><span class="token string">"lxt"</span><span class="token punctuation">,</span><span class="token string">"fl"</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// å¯ä»¥å†™å…¨ä¹Ÿå¯ä»¥ç©ºå‡ ä¸ªæˆ–è€…å…¨ç©º</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 4 æ•°ç»„ç‰¹æ®Šåˆå§‹åŒ–</span><span class="token comment" spellcheck="true">// æ•°ç»„çš„é•¿åº¦æ ¹æ®&amp;#123;&amp;#125;ç»™çš„é•¿åº¦å†³å®š</span>name <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token string">"1"</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 5 æ•°ç»„æ˜¯å€¼ä¼ é€’</span><span class="token comment" spellcheck="true">// æ‰€ä»¥åœ¨goä¸­æ•°ç»„ä½œä¸ºå‚æ•°ä¼ ç»™å‡½æ•°ï¼Œå°±æ˜¯copyäº†ä¸€ä¸ªæ–°çš„æ•°ç»„åœ¨å‡½æ•°ä¸­æ“ä½œ</span><span class="token comment" spellcheck="true">// å€¼ä¼ é€’ä¸ä¼šå½±å“åŸå€¼</span>name <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token function">change</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token operator">--</span><span class="token operator">-</span> ä¸¤æ¬¡éƒ½æ˜¯<span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token keyword">func</span> <span class="token function">change</span><span class="token punctuation">(</span>name <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>  <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    name<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 6 æ•°ç»„é•¿åº¦</span>name <span class="token operator">:=</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token function">len</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 3,æ•°ç»„çš„é•¿åº¦åœ¨æ•°ç»„å®šä¹‰çš„æ—¶å€™å°±å†³å®šå¥½äº†</span><span class="token comment" spellcheck="true">// 7 æ•°ç»„å¾ªç¯</span><span class="token comment" spellcheck="true">// æ™®é€šå¾ªç¯</span>name<span class="token operator">:=</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">for</span> i<span class="token operator">:=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token function">len</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// rangeå¾ªç¯</span>name<span class="token operator">:=</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">for</span> i<span class="token operator">:=</span><span class="token keyword">range</span> name<span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ‰“å°çš„æ˜¯ç´¢å¼•</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// è¡¥å……</span><span class="token keyword">for</span> i<span class="token punctuation">,</span>value<span class="token operator">:=</span><span class="token keyword">range</span> a<span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//æŠŠæ•°ç»„å¾ªç¯æ‰“å°å‡ºæ¥</span><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span>value<span class="token operator">:=</span><span class="token keyword">range</span> a<span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 8 å¤šç»´æ•°ç»„</span><span class="token keyword">var</span> name <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">int</span>name<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">55</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">55</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token comment" spellcheck="true">// å¤šç»´æ•°ç»„å¾ªç¯</span><span class="token keyword">var</span> name <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token builtin">int</span>name<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">55</span>name<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">66</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token keyword">for</span> x<span class="token punctuation">,</span>y <span class="token operator">:=</span> <span class="token keyword">range</span> name<span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// ç´¢å¼•</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ¯ä¸ªæ•°ç»„</span>    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span>num <span class="token operator">:=</span><span class="token keyword">range</span> y<span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ•°ç»„ä¸­çš„å…ƒç´ </span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 9 æ•°ç»„åˆå§‹åŒ–ã®æŒ‡å®šä½ç½®åˆå§‹åŒ–</span><span class="token keyword">var</span> name <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span></code></pre><h3 id="6-åˆ‡ç‰‡"><a href="#6-åˆ‡ç‰‡" class="headerlink" title="6 åˆ‡ç‰‡"></a>6 åˆ‡ç‰‡</h3><p>åˆ‡ç‰‡æ˜¯ç”±æ•°ç»„å»ºç«‹çš„ä¸€ç§æ–¹ä¾¿ï¼Œçµæ´»ï¼Œæœ‰å¼ºå¤§åŒ…è£…èƒ½åŠ›çš„ç±»å‹</p><p>åˆ‡ç‰‡æœ¬èº«ä¸æ‹¥æœ‰ä»»ä½•æ•°æ®ç±»å‹ï¼Œå®ƒåªæ˜¯å¯¹æ•°ç»„çš„å¼•ç”¨</p><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// åˆ‡ç‰‡çš„å®šä¹‰æ–¹å¼</span><span class="token keyword">var</span> a <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">var</span> b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>b<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%T"</span><span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æŸ¥çœ‹bçš„ç±»å‹ []int</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>   <span class="token comment" spellcheck="true">// [0,1,2,3,4,5,6,7,8,9]</span><span class="token comment" spellcheck="true">// ä¿®æ”¹åˆ‡ç‰‡ï¼Œæ•°ç»„ä¼šè·Ÿç€å˜</span>b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">99</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// ä¿®æ”¹æ•°ç»„ï¼Œåˆ‡ç‰‡ä¼šè·Ÿç€å˜</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">99</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// åªåˆ‡æ•°ç»„çš„ä¸€éƒ¨åˆ†çš„æƒ…å†µ</span><span class="token keyword">var</span> a <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">var</span> b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>b<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">// åˆ‡ç‰‡é¡¾å¤´ä¸é¡¾å°¾ [2,3,4]</span>b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [12,3,4]</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [0,1,12,3,4,5,6,7,8,9] æ ¹æ®åˆ‡çš„åœ°æ–¹ä¿®æ”¹</span><span class="token comment" spellcheck="true">// å¤šä¸ªåˆ‡ç‰‡åˆ‡äº†åŒä¸€å—æ•°ç»„çš„å€¼æ”¹å˜æƒ…å†µ</span><span class="token comment" spellcheck="true">// è¿™é‡Œå¯ä»¥æ·±åˆ»ç†è§£åˆ‡ç‰‡åªæ˜¯æ•°ç»„çš„ä¸€æ®µå¼•ç”¨</span><span class="token keyword">var</span> a <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">var</span> b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token keyword">var</span> c <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>b<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span> c<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span>b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [12,3,4]</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [0,1,12,3,4,5,6,7,8,9]</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// [12,3,4,5]</span><span class="token comment" spellcheck="true">// æŸ¥çœ‹åˆ‡ç‰‡çš„é•¿åº¦å’Œå®¹é‡</span><span class="token keyword">var</span> a <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">var</span> b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>b<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//3</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">cap</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//8 ç†è§£ï¼šä»ç´¢å¼•ä¸º2çš„ä½ç½®åˆ°æ•°ç»„çš„æœ€åå°±æ˜¯8</span><span class="token comment" spellcheck="true">// åˆ‡ç‰‡è¿½åŠ </span><span class="token keyword">var</span> a <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">var</span> b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>b<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span> b<span class="token operator">=</span><span class="token function">append</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// è¿½åŠ båï¼Œä¼šä¿®æ”¹åŸæ•°ç»„ä¸­å¯¹åº”çš„ä½ç½®çš„å€¼</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// é•¿åº¦å¢åŠ äº†ï¼Œæœ€åä¸€ä¸ªä½ç½®ä¸º100</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">cap</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">// è¿½åŠ è¶…å‡ºåˆ‡ç‰‡å®¹é‡</span><span class="token keyword">var</span> a <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">var</span> b <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>b<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span> b<span class="token operator">=</span><span class="token function">append</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// æ­¤æ—¶åˆ‡ç‰‡çš„è¿½åŠ ç´¢å¼•å·²ç»è¶…å‡ºäº†æ•°ç»„çš„æœ€å¤§ç´¢å¼•ï¼Œæ‰€ä»¥ä¸ä¼šæ”¹</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 9</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">cap</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// 16 åœ¨åŸæ¥çš„åŸºç¡€ä¸Šç¿»äº†ä¸€å€</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;1-åŒ…ç®¡ç†&quot;&gt;&lt;a href=&quot;#1-åŒ…ç®¡ç†&quot; class=&quot;headerlink&quot; title=&quot;1 åŒ…ç®¡ç†&quot;&gt;&lt;/a&gt;1 åŒ…ç®¡ç†&lt;/h3&gt;&lt;h4 id=&quot;1-1-è‡ªå®šä¹‰åŒ…çš„è§„åˆ™&quot;&gt;&lt;a href=&quot;#1-1-è‡ªå®šä¹‰åŒ…çš„è§„åˆ™&quot; class=&quot;headerlink</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="go" scheme="http://huang_zhao.gitee.io/task/tags/go/"/>
    
    <category term="åŸºç¡€" scheme="http://huang_zhao.gitee.io/task/tags/%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>Goè¯­è¨€åŸºç¡€</title>
    <link href="http://huang_zhao.gitee.io/task/2020/01/09/GO%E5%85%A5%E9%97%A8/"/>
    <id>http://huang_zhao.gitee.io/task/2020/01/09/GO%E5%85%A5%E9%97%A8/</id>
    <published>2020-01-09T11:17:57.000Z</published>
    <updated>2020-09-09T11:17:15.400Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€è¯­è¨€ä»‹ç»"><a href="#ä¸€ã€è¯­è¨€ä»‹ç»" class="headerlink" title="ä¸€ã€è¯­è¨€ä»‹ç»"></a>ä¸€ã€è¯­è¨€ä»‹ç»</h3><h4 id="1-ç®€ä»‹"><a href="#1-ç®€ä»‹" class="headerlink" title="1 ç®€ä»‹"></a>1 ç®€ä»‹</h4><p>Go å³Golangï¼Œæ˜¯Googleå…¬å¸2009å¹´11æœˆæ­£å¼å¯¹å¤–å…¬å¼€çš„ä¸€é—¨ç¼–ç¨‹è¯­è¨€ã€‚</p><p>Goæ˜¯é™æ€å¼ºç±»å‹è¯­è¨€ï¼Œæ˜¯åŒºåˆ«äºè§£æå‹è¯­è¨€çš„ç¼–è¯‘å‹è¯­è¨€(é™æ€ï¼šç±»å‹å›ºå®š å¼ºç±»å‹ï¼šä¸åŒç±»å‹ä¸å…è®¸ç›´æ¥è¿ç®—)ã€‚</p><h4 id="2-ç‰¹æ€§"><a href="#2-ç‰¹æ€§" class="headerlink" title="2 ç‰¹æ€§"></a>2 ç‰¹æ€§</h4><p>è·¨å¹³å°çš„ç¼–è¯‘å‹è¯­è¨€</p><p>è¯­æ³•æ¥è¿‘Cè¯­è¨€</p><p>ç®¡é“ï¼ˆchannelï¼‰ï¼Œåˆ‡ç‰‡ï¼ˆsliceï¼‰ï¼Œå¹¶å‘ï¼ˆroutineï¼‰</p><p>æœ‰åƒåœ¾å›æ”¶çš„æœºåˆ¶</p><p>æ”¯æŒé¢å‘å¯¹è±¡ï¼ˆä½†æ˜¯goä¸­æ²¡æœ‰ç±»çš„æ¦‚å¿µï¼‰å’Œé¢å‘è¿‡ç¨‹çš„ç¼–ç¨‹æ¨¡å¼</p><h4 id="3-ç‰ˆæœ¬"><a href="#3-ç‰ˆæœ¬" class="headerlink" title="3 ç‰ˆæœ¬"></a>3 ç‰ˆæœ¬</h4><ul><li>2009å¹´11æœˆ7æ—¥ weekly.2009-11-06 â€”â€” æ—©æœŸçš„ç‰ˆæœ¬</li><li>2018å¹´8æœˆ24æ—¥ go1.11 â€”â€” moduleså’ŒWebAssemblyæ”¯æŒã€‚</li><li>2020 å¹´ 8 æœˆ go 1.15</li></ul><h4 id="4-ä¸‹è½½"><a href="#4-ä¸‹è½½" class="headerlink" title="4 ä¸‹è½½"></a>4 ä¸‹è½½</h4><p>å¼€å‘ç¯å¢ƒæ­å»ºï¼š<a href="https://golang.google.cn/dl/%E3%80%82">https://golang.google.cn/dl/ã€‚</a></p><p>ä¸€è·¯ä¸‹ä¸€æ­¥ï¼Œé»˜è®¤ä¼šæ·»åŠ åˆ°ç¯å¢ƒå˜é‡</p><p>cmdçª—å£è¾“å…¥<code>go version</code>åˆ¤æ–­æ˜¯å¦å®‰è£…å®Œæˆ</p><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// å¸¸ç”¨å‘½ä»¤</span><span class="token keyword">go</span> env <span class="token comment" spellcheck="true">// goçš„ç¯å¢ƒå˜é‡</span><span class="token keyword">go</span> build <span class="token comment" spellcheck="true">// ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶</span><span class="token keyword">go</span> run <span class="token comment" spellcheck="true">// ç¼–è¯‘å¹¶æ‰§è¡Œ</span></code></pre><p>ideä¸‹è½½ï¼š<a href="https://www.jetbrains.com/go/download/#section=mac">https://www.jetbrains.com/go/download/#section=mac</a></p><p>ä¸€è·¯ä¸‹ä¸€æ­¥ï¼Œè¯•ç”¨30å¤©ï¼Œå†æ‰“å¼€ä¸€ä¸ªçª—å£æŠŠjaråŒ…æ‹–å…¥ï¼Œé‡å¯è½¯ä»¶åè¾“å…¥éªŒè¯ç å³å¯æ°¸ä¹…è¯•ç”¨</p><p>åˆ›å»ºé¡¹ç›®åä¼šé»˜è®¤æŠŠgoçš„æ‰€æœ‰é¡¹ç›®éƒ½æ”¾åˆ°ç”¨æˆ·å®¶ç›®å½•ä¸‹çš„goæ–‡ä»¶å¤¹ä¸‹ï¼Œè¦è¿è¡Œçš„é¡¹ç›®<strong>å¿…é¡»</strong>åœ¨è¿™é‡Œï¼Œä¸ç„¶æ— æ³•æ‰§è¡Œ</p><h4 id="5-hello-world"><a href="#5-hello-world" class="headerlink" title="5 hello world"></a>5 hello world</h4><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// ç¼–è¯‘å‹è¯­è¨€çš„ç‰¹æ€§ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªå…¥å£ï¼Œä¸€ä¸ªè¿è¡Œç¨‹åºåªèƒ½æœ‰ä¸€ä¸ªå…¥å£main</span><span class="token keyword">package</span> main<span class="token comment" spellcheck="true">// æ‰“å°å‡½æ•°åœ¨fmtåŒ…ä¸‹</span><span class="token keyword">import</span> <span class="token string">"fmt"</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"hello word"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// è‡ªå¸¦æ¢è¡Œå’Œpythonçš„ä¸€æ ·</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><h3 id="äºŒã€å˜é‡"><a href="#äºŒã€å˜é‡" class="headerlink" title="äºŒã€å˜é‡"></a>äºŒã€å˜é‡</h3><p>æ³¨æ„ç‚¹ï¼š</p><ul><li>å˜é‡å®šä¹‰äº†å°±å¿…é¡»ä½¿ç”¨ï¼Œå¦åˆ™æŠ¥é”™</li><li>å˜é‡ç±»å‹åœ¨å®šä¹‰é˜¶æ®µå°±å†³å®šäº†ï¼Œæ— æ³•æ”¹å˜</li><li>å˜é‡æ¨èç”¨é©¼å³°ä½“ï¼Œæ–‡ä»¶åæ¨èç”¨ä¸‹åˆ’çº¿åˆ†éš”</li></ul><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// å˜é‡çš„ä¸‰ç§å®šä¹‰æ–¹å¼</span><span class="token comment" spellcheck="true">// 1 å…¨å®šä¹‰</span><span class="token comment" spellcheck="true">// var å˜é‡å ç±»å‹ = å€¼</span><span class="token comment" spellcheck="true">//var a int = 123</span><span class="token comment" spellcheck="true">//fmt.Println(a)</span><span class="token comment" spellcheck="true">// 2 ç±»å‹æ¨å¯¼å¼</span><span class="token comment" spellcheck="true">// å’Œä¸Šé¢çš„åŒºåˆ«å°±æ˜¯ä¸ç”¨å†™ç±»å‹</span><span class="token comment" spellcheck="true">//var a = 123</span><span class="token comment" spellcheck="true">//fmt.Println(a)</span><span class="token comment" spellcheck="true">// 3 ç®€ç•¥å‹</span><span class="token comment" spellcheck="true">// å˜é‡å := å€¼</span>a <span class="token operator">:=</span> <span class="token number">123</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token comment" spellcheck="true">// 4 å£°æ˜å¤šä¸ªå˜é‡</span>a<span class="token punctuation">,</span>b<span class="token operator">:=</span><span class="token number">123</span><span class="token punctuation">,</span><span class="token number">456</span><span class="token comment" spellcheck="true">// 5 æŒ‰é»˜è®¤å€¼å®šä¹‰</span><span class="token keyword">var</span> age <span class="token builtin">int</span> <span class="token comment" spellcheck="true">// intç±»å‹é»˜è®¤å€¼ä¸º0ï¼Œstringé»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²</span><span class="token comment" spellcheck="true">// å‘</span><span class="token comment" spellcheck="true">// åŸæ¥åœ¨goä¸­ï¼Œå˜é‡ä¸èƒ½é‡å¤å®šä¹‰ï¼Œä½†æ˜¯åœ¨å¤šä¸ªåŒæ—¶èµ‹å€¼æ—¶ï¼Œå·¦è¾¹åªè¦æœ‰ä¸€ä¸ªæ˜¯æœªå®šä¹‰çš„ï¼Œå°±å¯ä»¥è¿™æ ·ä½¿ç”¨</span>a<span class="token operator">:=</span><span class="token number">123</span>a<span class="token punctuation">,</span>b<span class="token operator">:=</span><span class="token number">789</span><span class="token punctuation">,</span><span class="token number">444</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span></code></pre><h3 id="ä¸‰ã€ç±»å‹"><a href="#ä¸‰ã€ç±»å‹" class="headerlink" title="ä¸‰ã€ç±»å‹"></a>ä¸‰ã€ç±»å‹</h3><pre class=" language-go"><code class="language-go">åŸºç¡€æ•°æ®ç±»å‹        æ•°å­—ï¼š            æœ‰ç¬¦å·æ•´å½¢                <span class="token operator">-</span><span class="token builtin">int</span>ï¼šåœ¨<span class="token number">32</span>ä½æœºå™¨æ˜¯<span class="token builtin">int32</span>ï¼Œåœ¨<span class="token number">64</span>ä½æœºå™¨æ˜¯<span class="token builtin">int64</span>                <span class="token operator">-</span><span class="token builtin">int8</span>ï¼šè¡¨ç¤ºæ•´æ•°èŒƒå›´æ˜¯ï¼š<span class="token number">8</span>ä¸ªæ¯”ç‰¹ä½ï¼Œ<span class="token number">8</span>ä¸ªbitæ˜¯1byte ï¼Œè´Ÿæ•°å’Œ<span class="token number">0</span>ï¼Œ <span class="token number">2</span>çš„<span class="token number">7</span>æ¬¡æ–¹<span class="token operator">-</span><span class="token number">1</span> çš„èŒƒå›´                <span class="token operator">-</span><span class="token builtin">int16</span> <span class="token number">2</span>çš„<span class="token number">15</span>æ¬¡æ–¹å‡ä¸€                <span class="token operator">-</span><span class="token builtin">int32</span>                <span class="token operator">-</span><span class="token builtin">int64</span>            æ— ç¬¦å·æ•´å‹                <span class="token operator">-</span><span class="token builtin">uint8</span>   <span class="token number">2</span>çš„<span class="token number">8</span>æ¬¡æ–¹å‡ä¸€  å®šä¹‰ä¸€ä¸ªäººçš„å¹´é¾„                <span class="token operator">-</span><span class="token builtin">uint16</span>                <span class="token operator">-</span><span class="token builtin">uint32</span>                <span class="token operator">-</span><span class="token builtin">uint64</span>            æµ®ç‚¹å‹ï¼ˆå°æ•°ï¼‰ï¼Œè¡¨ç¤ºå°æ•°ç‚¹åé•¿åº¦å¤šå°‘ä½                <span class="token operator">-</span><span class="token builtin">float32</span>                <span class="token operator">-</span><span class="token builtin">float64</span>            å¤æ•°                <span class="token operator">-</span><span class="token builtin">complex64</span>                <span class="token operator">-</span><span class="token builtin">complex128</span>            <span class="token builtin">byte</span>ï¼šæ˜¯<span class="token builtin">int8</span>çš„åˆ«å  å•å¼•å·åŒ…è£¹            <span class="token builtin">rune</span>ï¼šæ˜¯<span class="token builtin">int32</span>çš„åˆ«å  å•å¼•å·åŒ…è£¹        å­—ç¬¦ä¸²            åŒå¼•å·åŒ…è£¹            åå¼•å·åŒ…è£¹  <span class="token string">` `</span> å¯ä»¥æ¢è¡Œ        å¸ƒå°”            <span class="token builtin">bool</span> <span class="token boolean">true</span> å’Œ <span class="token boolean">false</span>        æ•°æ®ç±»å‹é»˜è®¤å€¼ï¼š            æ•°å­—ç±»å‹æ˜¯<span class="token number">0</span>            å­—ç¬¦ä¸²ç±»å‹æ˜¯ ç©ºå­—ç¬¦ä¸²            å¸ƒå°”ç±»å‹   <span class="token boolean">false</span></code></pre><h3 id="å››ã€å¸¸é‡"><a href="#å››ã€å¸¸é‡" class="headerlink" title="å››ã€å¸¸é‡"></a>å››ã€å¸¸é‡</h3><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// åªæœ‰ä¸¤ç§å®šä¹‰æ–¹å¼ï¼Œä¸”ä¸èƒ½ä¿®æ”¹</span><span class="token comment" spellcheck="true">// 1 </span><span class="token keyword">const</span> å¸¸é‡å å¸¸é‡ç±»å‹ <span class="token operator">=</span> å¸¸é‡å€¼<span class="token comment" spellcheck="true">// 2</span><span class="token keyword">const</span> å¸¸é‡å <span class="token operator">=</span> å¸¸é‡å€¼<span class="token comment" spellcheck="true">// 3 æ‰©å±•</span><span class="token keyword">const</span> name<span class="token punctuation">,</span>age <span class="token operator">=</span> <span class="token string">"hz"</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token keyword">const</span> <span class="token punctuation">(</span>    name <span class="token operator">=</span> <span class="token string">"hz"</span>    age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">(</span>    s1 <span class="token operator">=</span><span class="token boolean">iota</span> <span class="token comment" spellcheck="true">// ä»0è‡ªå¢  0</span>    s2 <span class="token operator">=</span><span class="token boolean">iota</span> <span class="token comment" spellcheck="true">// 1</span>    s3  <span class="token comment" spellcheck="true">// 2</span>    s4 <span class="token operator">=</span><span class="token number">99</span>    s5 <span class="token operator">=</span><span class="token boolean">iota</span> <span class="token comment" spellcheck="true">// 4</span><span class="token punctuation">)</span></code></pre><h3 id="äº”ã€å‡½æ•°"><a href="#äº”ã€å‡½æ•°" class="headerlink" title="äº”ã€å‡½æ•°"></a>äº”ã€å‡½æ•°</h3><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// æœ‰å‚ï¼Œæœ‰è¿”å›å€¼å‡½æ•°çš„è°ƒç”¨ä¸å®šä¹‰</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    msg<span class="token punctuation">,</span>s <span class="token operator">:=</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// å¤šä¸ªåŒç±»å‹å‚æ•°å¯ä»¥çœç•¥ç±»å‹ï¼Œå¦‚æœæœ‰è¿”å›å€¼å°±å¿…é¡»å®šä¹‰æ—¶ä¹¦å†™è¿”å›å€¼ç±»å‹ï¼Œè€Œä¸”å†™äº†å°±å¿…é¡»ä¸€ä¸€å¯¹åº”è¿”å›</span><span class="token keyword">func</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">)</span>  <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token string">"åŠ æ³•"</span><span class="token punctuation">,</span>a<span class="token operator">+</span>b<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// åŒ¿åå‡½æ•°</span><span class="token comment" spellcheck="true">// åœ¨goä¸­å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œå¯ä»¥æŠŠå‡½æ•°çš„å†…å­˜åœ°å€ä¼ ç»™å˜é‡</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    a <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"æˆ‘æ˜¯åŒ¿åå‡½æ•°"</span><span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// è¦éµå¾ªå˜é‡è¢«å®šä¹‰å°±å¿…é¡»ä½¿ç”¨çš„åŸåˆ™</span>    <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// å‡½æ•°çš„å‚æ•°æ˜¯å‡½æ•°ï¼Œå‡½æ•°çš„è¿”å›å€¼ä¹Ÿæ˜¯å‡½æ•°</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    add <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> a<span class="token operator">+</span>b    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>    newAdd <span class="token operator">:=</span> <span class="token function">niuBiDeFunc</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span>    msg <span class="token operator">:=</span> <span class="token function">newAdd</span><span class="token punctuation">(</span><span class="token string">"ä½ å¥½"</span><span class="token punctuation">,</span><span class="token string">"å¸…"</span><span class="token punctuation">)</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">func</span> <span class="token function">niuBiDeFunc</span><span class="token punctuation">(</span>add <span class="token keyword">func</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span>  <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    msg <span class="token operator">:=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"æˆ‘æ˜¯"</span><span class="token punctuation">,</span><span class="token string">"hz"</span><span class="token punctuation">)</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>    <span class="token keyword">return</span> add<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// é—­åŒ…å‡½æ•° 1 å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨ 2 å¯¹å¤–éƒ¨ä½œç”¨åŸŸæœ‰å¼•ç”¨</span><span class="token keyword">func</span> <span class="token function">test</span><span class="token punctuation">(</span>age <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    a<span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>    <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> a<span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><h3 id="å…­ã€å˜é‡ä½œç”¨åŸŸå’ŒèŒƒå›´"><a href="#å…­ã€å˜é‡ä½œç”¨åŸŸå’ŒèŒƒå›´" class="headerlink" title="å…­ã€å˜é‡ä½œç”¨åŸŸå’ŒèŒƒå›´"></a>å…­ã€å˜é‡ä½œç”¨åŸŸå’ŒèŒƒå›´</h3><pre class=" language-go"><code class="language-go"><span class="token comment" spellcheck="true">// å®šä¹‰åœ¨å…¨å±€çš„å˜é‡</span><span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">// æ‹¿åˆ°çš„æ˜¯å…¨å±€çš„ï¼Œæ”¹çš„ä¹Ÿæ˜¯å…¨å±€çš„</span>    age <span class="token operator">=</span> <span class="token number">19</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>    <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">func</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>    age <span class="token operator">=</span> <span class="token number">20</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// å®šä¹‰åœ¨å…¨å±€å’Œå±€éƒ¨çš„å˜é‡</span><span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// åœ¨mainå‡½æ•°åç§°ç©ºé—´å†…ç”¨çš„æ˜¯è‡ªå·±çš„age</span>    age <span class="token operator">:=</span> <span class="token number">0</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>    age <span class="token operator">=</span> <span class="token number">19</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>    <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token keyword">func</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>    age <span class="token operator">=</span> <span class="token number">20</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span></code></pre><h5 id="è¡¥å……è‡ªå·±å‘ç°çš„å°ç‚¹"><a href="#è¡¥å……è‡ªå·±å‘ç°çš„å°ç‚¹" class="headerlink" title="è¡¥å……è‡ªå·±å‘ç°çš„å°ç‚¹"></a>è¡¥å……è‡ªå·±å‘ç°çš„å°ç‚¹</h5><p>goè¯­è¨€åœ¨æœ€å¤–å±‚åŒçº§åˆ«ä¸‹åªèƒ½å­˜åœ¨å…³é”®å­—</p><pre class=" language-go"><code class="language-go"><span class="token keyword">package</span> main<span class="token keyword">import</span> <span class="token string">"fmt"</span><span class="token comment" spellcheck="true">// æŠ¥é”™</span>hz <span class="token operator">:=</span> <span class="token number">123</span><span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;ä¸€ã€è¯­è¨€ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä¸€ã€è¯­è¨€ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€è¯­è¨€ä»‹ç»&quot;&gt;&lt;/a&gt;ä¸€ã€è¯­è¨€ä»‹ç»&lt;/h3&gt;&lt;h4 id=&quot;1-ç®€ä»‹&quot;&gt;&lt;a href=&quot;#1-ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;1</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="http://huang_zhao.gitee.io/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="go" scheme="http://huang_zhao.gitee.io/task/tags/go/"/>
    
    <category term="åŸºç¡€" scheme="http://huang_zhao.gitee.io/task/tags/%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
</feed>
