<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="爱肖彤真是太好了"><meta name="copyright" content="爱肖彤真是太好了"><meta name="generator" content="Hexo 5.1.1"><meta name="theme" content="hexo-theme-yun"><title>Redis持久化，主从，哨兵，集群 | 工藤旧二の博客</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="none" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.19/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_stqaphw3j4.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link rel="shortcut icon" type="image/svg+xml" href="/task/yun.ico"><link rel="mask-icon" href="/task/yun.ico" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/task/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/task/js/utils.js" as="script"><link rel="preload" href="/task/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/task/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/task/css/hexo-theme-yun.css"><link rel="alternate" href="/task/atom.xml" title="工藤旧二の博客" type="application/atom+xml"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"root":"/task/","title":"工藤旧二の博客","version":"0.9.7","anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/task/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><meta name="description" content="一、持久化持久化表示把数据存储到硬盘的过程 持久化的两种方式  快照：某事某刻数据库的完整备份 redis的RDB 写日志：任何操作都记录下来，要恢复数据就重新走一遍流程即可 redis的AOF  1 RDBRDB的三种触发机制 &#39;&#39;&#39; save(同步) 1 客户端执行save命令----》redis服务端----》同步创建RDB二进制文件 2 会造成redis的阻塞（数据量非常大的时候） 3 文">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis持久化，主从，哨兵，集群">
<meta property="og:url" content="http://huang_zhao.gitee.io/task/2020/04/21/Redis%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%8C%E4%B8%BB%E4%BB%8E%EF%BC%8C%E5%93%A8%E5%85%B5%EF%BC%8C%E9%9B%86%E7%BE%A4/index.html">
<meta property="og:site_name" content="工藤旧二の博客">
<meta property="og:description" content="一、持久化持久化表示把数据存储到硬盘的过程 持久化的两种方式  快照：某事某刻数据库的完整备份 redis的RDB 写日志：任何操作都记录下来，要恢复数据就重新走一遍流程即可 redis的AOF  1 RDBRDB的三种触发机制 &#39;&#39;&#39; save(同步) 1 客户端执行save命令----》redis服务端----》同步创建RDB二进制文件 2 会造成redis的阻塞（数据量非常大的时候） 3 文">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-04-21T06:10:11.000Z">
<meta property="article:modified_time" content="2020-09-13T14:51:53.738Z">
<meta property="article:author" content="爱肖彤真是太好了">
<meta property="article:tag" content="Redis高级">
<meta property="article:tag" content="数据库">
<meta name="twitter:card" content="summary"><script src="/task/js/ui/mode.js"></script><link rel="stylesheet" href="/task/css/prism.css" type="text/css"></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script defer src="/task/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/task/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/task/about/" title="爱肖彤真是太好了"><img width="96" loading="lazy" src="/task/Yun.png" alt="爱肖彤真是太好了"></a><div class="site-author-name"><a href="/task/about/">爱肖彤真是太好了</a></div><a class="site-name" href="/task/about/site.html">工藤旧二の博客</a><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/task/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/task/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">40</span></a></div><div class="site-state-item"><a href="/task/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">2</span></a></div><div class="site-state-item"><a href="/task/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">38</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="微博" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="豆瓣" target="_blank" style="color:#007722"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-douban-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=552858287" title="网易云音乐" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="知乎" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/15081363" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="Telegram Channel" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-send-plane-2-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/task/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">一、持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-RDB"><span class="toc-text">1 RDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-AOF"><span class="toc-text">2 AOF</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-AOF%E9%87%8D%E5%86%99"><span class="toc-text">3.1 AOF重写</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-text">二、主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%BE%85%E5%8A%A9%E9%85%8D%E7%BD%AE"><span class="toc-text">1 辅助配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE"><span class="toc-text">2 复制配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-slave%E5%91%BD%E4%BB%A4"><span class="toc-text">2.1 slave命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">2.2 配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%A4%8D%E5%88%B6%E5%B8%B8%E8%A7%81%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">2.3 复制常见的问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81redis-Sentinel%EF%BC%88%E5%93%A8%E5%85%B5%EF%BC%89"><span class="toc-text">三、redis-Sentinel（哨兵）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="toc-text">1 安装配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%93%BE%E6%8E%A5"><span class="toc-text">2 客户端链接</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://huang_zhao.gitee.io/task/task/2020/04/21/Redis%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%8C%E4%B8%BB%E4%BB%8E%EF%BC%8C%E5%93%A8%E5%85%B5%EF%BC%8C%E9%9B%86%E7%BE%A4/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="爱肖彤真是太好了"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="工藤旧二の博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Redis持久化，主从，哨兵，集群</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2020-04-21 14:10:11" itemprop="dateCreated datePublished" datetime="2020-04-21T14:10:11+08:00">2020-04-21</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="修改时间：2020-09-13 22:51:53" itemprop="dateModified" datetime="2020-09-13T22:51:53+08:00">2020-09-13</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-file-word-line"></use></svg></span> <span title="本文字数">3.1k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-timer-line"></use></svg></span> <span title="阅读时长">12m</span></span></span><div class="post-classify"><span class="post-category"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/task/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">技术分享</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/task/tags/Redis%E9%AB%98%E7%BA%A7/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Redis高级</span></a><a class="tag" href="/task/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">数据库</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h2 id="一、持久化"><a href="#一、持久化" class="headerlink" title="一、持久化"></a>一、持久化</h2><p>持久化表示把数据存储到硬盘的过程</p>
<p>持久化的两种方式</p>
<ul>
<li>快照：某事某刻数据库的完整备份 redis的RDB</li>
<li>写日志：任何操作都记录下来，要恢复数据就重新走一遍流程即可 redis的AOF</li>
</ul>
<h3 id="1-RDB"><a href="#1-RDB" class="headerlink" title="1 RDB"></a>1 RDB</h3><p>RDB的三种触发机制</p>
<pre class=" language-python"><code class="language-python"><span class="token triple-quoted-string string">'''
save(同步)
1 客户端执行save命令----》redis服务端----》同步创建RDB二进制文件
2 会造成redis的阻塞（数据量非常大的时候）
3 文件策略：如果老的RDB存在，会替换老的
4 复杂度 o(n)
'''</span>

<span class="token triple-quoted-string string">'''
bgsave(异步，Backgroud saving started)

1 客户端执行save命令----》redis服务端----》异步创建RDB二进制文件（fork函数生成一个子进程（fork会阻塞reids），执行createRDB，执行成功，返回给reids消息）
2 此时访问redis，会正常响应客户端
3 文件策略：跟save相同，如果老的RDB存在，会替换老的
4 复杂度 o(n)
'''</span>

<span class="token triple-quoted-string string">'''
自动（通过配置）
配置   seconds   changes
save   900        1
save   300        10
save   60         10000
如果60s中改变了1w条数据，自动生成rdb
如果300s中改变了10条数据，自动生成rdb
如果900s中改变了1条数据，自动生成rdb

以上三条符合任意一条，就自动生成rdb，内部使用bgsave
'''</span>

<span class="token comment" spellcheck="true">#配置：</span>
save <span class="token number">900</span> <span class="token number">1</span> <span class="token comment" spellcheck="true">#配置一条</span>
save <span class="token number">300</span> <span class="token number">10</span> <span class="token comment" spellcheck="true">#配置一条</span>
save <span class="token number">60</span> <span class="token number">10000</span> <span class="token comment" spellcheck="true">#配置一条</span>
dbfilename dump<span class="token punctuation">.</span>rdb  <span class="token comment" spellcheck="true">#rdb文件的名字，默认为dump.rdb</span>
dir <span class="token punctuation">.</span><span class="token operator">/</span> <span class="token comment" spellcheck="true">#rdb文件存在当前目录</span>

stop<span class="token operator">-</span>writes<span class="token operator">-</span>on<span class="token operator">-</span>bgsave<span class="token operator">-</span>error yes <span class="token comment" spellcheck="true">#如果bgsave出现错误，是否停止写入，默认为yes</span>
rdbcompression yes <span class="token comment" spellcheck="true">#采用压缩格式</span>
rdbchecksum yes <span class="token comment" spellcheck="true">#是否对rdb文件进行校验和检验</span>

<span class="token comment" spellcheck="true">#最佳配置</span>
save <span class="token number">900</span> <span class="token number">1</span> 
save <span class="token number">300</span> <span class="token number">10</span> 
save <span class="token number">60</span> <span class="token number">10000</span> 
dbfilename dump<span class="token operator">-</span>$<span class="token punctuation">{</span>port<span class="token punctuation">}</span><span class="token punctuation">.</span>rdb  <span class="token comment" spellcheck="true">#以端口号作为文件名，可能一台机器上很多reids，不会乱</span>
dir <span class="token operator">/</span>bigdiskpath <span class="token comment" spellcheck="true">#保存路径放到一个大硬盘位置目录</span>
stop<span class="token operator">-</span>writes<span class="token operator">-</span>on<span class="token operator">-</span>bgsave<span class="token operator">-</span>error yes <span class="token comment" spellcheck="true">#出现错误停止</span>
rdbcompression yes <span class="token comment" spellcheck="true">#压缩</span>
rdbchecksum yes <span class="token comment" spellcheck="true">#校验</span></code></pre>
<p><strong>触发机制</strong></p>
<pre><code>1 全量复制 #没有执行save和bgsave没有添加rdb策略，还会生成rdb文件，如果开启主从复制，主会自动生成rdb
2 debug reload #debug级别的重启，不会将内存中的数据清空
3 shutdown save#关闭会出发rdb的生成</code></pre>
<p><strong>存在的问题</strong>：耗时，耗性能，不可控，数据可能会丢失</p>
<h3 id="2-AOF"><a href="#2-AOF" class="headerlink" title="2 AOF"></a>2 AOF</h3><p>原理：客户端每写入一条命令就会记录一条日志，放到日志文件中，如果出现宕机完全可以恢复</p>
<p><strong>AOF三种保存策略</strong></p>
<p>日志不是直接写到硬盘上，而是先放在缓冲区，缓冲区根据一些策略，写到硬盘上</p>
<ul>
<li><p>always：redis–》写命令刷新的缓冲区—》每条命令fsync到硬盘—》AOF文件</p>
</li>
<li><p>everysec（默认值）：redis——》写命令刷新的缓冲区—》每秒把缓冲区fsync到硬盘–》AOF文件</p>
</li>
<li><p>no:redis——》写命令刷新的缓冲区—》操作系统决定，缓冲区fsync到硬盘–》AOF文件</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>命令</th>
<th>always</th>
<th>everysec</th>
<th>no</th>
</tr>
</thead>
<tbody><tr>
<td>优点</td>
<td>不丢失数据</td>
<td>每秒一次fsync，丢失1秒数据</td>
<td>不用管</td>
</tr>
<tr>
<td>缺点</td>
<td>IO开销大，一般的sata盘只有几百TPS</td>
<td>丢1秒数据</td>
<td>不可控</td>
</tr>
</tbody></table>
<h4 id="3-1-AOF重写"><a href="#3-1-AOF重写" class="headerlink" title="3.1 AOF重写"></a>3.1 AOF重写</h4><p>是aof中的一个模式，日志文件越堆越多就会存在很多没用的命令</p>
<p>比如给hello赋值了10次，实际上只有第10次有意义，所以前面9次都可以删掉，或者是rpush a，rpush b ，rpush c，可以写成rpush a，b，c</p>
<p>本质就是把过期的，无用的，重复的，可以优化的命令，来优化</p>
<p>这样可以减少磁盘占用量，加速恢复速度</p>
<p><strong>实现方式</strong></p>
<p>bgrewriteaof：</p>
<p>客户端向服务端发送bgrewriteaof命令，服务端会起一个fork进程，完成AOF重写</p>
<p><strong>配置方式</strong></p>
<pre class=" language-python"><code class="language-python">appendonly yes <span class="token comment" spellcheck="true">#将该选项设置为yes，打开</span>
appendfilename <span class="token string">"appendonly-${port}.aof"</span> <span class="token comment" spellcheck="true">#文件保存的名字</span>
appendfsync everysec <span class="token comment" spellcheck="true">#采用第二种策略</span>
dir <span class="token operator">/</span>bigdiskpath <span class="token comment" spellcheck="true">#存放的路径</span>
no<span class="token operator">-</span>appendfsync<span class="token operator">-</span>on<span class="token operator">-</span>rewrite yes <span class="token comment" spellcheck="true">#在aof重写的时候，是否要做aof的append操作，因为aof重写消耗性能，磁盘消耗，正常aof写磁盘有一定的冲突，这段期间的数据，允许丢失</span></code></pre>
<h2 id="二、主从复制"><a href="#二、主从复制" class="headerlink" title="二、主从复制"></a>二、主从复制</h2><p>QPS达到瓶颈就可以做主从复制</p>
<ul>
<li><p>一主一从或者一主多从</p>
</li>
<li><p>做读写分离，数据副本</p>
</li>
<li><p>扩展操作数据的新能</p>
</li>
<li><p>一个master（主）可以有多个slave（从）</p>
</li>
<li><p>一个从智能属于一个主</p>
</li>
<li><p>数据流向是单向的，从主到从</p>
</li>
</ul>
<p><strong>原理</strong></p>
<pre><code>1 从库通过 slaveof ip 端口连接主库，并发送一个SYNC请求给主库

2 主库接受到SYNC，会立即出发bgsave（持久化），后台保存RDB，发送给从库

3 从库接收到RDB文件会执行（就是把数据读出来）

4 此时主从复制就能正常工作了，主库会将新的操作以命令的形式陆续发给从库

5 所有的复制信息都可以从info中查到

6 如果发生主从关系断开时,从库数据没有任何损坏,在下次重连之后,从库发送PSYNC给主库
7 主库只会将从库缺失部分的数据同步给从库应用,达到快速恢复主从的目的</code></pre>
<h3 id="1-辅助配置"><a href="#1-辅助配置" class="headerlink" title="1 辅助配置"></a>1 辅助配置</h3><pre class=" language-python"><code class="language-python">min<span class="token operator">-</span>slaves<span class="token operator">-</span>to<span class="token operator">-</span>write <span class="token number">1</span>
min<span class="token operator">-</span>slaves<span class="token operator">-</span>max<span class="token operator">-</span>lag <span class="token number">3</span>
<span class="token comment" spellcheck="true">#那么在从服务器的数量少于1个，或者三个从服务器的延迟（lag）值都大于或等于3秒时，主服务器将拒绝执行写命令</span></code></pre>
<h3 id="2-复制配置"><a href="#2-复制配置" class="headerlink" title="2 复制配置"></a>2 复制配置</h3><h4 id="2-1-slave命令"><a href="#2-1-slave命令" class="headerlink" title="2.1 slave命令"></a>2.1 slave命令</h4><pre class=" language-python"><code class="language-python"><span class="token number">6380</span>是从，<span class="token number">6379</span>是主

在<span class="token number">6380</span>上执行（去从库配置，配置主库）

slaveof <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span> <span class="token number">6379</span> <span class="token comment" spellcheck="true">#异步</span>
slaveof no one <span class="token comment" spellcheck="true">#取消复制，不会把之前的数据清除</span></code></pre>
<h4 id="2-2-配置文件"><a href="#2-2-配置文件" class="headerlink" title="2.2 配置文件"></a>2.2 配置文件</h4><pre class=" language-python"><code class="language-python">slaveof ip port <span class="token comment" spellcheck="true">#配置从节点ip和端口</span>
slave<span class="token operator">-</span>read<span class="token operator">-</span>only yes <span class="token comment" spellcheck="true">#从节点只读，因为可读可写，数据会乱</span>

<span class="token triple-quoted-string string">'''
mkdir -p redis1/conf redis1/data redis2/conf redis2/data redis3/conf redis3/data
vim redis.conf

daemonize no
pidfile redis.pid
bind 0.0.0.0
protected-mode no
port 6379
timeout 0
logfile redis.log
dbfilename dump.rdb
dir /data
slaveof 10.0.0.101 6379
slave-read-only yes


cp redis.conf /home/redis2/conf/


docker run -p 6379:6379 --name redis_6379 -v /home/redis1/conf/redis.conf:/etc/redis/redis.conf -v /home/redis1/data:/data -d redis redis-server /etc/redis/redis.conf

docker run -p 6378:6379 --name redis_6378 -v /home/redis2/conf/redis.conf:/etc/redis/redis.conf -v /home/redis2/data:/data -d redis redis-server /etc/redis/redis.conf

docker run -p 6377:6379 --name redis_6377 -v /home/redis3/conf/redis.conf:/etc/redis/redis.conf -v /home/redis3/data:/data -d redis redis-server /etc/redis/redis.conf

info replication

'''</span></code></pre>
<h4 id="2-3-复制常见的问题"><a href="#2-3-复制常见的问题" class="headerlink" title="2.3 复制常见的问题"></a>2.3 复制常见的问题</h4><pre class=" language-python"><code class="language-python"><span class="token number">1</span> 读写分离

读流量分摊到从节点

可能遇到问题：复制数据延迟，读到过期数据，从节点故障

<span class="token number">2</span> 主从配置不一致

maxmemory不一致：丢失数据

数据结构优化参数：主节点做了优化，从节点没有设置优化，会出现一些问题

<span class="token number">3</span> 规避全量复制

第一次全量复制，不可避免：小主节点，低峰<span class="token punctuation">(</span>夜间<span class="token punctuation">)</span>

节点运行id不匹配：主节点重启<span class="token punctuation">(</span>运行id变化<span class="token punctuation">)</span>

复制挤压缓冲区不足：增大复制缓冲区大小，rel_backlog_size

<span class="token number">4</span> 规避复制风暴

单主节点复制风暴，主节点重启，所有从节点复制</code></pre>
<h2 id="三、redis-Sentinel（哨兵）"><a href="#三、redis-Sentinel（哨兵）" class="headerlink" title="三、redis-Sentinel（哨兵）"></a>三、redis-Sentinel（哨兵）</h2><p>哨兵就是为了实现主从复制的高可用</p>
<pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#主从复制存在的问题：</span>
<span class="token comment" spellcheck="true">#1 主从复制，主节点发生故障，需要做故障转移，可以手动转移：让其中一个slave变成master</span>
<span class="token comment" spellcheck="true">#2 主从复制，只能主写数据，所以写能力和存储能力有限</span></code></pre>
<p><strong>架构说明</strong></p>
<p>1 多个sentinel发现并确认master有问题</p>
<p>2 选举触一个sentinel作为领导</p>
<p>3 选取一个slave作为新的master</p>
<p>4 通知其余slave成为新的master的slave</p>
<p>5 通知客户端主从变化</p>
<p>6 等待老的master复活成为新master的slave</p>
<h3 id="1-安装配置"><a href="#1-安装配置" class="headerlink" title="1 安装配置"></a>1 安装配置</h3><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#配置开启sentinel监控主节点</span>
mkdir <span class="token operator">-</span>p redis4<span class="token operator">/</span>conf redis4<span class="token operator">/</span>data redis5<span class="token operator">/</span>conf redis5<span class="token operator">/</span>data redis6<span class="token operator">/</span>data redis6<span class="token operator">/</span>conf

vi sentinel<span class="token punctuation">.</span>conf


port <span class="token number">26379</span>
daemonize yes
dir data
protected<span class="token operator">-</span>mode no
bind <span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">0.0</span>
logfile <span class="token string">"redis_sentinel.log"</span>
sentinel monitor mymaster <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span> <span class="token number">6379</span> <span class="token number">2</span>
sentinel down<span class="token operator">-</span>after<span class="token operator">-</span>milliseconds mymaster <span class="token number">30000</span>
sentinel parallel<span class="token operator">-</span>syncs mymaster <span class="token number">1</span>
sentinel failover<span class="token operator">-</span>timeout mymaster <span class="token number">180000</span>


docker run <span class="token operator">-</span>p <span class="token number">26379</span><span class="token punctuation">:</span><span class="token number">26379</span> <span class="token operator">-</span><span class="token operator">-</span>name redis_26379 <span class="token operator">-</span>v <span class="token operator">/</span>home<span class="token operator">/</span>redis4<span class="token operator">/</span>conf<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf<span class="token punctuation">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf <span class="token operator">-</span>v <span class="token operator">/</span>home<span class="token operator">/</span>redis4<span class="token operator">/</span>data<span class="token punctuation">:</span><span class="token operator">/</span>data <span class="token operator">-</span>d redis redis<span class="token operator">-</span>sentinel <span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf

docker run <span class="token operator">-</span>p <span class="token number">26378</span><span class="token punctuation">:</span><span class="token number">26379</span> <span class="token operator">-</span><span class="token operator">-</span>name redis_26378 <span class="token operator">-</span>v <span class="token operator">/</span>home<span class="token operator">/</span>redis5<span class="token operator">/</span>conf<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf<span class="token punctuation">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf <span class="token operator">-</span>v <span class="token operator">/</span>home<span class="token operator">/</span>redis5<span class="token operator">/</span>data<span class="token punctuation">:</span><span class="token operator">/</span>data <span class="token operator">-</span>d redis redis<span class="token operator">-</span>sentinel <span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf

docker run <span class="token operator">-</span>p <span class="token number">26377</span><span class="token punctuation">:</span><span class="token number">26379</span> <span class="token operator">-</span><span class="token operator">-</span>name redis_26377 <span class="token operator">-</span>v <span class="token operator">/</span>home<span class="token operator">/</span>redis6<span class="token operator">/</span>conf<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf<span class="token punctuation">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf <span class="token operator">-</span>v <span class="token operator">/</span>home<span class="token operator">/</span>redis6<span class="token operator">/</span>data<span class="token punctuation">:</span><span class="token operator">/</span>data <span class="token operator">-</span>d redis redis<span class="token operator">-</span>sentinel <span class="token operator">/</span>etc<span class="token operator">/</span>redis<span class="token operator">/</span>sentinel<span class="token punctuation">.</span>conf



redis<span class="token operator">-</span>sentinel sentinel<span class="token punctuation">.</span>conf

info
配置会重写，自动发现slave</code></pre>
<pre class=" language-python"><code class="language-python">sentinel monitor mymaster <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span> <span class="token number">6379</span> <span class="token number">2</span>
sentinel down<span class="token operator">-</span>after<span class="token operator">-</span>milliseconds mymaster <span class="token number">30000</span>
sentinel parallel<span class="token operator">-</span>syncs mymaster <span class="token number">1</span>
sentinel failover<span class="token operator">-</span>timeout mymaster <span class="token number">180000</span>
sentinel monitor <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>ip<span class="token operator">></span> <span class="token operator">&lt;</span>redis<span class="token operator">-</span>port<span class="token operator">></span> <span class="token operator">&lt;</span>quorum<span class="token operator">></span>
告诉sentinel去监听地址为ip<span class="token punctuation">:</span>port的一个master，这里的master<span class="token operator">-</span>name可以自定义，quorum是一个数字，指明当有多少个sentinel认为一个master失效时，master才算真正失效

sentinel auth<span class="token operator">-</span><span class="token keyword">pass</span> <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>password<span class="token operator">></span>
设置连接master和slave时的密码，注意的是sentinel不能分别为master和slave设置不同的密码，因此master和slave的密码应该设置相同。

sentinel down<span class="token operator">-</span>after<span class="token operator">-</span>milliseconds <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>milliseconds<span class="token operator">></span> 
这个配置项指定了需要多少失效时间，一个master才会被这个sentinel主观地认为是不可用的。 单位是毫秒，默认为<span class="token number">30</span>秒

sentinel parallel<span class="token operator">-</span>syncs <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>numslaves<span class="token operator">></span> 
这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，这个数字越小，完成failover所需的时间就越长，但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。可以通过将这个值设为 <span class="token number">1</span> 来保证每次只有一个slave 处于不能处理命令请求的状态。

sentinel failover<span class="token operator">-</span>timeout <span class="token operator">&lt;</span>master<span class="token operator">-</span>name<span class="token operator">></span> <span class="token operator">&lt;</span>milliseconds<span class="token operator">></span>
failover<span class="token operator">-</span>timeout 可以用在以下这些方面：     
<span class="token number">1</span><span class="token punctuation">.</span> 同一个sentinel对同一个master两次failover之间的间隔时间。   
<span class="token number">2</span><span class="token punctuation">.</span> 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。    
<span class="token number">3</span><span class="token punctuation">.</span>当想要取消一个正在进行的failover所需要的时间。    
<span class="token number">4</span><span class="token punctuation">.</span>当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel<span class="token operator">-</span>syncs所配置的规则来了。</code></pre>
<pre class=" language-python"><code class="language-python"><span class="token number">1</span> 搭一个一主两从
<span class="token comment" spellcheck="true">#创建三个配置文件：</span>
<span class="token comment" spellcheck="true">#第一个是主配置文件</span>
daemonize yes
pidfile <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>redis<span class="token punctuation">.</span>pid
port <span class="token number">6379</span>
dir <span class="token string">"/opt/soft/redis/data"</span>
logfile “<span class="token number">6379.</span>log”

<span class="token comment" spellcheck="true">#第二个是从配置文件</span>
daemonize yes
pidfile <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>redis2<span class="token punctuation">.</span>pid
port <span class="token number">6378</span>
dir <span class="token string">"/opt/soft/redis/data2"</span>
logfile “<span class="token number">6378.</span>log”
slaveof <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span> <span class="token number">6379</span>
slave<span class="token operator">-</span>read<span class="token operator">-</span>only yes
<span class="token comment" spellcheck="true">#第三个是从配置文件</span>
daemonize yes
pidfile <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>redis3<span class="token punctuation">.</span>pid
port <span class="token number">6377</span>
dir <span class="token string">"/opt/soft/redis/data3"</span>
logfile “<span class="token number">6377.</span>log”
slaveof <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span> <span class="token number">6379</span>
slave<span class="token operator">-</span>read<span class="token operator">-</span>only yes


<span class="token comment" spellcheck="true">#把三个redis服务都启动起来</span>
<span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>redis<span class="token operator">-</span>server redis_6379<span class="token punctuation">.</span>conf
<span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>redis<span class="token operator">-</span>server redis_6378<span class="token punctuation">.</span>conf
<span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>redis<span class="token operator">-</span>server redis_6377<span class="token punctuation">.</span>conf


<span class="token number">2</span> 搭建哨兵
<span class="token comment" spellcheck="true"># sentinel.conf这个文件</span>
<span class="token comment" spellcheck="true"># 把哨兵也当成一个redis服务器</span>
创建三个配置文件分别叫sentinel_26379<span class="token punctuation">.</span>conf sentinel_26378<span class="token punctuation">.</span>conf  sentinel_26377<span class="token punctuation">.</span>conf

<span class="token comment" spellcheck="true"># 当前路径下创建 data1 data2 data3 个文件夹</span>
<span class="token comment" spellcheck="true">#内容如下(需要修改端口，文件地址日志文件名字)</span>
port <span class="token number">26379</span>
daemonize yes
dir <span class="token punctuation">.</span><span class="token operator">/</span>data3
protected<span class="token operator">-</span>mode no
bind <span class="token number">0.0</span><span class="token punctuation">.</span><span class="token number">0.0</span>
logfile <span class="token string">"redis_sentinel3.log"</span>
sentinel monitor mymaster <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span> <span class="token number">6379</span> <span class="token number">2</span>
sentinel down<span class="token operator">-</span>after<span class="token operator">-</span>milliseconds mymaster <span class="token number">30000</span>
sentinel parallel<span class="token operator">-</span>syncs mymaster <span class="token number">1</span>
sentinel failover<span class="token operator">-</span>timeout mymaster <span class="token number">180000</span>


<span class="token comment" spellcheck="true">#启动三个哨兵</span>
<span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>redis<span class="token operator">-</span>sentinel sentinel_26379<span class="token punctuation">.</span>conf
<span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>redis<span class="token operator">-</span>sentinel sentinel_26378<span class="token punctuation">.</span>conf
<span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>redis<span class="token operator">-</span>sentinel sentinel_26377<span class="token punctuation">.</span>conf



<span class="token comment" spellcheck="true"># 登陆哨兵</span>
<span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>redis<span class="token operator">-</span>cli <span class="token operator">-</span>p <span class="token number">26377</span>
<span class="token comment" spellcheck="true"># 输入 info</span>

<span class="token comment" spellcheck="true"># 查看哨兵的配置文件被修改了，自动生成的</span>

<span class="token comment" spellcheck="true"># 主动停掉主redis 6379，哨兵会自动选择一个从库作为主库</span>
redis<span class="token operator">-</span>cli <span class="token operator">-</span>p <span class="token number">6379</span>
shutdown
<span class="token comment" spellcheck="true">#等待原来的主库启动，该主库会变成从库</span></code></pre>
<h3 id="2-客户端链接"><a href="#2-客户端链接" class="headerlink" title="2 客户端链接"></a>2 客户端链接</h3><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> redis
<span class="token keyword">from</span> redis<span class="token punctuation">.</span>sentinel <span class="token keyword">import</span> Sentinel

<span class="token comment" spellcheck="true"># 连接哨兵服务器(主机名也可以用域名)</span>
<span class="token comment" spellcheck="true"># 10.0.0.101:26379</span>
sentinel <span class="token operator">=</span> Sentinel<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'10.0.0.101'</span><span class="token punctuation">,</span> <span class="token number">26379</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                     <span class="token punctuation">(</span><span class="token string">'10.0.0.101'</span><span class="token punctuation">,</span> <span class="token number">26378</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                     <span class="token punctuation">(</span><span class="token string">'10.0.0.101'</span><span class="token punctuation">,</span> <span class="token number">26377</span><span class="token punctuation">)</span>
             <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    socket_timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>sentinel<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取主服务器地址</span>
master <span class="token operator">=</span> sentinel<span class="token punctuation">.</span>discover_master<span class="token punctuation">(</span><span class="token string">'mymaster'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>master<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 获取从服务器地址</span>
slave <span class="token operator">=</span> sentinel<span class="token punctuation">.</span>discover_slaves<span class="token punctuation">(</span><span class="token string">'mymaster'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>slave<span class="token punctuation">)</span>



<span class="token comment" spellcheck="true">##### 读写分离</span>
<span class="token comment" spellcheck="true"># 获取主服务器进行写入</span>
<span class="token comment" spellcheck="true"># master = sentinel.master_for('mymaster', socket_timeout=0.5)</span>
<span class="token comment" spellcheck="true"># w_ret = master.set('foo', 'bar')</span>

<span class="token comment" spellcheck="true"># slave = sentinel.slave_for('mymaster', socket_timeout=0.5)</span>
<span class="token comment" spellcheck="true"># r_ret = slave.get('foo')</span>
<span class="token comment" spellcheck="true"># print(r_ret)</span></code></pre>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">点我就给你看点有意思的</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://gitee.com/huang_zhao/hz/raw/master/hz/alipay.png"><img loading="lazy" src="https://gitee.com/huang_zhao/hz/raw/master/hz/alipay.png" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://gitee.com/huang_zhao/hz/raw/master/hz/qqpay.jpg"><img loading="lazy" src="https://gitee.com/huang_zhao/hz/raw/master/hz/qqpay.jpg" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://gitee.com/huang_zhao/hz/raw/master/hz/wxpay.jpg"><img loading="lazy" src="https://gitee.com/huang_zhao/hz/raw/master/hz/wxpay.jpg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>爱肖彤真是太好了</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="http://huang_zhao.gitee.io/task/2020/04/21/Redis%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%8C%E4%B8%BB%E4%BB%8E%EF%BC%8C%E5%93%A8%E5%85%B5%EF%BC%8C%E9%9B%86%E7%BE%A4/" title="Redis持久化，主从，哨兵，集群">http://huang_zhao.gitee.io/task/2020/04/21/Redis%E6%8C%81%E4%B9%85%E5%8C%96%EF%BC%8C%E4%B8%BB%E4%BB%8E%EF%BC%8C%E5%93%A8%E5%85%B5%EF%BC%8C%E9%9B%86%E7%BE%A4/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/task/2020/04/21/BeautifulSoup%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8/" rel="prev" title="BeautifulSoup模块的使用"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">BeautifulSoup模块的使用</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/task/2020/03/24/Rabbitmq%EF%BC%8CRpc/" rel="next" title="Rabbitmq、Rpc"><span class="post-nav-text">Rabbitmq、Rpc</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> 爱肖彤真是太好了</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v5.1.1</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v0.9.7</span></div><div class="live_time"><span>本博客已萌萌哒地运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  window.setTimeout(blog_live_time, 1000);
  const start = new Date('2019-04-12T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/task/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div id="local-search-result"></div></div></div><script defer src="/task/js/utils.js"></script><script defer src="/task/js/hexo-theme-yun.js"></script></body></html>